2025-04-08 20:46:14,046 - app - INFO - Starting application...
2025-04-08 20:46:14,046 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:46:14,046 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:46:14,046 - __main__ - INFO - Setting webhook at: https://f925-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:46:14,683 - __main__ - INFO - Application started successfully
2025-04-08 20:46:14,683 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:46:17,317 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:46:17,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,330 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:46:17,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,332 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:46:17,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1043270764,)
2025-04-08 20:46:17,335 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:17,461 - aiogram.event - INFO - Update id=311268079 is handled. Duration 298 ms by bot id=7041366449
2025-04-08 20:46:20,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:20,709 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 20:46:20,710 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ()
2025-04-08 20:46:20,714 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:20,853 - aiogram.event - INFO - Update id=311268080 is handled. Duration 242 ms by bot id=7041366449
2025-04-08 20:46:23,228 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:23,229 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 20:46:23,229 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ('Дом и интерьер',)
2025-04-08 20:46:23,231 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:23,333 - aiogram.event - INFO - Update id=311268081 is handled. Duration 215 ms by bot id=7041366449
2025-04-08 20:46:24,819 - aiogram.event - INFO - Update id=311268082 is handled. Duration 199 ms by bot id=7041366449
2025-04-08 20:46:27,733 - aiogram.event - INFO - Update id=311268083 is handled. Duration 249 ms by bot id=7041366449
2025-04-08 20:46:31,306 - aiogram.event - INFO - Update id=311268084 is handled. Duration 300 ms by bot id=7041366449
2025-04-08 20:46:32,918 - aiogram.event - INFO - Update id=311268085 is handled. Duration 209 ms by bot id=7041366449
2025-04-08 20:46:37,549 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:46:37,549 - app - INFO - Является частью группы: True
2025-04-08 20:46:37,549 - app - INFO - Добавлено фото в группу 13953075179074098, всего фото в группе: 1
2025-04-08 20:46:37,906 - root - INFO - File saved: 2025/04/08/fbe29191496a4b8d95ee06d7fb7f8c0e.jpg
2025-04-08 20:46:37,906 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 20:46:38,407 - app - INFO - Ожидаем другие фото из группы 13953075179074098
2025-04-08 20:46:38,408 - aiogram.event - INFO - Update id=311268086 is handled. Duration 869 ms by bot id=7041366449
2025-04-08 20:46:38,666 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 20:46:38,666 - app - INFO - Является частью группы: True
2025-04-08 20:46:38,667 - app - INFO - Добавлено фото в группу 13953075179074098, всего фото в группе: 2
2025-04-08 20:46:39,042 - root - INFO - File saved: 2025/04/08/73e65ab3fb2c4635821d65a27568d4cc.jpg
2025-04-08 20:46:39,043 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 20:46:39,544 - app - INFO - Ожидаем другие фото из группы 13953075179074098
2025-04-08 20:46:39,545 - aiogram.event - INFO - Update id=311268087 is handled. Duration 889 ms by bot id=7041366449
2025-04-08 20:47:24,892 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:47:24,892 - app - INFO - Является частью группы: False
2025-04-08 20:47:25,394 - root - INFO - File saved: 2025/04/08/0307c70e1aaf4209b00820f54826a7f8.jpg
2025-04-08 20:47:25,394 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 20:47:25,529 - aiogram.event - INFO - Update id=311268088 is handled. Duration 639 ms by bot id=7041366449
2025-04-08 20:49:27,780 - __main__ - INFO - Stopping application...
2025-04-08 20:49:29,449 - __main__ - INFO - Application stopped
2025-04-08 20:50:26,144 - app - INFO - Starting application...
2025-04-08 20:50:26,144 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:50:26,144 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:50:26,144 - __main__ - INFO - Setting webhook at: https://f925-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:50:26,530 - __main__ - INFO - Application started successfully
2025-04-08 20:50:26,531 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:50:26,669 - aiogram.event - INFO - Update id=311268089 is not handled. Duration 3 ms by bot id=7041366449
2025-04-08 20:50:26,927 - aiogram.event - INFO - Update id=311268090 is not handled. Duration 9 ms by bot id=7041366449
2025-04-08 20:50:27,111 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 77 ms by bot id=7041366449
2025-04-08 20:50:27,111 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:27,188 - aiogram.event - INFO - Update id=311268091 is not handled. Duration 10 ms by bot id=7041366449
2025-04-08 20:50:27,441 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:50:27,441 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:27,447 - aiogram.event - INFO - Update id=311268093 is not handled. Duration 10 ms by bot id=7041366449
2025-04-08 20:50:27,695 - aiogram.event - INFO - Update id=311268094 is not handled. Duration 1 ms by bot id=7041366449
2025-04-08 20:50:27,967 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:50:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,968 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,970 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:50:27,970 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:50:27,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 20:50:27,971 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:50:28,154 - aiogram.event - INFO - Update id=311268095 is handled. Duration 213 ms by bot id=7041366449
2025-04-08 20:50:29,778 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 85 ms by bot id=7041366449
2025-04-08 20:50:29,778 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:34,366 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:50:34,367 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:42,870 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 91 ms by bot id=7041366449
2025-04-08 20:50:42,871 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:59,568 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 343 ms by bot id=7041366449
2025-04-08 20:50:59,568 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:11,145 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:51:11,147 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:51:11,147 - sqlalchemy.engine.Engine - INFO - [cached since 43.18s ago] (1043270764,)
2025-04-08 20:51:11,150 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:51:11,266 - aiogram.event - INFO - Update id=311268097 is handled. Duration 123 ms by bot id=7041366449
2025-04-08 20:51:32,155 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 235 ms by bot id=7041366449
2025-04-08 20:51:32,156 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:32,723 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 178 ms by bot id=7041366449
2025-04-08 20:51:32,724 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:33,092 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 117 ms by bot id=7041366449
2025-04-08 20:51:33,093 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:35,509 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 97 ms by bot id=7041366449
2025-04-08 20:51:35,509 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:39,991 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 120 ms by bot id=7041366449
2025-04-08 20:51:39,992 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:48,521 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 166 ms by bot id=7041366449
2025-04-08 20:51:48,522 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:54,978 - __main__ - INFO - Stopping application...
2025-04-08 20:51:55,301 - __main__ - INFO - Application stopped
2025-04-08 20:52:08,072 - app - INFO - Starting application...
2025-04-08 20:52:08,072 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:52:08,072 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:52:08,072 - __main__ - INFO - Setting webhook at: https://3982-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:52:08,450 - __main__ - INFO - Application started successfully
2025-04-08 20:52:08,450 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:52:08,682 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 86 ms by bot id=7041366449
2025-04-08 20:52:08,682 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:09,033 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 93 ms by bot id=7041366449
2025-04-08 20:52:09,033 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:11,442 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:52:11,443 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:15,843 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 20:52:15,843 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:24,277 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 77 ms by bot id=7041366449
2025-04-08 20:52:24,278 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:40,873 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 235 ms by bot id=7041366449
2025-04-08 20:52:40,873 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:41,243 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 116 ms by bot id=7041366449
2025-04-08 20:52:41,244 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:41,804 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 101 ms by bot id=7041366449
2025-04-08 20:52:41,804 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:44,242 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 120 ms by bot id=7041366449
2025-04-08 20:52:44,242 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:48,576 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:52:48,577 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:57,103 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:52:57,103 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:13,832 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 319 ms by bot id=7041366449
2025-04-08 20:53:13,832 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:22,597 - __main__ - INFO - Stopping application...
2025-04-08 20:53:22,921 - __main__ - INFO - Application stopped
2025-04-08 20:53:33,301 - app - INFO - Starting application...
2025-04-08 20:53:33,301 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:53:33,301 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:53:33,301 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:53:33,695 - __main__ - INFO - Application started successfully
2025-04-08 20:53:33,695 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:53:33,921 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:53:33,921 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:34,283 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 111 ms by bot id=7041366449
2025-04-08 20:53:34,283 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:36,618 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:53:36,618 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:41,160 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 284 ms by bot id=7041366449
2025-04-08 20:53:41,160 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:54:58,342 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:54:58,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,343 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:54:58,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,344 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:54:58,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-08 20:54:58,346 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:54:58,666 - aiogram.event - INFO - Update id=311268099 is handled. Duration 379 ms by bot id=7041366449
2025-04-08 20:55:02,479 - aiogram.event - INFO - Update id=311268100 is handled. Duration 317 ms by bot id=7041366449
2025-04-08 20:55:03,893 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:03,895 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 20:55:03,895 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1043270764,)
2025-04-08 20:55:03,899 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:03,995 - aiogram.event - INFO - Update id=311268101 is handled. Duration 195 ms by bot id=7041366449
2025-04-08 20:55:05,555 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:05,556 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 20:55:05,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ()
2025-04-08 20:55:05,561 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:05,732 - aiogram.event - INFO - Update id=311268102 is handled. Duration 341 ms by bot id=7041366449
2025-04-08 20:55:08,521 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:08,522 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 20:55:08,523 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('Зоотовары',)
2025-04-08 20:55:08,528 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:08,713 - aiogram.event - INFO - Update id=311268103 is handled. Duration 413 ms by bot id=7041366449
2025-04-08 20:55:10,860 - aiogram.event - INFO - Update id=311268104 is handled. Duration 299 ms by bot id=7041366449
2025-04-08 20:55:15,559 - aiogram.event - INFO - Update id=311268105 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 20:55:18,852 - aiogram.event - INFO - Update id=311268106 is handled. Duration 411 ms by bot id=7041366449
2025-04-08 20:55:21,604 - aiogram.event - INFO - Update id=311268107 is handled. Duration 193 ms by bot id=7041366449
2025-04-08 20:55:25,717 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:55:25,717 - app - INFO - Является частью группы: True
2025-04-08 20:55:25,717 - app - INFO - Добавлено фото в группу 13953079399243906, всего фото в группе: 1
2025-04-08 20:55:26,133 - root - INFO - File saved: 2025/04/08/4f82e04f959441e9b425ff0373832e68.jpg
2025-04-08 20:55:26,133 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 20:55:26,634 - app - INFO - Ожидаем другие фото из группы 13953079399243906
2025-04-08 20:55:26,636 - aiogram.event - INFO - Update id=311268108 is handled. Duration 922 ms by bot id=7041366449
2025-04-08 20:55:26,904 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:55:26,904 - app - INFO - Является частью группы: True
2025-04-08 20:55:26,905 - app - INFO - Добавлено фото в группу 13953079399243906, всего фото в группе: 2
2025-04-08 20:55:27,397 - root - INFO - File saved: 2025/04/08/41e143df8de846089ca5d211902fcf29.jpg
2025-04-08 20:55:27,397 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 20:55:27,898 - app - INFO - Ожидаем другие фото из группы 13953079399243906
2025-04-08 20:55:27,900 - aiogram.event - INFO - Update id=311268109 is handled. Duration 1006 ms by bot id=7041366449
2025-04-08 21:00:14,935 - __main__ - INFO - Stopping application...
2025-04-08 21:00:15,412 - __main__ - INFO - Application stopped
2025-04-08 21:00:18,120 - app - INFO - Starting application...
2025-04-08 21:00:18,120 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 21:00:18,121 - __main__ - INFO - Action config initialized successfully
2025-04-08 21:00:18,121 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 21:00:18,565 - __main__ - INFO - Application started successfully
2025-04-08 21:00:18,566 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 21:00:21,512 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 21:00:21,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:21,515 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:00:21,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 21:00:21,516 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:21,699 - aiogram.event - INFO - Update id=311268110 is handled. Duration 245 ms by bot id=7041366449
2025-04-08 21:00:23,332 - aiogram.event - INFO - Update id=311268111 is handled. Duration 446 ms by bot id=7041366449
2025-04-08 21:00:24,328 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:24,329 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 21:00:24,329 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (1043270764,)
2025-04-08 21:00:24,333 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:24,468 - aiogram.event - INFO - Update id=311268112 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 21:00:26,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:26,415 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 21:00:26,425 - sqlalchemy.engine.Engine - INFO - [generated in 0.01019s] ()
2025-04-08 21:00:26,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:26,547 - aiogram.event - INFO - Update id=311268113 is handled. Duration 282 ms by bot id=7041366449
2025-04-08 21:00:30,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:30,115 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 21:00:30,115 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('Зоотовары',)
2025-04-08 21:00:30,121 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:30,243 - aiogram.event - INFO - Update id=311268114 is handled. Duration 233 ms by bot id=7041366449
2025-04-08 21:00:31,731 - aiogram.event - INFO - Update id=311268115 is handled. Duration 235 ms by bot id=7041366449
2025-04-08 21:00:34,296 - aiogram.event - INFO - Update id=311268116 is handled. Duration 217 ms by bot id=7041366449
2025-04-08 21:00:37,424 - aiogram.event - INFO - Update id=311268117 is handled. Duration 523 ms by bot id=7041366449
2025-04-08 21:00:38,779 - aiogram.event - INFO - Update id=311268118 is handled. Duration 328 ms by bot id=7041366449
2025-04-08 21:00:43,491 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:43,492 - app - INFO - Является частью группы: True
2025-04-08 21:00:43,492 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 1
2025-04-08 21:00:44,005 - root - INFO - File saved: 2025/04/08/a19eb16839d44fd79c6694aa592b3844.jpg
2025-04-08 21:00:44,005 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 21:00:44,005 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:44,113 - aiogram.event - INFO - Update id=311268119 is handled. Duration 634 ms by bot id=7041366449
2025-04-08 21:00:44,379 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:44,379 - app - INFO - Является частью группы: True
2025-04-08 21:00:44,379 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 2
2025-04-08 21:00:45,163 - root - INFO - File saved: 2025/04/08/0953d845dc4f424ba361786d52bf2341.jpg
2025-04-08 21:00:45,163 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 21:00:45,163 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:45,310 - aiogram.event - INFO - Update id=311268120 is handled. Duration 941 ms by bot id=7041366449
2025-04-08 21:00:45,575 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:45,575 - app - INFO - Является частью группы: True
2025-04-08 21:00:45,576 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 3
2025-04-08 21:00:46,163 - root - INFO - File saved: 2025/04/08/dd6087d8a52e44afbdde2231d4164391.jpg
2025-04-08 21:00:46,163 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 21:00:46,163 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:46,743 - aiogram.event - INFO - Update id=311268121 is handled. Duration 1178 ms by bot id=7041366449
2025-04-08 21:00:46,996 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 21:00:46,996 - app - INFO - Является частью группы: True
2025-04-08 21:00:46,996 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 4
2025-04-08 21:00:47,818 - root - INFO - File saved: 2025/04/08/2303cd00e27e4420b7d7b26ab9900eff.jpg
2025-04-08 21:00:47,818 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 21:00:47,819 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:48,075 - aiogram.event - INFO - Update id=311268122 is handled. Duration 1080 ms by bot id=7041366449
2025-04-08 21:01:10,553 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:01:10,553 - app - INFO - Является частью группы: True
2025-04-08 21:01:10,554 - app - INFO - Добавлено фото в группу 13953082160280730, всего фото в группе: 1
2025-04-08 21:01:11,069 - root - INFO - File saved: 2025/04/08/7659e9a4b985441fbccf77546b7d0191.jpg
2025-04-08 21:01:11,070 - app - INFO - Фото сохранено, всего фото: 5
2025-04-08 21:01:11,070 - app - INFO - Группа 13953082160280730 завершена
2025-04-08 21:01:11,189 - aiogram.event - INFO - Update id=311268123 is handled. Duration 644 ms by bot id=7041366449
2025-04-08 21:01:11,456 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:01:11,456 - app - INFO - Является частью группы: True
2025-04-08 21:01:11,457 - app - INFO - Добавлено фото в группу 13953082160280730, всего фото в группе: 2
2025-04-08 21:01:11,806 - root - INFO - File saved: 2025/04/08/d175c2224e194cf4a6903beddaeef6d2.jpg
2025-04-08 21:01:11,806 - app - INFO - Фото сохранено, всего фото: 6
2025-04-08 21:01:11,807 - app - INFO - Группа 13953082160280730 завершена
2025-04-08 21:01:11,910 - aiogram.event - INFO - Update id=311268124 is handled. Duration 460 ms by bot id=7041366449
2025-04-08 21:09:04,824 - __main__ - INFO - Stopping application...
2025-04-08 21:09:05,290 - __main__ - INFO - Application stopped
2025-04-08 21:09:09,195 - app - INFO - Starting application...
2025-04-08 21:09:09,195 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 21:09:09,195 - __main__ - INFO - Action config initialized successfully
2025-04-08 21:09:09,195 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 21:09:09,644 - __main__ - INFO - Application started successfully
2025-04-08 21:09:09,646 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 21:09:10,831 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 21:09:10,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,833 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 21:09:10,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:10,835 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:09:10,835 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-08 21:09:10,836 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:10,982 - aiogram.event - INFO - Update id=311268125 is handled. Duration 212 ms by bot id=7041366449
2025-04-08 21:09:13,032 - aiogram.event - INFO - Update id=311268126 is handled. Duration 626 ms by bot id=7041366449
2025-04-08 21:09:14,229 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:14,230 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 21:09:14,231 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] (1043270764,)
2025-04-08 21:09:14,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:14,344 - aiogram.event - INFO - Update id=311268127 is handled. Duration 196 ms by bot id=7041366449
2025-04-08 21:09:15,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:15,835 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 21:09:15,835 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-08 21:09:15,836 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:15,939 - aiogram.event - INFO - Update id=311268128 is handled. Duration 229 ms by bot id=7041366449
2025-04-08 21:09:20,088 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:20,089 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 21:09:20,090 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ('Ювелирные изделия и украшения',)
2025-04-08 21:09:20,092 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:20,201 - aiogram.event - INFO - Update id=311268129 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 21:09:25,138 - aiogram.event - INFO - Update id=311268130 is handled. Duration 223 ms by bot id=7041366449
2025-04-08 21:09:27,869 - aiogram.event - INFO - Update id=311268131 is handled. Duration 260 ms by bot id=7041366449
2025-04-08 21:09:32,868 - aiogram.event - INFO - Update id=311268132 is handled. Duration 273 ms by bot id=7041366449
2025-04-08 21:09:36,641 - aiogram.event - INFO - Update id=311268133 is handled. Duration 170 ms by bot id=7041366449
2025-04-08 21:09:40,585 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 21:09:40,585 - app - INFO - Является частью группы: True
2025-04-08 21:09:40,585 - app - INFO - Добавлено фото в группу 13953086243243762, всего фото в группе: 1
2025-04-08 21:09:41,114 - root - INFO - File saved: 2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg
2025-04-08 21:09:41,114 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 21:09:41,224 - app - INFO - Создано новое сообщение для группы 13953086243243762
2025-04-08 21:09:41,225 - aiogram.event - INFO - Update id=311268134 is handled. Duration 643 ms by bot id=7041366449
2025-04-08 21:09:41,491 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:41,492 - app - INFO - Является частью группы: True
2025-04-08 21:09:41,492 - app - INFO - Добавлено фото в группу 13953086243243762, всего фото в группе: 2
2025-04-08 21:09:41,728 - root - INFO - File saved: 2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg
2025-04-08 21:09:41,728 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 21:09:41,821 - app - INFO - Сообщение для группы 13953086243243762 обновлено
2025-04-08 21:09:41,822 - aiogram.event - INFO - Update id=311268135 is handled. Duration 341 ms by bot id=7041366449
2025-04-08 21:09:48,696 - aiogram.event - INFO - Update id=311268136 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 21:09:51,988 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:51,989 - app - INFO - Является частью группы: False
2025-04-08 21:09:52,383 - root - INFO - File saved: 2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg
2025-04-08 21:09:52,384 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 21:09:52,756 - app - INFO - Отправлено сообщение для одиночного фото
2025-04-08 21:09:52,758 - aiogram.event - INFO - Update id=311268137 is handled. Duration 771 ms by bot id=7041366449
2025-04-08 21:09:56,597 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:56,597 - app - INFO - Является частью группы: True
2025-04-08 21:09:56,597 - app - INFO - Добавлено фото в группу 13953086371444826, всего фото в группе: 1
2025-04-08 21:09:56,999 - root - INFO - File saved: 2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg
2025-04-08 21:09:57,000 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 21:09:57,133 - app - INFO - Создано новое сообщение для группы 13953086371444826
2025-04-08 21:09:57,135 - aiogram.event - INFO - Update id=311268138 is handled. Duration 540 ms by bot id=7041366449
2025-04-08 21:09:57,402 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 21:09:57,403 - app - INFO - Является частью группы: True
2025-04-08 21:09:57,403 - app - INFO - Добавлено фото в группу 13953086371444826, всего фото в группе: 2
2025-04-08 21:09:57,584 - root - INFO - File saved: 2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg
2025-04-08 21:09:57,585 - app - INFO - Фото сохранено, всего фото: 5
2025-04-08 21:09:57,674 - app - INFO - Сообщение для группы 13953086371444826 обновлено
2025-04-08 21:09:57,676 - aiogram.event - INFO - Update id=311268139 is handled. Duration 282 ms by bot id=7041366449
2025-04-08 21:10:00,840 - aiogram.event - INFO - Update id=311268140 is handled. Duration 614 ms by bot id=7041366449
2025-04-08 21:10:13,538 - aiogram.event - INFO - Update id=311268141 is handled. Duration 507 ms by bot id=7041366449
2025-04-08 21:10:16,896 - root - INFO - === Подтверждение создания поставщика ===
2025-04-08 21:10:16,897 - root - INFO - ID пользователя: 1043270764
2025-04-08 21:10:16,897 - root - INFO - Данные из состояния: {'company_name': 'Jdjdhf', 'product_name': '-_;_+_', 'category_id': 100, 'photos_count': 5, 'has_video': False}
2025-04-08 21:10:16,897 - root - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 21:10:16,898 - root - INFO - Сессия БД создана
2025-04-08 21:10:16,898 - root - INFO - После проверки осталось 5 корректных фотографий
2025-04-08 21:10:16,898 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 21:10:16,899 - root - INFO - Данные: company_name=Jdjdhf, product_name=-_;_+_, category_id=100
2025-04-08 21:10:16,899 - root - INFO - Фотографии: 5 шт.
2025-04-08 21:10:16,899 - root - INFO - Видео: False
2025-04-08 21:10:16,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:10:16,902 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 21:10:16,902 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('Jdjdhf', '-_;_+_', 100, 'оалаьслв аоалашат', None, None, None, None, None, None, 1043270764)
2025-04-08 21:10:16,907 - root - INFO - Поставщик создан с ID: 4
2025-04-08 21:10:16,908 - root - INFO - Начинаю сохранение 5 фотографий
2025-04-08 21:10:16,908 - root - INFO - Сохраняю фото 1/5: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-08 21:10:16,908 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=4
2025-04-08 21:10:16,908 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,909 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,909 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ('photo', '2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg', 'photo_1.jpg', None, 4)
2025-04-08 21:10:16,910 - root - INFO - Файл сохранен с ID: 8
2025-04-08 21:10:16,911 - root - INFO - Фото 1 сохранено с ID: 8
2025-04-08 21:10:16,911 - root - INFO - Сохраняю фото 2/5: AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE
2025-04-08 21:10:16,911 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=4
2025-04-08 21:10:16,911 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,911 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,911 - sqlalchemy.engine.Engine - INFO - [cached since 0.00183s ago] ('photo', '2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg', 'photo_2.jpg', None, 4)
2025-04-08 21:10:16,912 - root - INFO - Файл сохранен с ID: 9
2025-04-08 21:10:16,912 - root - INFO - Фото 2 сохранено с ID: 9
2025-04-08 21:10:16,912 - root - INFO - Сохраняю фото 3/5: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 21:10:16,912 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=4
2025-04-08 21:10:16,912 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,912 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,912 - sqlalchemy.engine.Engine - INFO - [cached since 0.00293s ago] ('photo', '2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg', 'photo_3.jpg', None, 4)
2025-04-08 21:10:16,913 - root - INFO - Файл сохранен с ID: 10
2025-04-08 21:10:16,913 - root - INFO - Фото 3 сохранено с ID: 10
2025-04-08 21:10:16,913 - root - INFO - Сохраняю фото 4/5: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 21:10:16,913 - root - INFO - Сохранение файла: photo, photo_4.jpg, supplier_id=4
2025-04-08 21:10:16,913 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg', 'name': 'photo_4.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,913 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,913 - sqlalchemy.engine.Engine - INFO - [cached since 0.004069s ago] ('photo', '2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg', 'photo_4.jpg', None, 4)
2025-04-08 21:10:16,914 - root - INFO - Файл сохранен с ID: 11
2025-04-08 21:10:16,914 - root - INFO - Фото 4 сохранено с ID: 11
2025-04-08 21:10:16,914 - root - INFO - Сохраняю фото 5/5: AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE
2025-04-08 21:10:16,914 - root - INFO - Сохранение файла: photo, photo_5.jpg, supplier_id=4
2025-04-08 21:10:16,915 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg', 'name': 'photo_5.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,915 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,915 - sqlalchemy.engine.Engine - INFO - [cached since 0.005728s ago] ('photo', '2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg', 'photo_5.jpg', None, 4)
2025-04-08 21:10:16,916 - root - INFO - Файл сохранен с ID: 12
2025-04-08 21:10:16,916 - root - INFO - Фото 5 сохранено с ID: 12
2025-04-08 21:10:16,916 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 21:10:16,917 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 21:10:16,917 - root - INFO - Поставщик успешно создан с ID: 4
2025-04-08 21:10:17,229 - root - INFO - === Создание поставщика успешно завершено ===
2025-04-08 21:10:17,229 - aiogram.event - INFO - Update id=311268142 is handled. Duration 415 ms by bot id=7041366449
2025-04-08 21:12:32,634 - aiogram.event - INFO - Update id=311268143 is handled. Duration 371 ms by bot id=7041366449
2025-04-08 21:12:35,152 - aiogram.event - INFO - Update id=311268144 is handled. Duration 296 ms by bot id=7041366449
2025-04-08 21:12:41,088 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:12:41,089 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:12:41,090 - sqlalchemy.engine.Engine - INFO - [cached since 210.3s ago] (1043270764,)
2025-04-08 21:12:41,092 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:12:41,210 - aiogram.event - INFO - Update id=311268145 is handled. Duration 123 ms by bot id=7041366449
2025-04-08 22:25:01,911 - __main__ - INFO - Stopping application...
2025-04-08 22:25:02,746 - __main__ - INFO - Application stopped
2025-04-08 22:25:07,535 - app - INFO - Starting application...
2025-04-08 22:25:07,535 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:25:07,535 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:25:07,536 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:25:09,398 - __main__ - INFO - Application started successfully
2025-04-08 22:25:09,399 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:25:18,403 - aiogram.event - INFO - Update id=311268146 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 22:25:19,716 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:25:19,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,718 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:25:19,718 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,719 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:25:19,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,720 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:19,721 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:25:19,721 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-08 22:25:19,723 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:19,946 - aiogram.event - INFO - Update id=311268147 is handled. Duration 455 ms by bot id=7041366449
2025-04-08 22:25:22,358 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:22,360 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:25:22,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-04-08 22:25:22,365 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:22,539 - aiogram.event - INFO - Update id=311268148 is handled. Duration 299 ms by bot id=7041366449
2025-04-08 22:25:26,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:26,357 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:25:26,358 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('Цифровые товары',)
2025-04-08 22:25:26,363 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:26,478 - aiogram.event - INFO - Update id=311268149 is handled. Duration 240 ms by bot id=7041366449
2025-04-08 22:25:29,906 - aiogram.event - INFO - Update id=311268150 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 22:25:35,614 - aiogram.event - INFO - Update id=311268151 is handled. Duration 958 ms by bot id=7041366449
2025-04-08 22:25:37,439 - aiogram.event - INFO - Update id=311268152 is handled. Duration 559 ms by bot id=7041366449
2025-04-08 22:25:40,824 - aiogram.event - INFO - Update id=311268153 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 22:25:47,828 - aiogram.event - INFO - Update id=311268154 is handled. Duration 150 ms by bot id=7041366449
2025-04-08 22:25:51,893 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:25:51,894 - app - INFO - Является частью группы: True
2025-04-08 22:25:51,894 - app - INFO - Добавлено фото в группу 13953122813817218, всего фото в группе: 1
2025-04-08 22:25:53,997 - root - INFO - File saved: 2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg
2025-04-08 22:25:53,997 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:25:54,251 - app - INFO - Создано новое сообщение для группы 13953122813817218
2025-04-08 22:25:54,253 - aiogram.event - INFO - Update id=311268155 is handled. Duration 2368 ms by bot id=7041366449
2025-04-08 22:25:54,525 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:25:54,526 - app - INFO - Является частью группы: True
2025-04-08 22:25:54,526 - app - INFO - Добавлено фото в группу 13953122813817218, всего фото в группе: 2
2025-04-08 22:25:57,769 - root - INFO - File saved: 2025/04/08/dcb7c925bfeb47b19767997251003967.jpg
2025-04-08 22:25:57,769 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:25:57,940 - app - INFO - Сообщение для группы 13953122813817218 обновлено
2025-04-08 22:25:57,941 - aiogram.event - INFO - Update id=311268156 is handled. Duration 3425 ms by bot id=7041366449
2025-04-08 22:26:07,053 - aiogram.event - INFO - Update id=311268157 is handled. Duration 304 ms by bot id=7041366449
2025-04-08 22:26:11,873 - aiogram.event - INFO - Update id=311268158 is handled. Duration 867 ms by bot id=7041366449
2025-04-08 22:26:24,857 - aiogram.event - INFO - Update id=311268159 is handled. Duration 499 ms by bot id=7041366449
2025-04-08 22:26:34,722 - aiogram.event - INFO - Update id=311268160 is handled. Duration 530 ms by bot id=7041366449
2025-04-08 22:26:38,234 - aiogram.event - INFO - Update id=311268161 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 22:26:41,476 - aiogram.event - INFO - Update id=311268162 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 22:26:49,746 - aiogram.event - INFO - Update id=311268163 is handled. Duration 878 ms by bot id=7041366449
2025-04-08 22:26:52,789 - aiogram.event - INFO - Update id=311268164 is handled. Duration 245 ms by bot id=7041366449
2025-04-08 22:27:00,911 - aiogram.event - INFO - Update id=311268165 is handled. Duration 571 ms by bot id=7041366449
2025-04-08 22:27:05,588 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 22:27:05,588 - app - INFO - ID пользователя: 1043270764
2025-04-08 22:27:05,589 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 22:27:05,589 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 22:27:05,590 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 22:27:05,590 - root - INFO - Данные: company_name=Окоаьп, product_name=Коткьп, category_id=96
2025-04-08 22:27:05,590 - root - INFO - Фотографии: 2 шт.
2025-04-08 22:27:05,590 - root - INFO - Видео: False
2025-04-08 22:27:05,591 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:27:05,593 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 22:27:05,593 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('Окоаьп', 'Коткьп', 96, 'Шалкикьададвп', 'Россия', 'москва', None, None, '79267091083', None, 1043270764)
2025-04-08 22:27:05,599 - root - INFO - Поставщик создан с ID: 5
2025-04-08 22:27:05,600 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 22:27:05,600 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 22:27:05,601 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=5
2025-04-08 22:27:05,601 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-08 22:27:05,603 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:27:05,603 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('photo', '2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg', 'photo_1.jpg', None, 5)
2025-04-08 22:27:05,608 - root - INFO - Файл сохранен с ID: 13
2025-04-08 22:27:05,608 - root - INFO - Фото 1 сохранено с ID: 13
2025-04-08 22:27:05,609 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-08 22:27:05,609 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=5
2025-04-08 22:27:05,609 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/dcb7c925bfeb47b19767997251003967.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-08 22:27:05,610 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:27:05,611 - sqlalchemy.engine.Engine - INFO - [cached since 0.00852s ago] ('photo', '2025/04/08/dcb7c925bfeb47b19767997251003967.jpg', 'photo_2.jpg', None, 5)
2025-04-08 22:27:05,613 - root - INFO - Файл сохранен с ID: 14
2025-04-08 22:27:05,614 - root - INFO - Фото 2 сохранено с ID: 14
2025-04-08 22:27:05,614 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 22:27:05,616 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 22:27:05,616 - app - INFO - Поставщик успешно создан с ID: 5
2025-04-08 22:27:05,933 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 22:27:05,935 - aiogram.event - INFO - Update id=311268166 is handled. Duration 435 ms by bot id=7041366449
2025-04-08 22:27:41,913 - aiogram.event - INFO - Update id=311268167 is not handled. Duration 12 ms by bot id=7041366449
2025-04-08 22:44:40,882 - __main__ - INFO - Stopping application...
2025-04-08 22:44:41,617 - __main__ - INFO - Application stopped
2025-04-08 22:44:46,686 - app - INFO - Starting application...
2025-04-08 22:44:46,686 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:44:46,686 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:44:46,686 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:44:47,050 - __main__ - INFO - Application started successfully
2025-04-08 22:44:47,051 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:45:03,291 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:45:03,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,293 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:45:03,293 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,294 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:45:03,294 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:03,296 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 22:45:03,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-08 22:45:03,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:03,632 - aiogram.event - INFO - Update id=311268168 is handled. Duration 393 ms by bot id=7041366449
2025-04-08 22:45:03,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:03,884 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 22:45:03,884 - sqlalchemy.engine.Engine - INFO - [cached since 0.5883s ago] (1043270764,)
2025-04-08 22:45:03,885 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:03,989 - aiogram.event - INFO - Update id=311268169 is handled. Duration 107 ms by bot id=7041366449
2025-04-08 22:45:08,272 - aiogram.event - INFO - Update id=311268170 is handled. Duration 265 ms by bot id=7041366449
2025-04-08 22:45:10,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:10,497 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:45:10,497 - sqlalchemy.engine.Engine - INFO - [generated in 0.00092s] (1043270764,)
2025-04-08 22:45:10,510 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:10,802 - aiogram.event - INFO - Update id=311268171 is handled. Duration 1111 ms by bot id=7041366449
2025-04-08 22:45:17,783 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:17,784 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:45:17,795 - sqlalchemy.engine.Engine - INFO - [generated in 0.01039s] ()
2025-04-08 22:45:17,803 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:17,898 - aiogram.event - INFO - Update id=311268172 is handled. Duration 205 ms by bot id=7041366449
2025-04-08 22:45:21,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:21,127 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:45:21,127 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('Электроника',)
2025-04-08 22:45:21,135 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:21,225 - aiogram.event - INFO - Update id=311268173 is handled. Duration 191 ms by bot id=7041366449
2025-04-08 22:45:23,671 - aiogram.event - INFO - Update id=311268174 is handled. Duration 182 ms by bot id=7041366449
2025-04-08 22:45:26,390 - aiogram.event - INFO - Update id=311268175 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 22:45:30,158 - aiogram.event - INFO - Update id=311268176 is handled. Duration 554 ms by bot id=7041366449
2025-04-08 22:45:32,579 - aiogram.event - INFO - Update id=311268177 is handled. Duration 166 ms by bot id=7041366449
2025-04-08 22:45:37,392 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 22:45:37,392 - app - INFO - Является частью группы: True
2025-04-08 22:45:37,392 - app - INFO - Добавлено фото в группу 13953132298516410, всего фото в группе: 1
2025-04-08 22:45:38,443 - root - INFO - File saved: 2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg
2025-04-08 22:45:38,444 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:45:38,607 - app - INFO - Создано новое сообщение для группы 13953132298516410
2025-04-08 22:45:38,607 - aiogram.event - INFO - Update id=311268178 is handled. Duration 1218 ms by bot id=7041366449
2025-04-08 22:45:38,868 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:45:38,868 - app - INFO - Является частью группы: True
2025-04-08 22:45:38,869 - app - INFO - Добавлено фото в группу 13953132298516410, всего фото в группе: 2
2025-04-08 22:45:39,906 - root - INFO - File saved: 2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg
2025-04-08 22:45:39,907 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:45:40,001 - app - INFO - Сообщение для группы 13953132298516410 обновлено
2025-04-08 22:45:40,002 - aiogram.event - INFO - Update id=311268179 is handled. Duration 1143 ms by bot id=7041366449
2025-04-08 22:45:42,869 - aiogram.event - INFO - Update id=311268180 is handled. Duration 321 ms by bot id=7041366449
2025-04-08 22:45:46,410 - aiogram.event - INFO - Update id=311268181 is handled. Duration 277 ms by bot id=7041366449
2025-04-08 22:45:54,117 - aiogram.event - INFO - Update id=311268182 is handled. Duration 814 ms by bot id=7041366449
2025-04-08 22:46:15,250 - aiogram.event - INFO - Update id=311268183 is handled. Duration 444 ms by bot id=7041366449
2025-04-08 22:46:18,892 - aiogram.event - INFO - Update id=311268184 is handled. Duration 439 ms by bot id=7041366449
2025-04-08 22:46:21,961 - aiogram.event - INFO - Update id=311268185 is handled. Duration 190 ms by bot id=7041366449
2025-04-08 22:46:25,214 - aiogram.event - INFO - Update id=311268186 is handled. Duration 168 ms by bot id=7041366449
2025-04-08 22:46:46,683 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 22:46:46,778 - aiogram.event - INFO - Update id=311268187 is handled. Duration 431 ms by bot id=7041366449
2025-04-08 22:47:01,066 - aiogram.event - INFO - Update id=311268188 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 22:47:05,492 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 22:47:05,493 - app - INFO - ID пользователя: 1043270764
2025-04-08 22:47:05,493 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 22:47:05,493 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 22:47:05,494 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 22:47:05,494 - root - INFO - Данные: company_name=Раоалп, product_name=Аллалп, category_id=1
2025-04-08 22:47:05,494 - root - INFO - Фотографии: 2 шт.
2025-04-08 22:47:05,495 - root - INFO - Видео: False
2025-04-08 22:47:05,496 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:47:05,497 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 22:47:05,497 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Раоалп', 'Аллалп', 1, 'Лалаща слашаш алсшьа', None, None, None, None, '+89267091083', None, 1043270764)
2025-04-08 22:47:05,517 - root - INFO - Поставщик создан с ID: 6
2025-04-08 22:47:05,518 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 22:47:05,518 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-08 22:47:05,518 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=6
2025-04-08 22:47:05,519 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-08 22:47:05,520 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:47:05,521 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('photo', '2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg', 'photo_1.jpg', None, 6)
2025-04-08 22:47:05,527 - root - INFO - Файл сохранен с ID: 15
2025-04-08 22:47:05,528 - root - INFO - Фото 1 сохранено с ID: 15
2025-04-08 22:47:05,528 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 22:47:05,528 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=6
2025-04-08 22:47:05,529 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-08 22:47:05,530 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:47:05,530 - sqlalchemy.engine.Engine - INFO - [cached since 0.01s ago] ('photo', '2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg', 'photo_2.jpg', None, 6)
2025-04-08 22:47:05,532 - root - INFO - Файл сохранен с ID: 16
2025-04-08 22:47:05,532 - root - INFO - Фото 2 сохранено с ID: 16
2025-04-08 22:47:05,533 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 22:47:05,534 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 22:47:05,534 - app - INFO - Поставщик успешно создан с ID: 6
2025-04-08 22:47:05,829 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 22:47:05,831 - aiogram.event - INFO - Update id=311268189 is handled. Duration 438 ms by bot id=7041366449
2025-04-08 22:51:22,819 - __main__ - INFO - Stopping application...
2025-04-08 22:52:04,865 - app - INFO - Starting application...
2025-04-08 22:52:04,865 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:52:04,866 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:52:04,866 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:52:24,906 - __main__ - INFO - Application started successfully
2025-04-08 22:52:24,906 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:52:27,419 - __main__ - INFO - Stopping application...
2025-04-08 22:52:27,741 - __main__ - INFO - Application stopped
2025-04-08 22:52:31,367 - app - INFO - Starting application...
2025-04-08 22:52:31,368 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:52:31,368 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:52:31,368 - __main__ - INFO - Setting webhook at: https://f25f-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:52:32,138 - __main__ - INFO - Application started successfully
2025-04-08 22:52:32,138 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:52:32,310 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 125 ms by bot id=7041366449
2025-04-08 22:52:32,310 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:32,650 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 87 ms by bot id=7041366449
2025-04-08 22:52:32,650 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:35,354 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 330 ms by bot id=7041366449
2025-04-08 22:52:35,355 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:39,713 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:52:39,714 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:48,215 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:52:48,215 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:04,872 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 253 ms by bot id=7041366449
2025-04-08 22:53:04,873 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:37,570 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 287 ms by bot id=7041366449
2025-04-08 22:53:37,570 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:38,045 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 147 ms by bot id=7041366449
2025-04-08 22:53:38,045 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:38,426 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 126 ms by bot id=7041366449
2025-04-08 22:53:38,426 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:40,845 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 79 ms by bot id=7041366449
2025-04-08 22:53:40,846 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:45,349 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 169 ms by bot id=7041366449
2025-04-08 22:53:45,350 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:53,889 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 116 ms by bot id=7041366449
2025-04-08 22:53:53,889 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:10,622 - __main__ - INFO - Stopping application...
2025-04-08 22:54:11,434 - __main__ - INFO - Application stopped
2025-04-08 22:54:15,967 - app - INFO - Starting application...
2025-04-08 22:54:15,967 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:54:15,967 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:54:15,967 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:54:16,380 - __main__ - INFO - Application started successfully
2025-04-08 22:54:16,381 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:54:16,604 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 84 ms by bot id=7041366449
2025-04-08 22:54:16,604 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:16,943 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 86 ms by bot id=7041366449
2025-04-08 22:54:16,943 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:19,322 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 88 ms by bot id=7041366449
2025-04-08 22:54:19,322 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:23,702 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 128 ms by bot id=7041366449
2025-04-08 22:54:23,702 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:32,220 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 170 ms by bot id=7041366449
2025-04-08 22:54:32,221 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:48,916 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 254 ms by bot id=7041366449
2025-04-08 22:54:48,917 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:21,551 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 223 ms by bot id=7041366449
2025-04-08 22:55:21,552 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:21,890 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 22:55:21,890 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:22,225 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:55:22,225 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:24,556 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 79 ms by bot id=7041366449
2025-04-08 22:55:24,556 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:28,990 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 22:55:28,990 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:57:38,421 - __main__ - INFO - Stopping application...
2025-04-08 22:57:38,872 - __main__ - INFO - Application stopped
2025-04-08 22:57:43,189 - app - INFO - Starting application...
2025-04-08 22:57:43,189 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:57:43,189 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:57:43,189 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:57:43,564 - __main__ - INFO - Application started successfully
2025-04-08 22:57:43,564 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:57:51,140 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:57:51,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,142 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:57:51,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:51,144 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:57:51,144 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1043270764,)
2025-04-08 22:57:51,145 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:51,279 - aiogram.event - INFO - Update id=311268194 is handled. Duration 269 ms by bot id=7041366449
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-08 22:57:55,438 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:55,573 - aiogram.event - INFO - Update id=311268195 is handled. Duration 222 ms by bot id=7041366449
2025-04-08 22:57:58,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:58,757 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:57:58,757 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('Строительные материалы',)
2025-04-08 22:57:58,764 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:58,858 - aiogram.event - INFO - Update id=311268196 is handled. Duration 193 ms by bot id=7041366449
2025-04-08 22:58:01,138 - aiogram.event - INFO - Update id=311268197 is handled. Duration 186 ms by bot id=7041366449
2025-04-08 22:58:03,237 - aiogram.event - INFO - Update id=311268198 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 22:58:06,434 - aiogram.event - INFO - Update id=311268199 is handled. Duration 190 ms by bot id=7041366449
2025-04-08 22:58:09,187 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:09,188 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:09,447 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:09,447 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:11,731 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 9 ms by bot id=7041366449
2025-04-08 22:58:11,731 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:16,017 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:16,017 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:18,131 - aiogram.event - INFO - Update id=311268202 is handled. Duration 165 ms by bot id=7041366449
2025-04-08 22:58:24,420 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:58:24,420 - app - INFO - Является частью группы: True
2025-04-08 22:58:24,420 - app - INFO - Добавлено фото в группу 13953138312881770, всего фото в группе: 1
2025-04-08 22:58:24,842 - root - INFO - File saved: 2025/04/08/e919627a1fdb41a797aea2235421c866.jpg
2025-04-08 22:58:24,842 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:58:24,929 - app - INFO - Создано новое сообщение для группы 13953138312881770
2025-04-08 22:58:24,930 - aiogram.event - INFO - Update id=311268200 is handled. Duration 512 ms by bot id=7041366449
2025-04-08 22:58:25,189 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 22:58:25,189 - app - INFO - Является частью группы: True
2025-04-08 22:58:25,190 - app - INFO - Добавлено фото в группу 13953138312881770, всего фото в группе: 2
2025-04-08 22:58:25,365 - root - INFO - File saved: 2025/04/08/7035a817be4a404ebdc84ce1b53b3ee4.jpg
2025-04-08 22:58:25,366 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:58:25,453 - app - INFO - Сообщение для группы 13953138312881770 обновлено
2025-04-08 22:58:25,454 - aiogram.event - INFO - Update id=311268201 is handled. Duration 275 ms by bot id=7041366449
2025-04-08 22:58:25,709 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:58:25,710 - app - INFO - Является частью группы: True
2025-04-08 22:58:25,710 - app - INFO - Добавлено фото в группу 13953138424374986, всего фото в группе: 1
2025-04-08 22:58:26,131 - root - INFO - File saved: 2025/04/08/6d1e92eafbf74cd1a0ccd94a74fa464c.jpg
2025-04-08 22:58:26,131 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 22:58:26,229 - app - INFO - Создано новое сообщение для группы 13953138424374986
2025-04-08 22:58:26,230 - aiogram.event - INFO - Update id=311268203 is handled. Duration 529 ms by bot id=7041366449
2025-04-08 22:58:26,478 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 22:58:26,478 - app - INFO - Является частью группы: True
2025-04-08 22:58:26,478 - app - INFO - Добавлено фото в группу 13953138424374986, всего фото в группе: 2
2025-04-08 22:58:26,631 - root - INFO - File saved: 2025/04/08/800ed07f87d0462099ad9185af020608.jpg
2025-04-08 22:58:26,631 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 22:58:26,722 - app - INFO - Сообщение для группы 13953138424374986 обновлено
2025-04-08 22:58:26,724 - aiogram.event - INFO - Update id=311268204 is handled. Duration 247 ms by bot id=7041366449
2025-04-08 22:58:29,318 - aiogram.event - INFO - Update id=311268205 is handled. Duration 186 ms by bot id=7041366449
2025-04-08 22:58:34,239 - aiogram.event - INFO - Update id=311268206 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 22:58:40,247 - aiogram.event - INFO - Update id=311268207 is handled. Duration 361 ms by bot id=7041366449
2025-04-08 22:58:44,277 - aiogram.event - INFO - Update id=311268208 is handled. Duration 165 ms by bot id=7041366449
2025-04-08 22:58:55,535 - aiogram.event - INFO - Update id=311268209 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 22:58:58,443 - aiogram.event - INFO - Update id=311268210 is handled. Duration 171 ms by bot id=7041366449
2025-04-08 22:59:01,701 - aiogram.event - INFO - Update id=311268211 is handled. Duration 188 ms by bot id=7041366449
2025-04-08 23:10:31,249 - __main__ - INFO - Stopping application...
2025-04-08 23:10:31,702 - __main__ - INFO - Application stopped
2025-04-08 23:10:35,268 - app - INFO - Starting application...
2025-04-08 23:10:35,268 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:10:35,268 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:10:35,268 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:10:35,675 - __main__ - INFO - Application started successfully
2025-04-08 23:10:35,676 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:10:53,834 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:10:53,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,835 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:10:53,835 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,836 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:10:53,836 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-08 23:10:53,838 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:10:54,118 - aiogram.event - INFO - Update id=311268212 is handled. Duration 316 ms by bot id=7041366449
2025-04-08 23:13:33,531 - aiogram.event - INFO - Update id=311268213 is handled. Duration 331 ms by bot id=7041366449
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-08 23:13:34,424 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:34,510 - aiogram.event - INFO - Update id=311268214 is handled. Duration 164 ms by bot id=7041366449
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-08 23:13:37,909 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:38,133 - aiogram.event - INFO - Update id=311268215 is handled. Duration 389 ms by bot id=7041366449
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - [cached since 1.236s ago] ()
2025-04-08 23:13:39,144 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:39,240 - aiogram.event - INFO - Update id=311268216 is handled. Duration 98 ms by bot id=7041366449
2025-04-08 23:13:41,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:41,875 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:13:41,876 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ('Электроника',)
2025-04-08 23:13:41,882 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:42,017 - aiogram.event - INFO - Update id=311268217 is handled. Duration 297 ms by bot id=7041366449
2025-04-08 23:13:44,882 - aiogram.event - INFO - Update id=311268218 is handled. Duration 578 ms by bot id=7041366449
2025-04-08 23:13:46,178 - aiogram.event - INFO - Update id=311268219 is handled. Duration 200 ms by bot id=7041366449
2025-04-08 23:13:48,498 - aiogram.event - INFO - Update id=311268220 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 23:14:01,668 - aiogram.event - INFO - Update id=311268221 is handled. Duration 270 ms by bot id=7041366449
2025-04-08 23:14:03,713 - aiogram.event - INFO - Update id=311268222 is handled. Duration 264 ms by bot id=7041366449
2025-04-08 23:14:08,165 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:14:08,165 - app - INFO - Является частью группы: True
2025-04-08 23:14:08,166 - app - INFO - Добавлено фото в группу 13953145984647826, всего фото в группе: 1
2025-04-08 23:14:09,128 - root - INFO - File saved: 2025/04/08/39f6a3c2b96b40708c5ae628f7608258.jpg
2025-04-08 23:14:09,128 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:14:09,234 - app - INFO - Создано новое сообщение для группы 13953145984647826
2025-04-08 23:14:09,235 - aiogram.event - INFO - Update id=311268223 is handled. Duration 1078 ms by bot id=7041366449
2025-04-08 23:14:09,504 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 23:14:09,504 - app - INFO - Является частью группы: True
2025-04-08 23:14:09,505 - app - INFO - Добавлено фото в группу 13953145984647826, всего фото в группе: 2
2025-04-08 23:14:09,652 - root - INFO - File saved: 2025/04/08/3e37cad897274a95b9a8328df84df386.jpg
2025-04-08 23:14:09,653 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 23:14:09,747 - app - INFO - Сообщение для группы 13953145984647826 обновлено
2025-04-08 23:14:09,748 - aiogram.event - INFO - Update id=311268224 is handled. Duration 253 ms by bot id=7041366449
2025-04-08 23:14:11,504 - aiogram.event - INFO - Update id=311268225 is handled. Duration 171 ms by bot id=7041366449
2025-04-08 23:14:13,256 - aiogram.event - INFO - Update id=311268226 is handled. Duration 285 ms by bot id=7041366449
2025-04-08 23:14:16,123 - aiogram.event - INFO - Update id=311268227 is handled. Duration 387 ms by bot id=7041366449
2025-04-08 23:14:20,826 - aiogram.event - INFO - Update id=311268228 is handled. Duration 277 ms by bot id=7041366449
2025-04-08 23:14:23,156 - aiogram.event - INFO - Update id=311268229 is handled. Duration 355 ms by bot id=7041366449
2025-04-08 23:14:34,188 - aiogram.event - INFO - Update id=311268230 is handled. Duration 391 ms by bot id=7041366449
2025-04-08 23:14:36,594 - aiogram.event - INFO - Update id=311268231 is handled. Duration 276 ms by bot id=7041366449
2025-04-08 23:14:39,101 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:14:39,251 - aiogram.event - INFO - Update id=311268232 is handled. Duration 366 ms by bot id=7041366449
2025-04-08 23:14:44,892 - aiogram.event - INFO - Update id=311268233 is handled. Duration 176 ms by bot id=7041366449
2025-04-08 23:14:47,979 - aiogram.event - INFO - Update id=311268234 is handled. Duration 192 ms by bot id=7041366449
2025-04-08 23:14:52,985 - aiogram.event - INFO - Update id=311268235 is handled. Duration 181 ms by bot id=7041366449
2025-04-08 23:14:59,083 - aiogram.event - INFO - Update id=311268236 is handled. Duration 225 ms by bot id=7041366449
2025-04-08 23:15:01,599 - aiogram.event - INFO - Update id=311268237 is handled. Duration 182 ms by bot id=7041366449
2025-04-08 23:15:03,835 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:15:03,949 - aiogram.event - INFO - Update id=311268238 is handled. Duration 310 ms by bot id=7041366449
2025-04-08 23:15:11,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:15:11,937 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 23:15:11,937 - sqlalchemy.engine.Engine - INFO - [cached since 258.1s ago] (1043270764,)
2025-04-08 23:15:11,940 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:15:12,044 - aiogram.event - INFO - Update id=311268239 is handled. Duration 110 ms by bot id=7041366449
2025-04-08 23:21:11,162 - __main__ - INFO - Stopping application...
2025-04-08 23:21:11,639 - __main__ - INFO - Application stopped
2025-04-08 23:21:15,346 - app - INFO - Starting application...
2025-04-08 23:21:15,346 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:21:15,346 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:21:15,346 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:21:15,755 - __main__ - INFO - Application started successfully
2025-04-08 23:21:15,757 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:21:17,715 - aiogram.event - INFO - Update id=311268240 is handled. Duration 273 ms by bot id=7041366449
2025-04-08 23:21:19,428 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:21:19,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,429 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 23:21:19,432 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:19,585 - aiogram.event - INFO - Update id=311268241 is handled. Duration 301 ms by bot id=7041366449
2025-04-08 23:21:20,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:20,856 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:21:20,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-04-08 23:21:20,861 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:21,006 - aiogram.event - INFO - Update id=311268242 is handled. Duration 287 ms by bot id=7041366449
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - [cached since 1.135s ago] ()
2025-04-08 23:21:21,992 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:22,187 - aiogram.event - INFO - Update id=311268243 is handled. Duration 199 ms by bot id=7041366449
2025-04-08 23:21:23,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:23,557 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:21:23,558 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] ('Электроника',)
2025-04-08 23:21:23,564 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:23,667 - aiogram.event - INFO - Update id=311268244 is handled. Duration 206 ms by bot id=7041366449
2025-04-08 23:21:29,336 - aiogram.event - INFO - Update id=311268245 is handled. Duration 220 ms by bot id=7041366449
2025-04-08 23:21:31,678 - aiogram.event - INFO - Update id=311268246 is handled. Duration 205 ms by bot id=7041366449
2025-04-08 23:21:34,270 - aiogram.event - INFO - Update id=311268247 is handled. Duration 185 ms by bot id=7041366449
2025-04-08 23:21:37,601 - aiogram.event - INFO - Update id=311268248 is handled. Duration 292 ms by bot id=7041366449
2025-04-08 23:21:40,896 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:21:40,896 - app - INFO - Является частью группы: False
2025-04-08 23:21:41,301 - root - INFO - File saved: 2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg
2025-04-08 23:21:41,301 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:21:41,404 - app - INFO - Отправлено сообщение для одиночного фото
2025-04-08 23:21:41,407 - aiogram.event - INFO - Update id=311268249 is handled. Duration 515 ms by bot id=7041366449
2025-04-08 23:21:43,255 - aiogram.event - INFO - Update id=311268250 is handled. Duration 211 ms by bot id=7041366449
2025-04-08 23:21:47,727 - aiogram.event - INFO - Update id=311268251 is handled. Duration 279 ms by bot id=7041366449
2025-04-08 23:21:50,050 - aiogram.event - INFO - Update id=311268252 is handled. Duration 352 ms by bot id=7041366449
2025-04-08 23:21:55,107 - aiogram.event - INFO - Update id=311268253 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 23:21:56,719 - aiogram.event - INFO - Update id=311268254 is handled. Duration 259 ms by bot id=7041366449
2025-04-08 23:21:57,179 - root - ERROR - Error editing message: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-08 23:21:57,300 - aiogram.event - INFO - Update id=311268255 is handled. Duration 317 ms by bot id=7041366449
2025-04-08 23:22:02,999 - aiogram.event - INFO - Update id=311268256 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 23:22:04,550 - aiogram.event - INFO - Update id=311268257 is handled. Duration 508 ms by bot id=7041366449
2025-04-08 23:22:08,702 - aiogram.event - INFO - Update id=311268258 is handled. Duration 261 ms by bot id=7041366449
2025-04-08 23:22:11,284 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:22:11,504 - aiogram.event - INFO - Update id=311268259 is handled. Duration 569 ms by bot id=7041366449
2025-04-08 23:22:15,777 - aiogram.event - INFO - Update id=311268260 is handled. Duration 202 ms by bot id=7041366449
2025-04-08 23:22:17,839 - aiogram.event - INFO - Update id=311268261 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 23:22:21,418 - aiogram.event - INFO - Update id=311268262 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:22:22,906 - aiogram.event - INFO - Update id=311268263 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 23:22:25,230 - aiogram.event - INFO - Update id=311268264 is handled. Duration 192 ms by bot id=7041366449
2025-04-08 23:22:28,434 - aiogram.event - INFO - Update id=311268265 is handled. Duration 206 ms by bot id=7041366449
2025-04-08 23:22:29,858 - aiogram.event - INFO - Update id=311268266 is handled. Duration 213 ms by bot id=7041366449
2025-04-08 23:22:31,876 - aiogram.event - INFO - Update id=311268267 is handled. Duration 183 ms by bot id=7041366449
2025-04-08 23:22:41,670 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 23:22:41,670 - app - INFO - ID пользователя: 1043270764
2025-04-08 23:22:41,670 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 23:22:41,670 - app - INFO - После проверки осталось 1 корректных фотографий
2025-04-08 23:22:41,670 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 23:22:41,670 - root - INFO - Данные: company_name=Тататп, product_name=Алалаьпд, category_id=2
2025-04-08 23:22:41,670 - root - INFO - Фотографии: 1 шт.
2025-04-08 23:22:41,670 - root - INFO - Видео: False
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('Тататп', 'Алалаьпд', 2, 'Оалаьпдадал аладал', None, None, None, None, '79267091083', None, 1043270764)
2025-04-08 23:22:41,673 - root - INFO - Поставщик создан с ID: 7
2025-04-08 23:22:41,673 - root - INFO - Начинаю сохранение 1 фотографий
2025-04-08 23:22:41,673 - root - INFO - Сохраняю фото 1/1: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 23:22:41,673 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=7
2025-04-08 23:22:41,673 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 7}
2025-04-08 23:22:41,674 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:22:41,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg', 'photo_1.jpg', None, 7)
2025-04-08 23:22:41,675 - root - INFO - Файл сохранен с ID: 17
2025-04-08 23:22:41,675 - root - INFO - Фото 1 сохранено с ID: 17
2025-04-08 23:22:41,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 23:22:41,676 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 23:22:41,676 - app - INFO - Поставщик успешно создан с ID: 7
2025-04-08 23:22:42,033 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 23:22:42,034 - aiogram.event - INFO - Update id=311268268 is handled. Duration 511 ms by bot id=7041366449
2025-04-08 23:31:39,006 - __main__ - INFO - Stopping application...
2025-04-08 23:31:39,459 - __main__ - INFO - Application stopped
2025-04-08 23:31:43,164 - app - INFO - Starting application...
2025-04-08 23:31:43,164 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:31:43,164 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:31:43,164 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:31:43,547 - __main__ - INFO - Application started successfully
2025-04-08 23:31:43,548 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:31:45,642 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:31:45,642 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,643 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:31:45,643 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,644 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:31:45,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 23:31:45,646 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:45,743 - aiogram.event - INFO - Update id=311268269 is handled. Duration 278 ms by bot id=7041366449
2025-04-08 23:31:48,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:48,598 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:31:48,599 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ()
2025-04-08 23:31:48,604 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:48,754 - aiogram.event - INFO - Update id=311268270 is handled. Duration 249 ms by bot id=7041366449
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('Ювелирные изделия и украшения',)
2025-04-08 23:31:52,052 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:52,147 - aiogram.event - INFO - Update id=311268271 is handled. Duration 188 ms by bot id=7041366449
2025-04-08 23:31:54,630 - aiogram.event - INFO - Update id=311268272 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:31:59,338 - aiogram.event - INFO - Update id=311268273 is handled. Duration 180 ms by bot id=7041366449
2025-04-08 23:32:02,867 - aiogram.event - INFO - Update id=311268274 is handled. Duration 179 ms by bot id=7041366449
2025-04-08 23:32:05,634 - aiogram.event - INFO - Update id=311268275 is handled. Duration 1022 ms by bot id=7041366449
2025-04-08 23:32:10,234 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:32:10,234 - app - INFO - Является частью группы: True
2025-04-08 23:32:10,234 - app - INFO - Добавлено фото в группу 13953154640356610, всего фото в группе: 1
2025-04-08 23:32:10,626 - root - INFO - File saved: 2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg
2025-04-08 23:32:10,626 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:32:10,725 - app - INFO - Создано новое сообщение для группы 13953154640356610
2025-04-08 23:32:10,726 - aiogram.event - INFO - Update id=311268276 is handled. Duration 502 ms by bot id=7041366449
2025-04-08 23:32:10,990 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 23:32:10,991 - app - INFO - Является частью группы: True
2025-04-08 23:32:10,991 - app - INFO - Добавлено фото в группу 13953154640356610, всего фото в группе: 2
2025-04-08 23:32:11,131 - root - INFO - File saved: 2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg
2025-04-08 23:32:11,132 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 23:32:11,221 - app - INFO - Сообщение для группы 13953154640356610 обновлено
2025-04-08 23:32:11,222 - aiogram.event - INFO - Update id=311268277 is handled. Duration 242 ms by bot id=7041366449
2025-04-08 23:32:13,186 - aiogram.event - INFO - Update id=311268278 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:32:18,300 - aiogram.event - INFO - Update id=311268279 is handled. Duration 334 ms by bot id=7041366449
2025-04-08 23:33:41,990 - aiogram.event - INFO - Update id=311268280 is handled. Duration 707 ms by bot id=7041366449
2025-04-08 23:33:46,943 - aiogram.event - INFO - Update id=311268281 is handled. Duration 244 ms by bot id=7041366449
2025-04-08 23:33:48,718 - aiogram.event - INFO - Update id=311268282 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 23:33:56,406 - aiogram.event - INFO - Update id=311268283 is handled. Duration 167 ms by bot id=7041366449
2025-04-08 23:34:04,086 - aiogram.event - INFO - Update id=311268284 is handled. Duration 167 ms by bot id=7041366449
2025-04-08 23:34:15,724 - aiogram.event - INFO - Update id=311268285 is handled. Duration 334 ms by bot id=7041366449
2025-04-08 23:34:26,412 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:34:26,498 - aiogram.event - INFO - Update id=311268286 is handled. Duration 253 ms by bot id=7041366449
2025-04-08 23:34:34,680 - aiogram.event - INFO - Update id=311268287 is handled. Duration 345 ms by bot id=7041366449
2025-04-08 23:34:56,906 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 23:34:56,907 - app - INFO - ID пользователя: 1043270764
2025-04-08 23:34:56,907 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 23:34:56,908 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 23:34:56,908 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 23:34:56,908 - root - INFO - Данные: company_name=Оалалп, product_name=Шулкла, category_id=98
2025-04-08 23:34:56,909 - root - INFO - Фотографии: 2 шт.
2025-04-08 23:34:56,909 - root - INFO - Видео: False
2025-04-08 23:34:56,910 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:34:56,912 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 23:34:56,912 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ('Оалалп', 'Шулкла', 98, 'Оалвла алалала аладад', None, None, None, None, '+79267091083', None, 1043270764)
2025-04-08 23:34:56,918 - root - INFO - Поставщик создан с ID: 8
2025-04-08 23:34:56,918 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 23:34:56,919 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 23:34:56,919 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=8
2025-04-08 23:34:56,919 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 8}
2025-04-08 23:34:56,919 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:34:56,919 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg', 'photo_1.jpg', None, 8)
2025-04-08 23:34:56,921 - root - INFO - Файл сохранен с ID: 18
2025-04-08 23:34:56,921 - root - INFO - Фото 1 сохранено с ID: 18
2025-04-08 23:34:56,921 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE
2025-04-08 23:34:56,921 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=8
2025-04-08 23:34:56,921 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 8}
2025-04-08 23:34:56,921 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:34:56,921 - sqlalchemy.engine.Engine - INFO - [cached since 0.002391s ago] ('photo', '2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg', 'photo_2.jpg', None, 8)
2025-04-08 23:34:56,923 - root - INFO - Файл сохранен с ID: 19
2025-04-08 23:34:56,923 - root - INFO - Фото 2 сохранено с ID: 19
2025-04-08 23:34:56,923 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 23:34:56,924 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 23:34:56,924 - app - INFO - Поставщик успешно создан с ID: 8
2025-04-08 23:34:57,214 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 23:34:57,215 - aiogram.event - INFO - Update id=311268288 is handled. Duration 558 ms by bot id=7041366449
2025-04-09 00:09:07,839 - __main__ - INFO - Stopping application...
2025-04-09 00:09:08,247 - __main__ - INFO - Application stopped
2025-04-09 00:09:12,616 - app - INFO - Starting application...
2025-04-09 00:09:12,616 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:09:12,616 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:09:12,616 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:09:12,889 - __main__ - INFO - Application started successfully
2025-04-09 00:09:12,890 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:09:39,768 - __main__ - INFO - Stopping application...
2025-04-09 00:09:40,484 - __main__ - INFO - Application stopped
2025-04-09 00:09:44,433 - app - INFO - Starting application...
2025-04-09 00:09:44,433 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:09:44,433 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:09:44,433 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:09:44,851 - __main__ - INFO - Application started successfully
2025-04-09 00:09:44,853 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:09:45,042 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 00:09:45,042 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,043 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 00:09:45,043 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,044 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 00:09:45,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:09:45,045 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 00:09:45,046 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 00:09:45,046 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:09:45,192 - aiogram.event - INFO - Update id=311268289 is handled. Duration 191 ms by bot id=7041366449
2025-04-09 00:10:01,913 - __main__ - INFO - Stopping application...
2025-04-09 00:10:02,634 - __main__ - INFO - Application stopped
2025-04-09 00:10:06,268 - app - INFO - Starting application...
2025-04-09 00:10:06,268 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:10:06,268 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:10:06,268 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:10:06,680 - __main__ - INFO - Application started successfully
2025-04-09 00:10:06,681 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:12:18,017 - __main__ - INFO - Stopping application...
2025-04-09 00:12:18,721 - __main__ - INFO - Application stopped
2025-04-09 00:12:22,282 - app - INFO - Starting application...
2025-04-09 00:12:22,282 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:12:22,282 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:12:22,282 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:12:22,688 - __main__ - INFO - Application started successfully
2025-04-09 00:12:22,689 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:16:51,457 - __main__ - INFO - Stopping application...
2025-04-09 00:16:52,172 - __main__ - INFO - Application stopped
2025-04-09 00:19:49,106 - app - INFO - Starting application...
2025-04-09 00:19:49,106 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:19:49,106 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:19:49,106 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:19:49,528 - __main__ - INFO - Application started successfully
2025-04-09 00:19:49,529 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:20:30,418 - __main__ - INFO - Stopping application...
2025-04-09 00:20:31,122 - __main__ - INFO - Application stopped
2025-04-09 00:20:48,476 - app - INFO - Starting application...
2025-04-09 00:20:48,476 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 00:20:48,477 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 00:20:48,477 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 00:20:48,507 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 00:20:48,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,509 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 00:20:48,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,511 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 00:20:48,511 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,513 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 00:20:48,513 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 00:20:48,514 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,515 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 00:20:48,515 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 00:20:48,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,516 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 00:20:48,517 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ()
2025-04-09 00:20:48,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,518 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 00:20:48,519 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,522 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,534 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 00:20:48,535 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 00:20:48,538 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,539 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 00:20:48,539 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 00:20:48,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,540 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 00:20:48,540 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 00:20:48,542 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,543 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 00:20:48,544 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 00:20:48,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,544 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 00:20:48,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,549 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 00:20:48,550 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 00:20:48,550 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,551 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 00:20:48,551 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 00:20:48,554 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,556 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 00:20:48,556 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 00:20:48,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,557 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 00:20:48,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,560 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,563 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 00:20:48,563 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 00:20:48,563 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,564 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 00:20:48,564 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 00:20:48,566 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,569 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 00:20:48,569 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 00:20:48,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,570 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 00:20:48,570 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 00:20:48,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,575 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 00:20:48,575 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 00:20:48,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,576 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 00:20:48,576 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 00:20:48,579 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,581 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 00:20:48,581 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 00:20:48,583 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,585 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 00:20:48,586 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 00:20:48,586 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 00:20:48,586 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,587 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 00:20:48,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 00:20:48,590 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,591 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 00:20:48,591 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 00:20:48,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,593 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 00:20:48,593 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 00:20:48,597 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,598 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 00:20:48,598 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,603 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,604 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 00:20:48,604 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 00:20:48,610 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,611 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 00:20:48,611 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,617 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 00:20:48,617 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 00:20:48,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,618 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 00:20:48,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 00:20:48,622 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,623 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 00:20:48,623 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 00:20:48,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,623 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 00:20:48,624 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,628 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,629 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 00:20:48,629 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 00:20:48,629 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,630 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 00:20:48,630 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 00:20:48,635 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,636 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 00:20:48,636 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 00:20:48,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,636 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 00:20:48,637 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,641 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,642 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 00:20:48,642 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 00:20:48,646 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,647 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 00:20:48,647 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 00:20:48,647 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 00:20:48,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,648 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 00:20:48,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 00:20:48,654 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,654 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 00:20:48,655 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 00:20:48,655 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 00:20:48,655 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,656 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 00:20:48,656 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 00:20:48,660 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,661 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 00:20:48,661 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 00:20:48,661 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,669 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,672 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 00:20:48,673 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 00:20:48,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,673 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 00:20:48,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 00:20:48,679 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,681 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 00:20:48,681 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,685 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,686 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 00:20:48,686 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 00:20:48,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,686 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 00:20:48,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ()
2025-04-09 00:20:48,689 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,690 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 00:20:48,690 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 00:20:48,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,691 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 00:20:48,692 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 00:20:48,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,694 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 00:20:48,694 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,695 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,696 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 00:20:48,696 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,697 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,698 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 00:20:48,698 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,698 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,699 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 00:20:48,699 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,701 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,702 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 00:20:48,702 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 00:20:48,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,703 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 00:20:48,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,706 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 00:20:48,706 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,710 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 00:20:48,710 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,710 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 00:20:48,711 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,712 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 00:20:48,713 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,714 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,715 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 00:20:48,715 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,715 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,715 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 00:20:48,716 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 00:20:48,718 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,719 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 00:20:48,719 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 00:20:48,719 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,720 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 00:20:48,720 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 00:20:48,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,723 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 00:20:48,724 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 00:20:48,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,725 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 00:20:48,725 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 00:20:48,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,727 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 00:20:48,727 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,730 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 00:20:48,730 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,731 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,732 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 00:20:48,732 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 00:20:48,732 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,733 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 00:20:48,734 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ()
2025-04-09 00:20:48,735 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,736 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 00:20:48,736 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 00:20:48,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,737 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 00:20:48,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 00:20:48,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,739 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 00:20:48,740 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,741 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 00:20:48,741 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ()
2025-04-09 00:20:48,743 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,743 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 00:20:48,743 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,746 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 00:20:48,746 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 00:20:48,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,747 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 00:20:48,747 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ()
2025-04-09 00:20:48,748 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,748 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 00:20:48,748 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,750 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 00:20:48,750 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] ()
2025-04-09 00:20:48,752 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,753 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 00:20:48,753 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 00:20:48,753 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,754 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 00:20:48,754 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 00:20:48,756 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,757 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 00:20:48,758 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 00:20:48,758 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,759 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 00:20:48,759 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 00:20:48,761 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,761 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 00:20:48,762 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 00:20:48,764 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,764 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 00:20:48,764 - app.services.database - INFO - Database initialization completed
2025-04-09 00:20:48,764 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:20:48,764 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:20:49,159 - __main__ - INFO - Application started successfully
2025-04-09 00:20:49,160 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:21:00,013 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:00,014 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 00:21:00,014 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (1043270764,)
2025-04-09 00:21:00,015 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:21:00,317 - aiogram.event - INFO - Update id=311268290 is handled. Duration 304 ms by bot id=7041366449
2025-04-09 00:21:16,159 - aiogram.event - INFO - Update id=311268291 is handled. Duration 481 ms by bot id=7041366449
2025-04-09 00:21:23,277 - aiogram.event - INFO - Update id=311268292 is handled. Duration 226 ms by bot id=7041366449
2025-04-09 00:21:38,563 - aiogram.event - INFO - Update id=311268293 is handled. Duration 228 ms by bot id=7041366449
2025-04-09 00:21:42,064 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 00:21:42,162 - aiogram.event - INFO - Update id=311268294 is handled. Duration 370 ms by bot id=7041366449
2025-04-09 00:21:44,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:44,628 - sqlalchemy.engine.Engine - INFO - 
            INSERT INTO users (tg_id, username, first_name, last_name, email, phone, created_at)
            VALUES ($1, $2, $3, $4, $5, $6, NOW())
            ON CONFLICT (tg_id) DO UPDATE
            SET username = $2, 
                first_name = $3, 
                last_name = $4,
                email = COALESCE($5, users.email),
                phone = COALESCE($6, users.phone)
        
2025-04-09 00:21:44,628 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764, '@egormeisters', 'Егор', 'Смирнов', 'bot@egormeister.ru', '+79267091083')
2025-04-09 00:21:44,629 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:21:44,629 - root - INFO - User saved: 1043270764, @egormeisters, email: bot@egormeister.ru, phone: +79267091083
2025-04-09 00:21:44,814 - aiogram.event - INFO - Update id=311268295 is handled. Duration 266 ms by bot id=7041366449
2025-04-09 00:21:47,439 - aiogram.event - INFO - Update id=311268296 is handled. Duration 213 ms by bot id=7041366449
2025-04-09 00:21:49,457 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:49,458 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 00:21:49,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] (1043270764,)
2025-04-09 00:21:49,463 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:21:49,575 - aiogram.event - INFO - Update id=311268297 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 00:22:07,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:22:07,532 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 00:22:07,533 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ()
2025-04-09 00:22:07,538 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:22:07,674 - aiogram.event - INFO - Update id=311268298 is handled. Duration 668 ms by bot id=7041366449
2025-04-09 00:22:09,875 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:22:09,876 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 00:22:09,877 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ('Автотовары',)
2025-04-09 00:22:09,881 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:22:10,000 - aiogram.event - INFO - Update id=311268299 is handled. Duration 215 ms by bot id=7041366449
2025-04-09 00:22:11,160 - aiogram.event - INFO - Update id=311268300 is handled. Duration 246 ms by bot id=7041366449
2025-04-09 00:22:15,600 - aiogram.event - INFO - Update id=311268301 is handled. Duration 221 ms by bot id=7041366449
2025-04-09 00:22:19,582 - aiogram.event - INFO - Update id=311268302 is handled. Duration 309 ms by bot id=7041366449
2025-04-09 00:22:36,783 - aiogram.event - INFO - Update id=311268303 is handled. Duration 307 ms by bot id=7041366449
2025-04-09 00:23:50,441 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 00:23:50,442 - app - INFO - Является частью группы: True
2025-04-09 00:23:50,442 - app - INFO - Добавлено фото в группу 13953179440781378, всего фото в группе: 1
2025-04-09 00:23:51,190 - root - INFO - File saved: 2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg
2025-04-09 00:23:51,190 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 00:23:51,281 - app - INFO - Создано новое сообщение для группы 13953179440781378
2025-04-09 00:23:51,282 - aiogram.event - INFO - Update id=311268304 is handled. Duration 841 ms by bot id=7041366449
2025-04-09 00:23:51,555 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 00:23:51,555 - app - INFO - Является частью группы: True
2025-04-09 00:23:51,556 - app - INFO - Добавлено фото в группу 13953179440781378, всего фото в группе: 2
2025-04-09 00:23:51,913 - root - INFO - File saved: 2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg
2025-04-09 00:23:51,913 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 00:23:52,037 - app - INFO - Сообщение для группы 13953179440781378 обновлено
2025-04-09 00:23:52,038 - aiogram.event - INFO - Update id=311268305 is handled. Duration 495 ms by bot id=7041366449
2025-04-09 00:23:53,954 - aiogram.event - INFO - Update id=311268306 is handled. Duration 163 ms by bot id=7041366449
2025-04-09 00:23:59,599 - aiogram.event - INFO - Update id=311268307 is handled. Duration 174 ms by bot id=7041366449
2025-04-09 00:24:02,634 - aiogram.event - INFO - Update id=311268308 is handled. Duration 897 ms by bot id=7041366449
2025-04-09 00:24:06,715 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 00:24:06,807 - aiogram.event - INFO - Update id=311268309 is handled. Duration 420 ms by bot id=7041366449
2025-04-09 00:24:19,265 - aiogram.event - INFO - Update id=311268310 is handled. Duration 188 ms by bot id=7041366449
2025-04-09 00:24:25,007 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 00:24:25,007 - app - INFO - ID пользователя: 1043270764
2025-04-09 00:24:25,007 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 00:24:25,008 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-09 00:24:25,008 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 00:24:25,008 - root - INFO - Данные: company_name=поставляю, product_name=хуйню, category_id=58
2025-04-09 00:24:25,009 - root - INFO - Фотографии: 2 шт.
2025-04-09 00:24:25,009 - root - INFO - Видео: False
2025-04-09 00:24:25,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:24:25,011 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 00:24:25,012 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('поставляю', 'хуйню', 58, 'высшего сорта', 'Россия', 'Москва', 'Москва', None, '@egormeisters', '+79267091083', '2@egormeister.ru', 1043270764)
2025-04-09 00:24:25,018 - root - INFO - Поставщик создан с ID: 1
2025-04-09 00:24:25,019 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-09 00:24:25,019 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-09 00:24:25,019 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=1
2025-04-09 00:24:25,019 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 00:24:25,021 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 00:24:25,021 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('photo', '2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg', 'photo_1.jpg', None, 1)
2025-04-09 00:24:25,026 - root - INFO - Файл сохранен с ID: 1
2025-04-09 00:24:25,027 - root - INFO - Фото 1 сохранено с ID: 1
2025-04-09 00:24:25,027 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-09 00:24:25,028 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=1
2025-04-09 00:24:25,028 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 00:24:25,029 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 00:24:25,030 - sqlalchemy.engine.Engine - INFO - [cached since 0.008977s ago] ('photo', '2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg', 'photo_2.jpg', None, 1)
2025-04-09 00:24:25,032 - root - INFO - Файл сохранен с ID: 2
2025-04-09 00:24:25,033 - root - INFO - Фото 2 сохранено с ID: 2
2025-04-09 00:24:25,033 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:24:25,035 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 00:24:25,036 - app - INFO - Поставщик успешно создан с ID: 1
2025-04-09 00:24:25,304 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 00:24:25,304 - aiogram.event - INFO - Update id=311268311 is handled. Duration 381 ms by bot id=7041366449
2025-04-09 01:41:48,793 - __main__ - INFO - Stopping application...
2025-04-09 01:41:49,256 - __main__ - INFO - Application stopped
2025-04-09 01:41:53,456 - app - INFO - Starting application...
2025-04-09 01:41:53,456 - app.services.database - ERROR - Error initializing database: 'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'
2025-04-09 01:41:53,457 - app.services.database - ERROR - Exception type: AttributeError
2025-04-09 01:41:53,457 - app.services.database - ERROR - Full exception: AttributeError("'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'")
2025-04-09 01:41:53,457 - __main__ - ERROR - Failed to initialize database. Shutting down.
2025-04-09 01:41:53,457 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:41:53,457 - __main__ - INFO - Stopping application...
2025-04-09 01:41:53,956 - __main__ - INFO - Application stopped
2025-04-09 01:43:49,395 - app - INFO - Starting application...
2025-04-09 01:43:49,395 - app.services.database - ERROR - Error initializing database: 'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'
2025-04-09 01:43:49,395 - app.services.database - ERROR - Exception type: AttributeError
2025-04-09 01:43:49,395 - app.services.database - ERROR - Full exception: AttributeError("'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'")
2025-04-09 01:43:49,395 - __main__ - ERROR - Failed to initialize database. Shutting down.
2025-04-09 01:43:49,396 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:43:49,396 - __main__ - INFO - Stopping application...
2025-04-09 01:43:49,855 - __main__ - INFO - Application stopped
2025-04-09 01:45:56,551 - app - INFO - Starting application...
2025-04-09 01:45:56,552 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 01:45:56,552 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 01:45:56,552 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 01:45:56,586 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 01:45:56,586 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,588 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 01:45:56,588 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,589 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 01:45:56,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,591 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 01:45:56,591 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:45:56,593 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,594 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 01:45:56,594 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 01:45:56,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,595 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 01:45:56,595 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 01:45:56,596 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,596 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 01:45:56,597 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:45:56,599 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,600 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 01:45:56,600 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 01:45:56,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,601 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 01:45:56,601 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-04-09 01:45:56,602 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,603 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 01:45:56,603 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 01:45:56,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,604 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 01:45:56,604 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:45:56,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,608 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 01:45:56,609 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 01:45:56,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,609 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 01:45:56,610 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,613 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,616 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 01:45:56,616 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 01:45:56,616 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,617 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 01:45:56,617 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,620 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,621 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 01:45:56,621 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 01:45:56,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,622 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 01:45:56,622 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:45:56,624 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,625 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 01:45:56,626 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 01:45:56,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,627 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 01:45:56,628 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 01:45:56,630 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,633 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 01:45:56,633 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 01:45:56,633 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,634 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 01:45:56,634 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 01:45:56,636 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,638 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 01:45:56,638 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:45:56,640 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,641 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 01:45:56,641 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 01:45:56,642 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,643 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 01:45:56,644 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-04-09 01:45:56,645 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,647 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 01:45:56,647 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 01:45:56,647 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,652 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 01:45:56,652 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,657 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,657 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 01:45:56,658 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:45:56,664 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,665 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 01:45:56,665 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 01:45:56,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,666 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:45:56,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ()
2025-04-09 01:45:56,671 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,671 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 01:45:56,671 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 01:45:56,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,672 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:45:56,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,677 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 01:45:56,677 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 01:45:56,677 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,678 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:45:56,678 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 01:45:56,682 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,683 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 01:45:56,684 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:45:56,688 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,688 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 01:45:56,688 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,694 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 01:45:56,695 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,701 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 01:45:56,701 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,706 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 01:45:56,706 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 01:45:56,706 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 01:45:56,706 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,707 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 01:45:56,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,711 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 01:45:56,711 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 01:45:56,711 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:45:56,716 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,717 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 01:45:56,717 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 01:45:56,717 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,726 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 01:45:56,727 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 01:45:56,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,727 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 01:45:56,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,734 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,736 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 01:45:56,736 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 01:45:56,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,737 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 01:45:56,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:45:56,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,738 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 01:45:56,739 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,741 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,741 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 01:45:56,741 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:45:56,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,742 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 01:45:56,743 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ()
2025-04-09 01:45:56,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,745 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 01:45:56,746 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ()
2025-04-09 01:45:56,748 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,748 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 01:45:56,748 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:45:56,751 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,751 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 01:45:56,752 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,753 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 01:45:56,753 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 01:45:56,754 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,755 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 01:45:56,755 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 01:45:56,755 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,756 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 01:45:56,756 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:45:56,757 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,758 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 01:45:56,758 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 01:45:56,758 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,759 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 01:45:56,760 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ()
2025-04-09 01:45:56,762 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,763 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 01:45:56,763 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,763 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,763 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 01:45:56,764 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ()
2025-04-09 01:45:56,766 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,766 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 01:45:56,766 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,769 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,770 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 01:45:56,770 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,772 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 01:45:56,772 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,773 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,774 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 01:45:56,774 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:45:56,777 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,778 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 01:45:56,778 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,779 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 01:45:56,779 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ()
2025-04-09 01:45:56,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,781 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 01:45:56,782 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:45:56,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,782 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 01:45:56,783 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,784 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,785 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 01:45:56,785 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 01:45:56,785 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,786 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 01:45:56,786 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,787 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,787 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 01:45:56,787 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,789 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,789 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 01:45:56,789 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 01:45:56,791 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,792 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 01:45:56,792 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,793 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 01:45:56,794 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 01:45:56,795 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,797 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 01:45:56,797 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 01:45:56,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,798 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 01:45:56,798 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ()
2025-04-09 01:45:56,800 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,801 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 01:45:56,801 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,802 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 01:45:56,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,803 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 01:45:56,803 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,805 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,805 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 01:45:56,805 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,808 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,808 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 01:45:56,809 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,811 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 01:45:56,811 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ()
2025-04-09 01:45:56,814 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,814 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 01:45:56,815 - app.services.database - INFO - Database initialization completed
2025-04-09 01:45:56,815 - __main__ - INFO - Action config initialized successfully
2025-04-09 01:45:56,815 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 01:45:57,198 - __main__ - INFO - Application started successfully
2025-04-09 01:45:57,199 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:52:54,931 - __main__ - INFO - Stopping application...
2025-04-09 01:52:55,388 - __main__ - INFO - Application stopped
2025-04-09 01:52:59,060 - app - INFO - Starting application...
2025-04-09 01:52:59,060 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 01:52:59,061 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 01:52:59,061 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 01:52:59,089 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 01:52:59,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,091 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 01:52:59,092 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,093 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 01:52:59,093 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,094 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,095 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 01:52:59,095 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 01:52:59,097 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,097 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 01:52:59,097 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,099 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 01:52:59,099 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] ()
2025-04-09 01:52:59,101 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,102 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 01:52:59,102 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,106 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,107 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 01:52:59,107 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,110 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,111 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 01:52:59,111 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,113 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,115 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 01:52:59,115 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-04-09 01:52:59,117 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,119 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 01:52:59,119 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 01:52:59,119 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,120 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 01:52:59,120 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:52:59,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,129 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 01:52:59,129 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 01:52:59,131 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,132 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 01:52:59,132 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,136 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 01:52:59,136 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 01:52:59,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,137 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 01:52:59,138 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 01:52:59,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,143 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 01:52:59,143 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 01:52:59,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,144 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 01:52:59,144 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,145 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,146 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 01:52:59,146 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 01:52:59,147 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,150 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 01:52:59,150 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,153 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,153 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 01:52:59,153 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 01:52:59,153 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,154 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 01:52:59,154 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,158 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 01:52:59,158 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 01:52:59,166 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,167 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 01:52:59,167 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 01:52:59,167 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,167 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:52:59,168 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,170 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,171 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 01:52:59,171 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 01:52:59,171 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,171 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:52:59,172 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:52:59,176 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,177 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 01:52:59,177 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 01:52:59,177 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,178 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 01:52:59,178 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,183 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 01:52:59,184 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,187 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,187 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 01:52:59,187 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 01:52:59,187 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,188 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 01:52:59,188 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,192 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,193 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 01:52:59,193 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 01:52:59,193 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,194 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 01:52:59,194 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 01:52:59,200 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,201 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 01:52:59,201 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 01:52:59,201 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 01:52:59,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,201 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 01:52:59,202 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,204 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 01:52:59,204 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 01:52:59,204 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 01:52:59,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,204 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 01:52:59,205 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,207 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 01:52:59,207 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 01:52:59,208 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,218 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 01:52:59,218 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 01:52:59,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,219 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 01:52:59,220 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 01:52:59,224 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,226 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 01:52:59,226 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 01:52:59,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,226 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 01:52:59,227 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:52:59,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,229 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 01:52:59,229 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,233 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,234 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 01:52:59,234 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:52:59,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,235 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 01:52:59,236 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,237 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,238 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 01:52:59,238 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,238 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,238 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 01:52:59,239 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:52:59,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,240 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 01:52:59,240 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,241 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 01:52:59,241 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:52:59,242 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,242 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 01:52:59,242 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,244 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,245 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 01:52:59,245 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 01:52:59,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,246 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 01:52:59,247 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 01:52:59,249 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,250 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 01:52:59,250 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 01:52:59,250 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,251 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 01:52:59,251 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,252 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,252 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 01:52:59,252 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:52:59,254 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,254 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 01:52:59,254 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 01:52:59,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,256 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 01:52:59,257 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-04-09 01:52:59,258 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,259 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 01:52:59,259 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,259 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,260 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 01:52:59,260 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,261 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,261 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 01:52:59,261 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 01:52:59,261 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,262 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 01:52:59,262 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,263 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,263 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 01:52:59,264 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:52:59,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,264 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 01:52:59,265 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 01:52:59,267 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,268 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 01:52:59,268 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,269 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 01:52:59,269 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:52:59,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,270 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 01:52:59,270 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,273 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,274 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 01:52:59,275 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,277 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 01:52:59,277 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 01:52:59,278 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:52:59,278 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,279 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 01:52:59,279 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,279 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 01:52:59,280 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:52:59,281 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,281 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 01:52:59,282 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,283 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 01:52:59,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 01:52:59,285 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,286 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 01:52:59,286 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 01:52:59,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,287 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 01:52:59,287 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-04-09 01:52:59,289 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,290 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 01:52:59,291 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,291 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,291 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 01:52:59,292 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,293 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,294 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 01:52:59,295 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:52:59,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,295 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 01:52:59,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,297 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,298 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 01:52:59,298 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 01:52:59,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,300 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 01:52:59,300 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,301 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 01:52:59,301 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:52:59,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,303 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 01:52:59,303 - app.services.database - INFO - Database initialization completed
2025-04-09 01:52:59,303 - __main__ - INFO - Action config initialized successfully
2025-04-09 01:52:59,303 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 01:52:59,679 - __main__ - INFO - Application started successfully
2025-04-09 01:52:59,680 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764,)
2025-04-09 01:53:08,632 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:53:08,837 - aiogram.event - INFO - Update id=311268312 is handled. Duration 208 ms by bot id=7041366449
2025-04-09 01:53:10,866 - aiogram.event - INFO - Update id=311268313 is handled. Duration 84 ms by bot id=7041366449
2025-04-09 01:53:11,585 - aiogram.event - INFO - Update id=311268314 is handled. Duration 209 ms by bot id=7041366449
2025-04-09 01:53:13,191 - aiogram.event - INFO - Update id=311268315 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 01:53:14,627 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 01:53:14,717 - aiogram.event - INFO - Update id=311268316 is handled. Duration 249 ms by bot id=7041366449
2025-04-09 01:53:16,396 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:16,398 - sqlalchemy.engine.Engine - INFO - 
            INSERT INTO users (tg_id, username, first_name, last_name, email, phone, created_at)
            VALUES ($1, $2, $3, $4, $5, $6, NOW())
            ON CONFLICT (tg_id) DO UPDATE
            SET username = $2, 
                first_name = $3, 
                last_name = $4,
                email = COALESCE($5, users.email),
                phone = COALESCE($6, users.phone)
        
2025-04-09 01:53:16,398 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (1043270764, '@egormeisters', 'sdf', 'sdrg', None, None)
2025-04-09 01:53:16,401 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:53:16,402 - root - INFO - User saved: 1043270764, @egormeisters, email: NULL, phone: NULL
2025-04-09 01:53:16,642 - aiogram.event - INFO - Update id=311268317 is handled. Duration 354 ms by bot id=7041366449
2025-04-09 01:53:19,267 - aiogram.event - INFO - Update id=311268318 is handled. Duration 294 ms by bot id=7041366449
2025-04-09 01:53:22,609 - aiogram.event - INFO - Update id=311268319 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 01:53:25,218 - aiogram.event - INFO - Update id=311268320 is handled. Duration 408 ms by bot id=7041366449
2025-04-09 01:53:28,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:28,164 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 01:53:28,165 - sqlalchemy.engine.Engine - INFO - [cached since 19.53s ago] (1043270764,)
2025-04-09 01:53:28,168 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:53:28,259 - aiogram.event - INFO - Update id=311268321 is handled. Duration 98 ms by bot id=7041366449
2025-04-09 01:54:06,483 - aiogram.event - INFO - Update id=311268322 is handled. Duration 297 ms by bot id=7041366449
2025-04-09 01:54:08,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:08,524 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 01:54:08,525 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1043270764,)
2025-04-09 01:54:08,527 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:08,625 - aiogram.event - INFO - Update id=311268323 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 01:54:10,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:10,704 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 01:54:10,705 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ()
2025-04-09 01:54:10,708 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:10,836 - aiogram.event - INFO - Update id=311268324 is handled. Duration 355 ms by bot id=7041366449
2025-04-09 01:54:11,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:11,115 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 01:54:11,115 - sqlalchemy.engine.Engine - INFO - [cached since 0.4107s ago] ()
2025-04-09 01:54:11,117 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:11,238 - aiogram.event - INFO - Update id=311268325 is handled. Duration 131 ms by bot id=7041366449
2025-04-09 01:54:13,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:13,856 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 01:54:13,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ('Цифровые товары',)
2025-04-09 01:54:13,862 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:13,952 - aiogram.event - INFO - Update id=311268326 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 01:54:15,682 - aiogram.event - INFO - Update id=311268327 is handled. Duration 184 ms by bot id=7041366449
2025-04-09 01:54:17,397 - aiogram.event - INFO - Update id=311268328 is handled. Duration 217 ms by bot id=7041366449
2025-04-09 01:54:19,994 - aiogram.event - INFO - Update id=311268329 is handled. Duration 195 ms by bot id=7041366449
2025-04-09 01:54:38,976 - aiogram.event - INFO - Update id=311268330 is handled. Duration 231 ms by bot id=7041366449
2025-04-09 01:55:01,738 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-09 01:55:01,739 - app - INFO - Является частью группы: True
2025-04-09 01:55:01,739 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 1
2025-04-09 01:55:02,271 - root - INFO - File saved: 2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 01:55:02,271 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 01:55:02,362 - app - INFO - Создано новое сообщение для группы 13953223210684266
2025-04-09 01:55:02,362 - aiogram.event - INFO - Update id=311268331 is handled. Duration 633 ms by bot id=7041366449
2025-04-09 01:55:02,623 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBliVn9alFCbn8o2VozeXgOaWGPsA3YQAC2PsxG2fgqEv1vCw4_QL8uQEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:02,624 - app - INFO - Является частью группы: True
2025-04-09 01:55:02,624 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 2
2025-04-09 01:55:03,000 - root - INFO - File saved: 2025/04/09/b2a135030f334483bb8c624de797aea7.jpg
2025-04-09 01:55:03,001 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 01:55:03,089 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:03,091 - aiogram.event - INFO - Update id=311268332 is handled. Duration 478 ms by bot id=7041366449
2025-04-09 01:55:03,353 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:03,354 - app - INFO - Является частью группы: True
2025-04-09 01:55:03,354 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 3
2025-04-09 01:55:03,662 - root - INFO - File saved: 2025/04/09/60a7c066635f48a981575c170c2f98de.jpg
2025-04-09 01:55:03,662 - app - INFO - Фото сохранено, всего фото: 3
2025-04-09 01:55:03,746 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:03,747 - aiogram.event - INFO - Update id=311268333 is handled. Duration 405 ms by bot id=7041366449
2025-04-09 01:55:04,008 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:04,009 - app - INFO - Является частью группы: True
2025-04-09 01:55:04,009 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 4
2025-04-09 01:55:04,361 - root - INFO - File saved: 2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg
2025-04-09 01:55:04,362 - app - INFO - Фото сохранено, всего фото: 4
2025-04-09 01:55:04,454 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:04,456 - aiogram.event - INFO - Update id=311268334 is handled. Duration 458 ms by bot id=7041366449
2025-04-09 01:55:10,922 - aiogram.event - INFO - Update id=311268335 is handled. Duration 179 ms by bot id=7041366449
2025-04-09 01:55:12,097 - aiogram.event - INFO - Update id=311268336 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 01:55:15,551 - aiogram.event - INFO - Update id=311268337 is handled. Duration 351 ms by bot id=7041366449
2025-04-09 01:55:17,731 - aiogram.event - INFO - Update id=311268338 is handled. Duration 278 ms by bot id=7041366449
2025-04-09 01:55:19,937 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 01:55:20,031 - aiogram.event - INFO - Update id=311268339 is handled. Duration 274 ms by bot id=7041366449
2025-04-09 01:55:24,697 - aiogram.event - INFO - Update id=311268340 is handled. Duration 589 ms by bot id=7041366449
2025-04-09 01:55:26,958 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 01:55:26,959 - app - INFO - ID пользователя: 1043270764
2025-04-09 01:55:26,959 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 01:55:26,959 - app - INFO - После проверки осталось 4 корректных фотографий
2025-04-09 01:55:26,960 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 01:55:26,960 - root - INFO - Данные: company_name=sdfhr, product_name=sdfhgb, category_id=94
2025-04-09 01:55:26,960 - root - INFO - Фотографии: 4 шт.
2025-04-09 01:55:26,961 - root - INFO - Видео: False
2025-04-09 01:55:26,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:55:26,963 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 01:55:26,963 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('sdfhr', 'sdfhgb', 94, 'sdfbdfsbv sdfgsdfg', 'russia', 'moscow', None, None, '@egormeisters', '79267091083', None, 1043270764)
2025-04-09 01:55:26,964 - root - INFO - Поставщик создан с ID: 1
2025-04-09 01:55:26,964 - root - INFO - Начинаю сохранение 4 фотографий
2025-04-09 01:55:26,964 - root - INFO - Сохраняю фото 1/4: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-09 01:55:26,964 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=1
2025-04-09 01:55:26,964 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,965 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,965 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ('photo', '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'photo_1.jpg', None, 1)
2025-04-09 01:55:26,966 - root - INFO - Файл сохранен с ID: 1
2025-04-09 01:55:26,966 - root - INFO - Фото 1 сохранено с ID: 1
2025-04-09 01:55:26,966 - root - INFO - Сохраняю фото 2/4: AgACAgIAAxkBAAEBliVn9alFCbn8o2VozeXgOaWGPsA3YQAC2PsxG2fgqEv1vCw4_QL8uQEAAwIAA3kAAzYE
2025-04-09 01:55:26,966 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=1
2025-04-09 01:55:26,966 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,967 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,967 - sqlalchemy.engine.Engine - INFO - [cached since 0.001977s ago] ('photo', '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'photo_2.jpg', None, 1)
2025-04-09 01:55:26,967 - root - INFO - Файл сохранен с ID: 2
2025-04-09 01:55:26,967 - root - INFO - Фото 2 сохранено с ID: 2
2025-04-09 01:55:26,968 - root - INFO - Сохраняю фото 3/4: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-09 01:55:26,968 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=1
2025-04-09 01:55:26,968 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,968 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,968 - sqlalchemy.engine.Engine - INFO - [cached since 0.003333s ago] ('photo', '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'photo_3.jpg', None, 1)
2025-04-09 01:55:26,969 - root - INFO - Файл сохранен с ID: 3
2025-04-09 01:55:26,969 - root - INFO - Фото 3 сохранено с ID: 3
2025-04-09 01:55:26,969 - root - INFO - Сохраняю фото 4/4: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-09 01:55:26,969 - root - INFO - Сохранение файла: photo, photo_4.jpg, supplier_id=1
2025-04-09 01:55:26,969 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,970 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,970 - sqlalchemy.engine.Engine - INFO - [cached since 0.00528s ago] ('photo', '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'photo_4.jpg', None, 1)
2025-04-09 01:55:26,971 - root - INFO - Файл сохранен с ID: 4
2025-04-09 01:55:26,971 - root - INFO - Фото 4 сохранено с ID: 4
2025-04-09 01:55:26,971 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:55:26,972 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 01:55:26,972 - app - INFO - Поставщик успешно создан с ID: 1
2025-04-09 01:55:27,271 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 01:55:27,272 - aiogram.event - INFO - Update id=311268341 is handled. Duration 399 ms by bot id=7041366449
2025-04-09 01:55:32,466 - __main__ - INFO - Stopping application...
2025-04-09 01:55:32,797 - __main__ - INFO - Application stopped
2025-04-09 02:06:18,714 - app - INFO - Starting application...
2025-04-09 02:06:18,715 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:06:18,715 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:06:18,715 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:06:19,092 - __main__ - INFO - Application started successfully
2025-04-09 02:06:19,093 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:06:22,746 - aiogram.event - INFO - Update id=311268342 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 02:06:24,680 - aiogram.event - INFO - Update id=311268343 is handled. Duration 181 ms by bot id=7041366449
2025-04-09 02:06:26,175 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:06:26,175 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,215 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:06:26,215 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,217 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:06:26,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:26,218 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:26,219 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ()
2025-04-09 02:06:26,221 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:26,316 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 282 ms by bot id=7041366449
2025-04-09 02:06:26,316 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:26,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:26,662 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:26,662 - sqlalchemy.engine.Engine - INFO - [cached since 0.4441s ago] ()
2025-04-09 02:06:26,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:26,752 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 180 ms by bot id=7041366449
2025-04-09 02:06:26,753 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:29,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:29,186 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:29,187 - sqlalchemy.engine.Engine - INFO - [cached since 2.968s ago] ()
2025-04-09 02:06:29,189 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:29,271 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 164 ms by bot id=7041366449
2025-04-09 02:06:29,272 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:33,604 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:33,605 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:33,606 - sqlalchemy.engine.Engine - INFO - [cached since 7.387s ago] ()
2025-04-09 02:06:33,608 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:33,692 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 164 ms by bot id=7041366449
2025-04-09 02:06:33,692 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:42,186 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 76 ms by bot id=7041366449
2025-04-09 02:06:42,186 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:06:58,822 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 223 ms by bot id=7041366449
2025-04-09 02:06:58,823 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:07:31,483 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 221 ms by bot id=7041366449
2025-04-09 02:07:31,484 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:10,342 - __main__ - INFO - Stopping application...
2025-04-09 02:08:10,808 - __main__ - INFO - Application stopped
2025-04-09 02:08:14,754 - app - INFO - Starting application...
2025-04-09 02:08:14,754 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:08:14,754 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:08:14,754 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:08:15,138 - __main__ - INFO - Application started successfully
2025-04-09 02:08:15,138 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:08:15,387 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 92 ms by bot id=7041366449
2025-04-09 02:08:15,387 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:15,736 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 88 ms by bot id=7041366449
2025-04-09 02:08:15,736 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:18,084 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 90 ms by bot id=7041366449
2025-04-09 02:08:18,085 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:22,445 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 83 ms by bot id=7041366449
2025-04-09 02:08:22,445 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:30,951 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 87 ms by bot id=7041366449
2025-04-09 02:08:30,952 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:47,828 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 478 ms by bot id=7041366449
2025-04-09 02:08:47,828 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:48,162 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:08:48,162 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:48,500 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:08:48,500 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:50,912 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 82 ms by bot id=7041366449
2025-04-09 02:08:50,912 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:55,317 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:08:55,317 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:03,752 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:09:03,752 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:20,346 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 226 ms by bot id=7041366449
2025-04-09 02:09:20,346 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:46,877 - __main__ - INFO - Stopping application...
2025-04-09 02:09:47,584 - __main__ - INFO - Application stopped
2025-04-09 02:09:59,552 - app - INFO - Starting application...
2025-04-09 02:09:59,552 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:09:59,552 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:09:59,552 - __main__ - INFO - Setting webhook at: https://9a28-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:09:59,950 - __main__ - INFO - Application started successfully
2025-04-09 02:09:59,951 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:10:00,173 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 77 ms by bot id=7041366449
2025-04-09 02:10:00,173 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:00,761 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:00,761 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:03,409 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:10:03,409 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:08,123 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:08,124 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:11,581 - __main__ - INFO - Stopping application...
2025-04-09 02:10:11,922 - __main__ - INFO - Application stopped
2025-04-09 02:10:21,085 - app - INFO - Starting application...
2025-04-09 02:10:21,086 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:10:21,086 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:10:21,086 - __main__ - INFO - Setting webhook at: https://dcff-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:10:21,462 - __main__ - INFO - Application started successfully
2025-04-09 02:10:21,463 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:10:21,696 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 75 ms by bot id=7041366449
2025-04-09 02:10:21,696 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:22,966 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:10:22,966 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:25,624 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:10:25,625 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:30,279 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 116 ms by bot id=7041366449
2025-04-09 02:10:30,280 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,071 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 101 ms by bot id=7041366449
2025-04-09 02:10:39,072 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,544 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 77 ms by bot id=7041366449
2025-04-09 02:10:39,545 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,944 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:10:39,945 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:42,438 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 91 ms by bot id=7041366449
2025-04-09 02:10:42,439 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:46,936 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:46,936 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:53,630 - __main__ - INFO - Stopping application...
2025-04-09 02:10:53,949 - __main__ - INFO - Application stopped
2025-04-09 02:11:04,352 - app - INFO - Starting application...
2025-04-09 02:11:04,352 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:11:04,353 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:11:04,353 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:11:04,807 - __main__ - INFO - Application started successfully
2025-04-09 02:11:04,808 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:11:04,985 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 87 ms by bot id=7041366449
2025-04-09 02:11:04,985 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:05,657 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 108 ms by bot id=7041366449
2025-04-09 02:11:05,657 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:08,508 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:11:08,508 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:13,168 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 205 ms by bot id=7041366449
2025-04-09 02:11:13,169 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:21,757 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 86 ms by bot id=7041366449
2025-04-09 02:11:21,757 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:38,579 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 228 ms by bot id=7041366449
2025-04-09 02:11:38,580 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:12:11,399 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 225 ms by bot id=7041366449
2025-04-09 02:12:11,400 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:12:29,256 - aiogram.event - INFO - Update id=311268347 is handled. Duration 338 ms by bot id=7041366449
2025-04-09 02:12:32,076 - aiogram.event - INFO - Update id=311268348 is handled. Duration 158 ms by bot id=7041366449
2025-04-09 02:12:33,379 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:12:33,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 02:12:33,383 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:33,843 - aiogram.event - INFO - Update id=311268349 is handled. Duration 597 ms by bot id=7041366449
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('Товары для здоровья',)
2025-04-09 02:12:38,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:38,957 - aiogram.event - INFO - Update id=311268350 is handled. Duration 181 ms by bot id=7041366449
2025-04-09 02:12:44,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:44,711 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'accepted'
            ORDER BY created_at DESC
        
2025-04-09 02:12:44,711 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (122,)
2025-04-09 02:12:44,750 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:44,836 - aiogram.event - INFO - Update id=311268351 is handled. Duration 204 ms by bot id=7041366449
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - [cached since 12.18s ago] ('Товары для здоровья',)
2025-04-09 02:12:51,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:51,144 - aiogram.event - INFO - Update id=311268352 is handled. Duration 183 ms by bot id=7041366449
2025-04-09 02:12:54,832 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:54,832 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:12:54,833 - sqlalchemy.engine.Engine - INFO - [cached since 21.45s ago] ()
2025-04-09 02:12:54,833 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:54,922 - aiogram.event - INFO - Update id=311268353 is handled. Duration 169 ms by bot id=7041366449
2025-04-09 02:14:21,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:14:21,704 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:14:21,704 - sqlalchemy.engine.Engine - INFO - [cached since 102.8s ago] ('Цифровые товары',)
2025-04-09 02:14:21,705 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:14:21,796 - aiogram.event - INFO - Update id=311268354 is handled. Duration 311 ms by bot id=7041366449
2025-04-09 02:14:24,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:14:24,428 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'accepted'
            ORDER BY created_at DESC
        
2025-04-09 02:14:24,429 - sqlalchemy.engine.Engine - INFO - [cached since 99.72s ago] (94,)
2025-04-09 02:14:24,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:14:24,522 - aiogram.event - INFO - Update id=311268355 is handled. Duration 170 ms by bot id=7041366449
2025-04-09 02:18:32,306 - __main__ - INFO - Stopping application...
2025-04-09 02:18:32,774 - __main__ - INFO - Application stopped
2025-04-09 02:22:11,101 - app - INFO - Starting application...
2025-04-09 02:22:11,101 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:22:11,101 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:22:11,101 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:22:11,496 - __main__ - INFO - Application started successfully
2025-04-09 02:22:11,497 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:22:15,701 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:22:15,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,702 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:22:15,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,703 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:22:15,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:22:15,706 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:22:15,815 - aiogram.event - INFO - Update id=311268356 is handled. Duration 146 ms by bot id=7041366449
2025-04-09 02:22:17,791 - aiogram.event - INFO - Update id=311268357 is handled. Duration 201 ms by bot id=7041366449
2025-04-09 02:22:22,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:22:22,545 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:22:22,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 02:22:22,546 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:22:22,638 - aiogram.event - INFO - Update id=311268358 is handled. Duration 171 ms by bot id=7041366449
2025-04-09 02:22:32,128 - aiogram.event - INFO - Update id=311268359 is not handled. Duration 17 ms by bot id=7041366449
2025-04-09 02:24:25,360 - __main__ - INFO - Stopping application...
2025-04-09 02:24:25,809 - __main__ - INFO - Application stopped
2025-04-09 02:24:30,941 - app - INFO - Starting application...
2025-04-09 02:24:30,942 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:24:30,942 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:24:30,942 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:24:31,310 - __main__ - INFO - Application started successfully
2025-04-09 02:24:31,311 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:24:52,722 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:24:52,722 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,724 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:24:52,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,725 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:24:52,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:24:52,727 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:24:52,975 - aiogram.event - INFO - Update id=311268360 is handled. Duration 285 ms by bot id=7041366449
2025-04-09 02:25:06,030 - aiogram.event - INFO - Update id=311268361 is handled. Duration 229 ms by bot id=7041366449
2025-04-09 02:25:07,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:25:07,206 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:25:07,206 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 02:25:07,208 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:25:07,302 - aiogram.event - INFO - Update id=311268362 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 02:25:10,933 - aiogram.event - INFO - Update id=311268363 is not handled. Duration 15 ms by bot id=7041366449
2025-04-09 02:28:28,858 - __main__ - INFO - Stopping application...
2025-04-09 02:28:29,313 - __main__ - INFO - Application stopped
2025-04-09 02:28:33,414 - app - INFO - Starting application...
2025-04-09 02:28:33,414 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:28:33,414 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:28:33,414 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:28:33,853 - __main__ - INFO - Application started successfully
2025-04-09 02:28:33,853 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:28:37,295 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:28:37,295 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,296 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:37,298 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:28:37,299 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-09 02:28:37,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:37,419 - aiogram.event - INFO - Update id=311268364 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 02:28:45,730 - aiogram.event - INFO - Update id=311268365 is handled. Duration 176 ms by bot id=7041366449
2025-04-09 02:28:46,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:46,757 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:28:46,794 - sqlalchemy.engine.Engine - INFO - [generated in 0.03690s] ()
2025-04-09 02:28:46,796 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:46,887 - aiogram.event - INFO - Update id=311268366 is handled. Duration 211 ms by bot id=7041366449
2025-04-09 02:28:50,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:50,366 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:28:50,367 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Цифровые товары',)
2025-04-09 02:28:50,372 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:50,467 - aiogram.event - INFO - Update id=311268367 is handled. Duration 109 ms by bot id=7041366449
2025-04-09 02:28:54,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:54,928 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'accepted'
                ORDER BY created_at DESC
            
2025-04-09 02:28:54,928 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (94,)
2025-04-09 02:28:54,929 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:55,021 - aiogram.event - INFO - Update id=311268368 is handled. Duration 95 ms by bot id=7041366449
2025-04-09 02:29:22,624 - __main__ - INFO - Stopping application...
2025-04-09 02:29:23,075 - __main__ - INFO - Application stopped
2025-04-09 02:29:26,852 - app - INFO - Starting application...
2025-04-09 02:29:26,852 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:29:26,852 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:29:26,852 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:29:27,240 - __main__ - INFO - Application started successfully
2025-04-09 02:29:27,241 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:29:31,117 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:29:31,117 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,120 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:31,121 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:29:31,121 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:29:31,122 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:31,248 - aiogram.event - INFO - Update id=311268369 is handled. Duration 195 ms by bot id=7041366449
2025-04-09 02:29:36,977 - aiogram.event - INFO - Update id=311268370 is handled. Duration 206 ms by bot id=7041366449
2025-04-09 02:29:37,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:37,998 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:29:37,998 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] ()
2025-04-09 02:29:38,003 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:38,403 - aiogram.event - INFO - Update id=311268371 is handled. Duration 520 ms by bot id=7041366449
2025-04-09 02:29:42,087 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:42,089 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:29:42,089 - sqlalchemy.engine.Engine - INFO - [generated in 0.00094s] ('Цифровые товары',)
2025-04-09 02:29:42,094 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:42,184 - aiogram.event - INFO - Update id=311268372 is handled. Duration 105 ms by bot id=7041366449
2025-04-09 02:29:43,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,112 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:43,113 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (94,)
2025-04-09 02:29:43,117 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,227 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:43,228 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (1,)
2025-04-09 02:29:43,231 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:43,231 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1,)
2025-04-09 02:29:43,233 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,235 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 133 ms by bot id=7041366449
2025-04-09 02:29:43,236 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - [cached since 0.5391s ago] (94,)
2025-04-09 02:29:43,652 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,771 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,772 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:43,773 - sqlalchemy.engine.Engine - INFO - [cached since 0.5457s ago] (1,)
2025-04-09 02:29:43,776 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:43,777 - sqlalchemy.engine.Engine - INFO - [cached since 0.546s ago] (1,)
2025-04-09 02:29:43,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,784 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 135 ms by bot id=7041366449
2025-04-09 02:29:43,785 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:46,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:46,287 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:46,287 - sqlalchemy.engine.Engine - INFO - [cached since 3.175s ago] (94,)
2025-04-09 02:29:46,289 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:46,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:46,395 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:46,396 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] (1,)
2025-04-09 02:29:46,399 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:46,400 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] (1,)
2025-04-09 02:29:46,402 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:46,403 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 125 ms by bot id=7041366449
2025-04-09 02:29:46,404 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:50,794 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:50,795 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:50,796 - sqlalchemy.engine.Engine - INFO - [cached since 7.683s ago] (94,)
2025-04-09 02:29:50,798 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:50,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:50,884 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:50,884 - sqlalchemy.engine.Engine - INFO - [cached since 7.657s ago] (1,)
2025-04-09 02:29:50,887 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:50,888 - sqlalchemy.engine.Engine - INFO - [cached since 7.657s ago] (1,)
2025-04-09 02:29:50,890 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:50,893 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 109 ms by bot id=7041366449
2025-04-09 02:29:50,893 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:59,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:59,383 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:59,384 - sqlalchemy.engine.Engine - INFO - [cached since 16.27s ago] (94,)
2025-04-09 02:29:59,384 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - [cached since 16.26s ago] (1,)
2025-04-09 02:29:59,490 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:59,491 - sqlalchemy.engine.Engine - INFO - [cached since 16.26s ago] (1,)
2025-04-09 02:29:59,493 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:59,495 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 113 ms by bot id=7041366449
2025-04-09 02:29:59,495 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:30:16,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:16,042 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:30:16,043 - sqlalchemy.engine.Engine - INFO - [cached since 32.93s ago] (94,)
2025-04-09 02:30:16,043 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:16,277 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:16,278 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:30:16,279 - sqlalchemy.engine.Engine - INFO - [cached since 33.05s ago] (1,)
2025-04-09 02:30:16,283 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:30:16,284 - sqlalchemy.engine.Engine - INFO - [cached since 33.05s ago] (1,)
2025-04-09 02:30:16,288 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:16,291 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 250 ms by bot id=7041366449
2025-04-09 02:30:16,291 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:30:48,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:48,940 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:30:48,941 - sqlalchemy.engine.Engine - INFO - [cached since 65.83s ago] (94,)
2025-04-09 02:30:48,943 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:49,174 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:49,176 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:30:49,176 - sqlalchemy.engine.Engine - INFO - [cached since 65.95s ago] (1,)
2025-04-09 02:30:49,178 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:30:49,178 - sqlalchemy.engine.Engine - INFO - [cached since 65.95s ago] (1,)
2025-04-09 02:30:49,180 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:49,181 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 251 ms by bot id=7041366449
2025-04-09 02:30:49,181 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:31:12,794 - __main__ - INFO - Stopping application...
2025-04-09 02:31:13,245 - __main__ - INFO - Application stopped
2025-04-09 02:45:35,573 - app - INFO - Starting application...
2025-04-09 02:45:35,573 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:45:35,574 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:45:35,574 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:45:35,951 - __main__ - INFO - Application started successfully
2025-04-09 02:45:35,953 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:45:36,111 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 13 ms by bot id=7041366449
2025-04-09 02:45:40,180 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:45:40,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,181 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:45:40,181 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,182 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:45:40,182 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,183 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:40,183 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:45:40,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:45:40,185 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:40,540 - aiogram.event - INFO - Update id=311268374 is handled. Duration 390 ms by bot id=7041366449
2025-04-09 02:45:42,333 - aiogram.event - INFO - Update id=311268375 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 02:45:43,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:43,373 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:45:43,374 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] ()
2025-04-09 02:45:43,379 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:43,480 - aiogram.event - INFO - Update id=311268376 is handled. Duration 189 ms by bot id=7041366449
2025-04-09 02:45:46,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:46,440 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:45:46,441 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ('Цифровые товары',)
2025-04-09 02:45:46,446 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:46,538 - aiogram.event - INFO - Update id=311268377 is handled. Duration 106 ms by bot id=7041366449
2025-04-09 02:45:47,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,429 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:47,466 - sqlalchemy.engine.Engine - INFO - [generated in 0.03672s] (94,)
2025-04-09 02:45:47,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-04-09 02:45:47,563 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:47,563 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1,)
2025-04-09 02:45:47,564 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 143 ms by bot id=7041366449
2025-04-09 02:45:47,565 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - [cached since 0.5152s ago] (94,)
2025-04-09 02:45:47,946 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:48,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:48,043 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:48,044 - sqlalchemy.engine.Engine - INFO - [cached since 0.4827s ago] (1,)
2025-04-09 02:45:48,052 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:48,053 - sqlalchemy.engine.Engine - INFO - [cached since 0.4901s ago] (1,)
2025-04-09 02:45:48,060 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 183 ms by bot id=7041366449
2025-04-09 02:45:48,061 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - [cached since 3.015s ago] (94,)
2025-04-09 02:45:50,446 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:50,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:50,549 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:50,549 - sqlalchemy.engine.Engine - INFO - [cached since 2.989s ago] (1,)
2025-04-09 02:45:50,556 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:50,556 - sqlalchemy.engine.Engine - INFO - [cached since 2.993s ago] (1,)
2025-04-09 02:45:50,559 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 186 ms by bot id=7041366449
2025-04-09 02:45:50,559 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:54,908 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a6a5198b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,910 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca4e0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,912 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bcac60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,917 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:54,918 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:54,918 - sqlalchemy.engine.Engine - INFO - [cached since 7.489s ago] (94,)
2025-04-09 02:45:54,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:55,093 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:55,094 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:55,094 - sqlalchemy.engine.Engine - INFO - [cached since 7.533s ago] (1,)
2025-04-09 02:45:55,102 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:55,102 - sqlalchemy.engine.Engine - INFO - [cached since 7.539s ago] (1,)
2025-04-09 02:45:55,107 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 242 ms by bot id=7041366449
2025-04-09 02:45:55,107 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - [cached since 17.16s ago] (94,)
2025-04-09 02:46:04,591 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:46:04,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:46:04,753 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:46:04,753 - sqlalchemy.engine.Engine - INFO - [cached since 17.19s ago] (1,)
2025-04-09 02:46:04,756 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:46:04,756 - sqlalchemy.engine.Engine - INFO - [cached since 17.19s ago] (1,)
2025-04-09 02:46:04,759 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 234 ms by bot id=7041366449
2025-04-09 02:46:04,759 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:46:15,488 - __main__ - INFO - Stopping application...
2025-04-09 02:46:15,812 - __main__ - INFO - Application stopped
2025-04-09 02:46:15,955 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca210>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:46:15,970 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca210>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:46:15,970 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67a38aa0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:46:15,972 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67a38aa0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:28,802 - app - INFO - Starting application...
2025-04-09 02:47:28,802 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:47:28,802 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:47:28,802 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:47:29,230 - __main__ - INFO - Application started successfully
2025-04-09 02:47:29,232 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:47:29,564 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 3 ms by bot id=7041366449
2025-04-09 02:47:30,124 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:47:30,124 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,125 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:47:30,125 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,126 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:47:30,126 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:47:30,128 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:30,261 - aiogram.event - INFO - Update id=311268379 is handled. Duration 196 ms by bot id=7041366449
2025-04-09 02:47:32,339 - aiogram.event - INFO - Update id=311268380 is handled. Duration 213 ms by bot id=7041366449
2025-04-09 02:47:33,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:33,248 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:47:33,248 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ()
2025-04-09 02:47:33,254 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:33,350 - aiogram.event - INFO - Update id=311268381 is handled. Duration 187 ms by bot id=7041366449
2025-04-09 02:47:39,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:39,051 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:47:39,051 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('Цифровые товары',)
2025-04-09 02:47:39,057 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:39,156 - aiogram.event - INFO - Update id=311268382 is handled. Duration 114 ms by bot id=7041366449
2025-04-09 02:47:40,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:40,687 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:40,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (94,)
2025-04-09 02:47:40,693 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:40,788 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:40,794 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:40,797 - sqlalchemy.engine.Engine - INFO - [generated in 0.00412s] (1,)
2025-04-09 02:47:40,805 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:40,805 - sqlalchemy.engine.Engine - INFO - [generated in 0.00135s] (1,)
2025-04-09 02:47:40,814 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 135 ms by bot id=7041366449
2025-04-09 02:47:40,814 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - [cached since 0.843s ago] (94,)
2025-04-09 02:47:41,531 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:41,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:41,620 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:41,620 - sqlalchemy.engine.Engine - INFO - [cached since 0.827s ago] (1,)
2025-04-09 02:47:41,628 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:41,628 - sqlalchemy.engine.Engine - INFO - [cached since 0.8243s ago] (1,)
2025-04-09 02:47:41,635 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 169 ms by bot id=7041366449
2025-04-09 02:47:41,635 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:44,064 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:44,065 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:44,065 - sqlalchemy.engine.Engine - INFO - [cached since 3.379s ago] (94,)
2025-04-09 02:47:44,069 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - [cached since 3.369s ago] (1,)
2025-04-09 02:47:44,167 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:44,168 - sqlalchemy.engine.Engine - INFO - [cached since 3.364s ago] (1,)
2025-04-09 02:47:44,172 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 171 ms by bot id=7041366449
2025-04-09 02:47:44,173 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:48,482 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb368d8b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,482 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba27b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,483 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba2f30>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:48,516 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:48,516 - sqlalchemy.engine.Engine - INFO - [cached since 7.829s ago] (94,)
2025-04-09 02:47:48,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - [cached since 7.851s ago] (1,)
2025-04-09 02:47:48,647 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:48,647 - sqlalchemy.engine.Engine - INFO - [cached since 7.843s ago] (1,)
2025-04-09 02:47:48,649 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 170 ms by bot id=7041366449
2025-04-09 02:47:48,649 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:57,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:57,186 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:57,186 - sqlalchemy.engine.Engine - INFO - [cached since 16.5s ago] (94,)
2025-04-09 02:47:57,190 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:57,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:57,414 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:57,415 - sqlalchemy.engine.Engine - INFO - [cached since 16.62s ago] (1,)
2025-04-09 02:47:57,424 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:57,424 - sqlalchemy.engine.Engine - INFO - [cached since 16.62s ago] (1,)
2025-04-09 02:47:57,431 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 356 ms by bot id=7041366449
2025-04-09 02:47:57,431 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:58,808 - __main__ - INFO - Stopping application...
2025-04-09 02:47:59,129 - __main__ - INFO - Application stopped
2025-04-09 02:47:59,272 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba3b60>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:47:59,279 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba3b60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:59,280 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0bf0e60>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:47:59,283 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0bf0e60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:48:56,774 - app - INFO - Starting application...
2025-04-09 02:48:56,774 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:48:56,774 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:48:56,774 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:48:57,154 - __main__ - INFO - Application started successfully
2025-04-09 02:48:57,155 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:48:57,314 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 13 ms by bot id=7041366449
2025-04-09 02:49:00,720 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:49:00,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,722 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:49:00,722 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,723 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:49:00,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:49:00,725 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:00,837 - aiogram.event - INFO - Update id=311268384 is handled. Duration 182 ms by bot id=7041366449
2025-04-09 02:49:04,227 - aiogram.event - INFO - Update id=311268385 is handled. Duration 193 ms by bot id=7041366449
2025-04-09 02:49:08,002 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:08,003 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:49:08,003 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 02:49:08,005 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:08,092 - aiogram.event - INFO - Update id=311268386 is handled. Duration 166 ms by bot id=7041366449
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('Цифровые товары',)
2025-04-09 02:49:11,355 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:11,441 - aiogram.event - INFO - Update id=311268387 is handled. Duration 90 ms by bot id=7041366449
2025-04-09 02:49:12,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:12,335 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:49:12,336 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] (94,)
2025-04-09 02:49:12,340 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:12,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:12,429 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:49:12,430 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-04-09 02:49:12,437 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:49:12,437 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (1,)
2025-04-09 02:49:12,525 - aiogram.event - INFO - Update id=311268388 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 02:49:18,935 - root - ERROR - Ошибка при редактировании сообщения: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-09 02:49:19,023 - aiogram.event - INFO - Update id=311268389 is handled. Duration 240 ms by bot id=7041366449
2025-04-09 02:49:20,664 - root - ERROR - Ошибка при редактировании сообщения: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-09 02:49:20,750 - aiogram.event - INFO - Update id=311268390 is handled. Duration 259 ms by bot id=7041366449
2025-04-09 02:49:37,544 - __main__ - INFO - Stopping application...
2025-04-09 02:49:38,258 - __main__ - INFO - Application stopped
2025-04-09 02:49:38,378 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e2d8f6b58b0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:49:38,382 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e2d8f6b58b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:55:19,414 - app - INFO - Starting application...
2025-04-09 02:55:19,414 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:55:19,414 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:55:19,414 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:55:19,759 - __main__ - INFO - Application started successfully
2025-04-09 02:55:19,759 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:55:36,990 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:55:36,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:55:36,991 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:55:36,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:55:36,992 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:55:36,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:55:36,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:36,993 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:55:36,993 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-09 02:55:36,995 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:37,480 - aiogram.event - INFO - Update id=311268391 is handled. Duration 531 ms by bot id=7041366449
2025-04-09 02:55:39,831 - aiogram.event - INFO - Update id=311268392 is handled. Duration 166 ms by bot id=7041366449
2025-04-09 02:55:41,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:41,126 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:55:41,126 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 02:55:41,128 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:41,214 - aiogram.event - INFO - Update id=311268393 is handled. Duration 170 ms by bot id=7041366449
2025-04-09 02:55:44,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:44,302 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:55:44,302 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('Цифровые товары',)
2025-04-09 02:55:44,306 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:44,524 - aiogram.event - INFO - Update id=311268394 is handled. Duration 226 ms by bot id=7041366449
2025-04-09 02:55:45,457 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:45,458 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:55:45,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] (94,)
2025-04-09 02:55:45,465 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:45,560 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:45,560 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:55:45,560 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1,)
2025-04-09 02:55:45,562 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:55:45,562 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1,)
2025-04-09 02:55:45,564 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 115 ms by bot id=7041366449
2025-04-09 02:55:45,565 - __main__ - ERROR - Error processing webhook: cannot import name 'MediaGroup' from 'aiogram.types' (/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/types/__init__.py)
2025-04-09 02:55:46,027 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:46,027 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:55:46,027 - sqlalchemy.engine.Engine - INFO - [cached since 0.5692s ago] (94,)
2025-04-09 02:55:46,029 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:46,182 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:46,182 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:55:46,183 - sqlalchemy.engine.Engine - INFO - [cached since 0.6226s ago] (1,)
2025-04-09 02:55:46,189 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:55:46,189 - sqlalchemy.engine.Engine - INFO - [cached since 0.6271s ago] (1,)
2025-04-09 02:55:46,195 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 234 ms by bot id=7041366449
2025-04-09 02:55:46,195 - __main__ - ERROR - Error processing webhook: cannot import name 'MediaGroup' from 'aiogram.types' (/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/types/__init__.py)
2025-04-09 02:55:48,574 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:48,574 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:55:48,574 - sqlalchemy.engine.Engine - INFO - [cached since 3.116s ago] (94,)
2025-04-09 02:55:48,576 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:48,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:48,662 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:55:48,663 - sqlalchemy.engine.Engine - INFO - [cached since 3.102s ago] (1,)
2025-04-09 02:55:48,671 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:55:48,671 - sqlalchemy.engine.Engine - INFO - [cached since 3.109s ago] (1,)
2025-04-09 02:55:48,679 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 166 ms by bot id=7041366449
2025-04-09 02:55:48,680 - __main__ - ERROR - Error processing webhook: cannot import name 'MediaGroup' from 'aiogram.types' (/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/types/__init__.py)
2025-04-09 02:55:53,139 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a881cd70>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:55:53,141 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5de5b80>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:55:53,143 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5de68a0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:55:53,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:53,202 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:55:53,202 - sqlalchemy.engine.Engine - INFO - [cached since 7.744s ago] (94,)
2025-04-09 02:55:53,205 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:55:53,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:55:53,402 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:55:53,402 - sqlalchemy.engine.Engine - INFO - [cached since 7.841s ago] (1,)
2025-04-09 02:55:53,405 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:55:53,405 - sqlalchemy.engine.Engine - INFO - [cached since 7.842s ago] (1,)
2025-04-09 02:55:53,407 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 278 ms by bot id=7041366449
2025-04-09 02:55:53,407 - __main__ - ERROR - Error processing webhook: cannot import name 'MediaGroup' from 'aiogram.types' (/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/types/__init__.py)
2025-04-09 02:56:02,074 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:56:02,074 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:56:02,074 - sqlalchemy.engine.Engine - INFO - [cached since 16.62s ago] (94,)
2025-04-09 02:56:02,076 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:56:02,252 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:56:02,252 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:56:02,252 - sqlalchemy.engine.Engine - INFO - [cached since 16.69s ago] (1,)
2025-04-09 02:56:02,257 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:56:02,258 - sqlalchemy.engine.Engine - INFO - [cached since 16.7s ago] (1,)
2025-04-09 02:56:02,261 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 251 ms by bot id=7041366449
2025-04-09 02:56:02,261 - __main__ - ERROR - Error processing webhook: cannot import name 'MediaGroup' from 'aiogram.types' (/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/types/__init__.py)
2025-04-09 02:56:06,851 - __main__ - INFO - Stopping application...
2025-04-09 02:56:07,168 - __main__ - INFO - Application stopped
2025-04-09 02:56:07,327 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5de5c70>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:56:07,332 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5de5c70>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:56:07,332 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5c54140>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:56:07,335 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x77e3a5c54140>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:57:17,321 - app - INFO - Starting application...
2025-04-09 02:57:17,321 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:57:17,321 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:57:17,321 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:57:17,718 - __main__ - INFO - Application started successfully
2025-04-09 02:57:17,719 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:57:17,877 - aiogram.event - INFO - Update id=311268395 is not handled. Duration 12 ms by bot id=7041366449
2025-04-09 02:57:20,745 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:57:20,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:57:20,747 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:57:20,747 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:57:20,748 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:57:20,748 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:57:20,748 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:57:20,749 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:57:20,749 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1043270764,)
2025-04-09 02:57:20,750 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:57:20,863 - aiogram.event - INFO - Update id=311268396 is handled. Duration 180 ms by bot id=7041366449
2025-04-09 02:57:22,639 - aiogram.event - INFO - Update id=311268397 is handled. Duration 188 ms by bot id=7041366449
2025-04-09 02:57:24,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:57:24,047 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:57:24,047 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ()
2025-04-09 02:57:24,050 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:57:24,144 - aiogram.event - INFO - Update id=311268398 is handled. Duration 183 ms by bot id=7041366449
2025-04-09 02:57:26,453 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:57:26,454 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:57:26,455 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] ('Цифровые товары',)
2025-04-09 02:57:26,461 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:57:26,559 - aiogram.event - INFO - Update id=311268399 is handled. Duration 114 ms by bot id=7041366449
2025-04-09 02:57:27,262 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:57:27,263 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:57:27,263 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (94,)
2025-04-09 02:57:27,269 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:57:27,378 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:57:27,379 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:57:27,379 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (1,)
2025-04-09 02:57:27,382 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:57:27,382 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1,)
2025-04-09 02:57:27,472 - aiogram.event - INFO - Update id=311268400 is handled. Duration 217 ms by bot id=7041366449
2025-04-09 03:00:00,606 - __main__ - INFO - Stopping application...
2025-04-09 03:00:01,334 - __main__ - INFO - Application stopped
2025-04-09 03:00:01,430 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7d21e32719a0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:00:01,436 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7d21e32719a0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:00:04,996 - app - INFO - Starting application...
2025-04-09 03:00:04,997 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 03:00:04,997 - __main__ - INFO - Action config initialized successfully
2025-04-09 03:00:04,997 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 03:00:05,394 - __main__ - INFO - Application started successfully
2025-04-09 03:00:05,395 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 03:00:09,815 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 03:00:09,815 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:00:09,817 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 03:00:09,817 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:00:09,817 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 03:00:09,817 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:00:09,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:09,818 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 03:00:09,819 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 03:00:09,819 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:09,926 - aiogram.event - INFO - Update id=311268401 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 03:00:12,720 - aiogram.event - INFO - Update id=311268402 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 03:00:15,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:15,205 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 03:00:15,206 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ()
2025-04-09 03:00:15,209 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:15,422 - aiogram.event - INFO - Update id=311268403 is handled. Duration 345 ms by bot id=7041366449
2025-04-09 03:00:19,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:19,485 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 03:00:19,485 - sqlalchemy.engine.Engine - INFO - [generated in 0.00085s] ('Цифровые товары',)
2025-04-09 03:00:19,491 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:19,580 - aiogram.event - INFO - Update id=311268404 is handled. Duration 104 ms by bot id=7041366449
2025-04-09 03:00:20,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:20,754 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:00:20,754 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (94,)
2025-04-09 03:00:20,759 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:20,864 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:20,865 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:00:20,865 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (1,)
2025-04-09 03:00:20,869 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:00:20,869 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1,)
2025-04-09 03:00:20,871 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:00:20,871 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:20,872 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:20,958 - aiogram.event - INFO - Update id=311268405 is not handled. Duration 212 ms by bot id=7041366449
2025-04-09 03:00:20,958 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:00:22,410 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:22,411 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:00:22,411 - sqlalchemy.engine.Engine - INFO - [cached since 1.657s ago] (94,)
2025-04-09 03:00:22,412 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:22,522 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:22,523 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:00:22,524 - sqlalchemy.engine.Engine - INFO - [cached since 1.659s ago] (1,)
2025-04-09 03:00:22,529 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:00:22,529 - sqlalchemy.engine.Engine - INFO - [cached since 1.661s ago] (1,)
2025-04-09 03:00:22,532 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:00:22,533 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:22,533 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:22,655 - aiogram.event - INFO - Update id=311268405 is not handled. Duration 312 ms by bot id=7041366449
2025-04-09 03:00:22,655 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:00:25,754 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:25,754 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:00:25,754 - sqlalchemy.engine.Engine - INFO - [cached since 5.001s ago] (94,)
2025-04-09 03:00:25,756 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:00:25,873 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:00:25,874 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:00:25,874 - sqlalchemy.engine.Engine - INFO - [cached since 5.01s ago] (1,)
2025-04-09 03:00:25,879 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:00:25,880 - sqlalchemy.engine.Engine - INFO - [cached since 5.011s ago] (1,)
2025-04-09 03:00:25,883 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:00:25,883 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:25,883 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:00:25,965 - aiogram.event - INFO - Update id=311268405 is not handled. Duration 276 ms by bot id=7041366449
2025-04-09 03:00:25,965 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:00:26,768 - __main__ - INFO - Stopping application...
2025-04-09 03:00:27,095 - __main__ - INFO - Application stopped
2025-04-09 03:00:27,199 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d977d220>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:00:27,204 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d977d220>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:00:27,204 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d6c45b80>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:00:27,206 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d6c45b80>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:00:27,206 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d6c468a0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:00:27,208 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x76f0d6c468a0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:04:44,545 - app - INFO - Starting application...
2025-04-09 03:04:44,545 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 03:04:44,545 - __main__ - INFO - Action config initialized successfully
2025-04-09 03:04:44,546 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 03:04:44,920 - __main__ - INFO - Application started successfully
2025-04-09 03:04:44,921 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 03:04:45,089 - aiogram.event - INFO - Update id=311268405 is not handled. Duration 20 ms by bot id=7041366449
2025-04-09 03:04:47,113 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 03:04:47,113 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:04:47,115 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 03:04:47,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:04:47,116 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 03:04:47,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:04:47,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:47,117 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 03:04:47,117 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-09 03:04:47,118 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:47,236 - aiogram.event - INFO - Update id=311268406 is handled. Duration 182 ms by bot id=7041366449
2025-04-09 03:04:48,480 - aiogram.event - INFO - Update id=311268407 is handled. Duration 182 ms by bot id=7041366449
2025-04-09 03:04:49,487 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:49,488 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 03:04:49,489 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] ()
2025-04-09 03:04:49,495 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:49,591 - aiogram.event - INFO - Update id=311268408 is handled. Duration 185 ms by bot id=7041366449
2025-04-09 03:04:52,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:52,382 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 03:04:52,383 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('Цифровые товары',)
2025-04-09 03:04:52,385 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:52,471 - aiogram.event - INFO - Update id=311268409 is handled. Duration 92 ms by bot id=7041366449
2025-04-09 03:04:53,719 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:53,721 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:04:53,722 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] (94,)
2025-04-09 03:04:53,728 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:53,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:53,819 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:04:53,819 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (1,)
2025-04-09 03:04:53,822 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:04:53,823 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1,)
2025-04-09 03:04:53,824 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:04:53,825 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:53,825 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:53,915 - aiogram.event - INFO - Update id=311268410 is not handled. Duration 206 ms by bot id=7041366449
2025-04-09 03:04:53,916 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:04:54,285 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:54,285 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:04:54,286 - sqlalchemy.engine.Engine - INFO - [cached since 0.5647s ago] (94,)
2025-04-09 03:04:54,287 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:54,373 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:54,374 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:04:54,375 - sqlalchemy.engine.Engine - INFO - [cached since 0.5557s ago] (1,)
2025-04-09 03:04:54,383 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:04:54,384 - sqlalchemy.engine.Engine - INFO - [cached since 0.5618s ago] (1,)
2025-04-09 03:04:54,391 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:04:54,392 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:54,393 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:54,473 - aiogram.event - INFO - Update id=311268410 is not handled. Duration 257 ms by bot id=7041366449
2025-04-09 03:04:54,473 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:04:57,121 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:57,121 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 03:04:57,121 - sqlalchemy.engine.Engine - INFO - [cached since 3.4s ago] (94,)
2025-04-09 03:04:57,123 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:04:57,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:04:57,213 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:04:57,213 - sqlalchemy.engine.Engine - INFO - [cached since 3.394s ago] (1,)
2025-04-09 03:04:57,222 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:04:57,223 - sqlalchemy.engine.Engine - INFO - [cached since 3.4s ago] (1,)
2025-04-09 03:04:57,228 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:04:57,229 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:57,229 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:04:57,309 - aiogram.event - INFO - Update id=311268410 is not handled. Duration 221 ms by bot id=7041366449
2025-04-09 03:04:57,309 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:04:58,349 - __main__ - INFO - Stopping application...
2025-04-09 03:04:58,696 - __main__ - INFO - Application stopped
2025-04-09 03:04:58,792 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c3c8d8b0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:04:58,796 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c3c8d8b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:04:58,796 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c136e4e0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:04:58,798 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c136e4e0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:04:58,798 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c136ec60>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 03:04:58,799 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e06c136ec60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 03:13:04,961 - app - INFO - Starting application...
2025-04-09 03:13:04,962 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 03:13:04,962 - __main__ - INFO - Action config initialized successfully
2025-04-09 03:13:04,962 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 03:13:05,322 - __main__ - INFO - Application started successfully
2025-04-09 03:13:05,324 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 03:13:05,485 - aiogram.event - INFO - Update id=311268410 is not handled. Duration 11 ms by bot id=7041366449
2025-04-09 03:13:07,446 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 03:13:07,446 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:13:07,448 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 03:13:07,448 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:13:07,448 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 03:13:07,449 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:13:07,450 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:07,450 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 03:13:07,450 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1043270764,)
2025-04-09 03:13:07,451 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:07,582 - aiogram.event - INFO - Update id=311268411 is handled. Duration 191 ms by bot id=7041366449
2025-04-09 03:13:09,159 - aiogram.event - INFO - Update id=311268412 is handled. Duration 180 ms by bot id=7041366449
2025-04-09 03:13:12,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:12,282 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 03:13:12,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00125s] ()
2025-04-09 03:13:12,288 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:12,377 - aiogram.event - INFO - Update id=311268413 is handled. Duration 176 ms by bot id=7041366449
2025-04-09 03:13:15,003 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:15,003 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 03:13:15,003 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('Цифровые товары',)
2025-04-09 03:13:15,004 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:15,086 - aiogram.event - INFO - Update id=311268414 is handled. Duration 85 ms by bot id=7041366449
2025-04-09 03:13:15,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:15,995 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 03:13:15,996 - sqlalchemy.engine.Engine - INFO - [generated in 0.00116s] (94,)
2025-04-09 03:13:16,001 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:16,089 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:16,090 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:13:16,090 - sqlalchemy.engine.Engine - INFO - [generated in 0.00134s] (1,)
2025-04-09 03:13:16,098 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:16,100 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:13:16,101 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:13:16,102 - sqlalchemy.engine.Engine - INFO - [generated in 0.00134s] (1,)
2025-04-09 03:13:16,106 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:13:16,107 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:13:16,107 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:13:16,108 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:13:16,184 - root - ERROR - Ошибка при получении поставщиков для подкатегории 94: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-09 03:13:16,267 - aiogram.event - INFO - Update id=311268415 is handled. Duration 281 ms by bot id=7041366449
2025-04-09 03:13:24,103 - __main__ - INFO - Stopping application...
2025-04-09 03:13:24,423 - __main__ - INFO - Application stopped
2025-04-09 03:14:53,020 - app - INFO - Starting application...
2025-04-09 03:14:53,020 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 03:14:53,020 - __main__ - INFO - Action config initialized successfully
2025-04-09 03:14:53,020 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 03:14:53,442 - __main__ - INFO - Application started successfully
2025-04-09 03:14:53,442 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 03:14:54,921 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 03:14:54,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:14:54,923 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 03:14:54,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:14:54,924 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 03:14:54,924 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 03:14:54,925 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:14:54,925 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 03:14:54,925 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-09 03:14:54,926 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:14:55,031 - aiogram.event - INFO - Update id=311268416 is handled. Duration 139 ms by bot id=7041366449
2025-04-09 03:14:57,012 - aiogram.event - INFO - Update id=311268417 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 03:14:58,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:14:58,209 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 03:14:58,209 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-04-09 03:14:58,212 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:14:58,308 - aiogram.event - INFO - Update id=311268418 is handled. Duration 179 ms by bot id=7041366449
2025-04-09 03:15:01,084 - aiogram.event - INFO - Update id=311268419 is handled. Duration 99 ms by bot id=7041366449
2025-04-09 03:15:02,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:15:02,931 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 03:15:02,931 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] ('Цифровые товары',)
2025-04-09 03:15:02,936 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:15:03,035 - aiogram.event - INFO - Update id=311268420 is handled. Duration 111 ms by bot id=7041366449
2025-04-09 03:15:04,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:15:04,241 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 03:15:04,242 - sqlalchemy.engine.Engine - INFO - [generated in 0.00121s] (94,)
2025-04-09 03:15:04,246 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:15:04,339 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:15:04,340 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 03:15:04,340 - sqlalchemy.engine.Engine - INFO - [generated in 0.00173s] (1,)
2025-04-09 03:15:04,345 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:15:04,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 03:15:04,348 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 03:15:04,348 - sqlalchemy.engine.Engine - INFO - [generated in 0.00087s] (1,)
2025-04-09 03:15:04,350 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 03:15:04,351 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 03:15:04,352 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:15:04,352 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 03:15:04,352 - root - ERROR - Ошибка при отправке фото: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value=<_io.BufferedReader name=...44888ef36e1494f757.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value=<_io.BufferedReader name=...44888ef36e1494f757.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/is_instance_of
2025-04-09 03:15:04,441 - aiogram.event - INFO - Update id=311268421 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 13:56:08,983 - app - INFO - Starting application...
2025-04-09 13:56:08,984 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 13:56:08,984 - __main__ - INFO - Action config initialized successfully
2025-04-09 13:56:08,984 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 13:56:09,789 - __main__ - INFO - Application started successfully
2025-04-09 13:56:09,790 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 13:56:19,320 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 13:56:19,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:56:19,323 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 13:56:19,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:56:19,324 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 13:56:19,324 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:56:19,325 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:19,325 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 13:56:19,325 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764,)
2025-04-09 13:56:19,329 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:19,629 - aiogram.event - INFO - Update id=311268422 is handled. Duration 414 ms by bot id=7041366449
2025-04-09 13:56:21,341 - aiogram.event - INFO - Update id=311268423 is handled. Duration 492 ms by bot id=7041366449
2025-04-09 13:56:22,607 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:22,607 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 13:56:22,608 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] ()
2025-04-09 13:56:22,622 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:22,767 - aiogram.event - INFO - Update id=311268424 is handled. Duration 277 ms by bot id=7041366449
2025-04-09 13:56:26,591 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:26,591 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 13:56:26,602 - sqlalchemy.engine.Engine - INFO - [generated in 0.01087s] ('Цифровые товары',)
2025-04-09 13:56:26,608 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:26,763 - aiogram.event - INFO - Update id=311268425 is handled. Duration 178 ms by bot id=7041366449
2025-04-09 13:56:29,149 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:29,149 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 13:56:29,149 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (94,)
2025-04-09 13:56:29,188 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:29,404 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:29,405 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 13:56:29,405 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] (1,)
2025-04-09 13:56:29,410 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:29,412 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:56:29,413 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 13:56:29,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00128s] (1,)
2025-04-09 13:56:29,419 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:56:29,421 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 13:56:29,422 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:56:29,422 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:56:29,423 - root - ERROR - Ошибка при отправке фото: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 13:56:29,591 - aiogram.event - INFO - Update id=311268426 is handled. Duration 446 ms by bot id=7041366449
2025-04-09 13:57:32,122 - __main__ - INFO - Stopping application...
2025-04-09 13:57:32,925 - __main__ - INFO - Application stopped
2025-04-09 13:58:13,531 - app - INFO - Starting application...
2025-04-09 13:58:13,531 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 13:58:13,531 - __main__ - INFO - Action config initialized successfully
2025-04-09 13:58:13,532 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 13:58:14,250 - __main__ - INFO - Application started successfully
2025-04-09 13:58:14,251 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 13:58:20,432 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 13:58:20,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:58:20,433 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 13:58:20,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:58:20,435 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 13:58:20,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:58:20,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:20,436 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 13:58:20,436 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 13:58:20,437 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:20,605 - aiogram.event - INFO - Update id=311268427 is handled. Duration 352 ms by bot id=7041366449
2025-04-09 13:58:26,096 - aiogram.event - INFO - Update id=311268428 is handled. Duration 520 ms by bot id=7041366449
2025-04-09 13:58:27,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:27,506 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 13:58:27,507 - sqlalchemy.engine.Engine - INFO - [cached since 7.071s ago] ()
2025-04-09 13:58:27,509 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:27,694 - aiogram.event - INFO - Update id=311268429 is handled. Duration 379 ms by bot id=7041366449
2025-04-09 13:58:28,651 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:28,651 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 13:58:28,651 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('Цифровые товары',)
2025-04-09 13:58:28,652 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:28,775 - aiogram.event - INFO - Update id=311268430 is handled. Duration 127 ms by bot id=7041366449
2025-04-09 13:58:30,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:30,806 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 13:58:30,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (94,)
2025-04-09 13:58:30,811 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:30,961 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:30,962 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 13:58:30,962 - sqlalchemy.engine.Engine - INFO - [generated in 0.00107s] (1,)
2025-04-09 13:58:30,967 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:30,969 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:58:30,969 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 13:58:30,970 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (1,)
2025-04-09 13:58:30,973 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:58:30,974 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 13:58:30,974 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:58:30,974 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:58:30,974 - root - ERROR - Ошибка при отправке фото: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value=<_io.BufferedReader name=...44888ef36e1494f757.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value=<_io.BufferedReader name=...44888ef36e1494f757.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/is_instance_of
2025-04-09 13:58:31,107 - aiogram.event - INFO - Update id=311268431 is handled. Duration 309 ms by bot id=7041366449
2025-04-09 13:58:56,193 - __main__ - INFO - Stopping application...
2025-04-09 13:58:57,008 - __main__ - INFO - Application stopped
2025-04-09 13:59:28,353 - app - INFO - Starting application...
2025-04-09 13:59:28,353 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 13:59:28,353 - __main__ - INFO - Action config initialized successfully
2025-04-09 13:59:28,353 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 13:59:28,969 - __main__ - INFO - Application started successfully
2025-04-09 13:59:28,970 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 13:59:31,127 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 13:59:31,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:59:31,129 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 13:59:31,129 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:59:31,130 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 13:59:31,130 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 13:59:31,131 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:59:31,131 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 13:59:31,131 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 13:59:31,132 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:59:31,405 - aiogram.event - INFO - Update id=311268432 is handled. Duration 595 ms by bot id=7041366449
2025-04-09 13:59:33,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:59:33,777 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 13:59:33,778 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('Цифровые товары',)
2025-04-09 13:59:33,779 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:59:33,934 - aiogram.event - INFO - Update id=311268433 is handled. Duration 160 ms by bot id=7041366449
2025-04-09 13:59:35,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:59:35,230 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 13:59:35,231 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] (94,)
2025-04-09 13:59:35,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:59:35,460 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:59:35,461 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 13:59:35,461 - sqlalchemy.engine.Engine - INFO - [generated in 0.00111s] (1,)
2025-04-09 13:59:35,467 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:59:35,470 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 13:59:35,470 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 13:59:35,470 - sqlalchemy.engine.Engine - INFO - [generated in 0.00098s] (1,)
2025-04-09 13:59:35,474 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 13:59:35,477 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 13:59:35,477 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:59:35,477 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:59:36,639 - root - INFO - Отправляем доп. фото 1: storage/2025/04/09/b2a135030f334483bb8c624de797aea7.jpg
2025-04-09 13:59:37,561 - root - INFO - Отправляем доп. фото 2: storage/2025/04/09/60a7c066635f48a981575c170c2f98de.jpg
2025-04-09 13:59:38,584 - root - INFO - Отправляем доп. фото 3: storage/2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg
2025-04-09 13:59:39,302 - aiogram.event - INFO - Update id=311268434 is handled. Duration 4078 ms by bot id=7041366449
2025-04-09 13:59:46,990 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 13:59:46,990 - root - INFO - Полный путь к первому фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:59:47,155 - root - INFO - Отправляем фото: storage/2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 13:59:47,904 - root - INFO - Отправляем доп. фото 1: storage/2025/04/09/b2a135030f334483bb8c624de797aea7.jpg
2025-04-09 13:59:48,619 - root - INFO - Отправляем доп. фото 2: storage/2025/04/09/60a7c066635f48a981575c170c2f98de.jpg
2025-04-09 13:59:49,519 - root - INFO - Отправляем доп. фото 3: storage/2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg
2025-04-09 13:59:49,889 - aiogram.event - INFO - Update id=311268435 is handled. Duration 3106 ms by bot id=7041366449
2025-04-09 14:02:07,413 - __main__ - INFO - Stopping application...
2025-04-09 14:02:08,238 - __main__ - INFO - Application stopped
2025-04-09 14:02:11,683 - app - INFO - Starting application...
2025-04-09 14:02:11,683 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:02:11,683 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:02:11,683 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:02:12,494 - __main__ - INFO - Application started successfully
2025-04-09 14:02:12,496 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:02:16,009 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:02:16,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:02:16,019 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:02:16,019 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:02:16,020 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:02:16,020 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:02:16,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:16,021 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:02:16,021 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1043270764,)
2025-04-09 14:02:16,022 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:16,321 - aiogram.event - INFO - Update id=311268436 is handled. Duration 341 ms by bot id=7041366449
2025-04-09 14:02:19,378 - aiogram.event - INFO - Update id=311268437 is handled. Duration 239 ms by bot id=7041366449
2025-04-09 14:02:20,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:20,415 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:02:20,415 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ()
2025-04-09 14:02:20,419 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:20,551 - aiogram.event - INFO - Update id=311268438 is handled. Duration 272 ms by bot id=7041366449
2025-04-09 14:02:26,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:26,722 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:02:26,722 - sqlalchemy.engine.Engine - INFO - [generated in 0.00094s] ('Цифровые товары',)
2025-04-09 14:02:26,726 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:26,846 - aiogram.event - INFO - Update id=311268439 is handled. Duration 130 ms by bot id=7041366449
2025-04-09 14:02:29,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:29,606 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:02:29,606 - sqlalchemy.engine.Engine - INFO - [generated in 0.00101s] (94,)
2025-04-09 14:02:29,610 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:29,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:29,742 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:02:29,742 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (1,)
2025-04-09 14:02:29,747 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:29,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:02:29,749 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:02:29,750 - sqlalchemy.engine.Engine - INFO - [generated in 0.00103s] (1,)
2025-04-09 14:02:29,753 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:02:29,755 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:02:32,067 - aiogram.event - INFO - Update id=311268440 is handled. Duration 2468 ms by bot id=7041366449
2025-04-09 14:03:50,590 - __main__ - INFO - Stopping application...
2025-04-09 14:03:51,491 - __main__ - INFO - Application stopped
2025-04-09 14:03:55,077 - app - INFO - Starting application...
2025-04-09 14:03:55,077 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:03:55,077 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:03:55,078 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:03:55,731 - __main__ - INFO - Application started successfully
2025-04-09 14:03:55,731 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:03:57,908 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:03:57,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:03:57,910 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:03:57,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:03:57,911 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:03:57,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:03:57,912 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:03:57,912 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:03:57,912 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 14:03:57,913 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:03:58,119 - aiogram.event - INFO - Update id=311268441 is handled. Duration 350 ms by bot id=7041366449
2025-04-09 14:04:01,659 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:04:01,659 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:04:01,659 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ('Цифровые товары',)
2025-04-09 14:04:01,661 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:04:01,798 - aiogram.event - INFO - Update id=311268442 is handled. Duration 140 ms by bot id=7041366449
2025-04-09 14:04:04,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:04:04,737 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:04:04,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00120s] (94,)
2025-04-09 14:04:04,742 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:04:04,956 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:04:04,956 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:04:04,957 - sqlalchemy.engine.Engine - INFO - [generated in 0.00114s] (1,)
2025-04-09 14:04:04,962 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:04:04,964 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:04:04,964 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:04:04,965 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] (1,)
2025-04-09 14:04:04,968 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:04:04,971 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:04:05,969 - aiogram.event - INFO - Update id=311268443 is handled. Duration 1240 ms by bot id=7041366449
2025-04-09 14:06:50,354 - __main__ - INFO - Stopping application...
2025-04-09 14:06:51,300 - __main__ - INFO - Application stopped
2025-04-09 14:06:56,265 - app - INFO - Starting application...
2025-04-09 14:06:56,265 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:06:56,265 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:06:56,265 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:06:56,897 - __main__ - INFO - Application started successfully
2025-04-09 14:06:56,898 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:06:59,700 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:06:59,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:06:59,701 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:06:59,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:06:59,702 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:06:59,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:06:59,704 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:06:59,704 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:06:59,704 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1043270764,)
2025-04-09 14:06:59,705 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:06:59,872 - aiogram.event - INFO - Update id=311268444 is handled. Duration 219 ms by bot id=7041366449
2025-04-09 14:07:11,360 - aiogram.event - INFO - Update id=311268445 is handled. Duration 329 ms by bot id=7041366449
2025-04-09 14:07:12,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:12,742 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:07:12,742 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 14:07:12,744 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:12,918 - aiogram.event - INFO - Update id=311268446 is handled. Duration 324 ms by bot id=7041366449
2025-04-09 14:07:14,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:14,728 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:07:14,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ('Цифровые товары',)
2025-04-09 14:07:14,729 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:14,903 - aiogram.event - INFO - Update id=311268447 is handled. Duration 177 ms by bot id=7041366449
2025-04-09 14:07:17,182 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:17,182 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:07:17,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (94,)
2025-04-09 14:07:17,186 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:17,320 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:17,320 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:07:17,321 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (1,)
2025-04-09 14:07:17,323 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:17,324 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:17,324 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:07:17,324 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1,)
2025-04-09 14:07:17,325 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:17,326 - root - ERROR - Ошибка при получении поставщиков для подкатегории 94: send_supplier_card() got an unexpected keyword argument 'inline_keyboard'
2025-04-09 14:07:17,447 - aiogram.event - INFO - Update id=311268448 is handled. Duration 266 ms by bot id=7041366449
2025-04-09 14:07:40,601 - __main__ - INFO - Stopping application...
2025-04-09 14:07:41,429 - __main__ - INFO - Application stopped
2025-04-09 14:07:44,747 - app - INFO - Starting application...
2025-04-09 14:07:44,747 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:07:44,748 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:07:44,748 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:07:45,450 - __main__ - INFO - Application started successfully
2025-04-09 14:07:45,451 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:07:53,448 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:07:53,448 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:07:53,450 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:07:53,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:07:53,450 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:07:53,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:07:53,451 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:07:53,451 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:07:53,452 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 14:07:53,452 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:07:53,663 - aiogram.event - INFO - Update id=311268449 is handled. Duration 421 ms by bot id=7041366449
2025-04-09 14:07:57,577 - aiogram.event - INFO - Update id=311268450 is handled. Duration 293 ms by bot id=7041366449
2025-04-09 14:08:01,891 - aiogram.event - INFO - Update id=311268451 is handled. Duration 716 ms by bot id=7041366449
2025-04-09 14:08:05,055 - aiogram.event - INFO - Update id=311268452 is handled. Duration 462 ms by bot id=7041366449
2025-04-09 14:08:06,539 - aiogram.event - INFO - Update id=311268453 is handled. Duration 245 ms by bot id=7041366449
2025-04-09 14:10:03,861 - aiogram.event - INFO - Update id=311268454 is handled. Duration 827 ms by bot id=7041366449
2025-04-09 14:10:05,194 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:10:05,195 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:10:05,195 - sqlalchemy.engine.Engine - INFO - [cached since 131.7s ago] ()
2025-04-09 14:10:05,197 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:10:05,386 - aiogram.event - INFO - Update id=311268455 is handled. Duration 305 ms by bot id=7041366449
2025-04-09 14:10:08,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:10:08,774 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:10:08,774 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ('Цифровые товары',)
2025-04-09 14:10:08,779 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:10:08,920 - aiogram.event - INFO - Update id=311268456 is handled. Duration 153 ms by bot id=7041366449
2025-04-09 14:10:11,842 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:10:11,842 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:10:11,842 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (94,)
2025-04-09 14:10:11,843 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:10:12,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:10:12,043 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:10:12,043 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] (1,)
2025-04-09 14:10:12,048 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:10:12,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:10:12,050 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:10:12,051 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (1,)
2025-04-09 14:10:12,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:10:12,055 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:10:13,359 - aiogram.event - INFO - Update id=311268457 is handled. Duration 1520 ms by bot id=7041366449
2025-04-09 14:10:19,835 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:10:21,087 - aiogram.event - INFO - Update id=311268458 is handled. Duration 1258 ms by bot id=7041366449
2025-04-09 14:13:01,957 - __main__ - INFO - Stopping application...
2025-04-09 14:13:02,614 - __main__ - INFO - Application stopped
2025-04-09 14:13:07,855 - app - INFO - Starting application...
2025-04-09 14:13:07,855 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:13:07,855 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:13:07,855 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:13:09,704 - __main__ - INFO - Application started successfully
2025-04-09 14:13:09,706 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:13:10,737 - aiogram.event - INFO - Update id=311268459 is not handled. Duration 2 ms by bot id=7041366449
2025-04-09 14:13:14,030 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:13:14,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:13:14,031 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:13:14,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:13:14,032 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:13:14,032 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:13:14,033 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:14,033 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:13:14,033 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-09 14:13:14,034 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:14,214 - aiogram.event - INFO - Update id=311268460 is handled. Duration 209 ms by bot id=7041366449
2025-04-09 14:13:15,658 - aiogram.event - INFO - Update id=311268461 is handled. Duration 276 ms by bot id=7041366449
2025-04-09 14:13:17,111 - aiogram.event - INFO - Update id=311268462 is handled. Duration 231 ms by bot id=7041366449
2025-04-09 14:13:19,653 - aiogram.event - INFO - Update id=311268463 is handled. Duration 322 ms by bot id=7041366449
2025-04-09 14:13:21,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:21,996 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:13:21,997 - sqlalchemy.engine.Engine - INFO - [cached since 7.964s ago] (1043270764,)
2025-04-09 14:13:21,997 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:22,188 - aiogram.event - INFO - Update id=311268464 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 14:13:23,503 - aiogram.event - INFO - Update id=311268465 is handled. Duration 280 ms by bot id=7041366449
2025-04-09 14:13:25,959 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:25,959 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:13:25,960 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ()
2025-04-09 14:13:25,964 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:26,104 - aiogram.event - INFO - Update id=311268466 is handled. Duration 321 ms by bot id=7041366449
2025-04-09 14:13:29,470 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:29,470 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:13:29,470 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('Цифровые товары',)
2025-04-09 14:13:29,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:29,775 - aiogram.event - INFO - Update id=311268467 is handled. Duration 306 ms by bot id=7041366449
2025-04-09 14:13:31,516 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:31,516 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:13:31,517 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (94,)
2025-04-09 14:13:31,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:31,654 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:31,654 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:13:31,654 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1,)
2025-04-09 14:13:31,655 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:31,656 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:13:31,656 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:13:31,656 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1,)
2025-04-09 14:13:31,657 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:13:31,657 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:13:33,665 - aiogram.event - INFO - Update id=311268468 is handled. Duration 2150 ms by bot id=7041366449
2025-04-09 14:17:02,648 - __main__ - INFO - Stopping application...
2025-04-09 14:17:03,540 - __main__ - INFO - Application stopped
2025-04-09 14:17:09,873 - app - INFO - Starting application...
2025-04-09 14:17:09,873 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:17:09,874 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:17:09,874 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:17:10,683 - __main__ - INFO - Application started successfully
2025-04-09 14:17:10,684 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:17:17,437 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:17:17,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:17:17,439 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:17:17,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:17:17,440 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:17:17,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:17:17,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:17,441 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:17:17,441 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764,)
2025-04-09 14:17:17,441 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:17,613 - aiogram.event - INFO - Update id=311268469 is handled. Duration 203 ms by bot id=7041366449
2025-04-09 14:17:18,994 - aiogram.event - INFO - Update id=311268470 is handled. Duration 353 ms by bot id=7041366449
2025-04-09 14:17:20,277 - aiogram.event - INFO - Update id=311268471 is handled. Duration 407 ms by bot id=7041366449
2025-04-09 14:17:22,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:22,124 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:17:22,124 - sqlalchemy.engine.Engine - INFO - [cached since 4.683s ago] (1043270764,)
2025-04-09 14:17:22,124 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:22,265 - aiogram.event - INFO - Update id=311268472 is handled. Duration 143 ms by bot id=7041366449
2025-04-09 14:17:23,385 - aiogram.event - INFO - Update id=311268473 is handled. Duration 238 ms by bot id=7041366449
2025-04-09 14:17:24,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:24,565 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:17:24,566 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] ()
2025-04-09 14:17:24,570 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:24,753 - aiogram.event - INFO - Update id=311268474 is handled. Duration 377 ms by bot id=7041366449
2025-04-09 14:17:27,658 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:27,659 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:17:27,659 - sqlalchemy.engine.Engine - INFO - [generated in 0.00121s] ('Цифровые товары',)
2025-04-09 14:17:27,664 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:27,819 - aiogram.event - INFO - Update id=311268475 is handled. Duration 167 ms by bot id=7041366449
2025-04-09 14:17:29,502 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:29,502 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:17:29,503 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] (94,)
2025-04-09 14:17:29,507 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:29,700 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:29,700 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:17:29,738 - sqlalchemy.engine.Engine - INFO - [generated in 0.03766s] (1,)
2025-04-09 14:17:29,740 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:29,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:17:29,741 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:17:29,741 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1,)
2025-04-09 14:17:29,742 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:17:29,743 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:17:31,353 - aiogram.event - INFO - Update id=311268476 is handled. Duration 1857 ms by bot id=7041366449
2025-04-09 14:38:34,245 - __main__ - INFO - Stopping application...
2025-04-09 14:38:34,968 - __main__ - INFO - Application stopped
2025-04-09 14:38:49,196 - app - INFO - Starting application...
2025-04-09 14:38:49,196 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:38:49,197 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:38:49,197 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:38:49,639 - __main__ - INFO - Application started successfully
2025-04-09 14:38:49,641 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:38:55,686 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:38:55,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:38:55,687 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:38:55,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:38:55,688 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:38:55,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:38:55,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:38:55,689 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:38:55,689 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1043270764,)
2025-04-09 14:38:55,690 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:38:55,991 - aiogram.event - INFO - Update id=311268477 is handled. Duration 341 ms by bot id=7041366449
2025-04-09 14:38:59,848 - aiogram.event - INFO - Update id=311268478 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 14:39:02,404 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:39:02,404 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:39:02,405 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] ()
2025-04-09 14:39:02,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:39:02,616 - aiogram.event - INFO - Update id=311268479 is handled. Duration 415 ms by bot id=7041366449
2025-04-09 14:39:05,886 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:39:05,886 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:39:05,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('Цифровые товары',)
2025-04-09 14:39:05,887 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:39:05,987 - aiogram.event - INFO - Update id=311268480 is handled. Duration 102 ms by bot id=7041366449
2025-04-09 14:39:07,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:39:07,934 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:39:07,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (94,)
2025-04-09 14:39:07,936 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:39:08,081 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:39:08,081 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:39:08,081 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1,)
2025-04-09 14:39:08,083 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:39:08,085 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:39:08,085 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:39:08,085 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1,)
2025-04-09 14:39:08,087 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:39:08,087 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:39:08,737 - root - ERROR - Ошибка при получении поставщиков для подкатегории 94: Telegram server says - Bad Request: text must be non-empty
2025-04-09 14:39:08,835 - aiogram.event - INFO - Update id=311268481 is handled. Duration 902 ms by bot id=7041366449
2025-04-09 14:41:37,812 - __main__ - INFO - Stopping application...
2025-04-09 14:41:39,123 - __main__ - INFO - Application stopped
2025-04-09 14:41:42,886 - app - INFO - Starting application...
2025-04-09 14:41:42,887 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:41:42,887 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:41:42,887 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:41:43,273 - __main__ - INFO - Application started successfully
2025-04-09 14:41:43,274 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:41:50,581 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:41:50,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:41:50,582 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:41:50,582 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:41:50,583 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:41:50,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:41:50,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:41:50,584 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:41:50,584 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1043270764,)
2025-04-09 14:41:50,585 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:41:50,849 - aiogram.event - INFO - Update id=311268482 is handled. Duration 297 ms by bot id=7041366449
2025-04-09 14:41:52,465 - aiogram.event - INFO - Update id=311268483 is handled. Duration 173 ms by bot id=7041366449
2025-04-09 14:41:55,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:41:55,205 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:41:55,205 - sqlalchemy.engine.Engine - INFO - [generated in 0.00119s] ()
2025-04-09 14:41:55,210 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:41:55,367 - aiogram.event - INFO - Update id=311268484 is handled. Duration 313 ms by bot id=7041366449
2025-04-09 14:41:59,669 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:41:59,669 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:41:59,670 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ('Цифровые товары',)
2025-04-09 14:41:59,674 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:41:59,779 - aiogram.event - INFO - Update id=311268485 is handled. Duration 117 ms by bot id=7041366449
2025-04-09 14:42:02,333 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:42:02,334 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:42:02,334 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] (94,)
2025-04-09 14:42:02,339 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:42:02,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:42:02,489 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:42:02,489 - sqlalchemy.engine.Engine - INFO - [generated in 0.00137s] (1,)
2025-04-09 14:42:02,495 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:42:02,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:42:02,498 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:42:02,499 - sqlalchemy.engine.Engine - INFO - [generated in 0.00129s] (1,)
2025-04-09 14:42:02,504 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:42:02,507 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:42:05,959 - aiogram.event - INFO - Update id=311268486 is handled. Duration 3633 ms by bot id=7041366449
2025-04-09 14:45:15,616 - __main__ - INFO - Stopping application...
2025-04-09 14:45:16,070 - __main__ - INFO - Application stopped
2025-04-09 14:45:19,470 - app - INFO - Starting application...
2025-04-09 14:45:19,471 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 14:45:19,471 - __main__ - INFO - Action config initialized successfully
2025-04-09 14:45:19,471 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 14:45:19,897 - __main__ - INFO - Application started successfully
2025-04-09 14:45:19,899 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 14:45:24,700 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 14:45:24,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:45:24,703 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 14:45:24,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:45:24,704 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 14:45:24,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 14:45:24,705 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:24,706 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 14:45:24,706 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (1043270764,)
2025-04-09 14:45:24,707 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:24,892 - aiogram.event - INFO - Update id=311268487 is handled. Duration 222 ms by bot id=7041366449
2025-04-09 14:45:26,509 - aiogram.event - INFO - Update id=311268488 is handled. Duration 201 ms by bot id=7041366449
2025-04-09 14:45:33,969 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:33,971 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 14:45:33,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (1043270764,)
2025-04-09 14:45:33,974 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:34,065 - aiogram.event - INFO - Update id=311268489 is handled. Duration 176 ms by bot id=7041366449
2025-04-09 14:45:37,250 - aiogram.event - INFO - Update id=311268490 is handled. Duration 187 ms by bot id=7041366449
2025-04-09 14:45:38,404 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:38,404 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 14:45:38,405 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ()
2025-04-09 14:45:38,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:38,553 - aiogram.event - INFO - Update id=311268491 is handled. Duration 262 ms by bot id=7041366449
2025-04-09 14:45:41,688 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:41,688 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 14:45:41,688 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ('Цифровые товары',)
2025-04-09 14:45:41,690 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:41,779 - aiogram.event - INFO - Update id=311268492 is handled. Duration 93 ms by bot id=7041366449
2025-04-09 14:45:44,750 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:44,750 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 14:45:44,751 - sqlalchemy.engine.Engine - INFO - [generated in 0.00114s] (94,)
2025-04-09 14:45:44,755 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:44,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:44,901 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 14:45:44,901 - sqlalchemy.engine.Engine - INFO - [generated in 0.00124s] (1,)
2025-04-09 14:45:44,907 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:44,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 14:45:44,910 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 14:45:44,910 - sqlalchemy.engine.Engine - INFO - [generated in 0.00108s] (1,)
2025-04-09 14:45:44,915 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 14:45:44,917 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:45:45,585 - aiogram.event - INFO - Update id=311268493 is handled. Duration 842 ms by bot id=7041366449
2025-04-09 14:45:48,539 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:45:49,179 - aiogram.event - INFO - Update id=311268494 is handled. Duration 648 ms by bot id=7041366449
2025-04-09 14:45:56,318 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 14:45:56,957 - aiogram.event - INFO - Update id=311268495 is handled. Duration 642 ms by bot id=7041366449
2025-04-09 15:35:43,373 - __main__ - INFO - Stopping application...
2025-04-09 15:35:43,437 - main - ERROR - Exception
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 1122, in _wrap_create_connection
    return await self._loop.create_connection(*args, **kwargs, sock=sock)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 1193, in create_connection
    transport, protocol = await self._create_connection_transport(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        ssl_shutdown_timeout=ssl_shutdown_timeout)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 1226, in _create_connection_transport
    await waiter
  File "/usr/lib/python3.13/asyncio/sslproto.py", line 581, in _on_handshake_complete
    raise handshake_exc
  File "/usr/lib/python3.13/asyncio/sslproto.py", line 563, in _do_handshake
    self._sslobj.do_handshake()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/ssl.py", line 951, in do_handshake
    self._sslobj.do_handshake()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
ssl.SSLError: [SSL] record layer failure (_ssl.c:1028)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 177, in make_request
    async with session.post(
               ~~~~~~~~~~~~^
        url, data=form, timeout=self.timeout if timeout is None else timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as resp:
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/client.py", line 1425, in __aenter__
    self._resp: _RetType = await self._coro
                           ^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/client.py", line 703, in _request
    conn = await self._connector.connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req, traces=traces, timeout=real_timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 548, in connect
    proto = await self._create_connection(req, traces, timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 1056, in _create_connection
    _, proto = await self._create_direct_connection(req, traces, timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 1400, in _create_direct_connection
    raise last_exc
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 1369, in _create_direct_connection
    transp, proto = await self._wrap_create_connection(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiohttp/connector.py", line 1126, in _wrap_create_connection
    raise ClientConnectorSSLError(req.connection_key, exc) from exc
aiohttp.client_exceptions.ClientConnectorSSLError: Cannot connect to host api.telegram.org:443 ssl:default [[SSL] record layer failure (_ssl.c:1028)]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/quart/app.py", line 1793, in shutdown
    await self.ensure_async(func)()
  File "/home/egor/projects/SupplyMatchBot/app/main.py", line 97, in shutdown
    await bot.delete_webhook()
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 1206, in delete_webhook
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 453, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 184, in make_request
    raise TelegramNetworkError(method=method, message=f"{type(e).__name__}: {e}")
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectorSSLError: Cannot connect to host api.telegram.org:443 ssl:default [[SSL] record layer failure (_ssl.c:1028)]
2025-04-09 15:35:43,462 - __main__ - ERROR - Error starting application: Lifespan failure in shutdown. 'HTTP Client says - ClientConnectorSSLError: Cannot connect to host api.telegram.org:443 ssl:default [[SSL] record layer failure (_ssl.c:1028)]'
2025-04-09 15:37:24,202 - app - INFO - Starting application...
2025-04-09 15:37:24,202 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 15:37:24,203 - __main__ - INFO - Action config initialized successfully
2025-04-09 15:37:24,203 - __main__ - INFO - Setting webhook at: https://0a79-46-8-230-15.ngrok-free.app/webhook
2025-04-09 15:37:25,039 - __main__ - INFO - Application started successfully
2025-04-09 15:37:25,041 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 15:38:28,491 - __main__ - INFO - Stopping application...
2025-04-09 15:38:29,478 - __main__ - INFO - Application stopped
2025-04-09 15:38:36,385 - app - INFO - Starting application...
2025-04-09 15:38:36,385 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 15:38:36,385 - __main__ - INFO - Action config initialized successfully
2025-04-09 15:38:36,385 - __main__ - INFO - Setting webhook at: https://e5a0-46-8-230-15.ngrok-free.app/webhook
2025-04-09 15:38:37,281 - __main__ - INFO - Application started successfully
2025-04-09 15:38:37,282 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 15:38:39,246 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 15:38:39,246 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:38:39,247 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 15:38:39,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:38:39,248 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 15:38:39,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:38:39,249 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:39,249 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 15:38:39,249 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1043270764,)
2025-04-09 15:38:39,250 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:39,533 - aiogram.event - INFO - Update id=311268496 is handled. Duration 319 ms by bot id=7041366449
2025-04-09 15:38:42,491 - aiogram.event - INFO - Update id=311268497 is handled. Duration 428 ms by bot id=7041366449
2025-04-09 15:38:45,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:45,047 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 15:38:45,047 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ()
2025-04-09 15:38:45,049 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:45,260 - aiogram.event - INFO - Update id=311268498 is handled. Duration 409 ms by bot id=7041366449
2025-04-09 15:38:47,769 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:47,769 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 15:38:47,770 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('Цифровые товары',)
2025-04-09 15:38:47,771 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:47,932 - aiogram.event - INFO - Update id=311268499 is handled. Duration 164 ms by bot id=7041366449
2025-04-09 15:38:49,880 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:49,880 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 15:38:49,881 - sqlalchemy.engine.Engine - INFO - [generated in 0.00117s] (94,)
2025-04-09 15:38:49,886 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:50,038 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:50,039 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 15:38:50,039 - sqlalchemy.engine.Engine - INFO - [generated in 0.00102s] (1,)
2025-04-09 15:38:50,044 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:50,047 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:38:50,047 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 15:38:50,048 - sqlalchemy.engine.Engine - INFO - [generated in 0.00121s] (1,)
2025-04-09 15:38:50,053 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:38:50,055 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 15:38:51,381 - aiogram.event - INFO - Update id=311268500 is handled. Duration 1508 ms by bot id=7041366449
2025-04-09 15:39:05,761 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 15:39:07,545 - aiogram.event - INFO - Update id=311268501 is handled. Duration 1792 ms by bot id=7041366449
2025-04-09 15:39:11,154 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 15:39:12,949 - aiogram.event - INFO - Update id=311268502 is handled. Duration 1798 ms by bot id=7041366449
2025-04-09 15:39:23,733 - __main__ - INFO - Stopping application...
2025-04-09 15:39:24,155 - __main__ - INFO - Application stopped
2025-04-09 15:52:17,029 - app - INFO - Starting application...
2025-04-09 15:52:17,029 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 15:52:17,029 - __main__ - INFO - Action config initialized successfully
2025-04-09 15:52:17,029 - __main__ - INFO - Setting webhook at: https://ff75-46-8-230-15.ngrok-free.app/webhook
2025-04-09 15:52:18,220 - __main__ - INFO - Application started successfully
2025-04-09 15:52:18,221 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 15:52:20,554 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 15:52:20,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:52:20,555 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 15:52:20,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:52:20,556 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 15:52:20,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 15:52:20,557 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:20,557 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 15:52:20,558 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-09 15:52:20,559 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:20,835 - aiogram.event - INFO - Update id=311268503 is handled. Duration 336 ms by bot id=7041366449
2025-04-09 15:52:22,710 - aiogram.event - INFO - Update id=311268504 is handled. Duration 341 ms by bot id=7041366449
2025-04-09 15:52:24,314 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:24,314 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 15:52:24,314 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ()
2025-04-09 15:52:24,319 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:24,491 - aiogram.event - INFO - Update id=311268505 is handled. Duration 374 ms by bot id=7041366449
2025-04-09 15:52:28,315 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:28,316 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 15:52:28,316 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('Цифровые товары',)
2025-04-09 15:52:28,320 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:28,469 - aiogram.event - INFO - Update id=311268506 is handled. Duration 160 ms by bot id=7041366449
2025-04-09 15:52:32,505 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:32,505 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 15:52:32,505 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (94,)
2025-04-09 15:52:32,506 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:32,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:32,742 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 15:52:32,742 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] (1,)
2025-04-09 15:52:32,747 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:32,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 15:52:32,750 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 15:52:32,750 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (1,)
2025-04-09 15:52:32,754 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 15:52:32,756 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 15:52:35,547 - aiogram.event - INFO - Update id=311268507 is handled. Duration 3044 ms by bot id=7041366449
2025-04-09 15:52:38,302 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 15:52:40,600 - aiogram.event - INFO - Update id=311268508 is handled. Duration 2305 ms by bot id=7041366449
2025-04-09 17:36:38,523 - __main__ - INFO - Stopping application...
2025-04-09 17:36:39,167 - __main__ - INFO - Application stopped
2025-04-09 17:36:44,216 - app - INFO - Starting application...
2025-04-09 17:36:44,216 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 17:36:44,216 - __main__ - INFO - Action config initialized successfully
2025-04-09 17:36:44,216 - __main__ - INFO - Setting webhook at: https://2b45-46-8-230-15.ngrok-free.app/webhook
2025-04-09 17:36:44,996 - __main__ - INFO - Application started successfully
2025-04-09 17:36:44,997 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 17:36:51,416 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 17:36:51,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 17:36:51,417 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 17:36:51,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 17:36:51,418 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 17:36:51,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 17:36:51,419 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:36:51,419 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 17:36:51,419 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1043270764,)
2025-04-09 17:36:51,420 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:36:51,652 - aiogram.event - INFO - Update id=311268509 is handled. Duration 267 ms by bot id=7041366449
2025-04-09 17:36:53,551 - aiogram.event - INFO - Update id=311268510 is handled. Duration 463 ms by bot id=7041366449
2025-04-09 17:36:54,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:36:54,525 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 17:36:54,525 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1043270764,)
2025-04-09 17:36:54,526 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:36:54,682 - aiogram.event - INFO - Update id=311268511 is handled. Duration 306 ms by bot id=7041366449
2025-04-09 17:37:01,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:37:01,282 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 17:37:01,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ()
2025-04-09 17:37:01,286 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:37:01,464 - aiogram.event - INFO - Update id=311268512 is handled. Duration 327 ms by bot id=7041366449
2025-04-09 17:37:04,323 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:37:04,324 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 17:37:04,324 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ('Автотовары',)
2025-04-09 17:37:04,325 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:37:04,488 - aiogram.event - INFO - Update id=311268513 is handled. Duration 382 ms by bot id=7041366449
2025-04-09 17:37:06,634 - aiogram.event - INFO - Update id=311268514 is handled. Duration 291 ms by bot id=7041366449
2025-04-09 17:37:10,485 - aiogram.event - INFO - Update id=311268515 is handled. Duration 235 ms by bot id=7041366449
2025-04-09 17:37:17,148 - aiogram.event - INFO - Update id=311268516 is handled. Duration 496 ms by bot id=7041366449
2025-04-09 17:37:33,386 - aiogram.event - INFO - Update id=311268517 is handled. Duration 881 ms by bot id=7041366449
2025-04-09 17:37:45,392 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 17:37:45,393 - app - INFO - Является частью группы: True
2025-04-09 17:37:45,393 - app - INFO - Добавлено фото в группу 13953675719010474, всего фото в группе: 1
2025-04-09 17:37:47,922 - root - INFO - File saved: 2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg
2025-04-09 17:37:47,923 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 17:37:48,146 - app - INFO - Создано новое сообщение для группы 13953675719010474
2025-04-09 17:37:48,148 - aiogram.event - INFO - Update id=311268518 is handled. Duration 2766 ms by bot id=7041366449
2025-04-09 17:37:48,288 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Zn9oY4LWX5PHH-pqMcX9YvrRHu0QACQPQxG8vuuUs0yV__QSHMiQEAAwIAA3kAAzYE, размер=576x1280
2025-04-09 17:37:48,289 - app - INFO - Является частью группы: True
2025-04-09 17:37:48,289 - app - INFO - Добавлено фото в группу 13953675719010474, всего фото в группе: 2
2025-04-09 17:37:48,658 - root - INFO - File saved: 2025/04/09/c5fd967519844362a8902100e82566ff.jpg
2025-04-09 17:37:48,658 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 17:37:48,778 - app - INFO - Сообщение для группы 13953675719010474 обновлено
2025-04-09 17:37:48,779 - aiogram.event - INFO - Update id=311268519 is handled. Duration 501 ms by bot id=7041366449
2025-04-09 17:37:48,897 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3dn9oY4q0qWk1Degs2AFL5pLpWaLQACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 17:37:48,898 - app - INFO - Является частью группы: True
2025-04-09 17:37:48,898 - app - INFO - Добавлено фото в группу 13953675719010474, всего фото в группе: 3
2025-04-09 17:37:51,367 - root - INFO - File saved: 2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg
2025-04-09 17:37:51,367 - app - INFO - Фото сохранено, всего фото: 3
2025-04-09 17:37:51,527 - app - INFO - Сообщение для группы 13953675719010474 обновлено
2025-04-09 17:37:51,529 - aiogram.event - INFO - Update id=311268520 is handled. Duration 2642 ms by bot id=7041366449
2025-04-09 17:37:51,634 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE, размер=576x1280
2025-04-09 17:37:51,634 - app - INFO - Является частью группы: True
2025-04-09 17:37:51,634 - app - INFO - Добавлено фото в группу 13953675719010474, всего фото в группе: 4
2025-04-09 17:37:52,240 - root - INFO - File saved: 2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg
2025-04-09 17:37:52,241 - app - INFO - Фото сохранено, всего фото: 4
2025-04-09 17:37:52,447 - app - INFO - Сообщение для группы 13953675719010474 обновлено
2025-04-09 17:37:52,448 - aiogram.event - INFO - Update id=311268521 is handled. Duration 817 ms by bot id=7041366449
2025-04-09 17:37:52,667 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 17:37:52,667 - app - INFO - Является частью группы: True
2025-04-09 17:37:52,668 - app - INFO - Добавлено фото в группу 13953675719010474, всего фото в группе: 5
2025-04-09 17:37:54,598 - root - INFO - File saved: 2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg
2025-04-09 17:37:54,598 - app - INFO - Фото сохранено, всего фото: 5
2025-04-09 17:37:54,803 - app - INFO - Сообщение для группы 13953675719010474 обновлено
2025-04-09 17:37:54,804 - aiogram.event - INFO - Update id=311268522 is handled. Duration 2149 ms by bot id=7041366449
2025-04-09 17:38:02,444 - aiogram.event - INFO - Update id=311268523 is handled. Duration 392 ms by bot id=7041366449
2025-04-09 17:38:04,416 - aiogram.event - INFO - Update id=311268524 is handled. Duration 290 ms by bot id=7041366449
2025-04-09 17:38:07,548 - aiogram.event - INFO - Update id=311268525 is handled. Duration 759 ms by bot id=7041366449
2025-04-09 17:38:09,143 - aiogram.event - INFO - Update id=311268526 is handled. Duration 308 ms by bot id=7041366449
2025-04-09 17:38:13,422 - aiogram.event - INFO - Update id=311268527 is handled. Duration 387 ms by bot id=7041366449
2025-04-09 17:38:16,973 - aiogram.event - INFO - Update id=311268528 is handled. Duration 1171 ms by bot id=7041366449
2025-04-09 17:38:19,332 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 17:38:19,333 - app - INFO - ID пользователя: 1043270764
2025-04-09 17:38:19,333 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 17:38:19,333 - app - INFO - После проверки осталось 5 корректных фотографий
2025-04-09 17:38:19,334 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 17:38:19,334 - root - INFO - Данные: company_name=Лалаалла, product_name=Тачка, category_id=58
2025-04-09 17:38:19,334 - root - INFO - Фотографии: 5 шт.
2025-04-09 17:38:19,334 - root - INFO - Видео: False
2025-04-09 17:38:19,335 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:38:19,337 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 17:38:19,337 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('Лалаалла', 'Тачка', 58, 'Машина Биби бибон', 'Россия', 'Удмуртия', 'хугакон', None, '@egormeisters', None, None, 1043270764)
2025-04-09 17:38:19,354 - root - INFO - Поставщик создан с ID: 2
2025-04-09 17:38:19,354 - root - INFO - Начинаю сохранение 5 фотографий
2025-04-09 17:38:19,354 - root - INFO - Сохраняю фото 1/5: AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-09 17:38:19,354 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=2
2025-04-09 17:38:19,354 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 2}
2025-04-09 17:38:19,354 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:38:19,354 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('photo', '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'photo_1.jpg', None, 2)
2025-04-09 17:38:19,356 - root - INFO - Файл сохранен с ID: 5
2025-04-09 17:38:19,356 - root - INFO - Фото 1 сохранено с ID: 5
2025-04-09 17:38:19,357 - root - INFO - Сохраняю фото 2/5: AgACAgIAAxkBAAEBl3Zn9oY4LWX5PHH-pqMcX9YvrRHu0QACQPQxG8vuuUs0yV__QSHMiQEAAwIAA3kAAzYE
2025-04-09 17:38:19,357 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=2
2025-04-09 17:38:19,357 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 2}
2025-04-09 17:38:19,357 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:38:19,357 - sqlalchemy.engine.Engine - INFO - [cached since 0.002819s ago] ('photo', '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'photo_2.jpg', None, 2)
2025-04-09 17:38:19,358 - root - INFO - Файл сохранен с ID: 6
2025-04-09 17:38:19,358 - root - INFO - Фото 2 сохранено с ID: 6
2025-04-09 17:38:19,358 - root - INFO - Сохраняю фото 3/5: AgACAgIAAxkBAAEBl3dn9oY4q0qWk1Degs2AFL5pLpWaLQACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-09 17:38:19,358 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=2
2025-04-09 17:38:19,358 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 2}
2025-04-09 17:38:19,358 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:38:19,358 - sqlalchemy.engine.Engine - INFO - [cached since 0.003998s ago] ('photo', '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'photo_3.jpg', None, 2)
2025-04-09 17:38:19,359 - root - INFO - Файл сохранен с ID: 7
2025-04-09 17:38:19,359 - root - INFO - Фото 3 сохранено с ID: 7
2025-04-09 17:38:19,359 - root - INFO - Сохраняю фото 4/5: AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE
2025-04-09 17:38:19,359 - root - INFO - Сохранение файла: photo, photo_4.jpg, supplier_id=2
2025-04-09 17:38:19,359 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'request_id': None, 'supplier_id': 2}
2025-04-09 17:38:19,359 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:38:19,360 - sqlalchemy.engine.Engine - INFO - [cached since 0.005292s ago] ('photo', '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'photo_4.jpg', None, 2)
2025-04-09 17:38:19,360 - root - INFO - Файл сохранен с ID: 8
2025-04-09 17:38:19,360 - root - INFO - Фото 4 сохранено с ID: 8
2025-04-09 17:38:19,361 - root - INFO - Сохраняю фото 5/5: AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE
2025-04-09 17:38:19,361 - root - INFO - Сохранение файла: photo, photo_5.jpg, supplier_id=2
2025-04-09 17:38:19,361 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'request_id': None, 'supplier_id': 2}
2025-04-09 17:38:19,361 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:38:19,361 - sqlalchemy.engine.Engine - INFO - [cached since 0.006817s ago] ('photo', '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'photo_5.jpg', None, 2)
2025-04-09 17:38:19,362 - root - INFO - Файл сохранен с ID: 9
2025-04-09 17:38:19,362 - root - INFO - Фото 5 сохранено с ID: 9
2025-04-09 17:38:19,362 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 17:38:19,362 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 17:38:19,362 - app - INFO - Поставщик успешно создан с ID: 2
2025-04-09 17:38:19,870 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 17:38:19,872 - aiogram.event - INFO - Update id=311268529 is handled. Duration 685 ms by bot id=7041366449
2025-04-09 17:38:21,588 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:38:21,589 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 17:38:21,589 - sqlalchemy.engine.Engine - INFO - [cached since 87.06s ago] (1043270764,)
2025-04-09 17:38:21,592 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:38:21,721 - aiogram.event - INFO - Update id=311268530 is handled. Duration 283 ms by bot id=7041366449
2025-04-09 17:38:28,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:38:28,540 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 17:38:28,540 - sqlalchemy.engine.Engine - INFO - [cached since 87.26s ago] ()
2025-04-09 17:38:28,542 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:38:28,706 - aiogram.event - INFO - Update id=311268531 is handled. Duration 341 ms by bot id=7041366449
2025-04-09 17:38:33,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:38:33,212 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 17:38:33,213 - sqlalchemy.engine.Engine - INFO - [cached since 88.89s ago] ('Автотовары',)
2025-04-09 17:38:33,215 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:38:33,418 - aiogram.event - INFO - Update id=311268532 is handled. Duration 411 ms by bot id=7041366449
2025-04-09 17:38:35,263 - aiogram.event - INFO - Update id=311268533 is handled. Duration 312 ms by bot id=7041366449
2025-04-09 17:38:40,992 - aiogram.event - INFO - Update id=311268534 is handled. Duration 487 ms by bot id=7041366449
2025-04-09 17:38:45,947 - aiogram.event - INFO - Update id=311268535 is handled. Duration 347 ms by bot id=7041366449
2025-04-09 17:38:53,754 - aiogram.event - INFO - Update id=311268536 is handled. Duration 154 ms by bot id=7041366449
2025-04-09 17:38:59,702 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 17:38:59,702 - app - INFO - Является частью группы: True
2025-04-09 17:38:59,702 - app - INFO - Добавлено фото в группу 13953676315647130, всего фото в группе: 1
2025-04-09 17:39:01,244 - root - INFO - File saved: 2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg
2025-04-09 17:39:01,244 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 17:39:01,395 - app - INFO - Создано новое сообщение для группы 13953676315647130
2025-04-09 17:39:01,396 - aiogram.event - INFO - Update id=311268537 is handled. Duration 1697 ms by bot id=7041366449
2025-04-09 17:39:01,510 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE, размер=576x1280
2025-04-09 17:39:01,510 - app - INFO - Является частью группы: True
2025-04-09 17:39:01,510 - app - INFO - Добавлено фото в группу 13953676315647130, всего фото в группе: 2
2025-04-09 17:39:02,104 - root - INFO - File saved: 2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg
2025-04-09 17:39:02,104 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 17:39:02,390 - app - INFO - Сообщение для группы 13953676315647130 обновлено
2025-04-09 17:39:02,390 - aiogram.event - INFO - Update id=311268538 is handled. Duration 882 ms by bot id=7041366449
2025-04-09 17:39:02,500 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl49n9oaDctjHZt3VBXP0wuUBDqLRFQACl_YxG2fgqEtoneGDfgJApwEAAwIAA3kAAzYE, размер=576x1280
2025-04-09 17:39:02,500 - app - INFO - Является частью группы: True
2025-04-09 17:39:02,500 - app - INFO - Добавлено фото в группу 13953676315647130, всего фото в группе: 3
2025-04-09 17:39:03,226 - root - INFO - File saved: 2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg
2025-04-09 17:39:03,226 - app - INFO - Фото сохранено, всего фото: 3
2025-04-09 17:39:03,417 - app - INFO - Сообщение для группы 13953676315647130 обновлено
2025-04-09 17:39:03,418 - aiogram.event - INFO - Update id=311268539 is handled. Duration 921 ms by bot id=7041366449
2025-04-09 17:39:04,713 - aiogram.event - INFO - Update id=311268540 is handled. Duration 286 ms by bot id=7041366449
2025-04-09 17:39:08,032 - aiogram.event - INFO - Update id=311268541 is handled. Duration 417 ms by bot id=7041366449
2025-04-09 17:39:10,700 - aiogram.event - INFO - Update id=311268542 is handled. Duration 887 ms by bot id=7041366449
2025-04-09 17:39:12,008 - aiogram.event - INFO - Update id=311268543 is handled. Duration 287 ms by bot id=7041366449
2025-04-09 17:39:13,725 - aiogram.event - INFO - Update id=311268544 is handled. Duration 571 ms by bot id=7041366449
2025-04-09 17:39:15,538 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 17:39:15,538 - app - INFO - ID пользователя: 1043270764
2025-04-09 17:39:15,538 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 17:39:15,538 - app - INFO - После проверки осталось 3 корректных фотографий
2025-04-09 17:39:15,539 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 17:39:15,539 - root - INFO - Данные: company_name=Рулю кобылу, product_name=Ручка, category_id=58
2025-04-09 17:39:15,539 - root - INFO - Фотографии: 3 шт.
2025-04-09 17:39:15,539 - root - INFO - Видео: False
2025-04-09 17:39:15,540 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:15,541 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 17:39:15,541 - sqlalchemy.engine.Engine - INFO - [cached since 56.21s ago] ('Рулю кобылу', 'Ручка', 58, 'Дверная пиздец', 'Рашка', 'чернобыль', None, None, '@egormeisters', None, None, 1043270764)
2025-04-09 17:39:15,544 - root - INFO - Поставщик создан с ID: 3
2025-04-09 17:39:15,545 - root - INFO - Начинаю сохранение 3 фотографий
2025-04-09 17:39:15,545 - root - INFO - Сохраняю фото 1/3: AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE
2025-04-09 17:39:15,545 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=3
2025-04-09 17:39:15,545 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 3}
2025-04-09 17:39:15,546 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:39:15,547 - sqlalchemy.engine.Engine - INFO - [cached since 56.19s ago] ('photo', '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'photo_1.jpg', None, 3)
2025-04-09 17:39:15,549 - root - INFO - Файл сохранен с ID: 10
2025-04-09 17:39:15,549 - root - INFO - Фото 1 сохранено с ID: 10
2025-04-09 17:39:15,550 - root - INFO - Сохраняю фото 2/3: AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE
2025-04-09 17:39:15,550 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=3
2025-04-09 17:39:15,550 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 3}
2025-04-09 17:39:15,551 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:39:15,552 - sqlalchemy.engine.Engine - INFO - [cached since 56.2s ago] ('photo', '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'photo_2.jpg', None, 3)
2025-04-09 17:39:15,554 - root - INFO - Файл сохранен с ID: 11
2025-04-09 17:39:15,554 - root - INFO - Фото 2 сохранено с ID: 11
2025-04-09 17:39:15,554 - root - INFO - Сохраняю фото 3/3: AgACAgIAAxkBAAEBl49n9oaDctjHZt3VBXP0wuUBDqLRFQACl_YxG2fgqEtoneGDfgJApwEAAwIAA3kAAzYE
2025-04-09 17:39:15,554 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=3
2025-04-09 17:39:15,554 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 3}
2025-04-09 17:39:15,554 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 17:39:15,555 - sqlalchemy.engine.Engine - INFO - [cached since 56.2s ago] ('photo', '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'photo_3.jpg', None, 3)
2025-04-09 17:39:15,555 - root - INFO - Файл сохранен с ID: 12
2025-04-09 17:39:15,555 - root - INFO - Фото 3 сохранено с ID: 12
2025-04-09 17:39:15,556 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 17:39:15,557 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 17:39:15,557 - app - INFO - Поставщик успешно создан с ID: 3
2025-04-09 17:39:16,010 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 17:39:16,011 - aiogram.event - INFO - Update id=311268545 is handled. Duration 613 ms by bot id=7041366449
2025-04-09 17:39:20,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:20,709 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 17:39:20,709 - sqlalchemy.engine.Engine - INFO - [cached since 139.4s ago] ()
2025-04-09 17:39:20,711 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:20,875 - aiogram.event - INFO - Update id=311268546 is handled. Duration 342 ms by bot id=7041366449
2025-04-09 17:39:22,981 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:22,982 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 17:39:22,982 - sqlalchemy.engine.Engine - INFO - [cached since 138.7s ago] ('Автотовары',)
2025-04-09 17:39:22,984 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:23,150 - aiogram.event - INFO - Update id=311268547 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 17:39:25,850 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:25,850 - sqlalchemy.engine.Engine - INFO - 
            SELECT * FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 17:39:25,851 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] (58,)
2025-04-09 17:39:25,854 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:26,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:26,047 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 17:39:26,047 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] (3,)
2025-04-09 17:39:26,052 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:26,054 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:26,055 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 17:39:26,055 - sqlalchemy.engine.Engine - INFO - [generated in 0.00101s] (3,)
2025-04-09 17:39:26,058 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:26,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:26,061 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 17:39:26,062 - sqlalchemy.engine.Engine - INFO - [cached since 0.01587s ago] (2,)
2025-04-09 17:39:26,065 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:26,067 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 17:39:26,068 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 17:39:26,069 - sqlalchemy.engine.Engine - INFO - [cached since 0.01459s ago] (2,)
2025-04-09 17:39:26,072 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 17:39:26,073 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 17:39:27,216 - aiogram.event - INFO - Update id=311268548 is handled. Duration 1372 ms by bot id=7041366449
2025-04-09 17:39:34,146 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 17:39:36,736 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 17:39:36,939 - aiogram.event - INFO - Update id=311268549 is handled. Duration 2800 ms by bot id=7041366449
2025-04-09 17:39:42,742 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 17:39:43,695 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 17:39:43,935 - aiogram.event - INFO - Update id=311268550 is handled. Duration 1195 ms by bot id=7041366449
2025-04-09 17:39:51,438 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 17:39:54,390 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 17:39:54,532 - aiogram.event - INFO - Update id=311268551 is handled. Duration 3101 ms by bot id=7041366449
2025-04-09 18:31:56,164 - __main__ - INFO - Stopping application...
2025-04-09 18:32:07,832 - __main__ - INFO - Application stopped
2025-04-09 20:56:10,925 - app - INFO - Starting application...
2025-04-09 20:56:10,925 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 20:56:10,925 - __main__ - INFO - Action config initialized successfully
2025-04-09 20:56:10,926 - __main__ - INFO - Setting webhook at: https://0ac8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 20:56:11,346 - __main__ - INFO - Application started successfully
2025-04-09 20:56:11,347 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 20:56:18,964 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 20:56:18,964 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:56:18,966 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 20:56:18,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:56:18,966 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 20:56:18,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:56:18,967 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:18,968 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 20:56:18,968 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1043270764,)
2025-04-09 20:56:18,969 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:19,127 - aiogram.event - INFO - Update id=311268552 is handled. Duration 220 ms by bot id=7041366449
2025-04-09 20:56:24,250 - aiogram.event - INFO - Update id=311268553 is handled. Duration 216 ms by bot id=7041366449
2025-04-09 20:56:27,583 - aiogram.event - INFO - Update id=311268554 is handled. Duration 179 ms by bot id=7041366449
2025-04-09 20:56:28,827 - aiogram.event - INFO - Update id=311268555 is handled. Duration 186 ms by bot id=7041366449
2025-04-09 20:56:30,578 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:30,578 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 20:56:30,578 - sqlalchemy.engine.Engine - INFO - [cached since 11.61s ago] (1043270764,)
2025-04-09 20:56:30,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:30,721 - aiogram.event - INFO - Update id=311268556 is handled. Duration 143 ms by bot id=7041366449
2025-04-09 20:56:32,426 - aiogram.event - INFO - Update id=311268557 is handled. Duration 313 ms by bot id=7041366449
2025-04-09 20:56:33,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:33,531 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 20:56:33,531 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] ()
2025-04-09 20:56:33,536 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:33,643 - aiogram.event - INFO - Update id=311268558 is handled. Duration 196 ms by bot id=7041366449
2025-04-09 20:56:41,537 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:41,537 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 20:56:41,537 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ('Цифровые товары',)
2025-04-09 20:56:41,539 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:41,646 - aiogram.event - INFO - Update id=311268559 is handled. Duration 109 ms by bot id=7041366449
2025-04-09 20:56:43,795 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:43,796 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 20:56:43,796 - sqlalchemy.engine.Engine - INFO - [generated in 0.00111s] (94,)
2025-04-09 20:56:43,801 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:43,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:56:43,902 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 20:56:43,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00145s] ({'id': 1},)
2025-04-09 20:56:43,906 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:56:43,908 - app.services.database - ERROR - Error executing read query: 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
 ...
2025-04-09 20:56:43,908 - app.services.database - ERROR - Error details: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: {'id': 1} ('dict' object cannot be interpreted as an integer)
[SQL: 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            ]
[parameters: ({'id': 1},)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-04-09 20:56:43,909 - root - ERROR - Error getting supplier by ID: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: {'id': 1} ('dict' object cannot be interpreted as an integer)
[SQL: 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            ]
[parameters: ({'id': 1},)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-04-09 20:56:44,006 - aiogram.event - INFO - Update id=311268560 is handled. Duration 218 ms by bot id=7041366449
2025-04-09 20:58:20,210 - __main__ - INFO - Stopping application...
2025-04-09 20:58:20,675 - __main__ - INFO - Application stopped
2025-04-09 20:58:24,597 - app - INFO - Starting application...
2025-04-09 20:58:24,597 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 20:58:24,597 - __main__ - INFO - Action config initialized successfully
2025-04-09 20:58:24,597 - __main__ - INFO - Setting webhook at: https://0ac8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 20:58:25,014 - __main__ - INFO - Application started successfully
2025-04-09 20:58:25,015 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 20:58:28,884 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 20:58:28,884 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:58:28,886 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 20:58:28,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:58:28,886 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 20:58:28,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 20:58:28,887 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:28,887 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 20:58:28,888 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-09 20:58:28,888 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:29,079 - aiogram.event - INFO - Update id=311268561 is handled. Duration 227 ms by bot id=7041366449
2025-04-09 20:58:31,833 - aiogram.event - INFO - Update id=311268562 is handled. Duration 212 ms by bot id=7041366449
2025-04-09 20:58:32,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:32,931 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 20:58:32,931 - sqlalchemy.engine.Engine - INFO - [generated in 0.00128s] ()
2025-04-09 20:58:32,935 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:33,043 - aiogram.event - INFO - Update id=311268563 is handled. Duration 195 ms by bot id=7041366449
2025-04-09 20:58:36,541 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:36,541 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 20:58:36,542 - sqlalchemy.engine.Engine - INFO - [generated in 0.00154s] ('Цифровые товары',)
2025-04-09 20:58:36,547 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:36,737 - aiogram.event - INFO - Update id=311268564 is handled. Duration 203 ms by bot id=7041366449
2025-04-09 20:58:39,038 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:39,038 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 20:58:39,038 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (94,)
2025-04-09 20:58:39,039 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:39,139 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:39,140 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 20:58:39,140 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (1,)
2025-04-09 20:58:39,142 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:39,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:39,143 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 20:58:39,143 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1,)
2025-04-09 20:58:39,145 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:39,145 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 20:58:40,747 - aiogram.event - INFO - Update id=311268565 is handled. Duration 1716 ms by bot id=7041366449
2025-04-09 20:58:47,800 - root - INFO - Фотографии поставщика: [{'id': 1, 'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 2, 'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 3, 'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}, {'id': 4, 'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 1, 55, 26, 963380)}]
2025-04-09 20:58:49,156 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 20:58:49,270 - aiogram.event - INFO - Update id=311268566 is handled. Duration 1471 ms by bot id=7041366449
2025-04-09 20:58:53,009 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:53,010 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 20:58:53,010 - sqlalchemy.engine.Engine - INFO - [cached since 24.12s ago] (1043270764,)
2025-04-09 20:58:53,012 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:53,172 - aiogram.event - INFO - Update id=311268567 is handled. Duration 166 ms by bot id=7041366449
2025-04-09 20:58:54,866 - aiogram.event - INFO - Update id=311268568 is handled. Duration 208 ms by bot id=7041366449
2025-04-09 20:58:56,287 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:58:56,287 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 20:58:56,287 - sqlalchemy.engine.Engine - INFO - [cached since 23.36s ago] ()
2025-04-09 20:58:56,288 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:58:56,385 - aiogram.event - INFO - Update id=311268569 is handled. Duration 191 ms by bot id=7041366449
2025-04-09 20:58:59,403 - aiogram.event - INFO - Update id=311268570 is handled. Duration 173 ms by bot id=7041366449
2025-04-09 20:59:01,417 - aiogram.event - INFO - Update id=311268571 is handled. Duration 417 ms by bot id=7041366449
2025-04-09 20:59:02,707 - aiogram.event - INFO - Update id=311268572 is handled. Duration 266 ms by bot id=7041366449
2025-04-09 20:59:03,468 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:59:03,468 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 20:59:03,469 - sqlalchemy.engine.Engine - INFO - [cached since 34.58s ago] (1043270764,)
2025-04-09 20:59:03,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:59:03,614 - aiogram.event - INFO - Update id=311268573 is handled. Duration 149 ms by bot id=7041366449
2025-04-09 20:59:11,186 - aiogram.event - INFO - Update id=311268574 is handled. Duration 338 ms by bot id=7041366449
2025-04-09 20:59:12,564 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:59:12,565 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 20:59:12,565 - sqlalchemy.engine.Engine - INFO - [cached since 39.63s ago] ()
2025-04-09 20:59:12,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:59:12,664 - aiogram.event - INFO - Update id=311268575 is handled. Duration 184 ms by bot id=7041366449
2025-04-09 20:59:13,920 - aiogram.event - INFO - Update id=311268576 is handled. Duration 189 ms by bot id=7041366449
2025-04-09 20:59:15,888 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:59:15,889 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 20:59:15,889 - sqlalchemy.engine.Engine - INFO - [cached since 42.96s ago] ()
2025-04-09 20:59:15,892 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:59:16,051 - aiogram.event - INFO - Update id=311268577 is handled. Duration 297 ms by bot id=7041366449
2025-04-09 20:59:19,289 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 20:59:19,289 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 20:59:19,289 - sqlalchemy.engine.Engine - INFO - [cached since 42.75s ago] ('Автотовары',)
2025-04-09 20:59:19,290 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 20:59:19,469 - aiogram.event - INFO - Update id=311268578 is handled. Duration 182 ms by bot id=7041366449
2025-04-09 20:59:21,466 - aiogram.event - INFO - Update id=311268579 is handled. Duration 183 ms by bot id=7041366449
2025-04-09 21:00:59,450 - __main__ - INFO - Stopping application...
2025-04-09 21:00:59,923 - __main__ - INFO - Application stopped
2025-04-09 21:01:04,017 - app - INFO - Starting application...
2025-04-09 21:01:04,017 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:01:04,017 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:01:04,017 - __main__ - INFO - Setting webhook at: https://0ac8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:01:04,404 - __main__ - INFO - Application started successfully
2025-04-09 21:01:04,405 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:01:12,691 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:01:12,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:01:12,693 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:01:12,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:01:12,694 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:01:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:01:12,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:01:12,695 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:01:12,695 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-09 21:01:12,696 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:01:13,033 - aiogram.event - INFO - Update id=311268580 is handled. Duration 373 ms by bot id=7041366449
2025-04-09 21:01:24,368 - aiogram.event - INFO - Update id=311268581 is handled. Duration 409 ms by bot id=7041366449
2025-04-09 21:01:25,903 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:01:25,903 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:01:25,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 21:01:25,905 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:01:26,001 - aiogram.event - INFO - Update id=311268582 is handled. Duration 401 ms by bot id=7041366449
2025-04-09 21:01:30,650 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:01:30,651 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:01:30,651 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('Цифровые товары',)
2025-04-09 21:01:30,652 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:01:30,750 - aiogram.event - INFO - Update id=311268583 is handled. Duration 101 ms by bot id=7041366449
2025-04-09 21:01:33,755 - root - ERROR - Error editing message: Telegram server says - Bad Request: message text is empty
2025-04-09 21:01:33,830 - root - ERROR - Ошибка при возврате к состоянию: Telegram server says - Bad Request: message text is empty
2025-04-09 21:01:33,934 - aiogram.event - INFO - Update id=311268584 is handled. Duration 347 ms by bot id=7041366449
2025-04-09 21:05:11,265 - __main__ - INFO - Stopping application...
2025-04-09 21:05:11,748 - __main__ - INFO - Application stopped
2025-04-09 21:05:16,337 - app - INFO - Starting application...
2025-04-09 21:05:16,337 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:05:16,337 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:05:16,337 - __main__ - INFO - Setting webhook at: https://0ac8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:05:17,117 - __main__ - INFO - Application started successfully
2025-04-09 21:05:17,117 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:05:20,165 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:05:20,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:05:20,167 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:05:20,167 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:05:20,168 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:05:20,168 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:05:20,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:20,169 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:05:20,169 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1043270764,)
2025-04-09 21:05:20,170 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:20,290 - aiogram.event - INFO - Update id=311268585 is handled. Duration 184 ms by bot id=7041366449
2025-04-09 21:05:23,024 - aiogram.event - INFO - Update id=311268586 is handled. Duration 618 ms by bot id=7041366449
2025-04-09 21:05:24,271 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:24,271 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:05:24,272 - sqlalchemy.engine.Engine - INFO - [generated in 0.00121s] ()
2025-04-09 21:05:24,277 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:24,419 - aiogram.event - INFO - Update id=311268587 is handled. Duration 235 ms by bot id=7041366449
2025-04-09 21:05:26,420 - aiogram.event - INFO - Update id=311268588 is handled. Duration 174 ms by bot id=7041366449
2025-04-09 21:05:28,891 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:28,891 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:05:28,892 - sqlalchemy.engine.Engine - INFO - [cached since 4.621s ago] ()
2025-04-09 21:05:28,894 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:28,994 - aiogram.event - INFO - Update id=311268589 is handled. Duration 192 ms by bot id=7041366449
2025-04-09 21:05:31,446 - aiogram.event - INFO - Update id=311268590 is handled. Duration 388 ms by bot id=7041366449
2025-04-09 21:05:33,527 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:33,528 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:05:33,528 - sqlalchemy.engine.Engine - INFO - [cached since 9.258s ago] ()
2025-04-09 21:05:33,530 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:33,690 - aiogram.event - INFO - Update id=311268591 is handled. Duration 295 ms by bot id=7041366449
2025-04-09 21:05:34,947 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:34,947 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:05:34,947 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('Цифровые товары',)
2025-04-09 21:05:34,949 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:35,556 - aiogram.event - INFO - Update id=311268592 is handled. Duration 610 ms by bot id=7041366449
2025-04-09 21:05:37,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:37,199 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:05:37,199 - sqlalchemy.engine.Engine - INFO - [cached since 12.93s ago] ()
2025-04-09 21:05:37,199 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:37,372 - aiogram.event - INFO - Update id=311268593 is handled. Duration 377 ms by bot id=7041366449
2025-04-09 21:05:40,775 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:40,775 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:05:40,775 - sqlalchemy.engine.Engine - INFO - [cached since 5.828s ago] ('Автотовары',)
2025-04-09 21:05:40,776 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:40,872 - aiogram.event - INFO - Update id=311268594 is handled. Duration 98 ms by bot id=7041366449
2025-04-09 21:05:44,208 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:44,208 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:05:44,209 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] (58,)
2025-04-09 21:05:44,213 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:44,323 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:44,324 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:05:44,324 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] (3,)
2025-04-09 21:05:44,330 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:44,332 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:44,333 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:05:44,334 - sqlalchemy.engine.Engine - INFO - [generated in 0.00156s] (3,)
2025-04-09 21:05:44,339 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:44,341 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:44,341 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:05:44,342 - sqlalchemy.engine.Engine - INFO - [cached since 0.01875s ago] (2,)
2025-04-09 21:05:44,346 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:44,348 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:05:44,349 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:05:44,350 - sqlalchemy.engine.Engine - INFO - [cached since 0.01747s ago] (2,)
2025-04-09 21:05:44,352 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:05:44,353 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:05:45,909 - aiogram.event - INFO - Update id=311268595 is handled. Duration 1708 ms by bot id=7041366449
2025-04-09 21:05:46,598 - aiogram.event - INFO - Update id=311268596 is not handled. Duration 17 ms by bot id=7041366449
2025-04-09 21:05:50,055 - aiogram.event - INFO - Update id=311268597 is not handled. Duration 15 ms by bot id=7041366449
2025-04-09 21:05:52,565 - aiogram.event - INFO - Update id=311268598 is not handled. Duration 4 ms by bot id=7041366449
2025-04-09 21:05:55,336 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 21:05:57,582 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 21:05:57,922 - aiogram.event - INFO - Update id=311268599 is handled. Duration 2595 ms by bot id=7041366449
2025-04-09 21:06:09,869 - aiogram.event - INFO - Update id=311268600 is not handled. Duration 4 ms by bot id=7041366449
2025-04-09 21:06:10,483 - aiogram.event - INFO - Update id=311268601 is not handled. Duration 2 ms by bot id=7041366449
2025-04-09 21:06:11,066 - aiogram.event - INFO - Update id=311268602 is not handled. Duration 16 ms by bot id=7041366449
2025-04-09 21:06:11,627 - aiogram.event - INFO - Update id=311268603 is not handled. Duration 17 ms by bot id=7041366449
2025-04-09 21:06:12,233 - aiogram.event - INFO - Update id=311268604 is not handled. Duration 9 ms by bot id=7041366449
2025-04-09 21:06:12,746 - aiogram.event - INFO - Update id=311268605 is not handled. Duration 2 ms by bot id=7041366449
2025-04-09 21:06:13,365 - aiogram.event - INFO - Update id=311268606 is not handled. Duration 16 ms by bot id=7041366449
2025-04-09 21:06:13,964 - aiogram.event - INFO - Update id=311268607 is not handled. Duration 3 ms by bot id=7041366449
2025-04-09 21:06:14,558 - aiogram.event - INFO - Update id=311268608 is not handled. Duration 15 ms by bot id=7041366449
2025-04-09 21:06:15,416 - aiogram.event - INFO - Update id=311268609 is not handled. Duration 15 ms by bot id=7041366449
2025-04-09 21:06:16,221 - aiogram.event - INFO - Update id=311268610 is not handled. Duration 18 ms by bot id=7041366449
2025-04-09 21:06:16,731 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:06:17,281 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 21:06:17,375 - aiogram.event - INFO - Update id=311268611 is handled. Duration 645 ms by bot id=7041366449
2025-04-09 21:06:22,368 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 21:06:22,889 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 21:06:22,985 - aiogram.event - INFO - Update id=311268612 is handled. Duration 623 ms by bot id=7041366449
2025-04-09 21:07:56,457 - __main__ - INFO - Stopping application...
2025-04-09 21:07:56,928 - __main__ - INFO - Application stopped
2025-04-09 21:08:03,033 - app - INFO - Starting application...
2025-04-09 21:08:03,033 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:08:03,033 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:08:03,033 - __main__ - INFO - Setting webhook at: https://0ac8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:08:03,433 - __main__ - INFO - Application started successfully
2025-04-09 21:08:03,434 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:08:10,152 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:08:10,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:08:10,154 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:08:10,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:08:10,155 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:08:10,155 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:08:10,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:10,156 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:08:10,156 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1043270764,)
2025-04-09 21:08:10,157 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:10,341 - aiogram.event - INFO - Update id=311268613 is handled. Duration 248 ms by bot id=7041366449
2025-04-09 21:08:20,791 - aiogram.event - INFO - Update id=311268614 is handled. Duration 424 ms by bot id=7041366449
2025-04-09 21:08:22,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:22,359 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:08:22,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00114s] ()
2025-04-09 21:08:22,366 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:22,465 - aiogram.event - INFO - Update id=311268615 is handled. Duration 190 ms by bot id=7041366449
2025-04-09 21:08:34,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:34,192 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:08:34,192 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('Автотовары',)
2025-04-09 21:08:34,194 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:34,288 - aiogram.event - INFO - Update id=311268616 is handled. Duration 98 ms by bot id=7041366449
2025-04-09 21:08:36,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:36,516 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:08:36,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00117s] (58,)
2025-04-09 21:08:36,521 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:36,657 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:36,657 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:08:36,657 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (3,)
2025-04-09 21:08:36,659 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:36,660 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:36,660 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:08:36,660 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (3,)
2025-04-09 21:08:36,661 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:36,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:36,661 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:08:36,661 - sqlalchemy.engine.Engine - INFO - [cached since 0.004709s ago] (2,)
2025-04-09 21:08:36,662 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:36,663 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:36,663 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:08:36,663 - sqlalchemy.engine.Engine - INFO - [cached since 0.003918s ago] (2,)
2025-04-09 21:08:36,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:36,665 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:08:37,119 - aiogram.event - INFO - Update id=311268617 is handled. Duration 612 ms by bot id=7041366449
2025-04-09 21:08:39,385 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:39,386 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:08:39,386 - sqlalchemy.engine.Engine - INFO - [cached since 5.194s ago] ('Автотовары',)
2025-04-09 21:08:39,389 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:39,517 - aiogram.event - INFO - Update id=311268618 is handled. Duration 141 ms by bot id=7041366449
2025-04-09 21:08:45,317 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:08:45,317 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:08:45,317 - sqlalchemy.engine.Engine - INFO - [cached since 35.16s ago] (1043270764,)
2025-04-09 21:08:45,318 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:08:45,421 - aiogram.event - INFO - Update id=311268619 is handled. Duration 104 ms by bot id=7041366449
2025-04-09 21:14:20,934 - __main__ - INFO - Stopping application...
2025-04-09 21:14:21,389 - __main__ - INFO - Application stopped
2025-04-09 21:14:25,444 - app - INFO - Starting application...
2025-04-09 21:14:25,444 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:14:25,445 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:14:25,445 - __main__ - INFO - Setting webhook at: https://78f8-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:14:25,993 - __main__ - INFO - Application started successfully
2025-04-09 21:14:25,995 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:14:26,508 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 93 ms by bot id=7041366449
2025-04-09 21:14:26,509 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:14:27,255 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 119 ms by bot id=7041366449
2025-04-09 21:14:27,256 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:14:29,864 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 21:14:29,865 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:14:34,482 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 84 ms by bot id=7041366449
2025-04-09 21:14:34,482 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:14:43,306 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 80 ms by bot id=7041366449
2025-04-09 21:14:43,306 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:00,297 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 222 ms by bot id=7041366449
2025-04-09 21:15:00,297 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:19,878 - __main__ - INFO - Stopping application...
2025-04-09 21:15:20,356 - __main__ - INFO - Application stopped
2025-04-09 21:15:24,500 - app - INFO - Starting application...
2025-04-09 21:15:24,500 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:15:24,500 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:15:24,500 - __main__ - INFO - Setting webhook at: https://e410-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:15:24,883 - __main__ - INFO - Application started successfully
2025-04-09 21:15:24,885 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:15:25,376 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 98 ms by bot id=7041366449
2025-04-09 21:15:25,376 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:26,101 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 108 ms by bot id=7041366449
2025-04-09 21:15:26,101 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:28,710 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 21:15:28,711 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:33,402 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 117 ms by bot id=7041366449
2025-04-09 21:15:33,403 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:42,308 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 113 ms by bot id=7041366449
2025-04-09 21:15:42,308 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:59,315 - aiogram.event - INFO - Update id=311268620 is not handled. Duration 222 ms by bot id=7041366449
2025-04-09 21:15:59,315 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:15:59,993 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 84 ms by bot id=7041366449
2025-04-09 21:15:59,993 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:00,776 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 158 ms by bot id=7041366449
2025-04-09 21:16:00,777 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:03,467 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 80 ms by bot id=7041366449
2025-04-09 21:16:03,468 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:08,109 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 108 ms by bot id=7041366449
2025-04-09 21:16:08,110 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:17,053 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 142 ms by bot id=7041366449
2025-04-09 21:16:17,053 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:32,278 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:16:32,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:16:32,280 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:16:32,280 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:16:32,281 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:16:32,281 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:16:32,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:32,282 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:16:32,282 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1043270764,)
2025-04-09 21:16:32,283 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:32,668 - aiogram.event - INFO - Update id=311268622 is handled. Duration 424 ms by bot id=7041366449
2025-04-09 21:16:34,004 - aiogram.event - INFO - Update id=311268621 is not handled. Duration 199 ms by bot id=7041366449
2025-04-09 21:16:34,004 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 21:16:34,994 - aiogram.event - INFO - Update id=311268623 is handled. Duration 462 ms by bot id=7041366449
2025-04-09 21:16:37,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:37,997 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:16:37,997 - sqlalchemy.engine.Engine - INFO - [generated in 0.00154s] ()
2025-04-09 21:16:38,002 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:38,139 - aiogram.event - INFO - Update id=311268624 is handled. Duration 239 ms by bot id=7041366449
2025-04-09 21:16:41,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:41,256 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:16:41,256 - sqlalchemy.engine.Engine - INFO - [generated in 0.00143s] ('Автотовары',)
2025-04-09 21:16:41,262 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:41,482 - aiogram.event - INFO - Update id=311268625 is handled. Duration 234 ms by bot id=7041366449
2025-04-09 21:16:43,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:43,851 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:16:43,852 - sqlalchemy.engine.Engine - INFO - [generated in 0.00113s] (58,)
2025-04-09 21:16:43,856 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:44,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:44,099 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:16:44,099 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (3,)
2025-04-09 21:16:44,101 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:44,102 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:44,102 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:16:44,102 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (3,)
2025-04-09 21:16:44,106 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:44,107 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:44,108 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:16:44,108 - sqlalchemy.engine.Engine - INFO - [cached since 0.009471s ago] (2,)
2025-04-09 21:16:44,110 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:44,112 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:44,112 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:16:44,112 - sqlalchemy.engine.Engine - INFO - [cached since 0.01046s ago] (2,)
2025-04-09 21:16:44,114 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:44,114 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:16:50,244 - aiogram.event - INFO - Update id=311268626 is handled. Duration 6399 ms by bot id=7041366449
2025-04-09 21:16:58,106 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:16:58,106 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:16:58,107 - sqlalchemy.engine.Engine - INFO - [cached since 16.85s ago] ('Автотовары',)
2025-04-09 21:16:58,110 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:16:58,211 - aiogram.event - INFO - Update id=311268627 is handled. Duration 204 ms by bot id=7041366449
2025-04-09 21:22:29,082 - __main__ - INFO - Stopping application...
2025-04-09 21:22:29,543 - __main__ - INFO - Application stopped
2025-04-09 21:22:35,267 - app - INFO - Starting application...
2025-04-09 21:22:35,267 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:22:35,267 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:22:35,267 - __main__ - INFO - Setting webhook at: https://e410-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:22:35,691 - __main__ - INFO - Application started successfully
2025-04-09 21:22:35,692 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:22:46,846 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:22:46,847 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:22:46,848 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:22:46,848 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:22:46,850 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:22:46,850 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:22:46,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:46,852 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:22:46,852 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1043270764,)
2025-04-09 21:22:46,853 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:46,998 - aiogram.event - INFO - Update id=311268628 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 21:22:49,103 - aiogram.event - INFO - Update id=311268629 is handled. Duration 214 ms by bot id=7041366449
2025-04-09 21:22:51,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:51,381 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:22:51,381 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 21:22:51,384 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:51,512 - aiogram.event - INFO - Update id=311268630 is handled. Duration 254 ms by bot id=7041366449
2025-04-09 21:22:54,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:54,330 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:22:54,330 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ('Автотовары',)
2025-04-09 21:22:54,331 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:54,493 - aiogram.event - INFO - Update id=311268631 is handled. Duration 165 ms by bot id=7041366449
2025-04-09 21:22:57,000 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:57,000 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:22:57,001 - sqlalchemy.engine.Engine - INFO - [generated in 0.00136s] (58,)
2025-04-09 21:22:57,006 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:57,112 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:57,112 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:22:57,112 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (3,)
2025-04-09 21:22:57,114 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:57,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:57,114 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:22:57,114 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (3,)
2025-04-09 21:22:57,115 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:57,116 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:57,116 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:22:57,116 - sqlalchemy.engine.Engine - INFO - [cached since 0.004234s ago] (2,)
2025-04-09 21:22:57,117 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:57,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:22:57,117 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:22:57,117 - sqlalchemy.engine.Engine - INFO - [cached since 0.003296s ago] (2,)
2025-04-09 21:22:57,118 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:22:57,119 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:22:57,575 - aiogram.event - INFO - Update id=311268632 is handled. Duration 582 ms by bot id=7041366449
2025-04-09 21:23:02,119 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 21:23:02,830 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 21:23:03,087 - aiogram.event - INFO - Update id=311268633 is handled. Duration 975 ms by bot id=7041366449
2025-04-09 21:23:06,267 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:06,268 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:23:06,269 - sqlalchemy.engine.Engine - INFO - [cached since 11.94s ago] ('Автотовары',)
2025-04-09 21:23:06,272 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:06,616 - aiogram.event - INFO - Update id=311268634 is handled. Duration 1329 ms by bot id=7041366449
2025-04-09 21:23:09,055 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:09,056 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:23:09,056 - sqlalchemy.engine.Engine - INFO - [cached since 17.68s ago] ()
2025-04-09 21:23:09,059 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:09,154 - aiogram.event - INFO - Update id=311268635 is handled. Duration 183 ms by bot id=7041366449
2025-04-09 21:23:10,872 - aiogram.event - INFO - Update id=311268636 is handled. Duration 173 ms by bot id=7041366449
2025-04-09 21:23:15,910 - aiogram.event - INFO - Update id=311268637 is handled. Duration 178 ms by bot id=7041366449
2025-04-09 21:23:17,783 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:17,784 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:23:17,784 - sqlalchemy.engine.Engine - INFO - [cached since 30.93s ago] (1043270764,)
2025-04-09 21:23:17,787 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:17,892 - aiogram.event - INFO - Update id=311268638 is handled. Duration 111 ms by bot id=7041366449
2025-04-09 21:23:19,802 - aiogram.event - INFO - Update id=311268639 is handled. Duration 176 ms by bot id=7041366449
2025-04-09 21:23:21,047 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:21,047 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:23:21,048 - sqlalchemy.engine.Engine - INFO - [cached since 29.67s ago] ()
2025-04-09 21:23:21,050 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:21,158 - aiogram.event - INFO - Update id=311268640 is handled. Duration 204 ms by bot id=7041366449
2025-04-09 21:23:24,029 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:24,030 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:23:24,031 - sqlalchemy.engine.Engine - INFO - [cached since 29.7s ago] ('Автотовары',)
2025-04-09 21:23:24,034 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:24,133 - aiogram.event - INFO - Update id=311268641 is handled. Duration 111 ms by bot id=7041366449
2025-04-09 21:23:26,901 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:26,902 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:23:26,902 - sqlalchemy.engine.Engine - INFO - [cached since 29.9s ago] (58,)
2025-04-09 21:23:26,905 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:27,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:27,008 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:23:27,008 - sqlalchemy.engine.Engine - INFO - [cached since 29.9s ago] (3,)
2025-04-09 21:23:27,010 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:27,011 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:27,011 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:23:27,011 - sqlalchemy.engine.Engine - INFO - [cached since 29.9s ago] (3,)
2025-04-09 21:23:27,012 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:27,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:27,012 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:23:27,012 - sqlalchemy.engine.Engine - INFO - [cached since 29.9s ago] (2,)
2025-04-09 21:23:27,013 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:27,014 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:27,014 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:23:27,014 - sqlalchemy.engine.Engine - INFO - [cached since 29.9s ago] (2,)
2025-04-09 21:23:27,015 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:27,015 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:23:27,430 - aiogram.event - INFO - Update id=311268642 is handled. Duration 536 ms by bot id=7041366449
2025-04-09 21:23:29,034 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:29,034 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:23:29,034 - sqlalchemy.engine.Engine - INFO - [cached since 34.7s ago] ('Автотовары',)
2025-04-09 21:23:29,035 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:29,135 - aiogram.event - INFO - Update id=311268643 is handled. Duration 296 ms by bot id=7041366449
2025-04-09 21:23:35,895 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:23:35,895 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:23:35,896 - sqlalchemy.engine.Engine - INFO - [cached since 44.51s ago] ()
2025-04-09 21:23:35,898 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:23:36,024 - aiogram.event - INFO - Update id=311268644 is handled. Duration 217 ms by bot id=7041366449
2025-04-09 21:24:25,539 - aiogram.event - INFO - Update id=311268645 is handled. Duration 454 ms by bot id=7041366449
2025-04-09 21:24:36,346 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:24:36,346 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:24:36,347 - sqlalchemy.engine.Engine - INFO - [cached since 105s ago] ()
2025-04-09 21:24:36,349 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:24:36,537 - aiogram.event - INFO - Update id=311268646 is handled. Duration 344 ms by bot id=7041366449
2025-04-09 21:40:46,970 - __main__ - INFO - Stopping application...
2025-04-09 21:40:47,424 - __main__ - INFO - Application stopped
2025-04-09 21:41:31,241 - app - INFO - Starting application...
2025-04-09 21:41:31,241 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:41:31,241 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:41:31,241 - __main__ - INFO - Setting webhook at: https://e410-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:41:31,685 - __main__ - INFO - Application started successfully
2025-04-09 21:41:31,686 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:41:34,955 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:41:34,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:41:34,956 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:41:34,957 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:41:34,958 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:41:34,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:41:34,959 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:41:34,959 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:41:34,959 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-09 21:41:34,960 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:41:35,118 - aiogram.event - INFO - Update id=311268647 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 21:41:37,211 - aiogram.event - INFO - Update id=311268648 is handled. Duration 246 ms by bot id=7041366449
2025-04-09 21:41:38,432 - root - ERROR - Ошибка при получении категорий: type object 'SupplierSearchStates' has no attribute 'waiting_main_category'
2025-04-09 21:41:38,538 - aiogram.event - INFO - Update id=311268649 is handled. Duration 189 ms by bot id=7041366449
2025-04-09 21:42:30,841 - __main__ - INFO - Stopping application...
2025-04-09 21:42:31,559 - __main__ - INFO - Application stopped
2025-04-09 21:42:35,204 - app - INFO - Starting application...
2025-04-09 21:42:35,204 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:42:35,204 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:42:35,205 - __main__ - INFO - Setting webhook at: https://e410-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:42:35,612 - __main__ - INFO - Application started successfully
2025-04-09 21:42:35,614 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:42:41,500 - aiogram.event - INFO - Update id=311268650 is handled. Duration 222 ms by bot id=7041366449
2025-04-09 21:42:43,065 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:42:43,065 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:42:43,067 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:42:43,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:42:43,067 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:42:43,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:42:43,068 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:43,069 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:42:43,069 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 21:42:43,070 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:43,214 - aiogram.event - INFO - Update id=311268651 is handled. Duration 301 ms by bot id=7041366449
2025-04-09 21:42:46,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:46,607 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:42:46,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] ('Автотовары',)
2025-04-09 21:42:46,614 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:46,715 - aiogram.event - INFO - Update id=311268652 is handled. Duration 219 ms by bot id=7041366449
2025-04-09 21:42:50,315 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:50,315 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:42:50,315 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (58,)
2025-04-09 21:42:50,317 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:50,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:50,456 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:42:50,456 - sqlalchemy.engine.Engine - INFO - [generated in 0.00123s] (3,)
2025-04-09 21:42:50,462 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:50,466 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:50,466 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:42:50,467 - sqlalchemy.engine.Engine - INFO - [generated in 0.00142s] (3,)
2025-04-09 21:42:50,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:50,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:50,475 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:42:50,475 - sqlalchemy.engine.Engine - INFO - [cached since 0.0202s ago] (2,)
2025-04-09 21:42:50,479 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:50,481 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:50,482 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:42:50,482 - sqlalchemy.engine.Engine - INFO - [cached since 0.01663s ago] (2,)
2025-04-09 21:42:50,484 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:50,486 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:42:51,048 - aiogram.event - INFO - Update id=311268653 is handled. Duration 735 ms by bot id=7041366449
2025-04-09 21:42:53,334 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-09 21:42:54,074 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-09 21:42:54,280 - aiogram.event - INFO - Update id=311268654 is handled. Duration 955 ms by bot id=7041366449
2025-04-09 21:42:56,442 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:42:56,443 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:42:56,443 - sqlalchemy.engine.Engine - INFO - [cached since 9.836s ago] ('Автотовары',)
2025-04-09 21:42:56,443 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:42:56,538 - aiogram.event - INFO - Update id=311268655 is handled. Duration 293 ms by bot id=7041366449
2025-04-09 21:43:06,761 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:43:06,762 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:43:06,763 - sqlalchemy.engine.Engine - INFO - [cached since 23.69s ago] ()
2025-04-09 21:43:06,765 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:43:06,871 - aiogram.event - INFO - Update id=311268656 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 21:43:08,223 - aiogram.event - INFO - Update id=311268657 is handled. Duration 185 ms by bot id=7041366449
2025-04-09 21:46:05,118 - __main__ - INFO - Stopping application...
2025-04-09 21:46:05,510 - __main__ - INFO - Application stopped
2025-04-09 21:50:14,917 - app - INFO - Starting application...
2025-04-09 21:50:14,917 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 21:50:14,917 - __main__ - INFO - Action config initialized successfully
2025-04-09 21:50:14,918 - __main__ - INFO - Setting webhook at: https://b396-46-8-230-15.ngrok-free.app/webhook
2025-04-09 21:50:15,353 - __main__ - INFO - Application started successfully
2025-04-09 21:50:15,354 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 21:50:27,239 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 21:50:27,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:50:27,241 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 21:50:27,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:50:27,241 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 21:50:27,242 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 21:50:27,242 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:27,242 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 21:50:27,243 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 21:50:27,244 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:27,478 - aiogram.event - INFO - Update id=311268658 is handled. Duration 438 ms by bot id=7041366449
2025-04-09 21:50:30,635 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:30,635 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:50:30,636 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ('Автотовары',)
2025-04-09 21:50:30,638 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:30,729 - aiogram.event - INFO - Update id=311268659 is handled. Duration 223 ms by bot id=7041366449
2025-04-09 21:50:33,099 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:33,100 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:50:33,100 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (58,)
2025-04-09 21:50:33,101 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:33,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:33,192 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:50:33,192 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (3,)
2025-04-09 21:50:33,194 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:33,194 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:33,195 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:50:33,195 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (3,)
2025-04-09 21:50:33,195 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:33,196 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:33,196 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:50:33,196 - sqlalchemy.engine.Engine - INFO - [cached since 0.004057s ago] (2,)
2025-04-09 21:50:33,197 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:33,197 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:33,197 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:50:33,198 - sqlalchemy.engine.Engine - INFO - [cached since 0.003178s ago] (2,)
2025-04-09 21:50:33,198 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:33,200 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:50:33,608 - aiogram.event - INFO - Update id=311268660 is handled. Duration 511 ms by bot id=7041366449
2025-04-09 21:50:41,903 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:41,903 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 21:50:41,904 - sqlalchemy.engine.Engine - INFO - [cached since 11.27s ago] ('Автотовары',)
2025-04-09 21:50:41,906 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:41,997 - aiogram.event - INFO - Update id=311268661 is handled. Duration 256 ms by bot id=7041366449
2025-04-09 21:50:49,222 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:49,222 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-09 21:50:49,222 - sqlalchemy.engine.Engine - INFO - [cached since 16.12s ago] (58,)
2025-04-09 21:50:49,223 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:49,344 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:49,345 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:50:49,345 - sqlalchemy.engine.Engine - INFO - [cached since 16.15s ago] (3,)
2025-04-09 21:50:49,347 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:49,348 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:49,348 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:50:49,349 - sqlalchemy.engine.Engine - INFO - [cached since 16.15s ago] (3,)
2025-04-09 21:50:49,350 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:49,352 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:49,353 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 21:50:49,353 - sqlalchemy.engine.Engine - INFO - [cached since 16.16s ago] (2,)
2025-04-09 21:50:49,356 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:49,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:49,357 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 21:50:49,357 - sqlalchemy.engine.Engine - INFO - [cached since 16.16s ago] (2,)
2025-04-09 21:50:49,359 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:49,360 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-09 21:50:49,759 - aiogram.event - INFO - Update id=311268662 is handled. Duration 538 ms by bot id=7041366449
2025-04-09 21:50:52,193 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 21:50:52,194 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 21:50:52,194 - sqlalchemy.engine.Engine - INFO - [generated in 0.00123s] (1043270764,)
2025-04-09 21:50:52,198 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 21:50:52,464 - aiogram.event - INFO - Update id=311268663 is handled. Duration 275 ms by bot id=7041366449
2025-04-09 21:51:40,744 - __main__ - INFO - Stopping application...
2025-04-09 21:51:41,471 - __main__ - INFO - Application stopped
2025-04-10 01:56:41,602 - app - INFO - Starting application...
2025-04-10 01:56:41,602 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 01:56:41,603 - __main__ - INFO - Action config initialized successfully
2025-04-10 01:56:41,603 - __main__ - INFO - Setting webhook at: https://ed09-46-8-230-15.ngrok-free.app/webhook
2025-04-10 01:56:41,991 - __main__ - INFO - Application started successfully
2025-04-10 01:56:41,993 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 01:56:42,379 - aiogram.event - INFO - Update id=311268665 is not handled. Duration 3 ms by bot id=7041366449
2025-04-10 01:56:42,894 - aiogram.event - INFO - Update id=311268666 is not handled. Duration 3 ms by bot id=7041366449
2025-04-10 01:56:43,136 - aiogram.event - INFO - Update id=311268664 is not handled. Duration 1 ms by bot id=7041366449
2025-04-10 01:56:43,513 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 01:56:43,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 01:56:43,514 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 01:56:43,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 01:56:43,515 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 01:56:43,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 01:56:43,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 01:56:43,517 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 01:56:43,518 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (1043270764,)
2025-04-10 01:56:43,519 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 01:56:43,797 - aiogram.event - INFO - Update id=311268667 is handled. Duration 392 ms by bot id=7041366449
2025-04-10 01:56:44,351 - aiogram.event - INFO - Update id=311268668 is not handled. Duration 4 ms by bot id=7041366449
2025-04-10 01:57:07,252 - aiogram.event - INFO - Update id=311268669 is handled. Duration 580 ms by bot id=7041366449
2025-04-10 01:57:10,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 01:57:10,592 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 01:57:10,592 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (1043270764,)
2025-04-10 01:57:10,595 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 01:57:10,686 - aiogram.event - INFO - Update id=311268670 is handled. Duration 173 ms by bot id=7041366449
2025-04-10 01:57:15,374 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 01:57:15,374 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 01:57:15,375 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-10 01:57:15,376 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 01:57:15,496 - aiogram.event - INFO - Update id=311268671 is handled. Duration 465 ms by bot id=7041366449
2025-04-10 01:57:21,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 01:57:21,173 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 01:57:21,173 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('Автотовары',)
2025-04-10 01:57:21,174 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 01:57:21,265 - aiogram.event - INFO - Update id=311268672 is handled. Duration 177 ms by bot id=7041366449
2025-04-10 01:57:23,730 - aiogram.event - INFO - Update id=311268673 is handled. Duration 196 ms by bot id=7041366449
2025-04-10 01:57:29,929 - aiogram.event - INFO - Update id=311268674 is handled. Duration 219 ms by bot id=7041366449
2025-04-10 01:57:42,192 - aiogram.event - INFO - Update id=311268675 is handled. Duration 188 ms by bot id=7041366449
2025-04-10 01:57:44,946 - aiogram.event - INFO - Update id=311268676 is handled. Duration 181 ms by bot id=7041366449
2025-04-10 01:57:57,683 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmIFn9vt1CFGUb3k2BhmeLdPIq70fRgACf_cxG2fgqEupXNnaLff00AEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 01:57:57,684 - app - INFO - Является частью группы: True
2025-04-10 01:57:57,684 - app - INFO - Добавлено фото в группу 13953915816587618, всего фото в группе: 1
2025-04-10 01:57:58,077 - root - INFO - File saved: 2025/04/10/c9d00dbea00e41e48d204510811aa19a.jpg
2025-04-10 01:57:58,077 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 01:57:58,384 - app - INFO - Создано новое сообщение для группы 13953915816587618
2025-04-10 01:57:58,386 - aiogram.event - INFO - Update id=311268677 is handled. Duration 715 ms by bot id=7041366449
2025-04-10 01:57:59,129 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmIJn9vt1XonoJhKdYCKkzUa4KhoF0AAC3PYxG8vuuUuR6fGfpEvpTwEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 01:57:59,129 - app - INFO - Является частью группы: True
2025-04-10 01:57:59,129 - app - INFO - Добавлено фото в группу 13953915816587618, всего фото в группе: 2
2025-04-10 01:57:59,435 - root - INFO - File saved: 2025/04/10/44b73d8ff5054324986c766fcc90ce0d.jpg
2025-04-10 01:57:59,435 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 01:57:59,522 - app - INFO - Сообщение для группы 13953915816587618 обновлено
2025-04-10 01:57:59,522 - aiogram.event - INFO - Update id=311268678 is handled. Duration 395 ms by bot id=7041366449
2025-04-10 01:58:00,093 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 01:58:00,093 - app - INFO - Является частью группы: True
2025-04-10 01:58:00,093 - app - INFO - Добавлено фото в группу 13953915816587618, всего фото в группе: 3
2025-04-10 01:58:00,743 - root - INFO - File saved: 2025/04/10/5e7a302069804471aa2bc4684ee8af33.jpg
2025-04-10 01:58:00,743 - app - INFO - Фото сохранено, всего фото: 3
2025-04-10 01:58:00,883 - app - INFO - Сообщение для группы 13953915816587618 обновлено
2025-04-10 01:58:00,884 - aiogram.event - INFO - Update id=311268679 is handled. Duration 804 ms by bot id=7041366449
2025-04-10 01:58:02,761 - aiogram.event - INFO - Update id=311268680 is handled. Duration 169 ms by bot id=7041366449
2025-04-10 01:58:04,242 - aiogram.event - INFO - Update id=311268681 is handled. Duration 222 ms by bot id=7041366449
2025-04-10 01:58:06,607 - aiogram.event - INFO - Update id=311268682 is handled. Duration 339 ms by bot id=7041366449
2025-04-10 01:58:09,965 - aiogram.event - INFO - Update id=311268683 is handled. Duration 201 ms by bot id=7041366449
2025-04-10 01:58:11,468 - aiogram.event - INFO - Update id=311268684 is handled. Duration 174 ms by bot id=7041366449
2025-04-10 01:58:13,412 - aiogram.event - INFO - Update id=311268685 is handled. Duration 360 ms by bot id=7041366449
2025-04-10 01:58:15,741 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 01:58:15,742 - app - INFO - ID пользователя: 1043270764
2025-04-10 01:58:15,742 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 01:58:15,743 - app - INFO - После проверки осталось 3 корректных фотографий
2025-04-10 01:58:15,744 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 01:58:15,744 - root - INFO - Данные: company_name=New, product_name=Pidor, category_id=58
2025-04-10 01:58:15,744 - root - INFO - Фотографии: 3 шт.
2025-04-10 01:58:15,745 - root - INFO - Видео: False
2025-04-10 01:58:15,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 01:58:15,748 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 01:58:15,748 - sqlalchemy.engine.Engine - INFO - [generated in 0.00103s] ('New', 'Pidor', 58, 'Gnoyniy polzun', None, None, None, None, '@egormeisters', None, None, 1043270764)
2025-04-10 01:58:15,754 - root - INFO - Поставщик создан с ID: 4
2025-04-10 01:58:15,755 - root - INFO - Начинаю сохранение 3 фотографий
2025-04-10 01:58:15,755 - root - INFO - Сохраняю фото 1/3: AgACAgIAAxkBAAEBmIFn9vt1CFGUb3k2BhmeLdPIq70fRgACf_cxG2fgqEupXNnaLff00AEAAwIAA3kAAzYE
2025-04-10 01:58:15,755 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=4
2025-04-10 01:58:15,756 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/c9d00dbea00e41e48d204510811aa19a.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-10 01:58:15,758 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 01:58:15,758 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('photo', '2025/04/10/c9d00dbea00e41e48d204510811aa19a.jpg', 'photo_1.jpg', None, 4)
2025-04-10 01:58:15,764 - root - INFO - Файл сохранен с ID: 13
2025-04-10 01:58:15,764 - root - INFO - Фото 1 сохранено с ID: 13
2025-04-10 01:58:15,764 - root - INFO - Сохраняю фото 2/3: AgACAgIAAxkBAAEBmIJn9vt1XonoJhKdYCKkzUa4KhoF0AAC3PYxG8vuuUuR6fGfpEvpTwEAAwIAA3kAAzYE
2025-04-10 01:58:15,765 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=4
2025-04-10 01:58:15,765 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/44b73d8ff5054324986c766fcc90ce0d.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-10 01:58:15,766 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 01:58:15,767 - sqlalchemy.engine.Engine - INFO - [cached since 0.00909s ago] ('photo', '2025/04/10/44b73d8ff5054324986c766fcc90ce0d.jpg', 'photo_2.jpg', None, 4)
2025-04-10 01:58:15,769 - root - INFO - Файл сохранен с ID: 14
2025-04-10 01:58:15,769 - root - INFO - Фото 2 сохранено с ID: 14
2025-04-10 01:58:15,769 - root - INFO - Сохраняю фото 3/3: AgACAgIAAxkBAAEBl3ln9oY4l0lDUY-t9pcJX1g5pBLflQACVvAxG6tDeEt143bltfb-IAEAAwIAA3kAAzYE
2025-04-10 01:58:15,769 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=4
2025-04-10 01:58:15,769 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/5e7a302069804471aa2bc4684ee8af33.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-10 01:58:15,770 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 01:58:15,770 - sqlalchemy.engine.Engine - INFO - [cached since 0.0126s ago] ('photo', '2025/04/10/5e7a302069804471aa2bc4684ee8af33.jpg', 'photo_3.jpg', None, 4)
2025-04-10 01:58:15,772 - root - INFO - Файл сохранен с ID: 15
2025-04-10 01:58:15,772 - root - INFO - Фото 3 сохранено с ID: 15
2025-04-10 01:58:15,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 01:58:15,774 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 01:58:15,774 - app - INFO - Поставщик успешно создан с ID: 4
2025-04-10 01:58:15,774 - app - ERROR - Ошибка при отправке уведомления в чат администраторов: AdminChatService.send_supplier_to_admin_chat() got an unexpected keyword argument 'company_name'
2025-04-10 01:58:16,070 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 01:58:16,070 - aiogram.event - INFO - Update id=311268686 is handled. Duration 489 ms by bot id=7041366449
2025-04-10 02:05:36,816 - __main__ - INFO - Stopping application...
2025-04-10 02:05:37,277 - __main__ - INFO - Application stopped
2025-04-10 02:05:41,685 - app - INFO - Starting application...
2025-04-10 02:05:41,685 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:05:41,685 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:05:41,686 - __main__ - INFO - Setting webhook at: https://e3e0-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:05:42,083 - __main__ - INFO - Application started successfully
2025-04-10 02:05:42,084 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:06:00,928 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 02:06:00,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:06:00,929 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 02:06:00,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:06:00,930 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 02:06:00,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:06:00,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:06:00,931 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 02:06:00,931 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-10 02:06:00,932 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:06:01,049 - aiogram.event - INFO - Update id=311268687 is handled. Duration 659 ms by bot id=7041366449
2025-04-10 02:06:06,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:06:06,937 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 02:06:06,938 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-04-10 02:06:06,943 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:06:07,085 - aiogram.event - INFO - Update id=311268688 is handled. Duration 242 ms by bot id=7041366449
2025-04-10 02:06:09,233 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:06:09,234 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:06:09,235 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('Автотовары',)
2025-04-10 02:06:09,241 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:06:09,503 - aiogram.event - INFO - Update id=311268689 is handled. Duration 408 ms by bot id=7041366449
2025-04-10 02:06:11,039 - aiogram.event - INFO - Update id=311268690 is handled. Duration 202 ms by bot id=7041366449
2025-04-10 02:06:13,851 - aiogram.event - INFO - Update id=311268691 is handled. Duration 216 ms by bot id=7041366449
2025-04-10 02:06:19,850 - aiogram.event - INFO - Update id=311268692 is handled. Duration 210 ms by bot id=7041366449
2025-04-10 02:06:21,857 - aiogram.event - INFO - Update id=311268693 is handled. Duration 169 ms by bot id=7041366449
2025-04-10 02:06:30,119 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmJVn9v11e5OVq9gZ-RjLeJaueOr_0QAC3_YxG8vuuUtZumwG6TkFHQEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 02:06:30,119 - app - INFO - Является частью группы: True
2025-04-10 02:06:30,120 - app - INFO - Добавлено фото в группу 13953919916869994, всего фото в группе: 1
2025-04-10 02:06:30,426 - root - INFO - File saved: 2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg
2025-04-10 02:06:30,426 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 02:06:30,518 - app - INFO - Создано новое сообщение для группы 13953919916869994
2025-04-10 02:06:30,518 - aiogram.event - INFO - Update id=311268694 is handled. Duration 401 ms by bot id=7041366449
2025-04-10 02:06:31,096 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmJZn9v11_7_SN8DQB6ctoeBVX5gCMgAC4PYxG8vuuUvVKKioNprXkgEAAwIAA3kAAzYE, размер=1197x640
2025-04-10 02:06:31,096 - app - INFO - Является частью группы: True
2025-04-10 02:06:31,096 - app - INFO - Добавлено фото в группу 13953919916869994, всего фото в группе: 2
2025-04-10 02:06:31,544 - root - INFO - File saved: 2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg
2025-04-10 02:06:31,544 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 02:06:31,635 - app - INFO - Сообщение для группы 13953919916869994 обновлено
2025-04-10 02:06:31,636 - aiogram.event - INFO - Update id=311268695 is handled. Duration 553 ms by bot id=7041366449
2025-04-10 02:06:32,252 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmJdn9v11fMnhT_bWM9T-xScBGlXZKgAC4fYxG8vuuUvDUSf6glBuHwEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 02:06:32,253 - app - INFO - Является частью группы: True
2025-04-10 02:06:32,253 - app - INFO - Добавлено фото в группу 13953919916869994, всего фото в группе: 3
2025-04-10 02:06:32,647 - root - INFO - File saved: 2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg
2025-04-10 02:06:32,647 - app - INFO - Фото сохранено, всего фото: 3
2025-04-10 02:06:32,749 - app - INFO - Сообщение для группы 13953919916869994 обновлено
2025-04-10 02:06:32,756 - aiogram.event - INFO - Update id=311268696 is handled. Duration 517 ms by bot id=7041366449
2025-04-10 02:06:36,577 - aiogram.event - INFO - Update id=311268697 is handled. Duration 181 ms by bot id=7041366449
2025-04-10 02:06:37,942 - aiogram.event - INFO - Update id=311268698 is handled. Duration 174 ms by bot id=7041366449
2025-04-10 02:06:42,888 - aiogram.event - INFO - Update id=311268699 is handled. Duration 510 ms by bot id=7041366449
2025-04-10 02:06:53,832 - aiogram.event - INFO - Update id=311268700 is handled. Duration 172 ms by bot id=7041366449
2025-04-10 02:06:55,619 - aiogram.event - INFO - Update id=311268701 is handled. Duration 354 ms by bot id=7041366449
2025-04-10 02:06:59,240 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 02:06:59,241 - app - INFO - ID пользователя: 1043270764
2025-04-10 02:06:59,241 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 02:06:59,241 - app - INFO - После проверки осталось 3 корректных фотографий
2025-04-10 02:06:59,242 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 02:06:59,242 - root - INFO - Данные: company_name=Gdhdj, product_name=Ejjdodkd, category_id=58
2025-04-10 02:06:59,242 - root - INFO - Фотографии: 3 шт.
2025-04-10 02:06:59,243 - root - INFO - Видео: False
2025-04-10 02:06:59,244 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:06:59,244 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 02:06:59,245 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('Gdhdj', 'Ejjdodkd', 58, 'Bsjdjd d djdjdjjd dididnkdowjdbf', None, None, None, None, '@egormeisters', None, None, 1043270764)
2025-04-10 02:06:59,246 - root - INFO - Поставщик создан с ID: 5
2025-04-10 02:06:59,246 - root - INFO - Начинаю сохранение 3 фотографий
2025-04-10 02:06:59,246 - root - INFO - Сохраняю фото 1/3: AgACAgIAAxkBAAEBmJVn9v11e5OVq9gZ-RjLeJaueOr_0QAC3_YxG8vuuUtZumwG6TkFHQEAAwIAA3kAAzYE
2025-04-10 02:06:59,246 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=5
2025-04-10 02:06:59,246 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-10 02:06:59,247 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:06:59,247 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ('photo', '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'photo_1.jpg', None, 5)
2025-04-10 02:06:59,248 - root - INFO - Файл сохранен с ID: 16
2025-04-10 02:06:59,248 - root - INFO - Фото 1 сохранено с ID: 16
2025-04-10 02:06:59,248 - root - INFO - Сохраняю фото 2/3: AgACAgIAAxkBAAEBmJZn9v11_7_SN8DQB6ctoeBVX5gCMgAC4PYxG8vuuUvVKKioNprXkgEAAwIAA3kAAzYE
2025-04-10 02:06:59,248 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=5
2025-04-10 02:06:59,249 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-10 02:06:59,249 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:06:59,249 - sqlalchemy.engine.Engine - INFO - [cached since 0.002193s ago] ('photo', '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'photo_2.jpg', None, 5)
2025-04-10 02:06:59,250 - root - INFO - Файл сохранен с ID: 17
2025-04-10 02:06:59,250 - root - INFO - Фото 2 сохранено с ID: 17
2025-04-10 02:06:59,250 - root - INFO - Сохраняю фото 3/3: AgACAgIAAxkBAAEBmJdn9v11fMnhT_bWM9T-xScBGlXZKgAC4fYxG8vuuUvDUSf6glBuHwEAAwIAA3kAAzYE
2025-04-10 02:06:59,250 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=5
2025-04-10 02:06:59,250 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-10 02:06:59,250 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:06:59,251 - sqlalchemy.engine.Engine - INFO - [cached since 0.003738s ago] ('photo', '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'photo_3.jpg', None, 5)
2025-04-10 02:06:59,252 - root - INFO - Файл сохранен с ID: 18
2025-04-10 02:06:59,252 - root - INFO - Фото 3 сохранено с ID: 18
2025-04-10 02:06:59,253 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 02:06:59,254 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 02:06:59,255 - app - INFO - Поставщик успешно создан с ID: 5
2025-04-10 02:06:59,335 - app.services.admin_chat - ERROR - Ошибка при отправке карточки поставщика в чат администраторов: Telegram server says - Bad Request: chat not found
2025-04-10 02:06:59,335 - app - WARNING - Не удалось отправить уведомление в чат администраторов
2025-04-10 02:06:59,603 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 02:06:59,604 - aiogram.event - INFO - Update id=311268702 is handled. Duration 535 ms by bot id=7041366449
2025-04-10 02:14:24,865 - __main__ - INFO - Stopping application...
2025-04-10 02:14:25,353 - __main__ - INFO - Application stopped
2025-04-10 02:14:30,976 - app - INFO - Starting application...
2025-04-10 02:14:30,976 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:14:30,976 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:14:30,976 - __main__ - INFO - Setting webhook at: https://e3e0-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:14:31,462 - __main__ - INFO - Application started successfully
2025-04-10 02:14:31,463 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:14:46,126 - aiogram.event - INFO - Update id=311268703 is not handled. Duration 4 ms by bot id=7041366449
2025-04-10 02:15:08,158 - app.handlers.admin - INFO - Запрошен ID чата: -4610011073, тип: group, название: Чат админов
2025-04-10 02:15:08,695 - aiogram.event - INFO - Update id=311268704 is handled. Duration 552 ms by bot id=7041366449
2025-04-10 02:15:19,609 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 3 ms by bot id=7041366449
2025-04-10 02:15:19,609 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:15:20,240 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 16 ms by bot id=7041366449
2025-04-10 02:15:20,240 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:15:22,800 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 17 ms by bot id=7041366449
2025-04-10 02:15:22,801 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:15:27,401 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 10 ms by bot id=7041366449
2025-04-10 02:15:27,401 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:15:36,219 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 18 ms by bot id=7041366449
2025-04-10 02:15:36,220 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:15:52,963 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 2 ms by bot id=7041366449
2025-04-10 02:15:52,963 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:16:25,764 - aiogram.event - INFO - Update id=311268705 is not handled. Duration 5 ms by bot id=7041366449
2025-04-10 02:16:25,765 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-04-10 02:16:30,260 - __main__ - INFO - Stopping application...
2025-04-10 02:16:30,727 - __main__ - INFO - Application stopped
2025-04-10 02:17:43,964 - app - INFO - Starting application...
2025-04-10 02:17:43,965 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:17:43,965 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:17:43,965 - __main__ - INFO - Setting webhook at: https://e3e0-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:17:44,349 - __main__ - INFO - Application started successfully
2025-04-10 02:17:44,350 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:17:44,744 - app.handlers.admin - WARNING - Попытка установки админ-чата пользователем без прав: 1043270764
2025-04-10 02:17:44,840 - aiogram.event - INFO - Update id=311268705 is handled. Duration 99 ms by bot id=7041366449
2025-04-10 02:19:34,646 - __main__ - INFO - Stopping application...
2025-04-10 02:19:35,354 - __main__ - INFO - Application stopped
2025-04-10 02:19:39,221 - app - INFO - Starting application...
2025-04-10 02:19:39,221 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:19:39,221 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:19:39,221 - __main__ - INFO - Setting webhook at: https://e3e0-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:19:39,583 - __main__ - INFO - Application started successfully
2025-04-10 02:19:39,583 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:19:46,770 - aiogram.event - INFO - Update id=311268706 is not handled. Duration 15 ms by bot id=7041366449
2025-04-10 02:19:48,967 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 02:19:48,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:19:48,969 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 02:19:48,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:19:48,969 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 02:19:48,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:19:48,970 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:19:48,971 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 02:19:48,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-10 02:19:48,972 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:19:49,164 - aiogram.event - INFO - Update id=311268707 is handled. Duration 369 ms by bot id=7041366449
2025-04-10 02:19:53,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:19:53,692 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 02:19:53,692 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] ()
2025-04-10 02:19:53,696 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:19:53,801 - aiogram.event - INFO - Update id=311268708 is handled. Duration 178 ms by bot id=7041366449
2025-04-10 02:19:56,257 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:19:56,259 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:19:56,259 - sqlalchemy.engine.Engine - INFO - [generated in 0.00102s] ('Автотовары',)
2025-04-10 02:19:56,265 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:19:56,357 - aiogram.event - INFO - Update id=311268709 is handled. Duration 191 ms by bot id=7041366449
2025-04-10 02:19:58,779 - aiogram.event - INFO - Update id=311268710 is handled. Duration 167 ms by bot id=7041366449
2025-04-10 02:20:02,306 - aiogram.event - INFO - Update id=311268711 is handled. Duration 174 ms by bot id=7041366449
2025-04-10 02:20:12,203 - aiogram.event - INFO - Update id=311268712 is handled. Duration 167 ms by bot id=7041366449
2025-04-10 02:20:13,766 - aiogram.event - INFO - Update id=311268713 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 02:20:20,378 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 02:20:20,378 - app - INFO - Является частью группы: True
2025-04-10 02:20:20,378 - app - INFO - Добавлено фото в группу 13953926558651474, всего фото в группе: 1
2025-04-10 02:20:20,875 - root - INFO - File saved: 2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg
2025-04-10 02:20:20,875 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 02:20:20,958 - app - INFO - Создано новое сообщение для группы 13953926558651474
2025-04-10 02:20:20,959 - aiogram.event - INFO - Update id=311268714 is handled. Duration 594 ms by bot id=7041366449
2025-04-10 02:20:21,602 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmK9n9wABs2PycBZtx11q4ZdBvq2um4YAAuT2MRvL7rlLAcHitDqz0CUBAAMCAAN5AAM2BA, размер=576x1280
2025-04-10 02:20:21,602 - app - INFO - Является частью группы: True
2025-04-10 02:20:21,603 - app - INFO - Добавлено фото в группу 13953926558651474, всего фото в группе: 2
2025-04-10 02:20:21,753 - root - INFO - File saved: 2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg
2025-04-10 02:20:21,753 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 02:20:21,831 - app - INFO - Сообщение для группы 13953926558651474 обновлено
2025-04-10 02:20:21,831 - aiogram.event - INFO - Update id=311268715 is handled. Duration 240 ms by bot id=7041366449
2025-04-10 02:20:22,423 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 02:20:22,423 - app - INFO - Является частью группы: True
2025-04-10 02:20:22,424 - app - INFO - Добавлено фото в группу 13953926558651474, всего фото в группе: 3
2025-04-10 02:20:22,687 - root - INFO - File saved: 2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg
2025-04-10 02:20:22,687 - app - INFO - Фото сохранено, всего фото: 3
2025-04-10 02:20:22,768 - app - INFO - Сообщение для группы 13953926558651474 обновлено
2025-04-10 02:20:22,769 - aiogram.event - INFO - Update id=311268716 is handled. Duration 357 ms by bot id=7041366449
2025-04-10 02:20:30,136 - aiogram.event - INFO - Update id=311268717 is handled. Duration 161 ms by bot id=7041366449
2025-04-10 02:20:32,619 - aiogram.event - INFO - Update id=311268718 is handled. Duration 274 ms by bot id=7041366449
2025-04-10 02:20:34,276 - aiogram.event - INFO - Update id=311268719 is handled. Duration 346 ms by bot id=7041366449
2025-04-10 02:20:37,316 - aiogram.event - INFO - Update id=311268720 is handled. Duration 159 ms by bot id=7041366449
2025-04-10 02:20:40,279 - aiogram.event - INFO - Update id=311268721 is handled. Duration 338 ms by bot id=7041366449
2025-04-10 02:20:43,703 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 02:20:43,704 - app - INFO - ID пользователя: 1043270764
2025-04-10 02:20:43,704 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 02:20:43,705 - app - INFO - После проверки осталось 3 корректных фотографий
2025-04-10 02:20:43,705 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 02:20:43,706 - root - INFO - Данные: company_name=Опопоатеи, product_name=Рооорос, category_id=58
2025-04-10 02:20:43,706 - root - INFO - Фотографии: 3 шт.
2025-04-10 02:20:43,706 - root - INFO - Видео: False
2025-04-10 02:20:43,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:20:43,711 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 02:20:43,712 - sqlalchemy.engine.Engine - INFO - [generated in 0.00155s] ('Опопоатеи', 'Рооорос', 58, 'Рсивмвосп ашстаоа', None, None, None, None, '@egormeisters', None, None, 1043270764)
2025-04-10 02:20:43,718 - root - INFO - Поставщик создан с ID: 6
2025-04-10 02:20:43,718 - root - INFO - Начинаю сохранение 3 фотографий
2025-04-10 02:20:43,718 - root - INFO - Сохраняю фото 1/3: AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-10 02:20:43,719 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=6
2025-04-10 02:20:43,719 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-10 02:20:43,721 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:20:43,721 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] ('photo', '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'photo_1.jpg', None, 6)
2025-04-10 02:20:43,725 - root - INFO - Файл сохранен с ID: 19
2025-04-10 02:20:43,725 - root - INFO - Фото 1 сохранено с ID: 19
2025-04-10 02:20:43,726 - root - INFO - Сохраняю фото 2/3: AgACAgIAAxkBAAEBmK9n9wABs2PycBZtx11q4ZdBvq2um4YAAuT2MRvL7rlLAcHitDqz0CUBAAMCAAN5AAM2BA
2025-04-10 02:20:43,727 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=6
2025-04-10 02:20:43,727 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-10 02:20:43,728 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:20:43,728 - sqlalchemy.engine.Engine - INFO - [cached since 0.007581s ago] ('photo', '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'photo_2.jpg', None, 6)
2025-04-10 02:20:43,729 - root - INFO - Файл сохранен с ID: 20
2025-04-10 02:20:43,729 - root - INFO - Фото 2 сохранено с ID: 20
2025-04-10 02:20:43,729 - root - INFO - Сохраняю фото 3/3: AgACAgIAAxkBAAEBl3hn9oY4CfHmNLYQW45pf7rzmC4dYgACQfQxG8vuuUsFYGkoZxnqYQEAAwIAA3kAAzYE
2025-04-10 02:20:43,730 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=6
2025-04-10 02:20:43,730 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-10 02:20:43,730 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:20:43,731 - sqlalchemy.engine.Engine - INFO - [cached since 0.01058s ago] ('photo', '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'photo_3.jpg', None, 6)
2025-04-10 02:20:43,733 - root - INFO - Файл сохранен с ID: 21
2025-04-10 02:20:43,733 - root - INFO - Фото 3 сохранено с ID: 21
2025-04-10 02:20:43,733 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 02:20:43,734 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 02:20:43,734 - app - INFO - Поставщик успешно создан с ID: 6
2025-04-10 02:20:43,735 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 6 в чат -4610011073
2025-04-10 02:20:43,817 - app.services.admin_chat - ERROR - Ошибка при отправке карточки поставщика в чат администраторов: Telegram server says - Bad Request: wrong HTTP URL specified
2025-04-10 02:20:43,817 - app - WARNING - Не удалось отправить уведомление в чат администраторов
2025-04-10 02:20:44,130 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 02:20:44,132 - aiogram.event - INFO - Update id=311268722 is handled. Duration 522 ms by bot id=7041366449
2025-04-10 02:25:27,802 - __main__ - INFO - Stopping application...
2025-04-10 02:25:28,533 - __main__ - INFO - Application stopped
2025-04-10 02:26:28,389 - app - INFO - Starting application...
2025-04-10 02:26:28,389 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:26:28,390 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:26:28,390 - __main__ - INFO - Setting webhook at: https://e3e0-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:26:28,760 - __main__ - INFO - Application started successfully
2025-04-10 02:26:28,761 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:26:49,281 - __main__ - INFO - Stopping application...
2025-04-10 02:26:49,991 - __main__ - INFO - Application stopped
2025-04-10 02:26:54,965 - app - INFO - Starting application...
2025-04-10 02:26:54,965 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:26:54,965 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:26:54,965 - __main__ - INFO - Setting webhook at: https://3e1f-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:26:55,378 - __main__ - INFO - Application started successfully
2025-04-10 02:26:55,379 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:26:55,869 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 94 ms by bot id=7041366449
2025-04-10 02:26:55,870 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:26:56,454 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 77 ms by bot id=7041366449
2025-04-10 02:26:56,454 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:26:59,079 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 88 ms by bot id=7041366449
2025-04-10 02:26:59,080 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:27:03,708 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 85 ms by bot id=7041366449
2025-04-10 02:27:03,708 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:27:12,625 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 90 ms by bot id=7041366449
2025-04-10 02:27:12,625 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:27:29,820 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 467 ms by bot id=7041366449
2025-04-10 02:27:29,820 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:28:02,885 - aiogram.event - INFO - Update id=311268723 is not handled. Duration 276 ms by bot id=7041366449
2025-04-10 02:28:02,885 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-10 02:28:03,537 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 02:28:03,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:28:03,538 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 02:28:03,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:28:03,539 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 02:28:03,540 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:28:03,543 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:28:03,544 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 02:28:03,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (1043270764,)
2025-04-10 02:28:03,547 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:28:03,647 - aiogram.event - INFO - Update id=311268724 is handled. Duration 224 ms by bot id=7041366449
2025-04-10 02:28:16,684 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:28:16,684 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 02:28:16,685 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ()
2025-04-10 02:28:16,689 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:28:16,843 - aiogram.event - INFO - Update id=311268725 is handled. Duration 246 ms by bot id=7041366449
2025-04-10 02:28:20,526 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:28:20,527 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:28:20,528 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('Автотовары',)
2025-04-10 02:28:20,534 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:28:20,624 - aiogram.event - INFO - Update id=311268726 is handled. Duration 200 ms by bot id=7041366449
2025-04-10 02:28:22,762 - aiogram.event - INFO - Update id=311268727 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 02:28:38,568 - aiogram.event - INFO - Update id=311268728 is handled. Duration 554 ms by bot id=7041366449
2025-04-10 02:28:43,446 - aiogram.event - INFO - Update id=311268729 is handled. Duration 187 ms by bot id=7041366449
2025-04-10 02:28:56,741 - aiogram.event - INFO - Update id=311268730 is handled. Duration 166 ms by bot id=7041366449
2025-04-10 02:29:04,062 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmMFn9wK_o8U8SdVINdXwKAdbWHNphgACJfAxG6aDIUsSveHaiXBUmAEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 02:29:04,062 - app - INFO - Является частью группы: True
2025-04-10 02:29:04,063 - app - INFO - Добавлено фото в группу 13953930747975898, всего фото в группе: 1
2025-04-10 02:29:04,362 - root - INFO - File saved: 2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg
2025-04-10 02:29:04,362 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 02:29:04,446 - app - INFO - Создано новое сообщение для группы 13953930747975898
2025-04-10 02:29:04,446 - aiogram.event - INFO - Update id=311268731 is handled. Duration 394 ms by bot id=7041366449
2025-04-10 02:29:05,075 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmMJn9wK_bwFl-aMQUucUckuMTGNroAAC5fYxG8vuuUt7dkjo90iY6AEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 02:29:05,075 - app - INFO - Является частью группы: True
2025-04-10 02:29:05,076 - app - INFO - Добавлено фото в группу 13953930747975898, всего фото в группе: 2
2025-04-10 02:29:05,362 - root - INFO - File saved: 2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg
2025-04-10 02:29:05,362 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 02:29:05,441 - app - INFO - Сообщение для группы 13953930747975898 обновлено
2025-04-10 02:29:05,441 - aiogram.event - INFO - Update id=311268732 is handled. Duration 372 ms by bot id=7041366449
2025-04-10 02:29:05,993 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmMNn9wK_1aWhXBEvRqh_9yCGFH8TvQACy-oxG6aDMUsEofL22_JzOAEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 02:29:05,993 - app - INFO - Является частью группы: True
2025-04-10 02:29:05,993 - app - INFO - Добавлено фото в группу 13953930747975898, всего фото в группе: 3
2025-04-10 02:29:06,282 - root - INFO - File saved: 2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg
2025-04-10 02:29:06,282 - app - INFO - Фото сохранено, всего фото: 3
2025-04-10 02:29:06,361 - app - INFO - Сообщение для группы 13953930747975898 обновлено
2025-04-10 02:29:06,361 - aiogram.event - INFO - Update id=311268733 is handled. Duration 370 ms by bot id=7041366449
2025-04-10 02:29:08,302 - aiogram.event - INFO - Update id=311268734 is handled. Duration 158 ms by bot id=7041366449
2025-04-10 02:29:10,719 - aiogram.event - INFO - Update id=311268735 is handled. Duration 191 ms by bot id=7041366449
2025-04-10 02:29:13,732 - aiogram.event - INFO - Update id=311268736 is handled. Duration 162 ms by bot id=7041366449
2025-04-10 02:29:16,177 - aiogram.event - INFO - Update id=311268737 is handled. Duration 250 ms by bot id=7041366449
2025-04-10 02:29:19,585 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-10 02:29:19,670 - aiogram.event - INFO - Update id=311268738 is handled. Duration 262 ms by bot id=7041366449
2025-04-10 02:29:22,295 - aiogram.event - INFO - Update id=311268739 is handled. Duration 340 ms by bot id=7041366449
2025-04-10 02:29:25,590 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 02:29:25,590 - app - INFO - ID пользователя: 1043270764
2025-04-10 02:29:25,590 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 02:29:25,591 - app - INFO - После проверки осталось 3 корректных фотографий
2025-04-10 02:29:25,591 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 02:29:25,591 - root - INFO - Данные: company_name=Оататплап, product_name=Октьа, category_id=58
2025-04-10 02:29:25,591 - root - INFO - Фотографии: 3 шт.
2025-04-10 02:29:25,591 - root - INFO - Видео: False
2025-04-10 02:29:25,591 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:29:25,592 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 02:29:25,592 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('Оататплап', 'Октьа', 58, 'Щкдкикоп лащададп лалала', None, None, None, None, None, '79267091083', None, 1043270764)
2025-04-10 02:29:25,593 - root - INFO - Поставщик создан с ID: 7
2025-04-10 02:29:25,593 - root - INFO - Начинаю сохранение 3 фотографий
2025-04-10 02:29:25,593 - root - INFO - Сохраняю фото 1/3: AgACAgIAAxkBAAEBmMFn9wK_o8U8SdVINdXwKAdbWHNphgACJfAxG6aDIUsSveHaiXBUmAEAAwIAA3kAAzYE
2025-04-10 02:29:25,593 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=7
2025-04-10 02:29:25,593 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 7}
2025-04-10 02:29:25,594 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:29:25,594 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'photo_1.jpg', None, 7)
2025-04-10 02:29:25,595 - root - INFO - Файл сохранен с ID: 22
2025-04-10 02:29:25,595 - root - INFO - Фото 1 сохранено с ID: 22
2025-04-10 02:29:25,595 - root - INFO - Сохраняю фото 2/3: AgACAgIAAxkBAAEBmMJn9wK_bwFl-aMQUucUckuMTGNroAAC5fYxG8vuuUt7dkjo90iY6AEAAwIAA3kAAzYE
2025-04-10 02:29:25,595 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=7
2025-04-10 02:29:25,595 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 7}
2025-04-10 02:29:25,595 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:29:25,596 - sqlalchemy.engine.Engine - INFO - [cached since 0.00181s ago] ('photo', '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'photo_2.jpg', None, 7)
2025-04-10 02:29:25,596 - root - INFO - Файл сохранен с ID: 23
2025-04-10 02:29:25,596 - root - INFO - Фото 2 сохранено с ID: 23
2025-04-10 02:29:25,596 - root - INFO - Сохраняю фото 3/3: AgACAgIAAxkBAAEBmMNn9wK_1aWhXBEvRqh_9yCGFH8TvQACy-oxG6aDMUsEofL22_JzOAEAAwIAA3kAAzYE
2025-04-10 02:29:25,596 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=7
2025-04-10 02:29:25,597 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 7}
2025-04-10 02:29:25,597 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:29:25,597 - sqlalchemy.engine.Engine - INFO - [cached since 0.0032s ago] ('photo', '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'photo_3.jpg', None, 7)
2025-04-10 02:29:25,597 - root - INFO - Файл сохранен с ID: 24
2025-04-10 02:29:25,598 - root - INFO - Фото 3 сохранено с ID: 24
2025-04-10 02:29:25,598 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 02:29:25,598 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 02:29:25,598 - app - INFO - Поставщик успешно создан с ID: 7
2025-04-10 02:29:25,598 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 7 в чат -4610011073
2025-04-10 02:29:25,599 - app.services.admin_chat - ERROR - Не удалось отправить фото: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value=<_io.BufferedReader name=...1f850e27e12aeb44fb.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value=<_io.BufferedReader name=...1f850e27e12aeb44fb.jpg'>, input_type=BufferedReader]
    For further information visit https://errors.pydantic.dev/2.10/v/is_instance_of. Отправляем без фото.
2025-04-10 02:29:25,687 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 7 в чат администраторов
2025-04-10 02:29:25,687 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-10 02:29:25,936 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 02:29:25,936 - aiogram.event - INFO - Update id=311268740 is handled. Duration 485 ms by bot id=7041366449
2025-04-10 02:30:11,067 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:30:11,068 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:30:11,068 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (7,)
2025-04-10 02:30:11,070 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:30:11,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:30:11,071 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:30:11,072 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (7,)
2025-04-10 02:30:11,073 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:30:11,074 - app.handlers.admin - INFO - Поставщик 7 назначен администратору 1043270764
2025-04-10 02:30:11,074 - app.handlers.admin - ERROR - Ошибка при назначении поставщика 7 администратору 1043270764: unsupported operand type(s) for +: 'NoneType' and 'str'
2025-04-10 02:30:11,154 - aiogram.event - INFO - Update id=311268741 is handled. Duration 302 ms by bot id=7041366449
2025-04-10 02:34:43,748 - __main__ - INFO - Stopping application...
2025-04-10 02:34:44,467 - __main__ - INFO - Application stopped
2025-04-10 02:34:49,026 - app - INFO - Starting application...
2025-04-10 02:34:49,027 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 02:34:49,027 - __main__ - INFO - Action config initialized successfully
2025-04-10 02:34:49,027 - __main__ - INFO - Setting webhook at: https://3e1f-46-8-230-15.ngrok-free.app/webhook
2025-04-10 02:34:49,394 - __main__ - INFO - Application started successfully
2025-04-10 02:34:49,394 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 02:34:55,794 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 02:34:55,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:34:55,796 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 02:34:55,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:34:55,796 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 02:34:55,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 02:34:55,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:34:55,797 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 02:34:55,798 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-10 02:34:55,799 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:34:55,918 - aiogram.event - INFO - Update id=311268742 is handled. Duration 345 ms by bot id=7041366449
2025-04-10 02:34:58,862 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:34:58,863 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 02:34:58,864 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ()
2025-04-10 02:34:58,868 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:34:58,974 - aiogram.event - INFO - Update id=311268743 is handled. Duration 203 ms by bot id=7041366449
2025-04-10 02:35:09,110 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:35:09,112 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:35:09,113 - sqlalchemy.engine.Engine - INFO - [generated in 0.00079s] ('Автотовары',)
2025-04-10 02:35:09,119 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:35:09,246 - aiogram.event - INFO - Update id=311268744 is handled. Duration 339 ms by bot id=7041366449
2025-04-10 02:35:10,638 - aiogram.event - INFO - Update id=311268745 is handled. Duration 197 ms by bot id=7041366449
2025-04-10 02:35:19,849 - aiogram.event - INFO - Update id=311268746 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 02:35:23,838 - aiogram.event - INFO - Update id=311268747 is handled. Duration 184 ms by bot id=7041366449
2025-04-10 02:35:25,853 - aiogram.event - INFO - Update id=311268748 is handled. Duration 268 ms by bot id=7041366449
2025-04-10 02:35:39,321 - aiogram.event - INFO - Update id=311268749 is not handled. Duration 2 ms by bot id=7041366449
2025-04-10 02:35:39,937 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmNpn9wRKoRE7bEKOQ5Siz7E8aqzAyQAC6fYxG8vuuUs7V9SeSO5qRQEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 02:35:39,938 - app - INFO - Является частью группы: True
2025-04-10 02:35:39,938 - app - INFO - Добавлено фото в группу 13953933910192586, всего фото в группе: 1
2025-04-10 02:35:40,810 - root - INFO - File saved: 2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg
2025-04-10 02:35:40,810 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 02:35:40,910 - app - INFO - Создано новое сообщение для группы 13953933910192586
2025-04-10 02:35:40,911 - aiogram.event - INFO - Update id=311268750 is handled. Duration 976 ms by bot id=7041366449
2025-04-10 02:35:45,959 - aiogram.event - INFO - Update id=311268751 is handled. Duration 222 ms by bot id=7041366449
2025-04-10 02:35:47,569 - aiogram.event - INFO - Update id=311268752 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 02:35:51,671 - aiogram.event - INFO - Update id=311268753 is handled. Duration 279 ms by bot id=7041366449
2025-04-10 02:35:53,004 - aiogram.event - INFO - Update id=311268754 is handled. Duration 164 ms by bot id=7041366449
2025-04-10 02:35:55,136 - aiogram.event - INFO - Update id=311268755 is handled. Duration 334 ms by bot id=7041366449
2025-04-10 02:35:57,055 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 02:35:57,055 - app - INFO - ID пользователя: 1043270764
2025-04-10 02:35:57,055 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 02:35:57,056 - app - INFO - После проверки осталось 1 корректных фотографий
2025-04-10 02:35:57,056 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 02:35:57,056 - root - INFO - Данные: company_name=Оаладпжпп, product_name=Тататптммд, category_id=58
2025-04-10 02:35:57,056 - root - INFO - Фотографии: 1 шт.
2025-04-10 02:35:57,056 - root - INFO - Видео: False
2025-04-10 02:35:57,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:35:57,057 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 02:35:57,057 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('Оаладпжпп', 'Тататптммд', 58, 'Та аьалп алалаьпд сладдп', None, None, None, None, None, None, None, 1043270764)
2025-04-10 02:35:57,058 - root - INFO - Поставщик создан с ID: 8
2025-04-10 02:35:57,058 - root - INFO - Начинаю сохранение 1 фотографий
2025-04-10 02:35:57,059 - root - INFO - Сохраняю фото 1/1: AgACAgIAAxkBAAEBmNpn9wRKoRE7bEKOQ5Siz7E8aqzAyQAC6fYxG8vuuUs7V9SeSO5qRQEAAwIAA3kAAzYE
2025-04-10 02:35:57,059 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=8
2025-04-10 02:35:57,059 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 8}
2025-04-10 02:35:57,059 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 02:35:57,059 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'photo_1.jpg', None, 8)
2025-04-10 02:35:57,060 - root - INFO - Файл сохранен с ID: 25
2025-04-10 02:35:57,060 - root - INFO - Фото 1 сохранено с ID: 25
2025-04-10 02:35:57,060 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 02:35:57,061 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 02:35:57,061 - app - INFO - Поставщик успешно создан с ID: 8
2025-04-10 02:35:57,061 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 8 в чат -4610011073
2025-04-10 02:35:57,545 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 8 в чат администраторов
2025-04-10 02:35:57,545 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-10 02:35:57,821 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 02:35:57,822 - aiogram.event - INFO - Update id=311268756 is handled. Duration 885 ms by bot id=7041366449
2025-04-10 02:36:08,367 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:08,367 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:08,367 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (8,)
2025-04-10 02:36:08,369 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:08,370 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:08,370 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:08,370 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (8,)
2025-04-10 02:36:08,372 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:08,373 - app.handlers.admin - INFO - Поставщик 8 назначен администратору 1043270764
2025-04-10 02:36:08,640 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 02:36:09,189 - app.handlers.admin - INFO - Карточка поставщика 8 отправлена администратору 1043270764
2025-04-10 02:36:09,189 - aiogram.event - INFO - Update id=311268757 is handled. Duration 1014 ms by bot id=7041366449
2025-04-10 02:36:31,261 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:31,262 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:31,262 - sqlalchemy.engine.Engine - INFO - [cached since 22.9s ago] (8,)
2025-04-10 02:36:31,265 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:31,267 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:31,268 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:31,269 - sqlalchemy.engine.Engine - INFO - [cached since 22.9s ago] (8,)
2025-04-10 02:36:31,272 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:31,273 - app.handlers.admin - INFO - Поставщик 8 одобрен администратором 1043270764
2025-04-10 02:36:31,540 - aiogram.event - INFO - Update id=311268758 is handled. Duration 845 ms by bot id=7041366449
2025-04-10 02:36:38,514 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:38,514 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 02:36:38,515 - sqlalchemy.engine.Engine - INFO - [generated in 0.00138s] (1043270764,)
2025-04-10 02:36:38,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:38,777 - aiogram.event - INFO - Update id=311268759 is handled. Duration 266 ms by bot id=7041366449
2025-04-10 02:36:40,703 - aiogram.event - INFO - Update id=311268760 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 02:36:41,856 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:41,856 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 02:36:41,857 - sqlalchemy.engine.Engine - INFO - [cached since 103s ago] ()
2025-04-10 02:36:41,858 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:41,952 - aiogram.event - INFO - Update id=311268761 is handled. Duration 166 ms by bot id=7041366449
2025-04-10 02:36:45,918 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:45,919 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:36:45,919 - sqlalchemy.engine.Engine - INFO - [cached since 96.81s ago] ('Автотовары',)
2025-04-10 02:36:45,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:46,044 - aiogram.event - INFO - Update id=311268762 is handled. Duration 571 ms by bot id=7041366449
2025-04-10 02:36:47,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,491 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 02:36:47,491 - sqlalchemy.engine.Engine - INFO - [generated in 0.00108s] (58,)
2025-04-10 02:36:47,494 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,591 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,592 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,592 - sqlalchemy.engine.Engine - INFO - [cached since 39.23s ago] (8,)
2025-04-10 02:36:47,596 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,599 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,600 - sqlalchemy.engine.Engine - INFO - [cached since 39.23s ago] (8,)
2025-04-10 02:36:47,602 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,606 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,607 - sqlalchemy.engine.Engine - INFO - [cached since 39.24s ago] (7,)
2025-04-10 02:36:47,610 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,613 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,613 - sqlalchemy.engine.Engine - INFO - [cached since 39.24s ago] (7,)
2025-04-10 02:36:47,615 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,617 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,617 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,618 - sqlalchemy.engine.Engine - INFO - [cached since 39.25s ago] (6,)
2025-04-10 02:36:47,621 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,622 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,623 - sqlalchemy.engine.Engine - INFO - [cached since 39.25s ago] (6,)
2025-04-10 02:36:47,624 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,626 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,626 - sqlalchemy.engine.Engine - INFO - [cached since 39.26s ago] (5,)
2025-04-10 02:36:47,628 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,630 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,631 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,631 - sqlalchemy.engine.Engine - INFO - [cached since 39.26s ago] (5,)
2025-04-10 02:36:47,632 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,633 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,633 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,633 - sqlalchemy.engine.Engine - INFO - [cached since 39.27s ago] (4,)
2025-04-10 02:36:47,634 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,636 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,636 - sqlalchemy.engine.Engine - INFO - [cached since 39.27s ago] (4,)
2025-04-10 02:36:47,637 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,640 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,640 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,640 - sqlalchemy.engine.Engine - INFO - [cached since 39.27s ago] (3,)
2025-04-10 02:36:47,641 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,642 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,642 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,642 - sqlalchemy.engine.Engine - INFO - [cached since 39.27s ago] (3,)
2025-04-10 02:36:47,645 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,647 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 02:36:47,647 - sqlalchemy.engine.Engine - INFO - [cached since 39.28s ago] (2,)
2025-04-10 02:36:47,648 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:36:47,650 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 02:36:47,650 - sqlalchemy.engine.Engine - INFO - [cached since 39.28s ago] (2,)
2025-04-10 02:36:47,651 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:36:47,651 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 02:36:48,130 - aiogram.event - INFO - Update id=311268763 is handled. Duration 647 ms by bot id=7041366449
2025-04-10 02:36:52,496 - root - INFO - Фотографии поставщика: [{'id': 22, 'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 23, 'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 24, 'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}]
2025-04-10 02:36:53,357 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:36:53,444 - aiogram.event - INFO - Update id=311268764 is handled. Duration 948 ms by bot id=7041366449
2025-04-10 02:37:05,005 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 02:37:05,416 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:05,499 - aiogram.event - INFO - Update id=311268765 is handled. Duration 503 ms by bot id=7041366449
2025-04-10 02:37:09,684 - root - INFO - Фотографии поставщика: [{'id': 22, 'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 23, 'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 24, 'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}]
2025-04-10 02:37:10,182 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:10,275 - aiogram.event - INFO - Update id=311268766 is handled. Duration 594 ms by bot id=7041366449
2025-04-10 02:37:11,458 - root - INFO - Фотографии поставщика: [{'id': 19, 'type': 'photo', 'file_path': '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 20, 'type': 'photo', 'file_path': '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 21, 'type': 'photo', 'file_path': '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}]
2025-04-10 02:37:12,013 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:12,105 - aiogram.event - INFO - Update id=311268767 is handled. Duration 648 ms by bot id=7041366449
2025-04-10 02:37:14,862 - root - INFO - Фотографии поставщика: [{'id': 16, 'type': 'photo', 'file_path': '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 17, 'type': 'photo', 'file_path': '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 18, 'type': 'photo', 'file_path': '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}]
2025-04-10 02:37:15,874 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:15,967 - aiogram.event - INFO - Update id=311268768 is handled. Duration 1107 ms by bot id=7041366449
2025-04-10 02:37:19,883 - root - INFO - Фотографии поставщика: [{'id': 13, 'type': 'photo', 'file_path': '2025/04/10/c9d00dbea00e41e48d204510811aa19a.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}, {'id': 14, 'type': 'photo', 'file_path': '2025/04/10/44b73d8ff5054324986c766fcc90ce0d.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}, {'id': 15, 'type': 'photo', 'file_path': '2025/04/10/5e7a302069804471aa2bc4684ee8af33.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}]
2025-04-10 02:37:20,748 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:20,835 - aiogram.event - INFO - Update id=311268769 is handled. Duration 955 ms by bot id=7041366449
2025-04-10 02:37:27,194 - root - INFO - Фотографии поставщика: [{'id': 10, 'type': 'photo', 'file_path': '2025/04/09/2ad9afad326448bfbaaa626792fb8899.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 11, 'type': 'photo', 'file_path': '2025/04/09/5eb8c952e1474d9b9f68e8bab609217a.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}, {'id': 12, 'type': 'photo', 'file_path': '2025/04/09/c0b5fd42dc644697ab08c08a993f5519.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 39, 15, 542631)}]
2025-04-10 02:37:27,783 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:28,072 - aiogram.event - INFO - Update id=311268770 is handled. Duration 886 ms by bot id=7041366449
2025-04-10 02:37:32,508 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-10 02:37:33,431 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:33,516 - aiogram.event - INFO - Update id=311268771 is handled. Duration 1017 ms by bot id=7041366449
2025-04-10 02:37:34,946 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 02:37:35,299 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:35,386 - aiogram.event - INFO - Update id=311268772 is handled. Duration 441 ms by bot id=7041366449
2025-04-10 02:37:36,684 - root - INFO - Фотографии поставщика: [{'id': 5, 'type': 'photo', 'file_path': '2025/04/09/e0e1c2f8b9b6437fbc049638ad32cdf9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 6, 'type': 'photo', 'file_path': '2025/04/09/c5fd967519844362a8902100e82566ff.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 7, 'type': 'photo', 'file_path': '2025/04/09/657a6e87a2424b0fb6e32eabca25713b.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 8, 'type': 'photo', 'file_path': '2025/04/09/44e3cb5fd6624935b02133702add49b5.jpg', 'name': 'photo_4.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}, {'id': 9, 'type': 'photo', 'file_path': '2025/04/09/9cd38151c2dd4ab49dc28ab3aada25ad.jpg', 'name': 'photo_5.jpg', 'uploaded_at': datetime.datetime(2025, 4, 9, 17, 38, 19, 338199)}]
2025-04-10 02:37:37,528 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 02:37:37,610 - aiogram.event - INFO - Update id=311268773 is handled. Duration 935 ms by bot id=7041366449
2025-04-10 02:37:38,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 02:37:38,992 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 02:37:38,992 - sqlalchemy.engine.Engine - INFO - [cached since 149.9s ago] ('Автотовары',)
2025-04-10 02:37:38,994 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 02:37:39,076 - aiogram.event - INFO - Update id=311268774 is handled. Duration 251 ms by bot id=7041366449
2025-04-10 19:15:35,358 - app - INFO - Starting application...
2025-04-10 19:15:35,359 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 19:15:35,359 - __main__ - INFO - Action config initialized successfully
2025-04-10 19:15:35,359 - __main__ - INFO - Setting webhook at: https://e5dc-46-8-230-15.ngrok-free.app/webhook
2025-04-10 19:15:35,806 - __main__ - INFO - Application started successfully
2025-04-10 19:15:35,807 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 19:20:53,833 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 19:20:53,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 19:20:53,836 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 19:20:53,836 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 19:20:53,837 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 19:20:53,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 19:20:53,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:20:53,838 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 19:20:53,838 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1043270764,)
2025-04-10 19:20:53,844 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:20:54,390 - aiogram.event - INFO - Update id=311268775 is handled. Duration 621 ms by bot id=7041366449
2025-04-10 19:20:56,159 - aiogram.event - INFO - Update id=311268776 is handled. Duration 246 ms by bot id=7041366449
2025-04-10 19:20:57,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:20:57,566 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 19:20:57,566 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (1043270764,)
2025-04-10 19:20:57,580 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:20:57,713 - aiogram.event - INFO - Update id=311268777 is handled. Duration 260 ms by bot id=7041366449
2025-04-10 19:21:06,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:21:06,563 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 19:21:06,564 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ()
2025-04-10 19:21:06,581 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:21:06,870 - aiogram.event - INFO - Update id=311268778 is handled. Duration 559 ms by bot id=7041366449
2025-04-10 19:21:09,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:21:09,301 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 19:21:09,302 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] ('Автотовары',)
2025-04-10 19:21:09,348 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:21:09,501 - aiogram.event - INFO - Update id=311268779 is handled. Duration 311 ms by bot id=7041366449
2025-04-10 19:21:11,879 - aiogram.event - INFO - Update id=311268780 is handled. Duration 215 ms by bot id=7041366449
2025-04-10 19:21:20,020 - aiogram.event - INFO - Update id=311268781 is handled. Duration 212 ms by bot id=7041366449
2025-04-10 19:21:36,178 - aiogram.event - INFO - Update id=311268782 is handled. Duration 426 ms by bot id=7041366449
2025-04-10 19:21:40,562 - aiogram.event - INFO - Update id=311268783 is handled. Duration 306 ms by bot id=7041366449
2025-04-10 19:21:50,609 - aiogram.event - INFO - Update id=311268784 is handled. Duration 213 ms by bot id=7041366449
2025-04-10 19:21:52,070 - aiogram.event - INFO - Update id=311268785 is handled. Duration 289 ms by bot id=7041366449
2025-04-10 19:21:55,630 - aiogram.event - INFO - Update id=311268786 is handled. Duration 220 ms by bot id=7041366449
2025-04-10 19:22:05,975 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmIFn9vt1CFGUb3k2BhmeLdPIq70fRgACf_cxG2fgqEupXNnaLff00AEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 19:22:05,976 - app - INFO - Является частью группы: True
2025-04-10 19:22:05,976 - app - INFO - Добавлено фото в группу 13954417002356170, всего фото в группе: 1
2025-04-10 19:22:06,366 - root - INFO - File saved: 2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg
2025-04-10 19:22:06,366 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 19:22:06,504 - app - INFO - Создано новое сообщение для группы 13954417002356170
2025-04-10 19:22:06,505 - aiogram.event - INFO - Update id=311268787 is handled. Duration 544 ms by bot id=7041366449
2025-04-10 19:22:06,898 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmTZn9_AthYun7K9Fz66wSZDVVvTeJwACQO8xG8vuwUtN6iojD6SoEQEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 19:22:06,898 - app - INFO - Является частью группы: True
2025-04-10 19:22:06,899 - app - INFO - Добавлено фото в группу 13954417002356170, всего фото в группе: 2
2025-04-10 19:22:07,291 - root - INFO - File saved: 2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg
2025-04-10 19:22:07,291 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 19:22:07,388 - app - INFO - Сообщение для группы 13954417002356170 обновлено
2025-04-10 19:22:07,390 - aiogram.event - INFO - Update id=311268788 is handled. Duration 506 ms by bot id=7041366449
2025-04-10 19:22:09,463 - aiogram.event - INFO - Update id=311268789 is handled. Duration 184 ms by bot id=7041366449
2025-04-10 19:22:20,722 - aiogram.event - INFO - Update id=311268790 is handled. Duration 425 ms by bot id=7041366449
2025-04-10 19:22:23,578 - aiogram.event - INFO - Update id=311268791 is handled. Duration 519 ms by bot id=7041366449
2025-04-10 19:22:32,082 - aiogram.event - INFO - Update id=311268792 is handled. Duration 316 ms by bot id=7041366449
2025-04-10 19:22:43,986 - aiogram.event - INFO - Update id=311268793 is handled. Duration 240 ms by bot id=7041366449
2025-04-10 19:22:51,380 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 19:22:51,381 - app - INFO - ID пользователя: 1043270764
2025-04-10 19:22:51,381 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 19:22:51,382 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-10 19:22:51,382 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 19:22:51,382 - root - INFO - Данные: company_name=Ракета, product_name=Писюн вонючка, category_id=58
2025-04-10 19:22:51,383 - root - INFO - Фотографии: 2 шт.
2025-04-10 19:22:51,383 - root - INFO - Видео: False
2025-04-10 19:22:51,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:22:51,386 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 19:22:51,387 - sqlalchemy.engine.Engine - INFO - [generated in 0.00087s] ('Ракета', 'Писюн вонючка', 58, 'Воняет хуями в машине', 'Рашка', 'Какашка', None, None, '@egormeisters', None, 'Top@egormeister.ru', 1043270764)
2025-04-10 19:22:51,410 - root - INFO - Поставщик создан с ID: 9
2025-04-10 19:22:51,410 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-10 19:22:51,411 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBmIFn9vt1CFGUb3k2BhmeLdPIq70fRgACf_cxG2fgqEupXNnaLff00AEAAwIAA3kAAzYE
2025-04-10 19:22:51,411 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=9
2025-04-10 19:22:51,412 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 9}
2025-04-10 19:22:51,413 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 19:22:51,414 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('photo', '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'photo_1.jpg', None, 9)
2025-04-10 19:22:51,419 - root - INFO - Файл сохранен с ID: 26
2025-04-10 19:22:51,419 - root - INFO - Фото 1 сохранено с ID: 26
2025-04-10 19:22:51,420 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBmTZn9_AthYun7K9Fz66wSZDVVvTeJwACQO8xG8vuwUtN6iojD6SoEQEAAwIAA3kAAzYE
2025-04-10 19:22:51,420 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=9
2025-04-10 19:22:51,420 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 9}
2025-04-10 19:22:51,421 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 19:22:51,421 - sqlalchemy.engine.Engine - INFO - [cached since 0.007991s ago] ('photo', '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'photo_2.jpg', None, 9)
2025-04-10 19:22:51,423 - root - INFO - Файл сохранен с ID: 27
2025-04-10 19:22:51,423 - root - INFO - Фото 2 сохранено с ID: 27
2025-04-10 19:22:51,423 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 19:22:51,424 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 19:22:51,424 - app - INFO - Поставщик успешно создан с ID: 9
2025-04-10 19:22:51,425 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 9 в чат -4610011073
2025-04-10 19:22:51,999 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 9 в чат администраторов
2025-04-10 19:22:51,999 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-10 19:22:52,635 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 19:22:52,636 - aiogram.event - INFO - Update id=311268794 is handled. Duration 1425 ms by bot id=7041366449
2025-04-10 19:22:57,333 - aiogram.event - INFO - Update id=311268795 is handled. Duration 345 ms by bot id=7041366449
2025-04-10 19:23:11,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:23:11,609 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:23:11,610 - sqlalchemy.engine.Engine - INFO - [generated in 0.00149s] (9,)
2025-04-10 19:23:11,628 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:23:11,630 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:23:11,631 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:23:11,631 - sqlalchemy.engine.Engine - INFO - [generated in 0.00113s] (9,)
2025-04-10 19:23:11,636 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:23:11,766 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-10 19:23:13,424 - app.handlers.admin - INFO - Карточка поставщика 9 отправлена администратору 1043270764
2025-04-10 19:23:13,426 - aiogram.event - INFO - Update id=311268796 is handled. Duration 1937 ms by bot id=7041366449
2025-04-10 19:23:30,931 - aiogram.event - INFO - Update id=311268797 is handled. Duration 440 ms by bot id=7041366449
2025-04-10 19:23:38,022 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:23:38,022 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:23:38,022 - sqlalchemy.engine.Engine - INFO - [cached since 26.41s ago] (9,)
2025-04-10 19:23:38,023 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:23:38,023 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:23:38,023 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:23:38,023 - sqlalchemy.engine.Engine - INFO - [cached since 26.39s ago] (9,)
2025-04-10 19:23:38,024 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:23:38,286 - aiogram.event - INFO - Update id=311268798 is handled. Duration 267 ms by bot id=7041366449
2025-04-10 19:23:55,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:23:55,637 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 19:23:55,638 - sqlalchemy.engine.Engine - INFO - [cached since 181.8s ago] (1043270764,)
2025-04-10 19:23:55,641 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:23:56,127 - aiogram.event - INFO - Update id=311268799 is handled. Duration 494 ms by bot id=7041366449
2025-04-10 19:24:43,151 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:24:43,151 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 19:24:43,152 - sqlalchemy.engine.Engine - INFO - [cached since 229.3s ago] (764360279,)
2025-04-10 19:24:43,154 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:24:43,776 - aiogram.event - INFO - Update id=311268800 is handled. Duration 628 ms by bot id=7041366449
2025-04-10 19:24:49,558 - aiogram.event - INFO - Update id=311268801 is handled. Duration 245 ms by bot id=7041366449
2025-04-10 19:24:52,146 - aiogram.event - INFO - Update id=311268802 is handled. Duration 194 ms by bot id=7041366449
2025-04-10 19:24:54,983 - aiogram.event - INFO - Update id=311268803 is handled. Duration 114 ms by bot id=7041366449
2025-04-10 19:24:59,332 - aiogram.event - INFO - Update id=311268804 is handled. Duration 211 ms by bot id=7041366449
2025-04-10 19:25:02,148 - aiogram.event - INFO - Update id=311268805 is handled. Duration 258 ms by bot id=7041366449
2025-04-10 19:25:12,410 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-10 19:25:12,518 - aiogram.event - INFO - Update id=311268806 is handled. Duration 292 ms by bot id=7041366449
2025-04-10 19:25:15,697 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:25:15,698 - sqlalchemy.engine.Engine - INFO - 
            INSERT INTO users (tg_id, username, first_name, last_name, email, phone, created_at)
            VALUES ($1, $2, $3, $4, $5, $6, NOW())
            ON CONFLICT (tg_id) DO UPDATE
            SET username = $2, 
                first_name = $3, 
                last_name = $4,
                email = COALESCE($5, users.email),
                phone = COALESCE($6, users.phone)
        
2025-04-10 19:25:15,699 - sqlalchemy.engine.Engine - INFO - [generated in 0.00084s] (764360279, '@n0t_joke', 'Хер', 'С горы', None, '79771283803')
2025-04-10 19:25:15,715 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 19:25:15,716 - root - INFO - User saved: 764360279, @n0t_joke, email: NULL, phone: 79771283803
2025-04-10 19:25:15,912 - aiogram.event - INFO - Update id=311268807 is handled. Duration 305 ms by bot id=7041366449
2025-04-10 19:26:18,387 - aiogram.event - INFO - Update id=311268808 is handled. Duration 515 ms by bot id=7041366449
2025-04-10 19:26:52,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:26:52,741 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 19:26:52,741 - sqlalchemy.engine.Engine - INFO - [cached since 346.2s ago] ()
2025-04-10 19:26:52,744 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:26:52,876 - aiogram.event - INFO - Update id=311268809 is handled. Duration 394 ms by bot id=7041366449
2025-04-10 19:26:57,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:26:57,448 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 19:26:57,485 - sqlalchemy.engine.Engine - INFO - [cached since 348.2s ago] ('Автотовары',)
2025-04-10 19:26:57,487 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:26:57,648 - aiogram.event - INFO - Update id=311268810 is handled. Duration 350 ms by bot id=7041366449
2025-04-10 19:27:01,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,383 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 19:27:01,383 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (58,)
2025-04-10 19:27:01,384 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,511 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,512 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,512 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (9,)
2025-04-10 19:27:01,516 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,518 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,519 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,519 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (9,)
2025-04-10 19:27:01,522 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,525 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,526 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (8,)
2025-04-10 19:27:01,529 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,532 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,532 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (8,)
2025-04-10 19:27:01,535 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,538 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,539 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (7,)
2025-04-10 19:27:01,542 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,544 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,544 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (7,)
2025-04-10 19:27:01,546 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,548 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,548 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (6,)
2025-04-10 19:27:01,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,551 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,551 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,551 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (6,)
2025-04-10 19:27:01,553 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,555 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,555 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (5,)
2025-04-10 19:27:01,557 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,558 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,558 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,558 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (5,)
2025-04-10 19:27:01,560 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,562 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,563 - sqlalchemy.engine.Engine - INFO - [cached since 230s ago] (4,)
2025-04-10 19:27:01,564 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,565 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,566 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (4,)
2025-04-10 19:27:01,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,567 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,567 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,567 - sqlalchemy.engine.Engine - INFO - [cached since 230s ago] (3,)
2025-04-10 19:27:01,568 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,569 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,569 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (3,)
2025-04-10 19:27:01,571 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,573 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:27:01,573 - sqlalchemy.engine.Engine - INFO - [cached since 230s ago] (2,)
2025-04-10 19:27:01,574 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:27:01,576 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:27:01,576 - sqlalchemy.engine.Engine - INFO - [cached since 229.9s ago] (2,)
2025-04-10 19:27:01,578 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:27:01,578 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-10 19:27:02,181 - aiogram.event - INFO - Update id=311268811 is handled. Duration 801 ms by bot id=7041366449
2025-04-10 19:27:31,709 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 19:27:32,414 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 19:27:32,529 - aiogram.event - INFO - Update id=311268812 is handled. Duration 827 ms by bot id=7041366449
2025-04-10 19:39:38,850 - aiogram.event - INFO - Update id=311268813 is not handled. Duration 2 ms by bot id=7041366449
2025-04-10 19:40:45,730 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:40:45,731 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 19:40:45,731 - sqlalchemy.engine.Engine - INFO - [cached since 1192s ago] (764360279,)
2025-04-10 19:40:45,733 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:40:46,333 - aiogram.event - INFO - Update id=311268814 is handled. Duration 605 ms by bot id=7041366449
2025-04-10 19:40:49,866 - aiogram.event - INFO - Update id=311268815 is handled. Duration 253 ms by bot id=7041366449
2025-04-10 19:40:51,395 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:40:51,396 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 19:40:51,406 - sqlalchemy.engine.Engine - INFO - [cached since 1194s ago] (764360279,)
2025-04-10 19:40:51,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:40:51,562 - aiogram.event - INFO - Update id=311268816 is handled. Duration 304 ms by bot id=7041366449
2025-04-10 19:40:58,161 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:40:58,162 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 19:40:58,163 - sqlalchemy.engine.Engine - INFO - [cached since 1192s ago] ()
2025-04-10 19:40:58,166 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:40:58,334 - aiogram.event - INFO - Update id=311268817 is handled. Duration 318 ms by bot id=7041366449
2025-04-10 19:41:05,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:41:05,382 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 19:41:05,382 - sqlalchemy.engine.Engine - INFO - [cached since 1196s ago] ('Товары для туризма',)
2025-04-10 19:41:05,383 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:41:05,558 - aiogram.event - INFO - Update id=311268818 is handled. Duration 372 ms by bot id=7041366449
2025-04-10 19:41:15,638 - aiogram.event - INFO - Update id=311268819 is handled. Duration 212 ms by bot id=7041366449
2025-04-10 19:41:41,393 - aiogram.event - INFO - Update id=311268820 is handled. Duration 709 ms by bot id=7041366449
2025-04-10 19:41:47,378 - aiogram.event - INFO - Update id=311268821 is handled. Duration 208 ms by bot id=7041366449
2025-04-10 19:41:58,449 - aiogram.event - INFO - Update id=311268822 is handled. Duration 221 ms by bot id=7041366449
2025-04-10 19:42:06,464 - aiogram.event - INFO - Update id=311268823 is handled. Duration 248 ms by bot id=7041366449
2025-04-10 19:42:10,606 - aiogram.event - INFO - Update id=311268824 is handled. Duration 192 ms by bot id=7041366449
2025-04-10 19:42:13,229 - aiogram.event - INFO - Update id=311268825 is handled. Duration 343 ms by bot id=7041366449
2025-04-10 19:42:15,634 - aiogram.event - INFO - Update id=311268826 is handled. Duration 510 ms by bot id=7041366449
2025-04-10 19:42:36,748 - app.handlers.admin - INFO - Запрошен ID чата: -4610011073, тип: group, название: Чат админов
2025-04-10 19:42:37,080 - aiogram.event - INFO - Update id=311268827 is handled. Duration 348 ms by bot id=7041366449
2025-04-10 19:42:45,348 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmXZn9_UE7MZDMFFPb9jL6xqQbExdgQACdu0xG41ewUuMMcY_MRG_8QEAAwIAA3kAAzYE, размер=1280x591
2025-04-10 19:42:45,348 - app - INFO - Является частью группы: False
2025-04-10 19:42:45,638 - root - INFO - File saved: 2025/04/10/5197039420434b9ca49dee75d354bfa9.jpg
2025-04-10 19:42:45,638 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 19:42:45,750 - app - INFO - Отправлено сообщение для одиночного фото
2025-04-10 19:42:45,751 - aiogram.event - INFO - Update id=311268828 is handled. Duration 415 ms by bot id=7041366449
2025-04-10 19:42:50,641 - aiogram.event - INFO - Update id=311268829 is handled. Duration 496 ms by bot id=7041366449
2025-04-10 19:43:01,203 - aiogram.event - INFO - Update id=311268830 is handled. Duration 508 ms by bot id=7041366449
2025-04-10 19:43:07,644 - aiogram.event - INFO - Update id=311268831 is handled. Duration 468 ms by bot id=7041366449
2025-04-10 19:43:16,799 - aiogram.event - INFO - Update id=311268832 is handled. Duration 436 ms by bot id=7041366449
2025-04-10 19:43:26,488 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-10 19:43:26,803 - aiogram.event - INFO - Update id=311268833 is handled. Duration 615 ms by bot id=7041366449
2025-04-10 19:43:32,442 - aiogram.event - INFO - Update id=311268834 is not handled. Duration 2 ms by bot id=7041366449
2025-04-10 19:43:40,134 - aiogram.event - INFO - Update id=311268835 is not handled. Duration 17 ms by bot id=7041366449
2025-04-10 19:44:14,906 - aiogram.event - INFO - Update id=311268836 is handled. Duration 684 ms by bot id=7041366449
2025-04-10 19:44:34,652 - aiogram.event - INFO - Update id=311268837 is handled. Duration 361 ms by bot id=7041366449
2025-04-10 19:45:08,480 - aiogram.event - INFO - Update id=311268838 is handled. Duration 604 ms by bot id=7041366449
2025-04-10 19:45:14,235 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 19:45:14,236 - app - INFO - ID пользователя: 764360279
2025-04-10 19:45:14,236 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 19:45:14,236 - app - INFO - После проверки осталось 1 корректных фотографий
2025-04-10 19:45:14,236 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 19:45:14,236 - root - INFO - Данные: company_name=Название, product_name=Re, category_id=116
2025-04-10 19:45:14,236 - root - INFO - Фотографии: 1 шт.
2025-04-10 19:45:14,236 - root - INFO - Видео: False
2025-04-10 19:45:14,237 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:45:14,237 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 19:45:14,237 - sqlalchemy.engine.Engine - INFO - [cached since 1343s ago] ('Название', 'Re', 116, 'Описание продукта', 'Россия', None, None, None, '@n0t_joke', '79771283803', 'example@domain.com', 764360279)
2025-04-10 19:45:14,238 - root - INFO - Поставщик создан с ID: 10
2025-04-10 19:45:14,238 - root - INFO - Начинаю сохранение 1 фотографий
2025-04-10 19:45:14,239 - root - INFO - Сохраняю фото 1/1: AgACAgIAAxkBAAEBmXZn9_UE7MZDMFFPb9jL6xqQbExdgQACdu0xG41ewUuMMcY_MRG_8QEAAwIAA3kAAzYE
2025-04-10 19:45:14,239 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=10
2025-04-10 19:45:14,239 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/10/5197039420434b9ca49dee75d354bfa9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 10}
2025-04-10 19:45:14,239 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-10 19:45:14,239 - sqlalchemy.engine.Engine - INFO - [cached since 1343s ago] ('photo', '2025/04/10/5197039420434b9ca49dee75d354bfa9.jpg', 'photo_1.jpg', None, 10)
2025-04-10 19:45:14,240 - root - INFO - Файл сохранен с ID: 28
2025-04-10 19:45:14,240 - root - INFO - Фото 1 сохранено с ID: 28
2025-04-10 19:45:14,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-10 19:45:14,241 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-10 19:45:14,241 - app - INFO - Поставщик успешно создан с ID: 10
2025-04-10 19:45:14,241 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 10 в чат -4610011073
2025-04-10 19:45:14,735 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 10 в чат администраторов
2025-04-10 19:45:14,735 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-10 19:45:15,088 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-10 19:45:15,089 - aiogram.event - INFO - Update id=311268839 is handled. Duration 967 ms by bot id=7041366449
2025-04-10 19:45:23,646 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:45:23,647 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:45:23,648 - sqlalchemy.engine.Engine - INFO - [cached since 1332s ago] (10,)
2025-04-10 19:45:23,651 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:45:23,653 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:45:23,653 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:45:23,654 - sqlalchemy.engine.Engine - INFO - [cached since 1332s ago] (10,)
2025-04-10 19:45:23,657 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:45:23,777 - root - INFO - Фотографии поставщика: [{'id': 28, 'type': 'photo', 'file_path': '2025/04/10/5197039420434b9ca49dee75d354bfa9.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 45, 14, 237941)}]
2025-04-10 19:45:24,377 - app.handlers.admin - INFO - Карточка поставщика 10 отправлена администратору 1043270764
2025-04-10 19:45:24,379 - aiogram.event - INFO - Update id=311268840 is handled. Duration 833 ms by bot id=7041366449
2025-04-10 19:45:38,407 - aiogram.event - INFO - Update id=311268841 is handled. Duration 423 ms by bot id=7041366449
2025-04-10 19:45:44,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:45:44,043 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 19:45:44,043 - sqlalchemy.engine.Engine - INFO - [cached since 1352s ago] (10,)
2025-04-10 19:45:44,045 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:45:44,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 19:45:44,046 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 19:45:44,046 - sqlalchemy.engine.Engine - INFO - [cached since 1352s ago] (10,)
2025-04-10 19:45:44,048 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 19:45:44,333 - aiogram.event - INFO - Update id=311268842 is handled. Duration 307 ms by bot id=7041366449
2025-04-10 19:46:46,489 - __main__ - INFO - Stopping application...
2025-04-10 19:46:47,001 - __main__ - INFO - Application stopped
2025-04-10 19:46:50,981 - app - INFO - Starting application...
2025-04-10 19:46:50,981 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 19:46:50,981 - __main__ - INFO - Action config initialized successfully
2025-04-10 19:46:50,981 - __main__ - INFO - Setting webhook at: https://e5dc-46-8-230-15.ngrok-free.app/webhook
2025-04-10 19:46:51,538 - __main__ - INFO - Application started successfully
2025-04-10 19:46:51,540 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 20:52:14,321 - __main__ - INFO - Stopping application...
2025-04-10 20:52:14,863 - __main__ - INFO - Application stopped
2025-04-10 20:52:19,290 - app - INFO - Starting application...
2025-04-10 20:52:19,291 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 20:52:19,291 - __main__ - INFO - Action config initialized successfully
2025-04-10 20:52:19,291 - __main__ - INFO - Setting webhook at: https://e5dc-46-8-230-15.ngrok-free.app/webhook
2025-04-10 20:52:19,741 - __main__ - INFO - Application started successfully
2025-04-10 20:52:19,742 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 21:11:11,337 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 21:11:11,337 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 21:11:11,339 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 21:11:11,339 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 21:11:11,340 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 21:11:11,340 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 21:11:11,341 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 21:11:11,341 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 21:11:11,341 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1043270764,)
2025-04-10 21:11:11,342 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 21:11:12,110 - aiogram.event - INFO - Update id=311268843 is handled. Duration 806 ms by bot id=7041366449
2025-04-10 21:11:14,123 - aiogram.event - INFO - Update id=311268844 is handled. Duration 256 ms by bot id=7041366449
2025-04-10 21:11:15,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 21:11:15,405 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 21:11:15,405 - sqlalchemy.engine.Engine - INFO - [generated in 0.00093s] (1043270764,)
2025-04-10 21:11:15,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 21:11:15,522 - aiogram.event - INFO - Update id=311268845 is handled. Duration 221 ms by bot id=7041366449
2025-04-10 21:11:17,853 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 21:11:17,854 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 21:11:17,855 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ()
2025-04-10 21:11:17,859 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 21:11:17,977 - aiogram.event - INFO - Update id=311268846 is handled. Duration 241 ms by bot id=7041366449
2025-04-10 21:11:20,913 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 21:11:20,915 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 21:11:20,915 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('Автотовары',)
2025-04-10 21:11:20,919 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 21:11:21,168 - aiogram.event - INFO - Update id=311268847 is handled. Duration 515 ms by bot id=7041366449
2025-04-10 21:11:23,941 - aiogram.event - INFO - Update id=311268848 is handled. Duration 243 ms by bot id=7041366449
2025-04-10 21:11:34,561 - aiogram.event - INFO - Update id=311268849 is handled. Duration 260 ms by bot id=7041366449
2025-04-10 21:11:46,058 - aiogram.event - INFO - Update id=311268850 is handled. Duration 242 ms by bot id=7041366449
2025-04-10 21:11:59,036 - aiogram.event - INFO - Update id=311268851 is handled. Duration 213 ms by bot id=7041366449
2025-04-10 21:12:05,015 - aiogram.event - INFO - Update id=311268852 is handled. Duration 356 ms by bot id=7041366449
2025-04-10 21:12:07,838 - aiogram.event - INFO - Update id=311268853 is handled. Duration 214 ms by bot id=7041366449
2025-04-10 21:12:10,940 - aiogram.event - INFO - Update id=311268854 is handled. Duration 241 ms by bot id=7041366449
2025-04-10 21:12:20,841 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 21:12:20,841 - app - INFO - Является частью группы: True
2025-04-10 21:12:20,841 - app - INFO - Добавлено фото в группу 13954469921429466, всего фото в группе: 1
2025-04-10 21:12:21,420 - root - INFO - File saved: 2025/04/10/9f25646219f74ebba92d44fa25d7ced8.jpg
2025-04-10 21:12:21,420 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 21:12:21,542 - app - INFO - Создано новое сообщение для группы 13954469921429466
2025-04-10 21:12:21,542 - aiogram.event - INFO - Update id=311268855 is handled. Duration 707 ms by bot id=7041366449
2025-04-10 21:12:21,978 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmaNn-AoEnBbi7H3zQ-coiYmtjFJzGwACqvUxGwfwwUtUj6EQzWF6igEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 21:12:21,978 - app - INFO - Является частью группы: True
2025-04-10 21:12:21,979 - app - INFO - Добавлено фото в группу 13954469921429466, всего фото в группе: 2
2025-04-10 21:12:22,289 - root - INFO - File saved: 2025/04/10/081b641eae564ab4b6bac857c0a06804.jpg
2025-04-10 21:12:22,289 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 21:12:22,413 - app - INFO - Сообщение для группы 13954469921429466 обновлено
2025-04-10 21:12:22,414 - aiogram.event - INFO - Update id=311268856 is handled. Duration 451 ms by bot id=7041366449
2025-04-10 21:12:28,389 - aiogram.event - INFO - Update id=311268857 is handled. Duration 192 ms by bot id=7041366449
2025-04-10 21:12:30,694 - aiogram.event - INFO - Update id=311268858 is handled. Duration 177 ms by bot id=7041366449
2025-04-10 21:12:33,654 - aiogram.event - INFO - Update id=311268859 is handled. Duration 216 ms by bot id=7041366449
2025-04-10 21:12:35,450 - aiogram.event - INFO - Update id=311268860 is handled. Duration 275 ms by bot id=7041366449
2025-04-10 21:12:37,949 - aiogram.event - INFO - Update id=311268861 is handled. Duration 626 ms by bot id=7041366449
2025-04-10 21:12:40,606 - aiogram.event - INFO - Update id=311268862 is handled. Duration 209 ms by bot id=7041366449
2025-04-10 21:12:47,072 - aiogram.event - INFO - Update id=311268863 is handled. Duration 121 ms by bot id=7041366449
2025-04-10 21:13:07,369 - aiogram.event - INFO - Update id=311268864 is handled. Duration 1375 ms by bot id=7041366449
2025-04-10 21:13:13,548 - aiogram.event - INFO - Update id=311268865 is handled. Duration 181 ms by bot id=7041366449
2025-04-10 21:13:17,617 - aiogram.event - INFO - Update id=311268866 is handled. Duration 95 ms by bot id=7041366449
2025-04-10 21:13:35,167 - aiogram.event - INFO - Update id=311268867 is handled. Duration 496 ms by bot id=7041366449
2025-04-10 21:13:45,249 - aiogram.event - INFO - Update id=311268868 is handled. Duration 133 ms by bot id=7041366449
2025-04-10 21:13:49,679 - aiogram.event - INFO - Update id=311268869 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 21:13:51,616 - aiogram.event - INFO - Update id=311268870 is handled. Duration 169 ms by bot id=7041366449
2025-04-10 23:04:26,519 - __main__ - INFO - Stopping application...
2025-04-10 23:04:26,976 - __main__ - INFO - Application stopped
2025-04-10 23:05:07,103 - app - INFO - Starting application...
2025-04-10 23:05:07,103 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:05:07,103 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:05:07,103 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:05:07,514 - __main__ - INFO - Application started successfully
2025-04-10 23:05:07,515 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:05:07,867 - aiogram.event - INFO - Update id=311268871 is not handled. Duration 3 ms by bot id=7041366449
2025-04-10 23:05:08,332 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:05:08,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:05:08,333 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:05:08,333 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:05:08,334 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:05:08,334 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:05:08,335 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:05:08,336 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:05:08,336 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1043270764,)
2025-04-10 23:05:08,337 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:05:08,877 - aiogram.event - INFO - Update id=311268872 is handled. Duration 606 ms by bot id=7041366449
2025-04-10 23:05:11,750 - aiogram.event - INFO - Update id=311268873 is handled. Duration 318 ms by bot id=7041366449
2025-04-10 23:05:13,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:05:13,300 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:05:13,300 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (1043270764,)
2025-04-10 23:05:13,304 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:05:13,415 - aiogram.event - INFO - Update id=311268874 is handled. Duration 228 ms by bot id=7041366449
2025-04-10 23:05:15,628 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:05:15,629 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:05:15,630 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ()
2025-04-10 23:05:15,634 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:05:15,761 - aiogram.event - INFO - Update id=311268875 is handled. Duration 248 ms by bot id=7041366449
2025-04-10 23:05:17,459 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:05:17,459 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:05:17,459 - sqlalchemy.engine.Engine - INFO - [cached since 1.83s ago] ()
2025-04-10 23:05:17,460 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:05:17,691 - aiogram.event - INFO - Update id=311268876 is handled. Duration 235 ms by bot id=7041366449
2025-04-10 23:05:19,307 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:05:19,308 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:05:19,309 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ('Автотовары',)
2025-04-10 23:05:19,314 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:05:19,412 - aiogram.event - INFO - Update id=311268877 is handled. Duration 211 ms by bot id=7041366449
2025-04-10 23:05:21,889 - aiogram.event - INFO - Update id=311268878 is handled. Duration 447 ms by bot id=7041366449
2025-04-10 23:05:23,425 - aiogram.event - INFO - Update id=311268879 is handled. Duration 180 ms by bot id=7041366449
2025-04-10 23:05:24,764 - aiogram.event - INFO - Update id=311268880 is handled. Duration 197 ms by bot id=7041366449
2025-04-10 23:05:27,941 - aiogram.event - INFO - Update id=311268881 is handled. Duration 189 ms by bot id=7041366449
2025-04-10 23:05:35,907 - aiogram.event - INFO - Update id=311268882 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 23:05:39,981 - aiogram.event - INFO - Update id=311268883 is handled. Duration 169 ms by bot id=7041366449
2025-04-10 23:05:41,130 - aiogram.event - INFO - Update id=311268884 is handled. Duration 192 ms by bot id=7041366449
2025-04-10 23:05:42,140 - aiogram.event - INFO - Update id=311268885 is handled. Duration 181 ms by bot id=7041366449
2025-04-10 23:05:46,332 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 23:05:46,333 - app - INFO - Является частью группы: True
2025-04-10 23:05:46,333 - app - INFO - Добавлено фото в группу 13954524368878162, всего фото в группе: 1
2025-04-10 23:05:46,740 - root - INFO - File saved: 2025/04/10/8a5214a80019459ea671cb31ad65c4b3.jpg
2025-04-10 23:05:46,741 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 23:05:46,856 - app - INFO - Создано новое сообщение для группы 13954524368878162
2025-04-10 23:05:46,858 - aiogram.event - INFO - Update id=311268886 is handled. Duration 540 ms by bot id=7041366449
2025-04-10 23:05:47,233 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmK9n9wABs2PycBZtx11q4ZdBvq2um4YAAuT2MRvL7rlLAcHitDqz0CUBAAMCAAN5AAM2BA, размер=576x1280
2025-04-10 23:05:47,233 - app - INFO - Является частью группы: True
2025-04-10 23:05:47,234 - app - INFO - Добавлено фото в группу 13954524368878162, всего фото в группе: 2
2025-04-10 23:05:47,379 - root - INFO - File saved: 2025/04/10/3265800720d54330a74fae40e6b17bc3.jpg
2025-04-10 23:05:47,379 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 23:05:47,527 - app - INFO - Сообщение для группы 13954524368878162 обновлено
2025-04-10 23:05:47,528 - aiogram.event - INFO - Update id=311268887 is handled. Duration 310 ms by bot id=7041366449
2025-04-10 23:05:49,070 - aiogram.event - INFO - Update id=311268888 is handled. Duration 246 ms by bot id=7041366449
2025-04-10 23:05:55,374 - aiogram.event - INFO - Update id=311268889 is handled. Duration 508 ms by bot id=7041366449
2025-04-10 23:05:57,771 - aiogram.event - INFO - Update id=311268890 is handled. Duration 246 ms by bot id=7041366449
2025-04-10 23:05:59,381 - aiogram.event - INFO - Update id=311268891 is handled. Duration 218 ms by bot id=7041366449
2025-04-10 23:06:07,006 - aiogram.event - INFO - Update id=311268892 is handled. Duration 227 ms by bot id=7041366449
2025-04-10 23:19:25,443 - __main__ - INFO - Stopping application...
2025-04-10 23:19:26,171 - __main__ - INFO - Application stopped
2025-04-10 23:19:29,806 - app - INFO - Starting application...
2025-04-10 23:19:29,806 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:19:29,806 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:19:29,806 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:19:30,179 - __main__ - INFO - Application started successfully
2025-04-10 23:19:30,180 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:19:42,847 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:19:42,847 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:19:42,848 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:19:42,848 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:19:42,849 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:19:42,849 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:19:42,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:19:42,851 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:19:42,851 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1043270764,)
2025-04-10 23:19:42,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:19:43,158 - aiogram.event - INFO - Update id=311268893 is handled. Duration 371 ms by bot id=7041366449
2025-04-10 23:19:48,073 - aiogram.event - INFO - Update id=311268894 is handled. Duration 171 ms by bot id=7041366449
2025-04-10 23:19:49,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:19:49,712 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:19:49,713 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1043270764,)
2025-04-10 23:19:49,714 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:19:49,793 - aiogram.event - INFO - Update id=311268895 is handled. Duration 154 ms by bot id=7041366449
2025-04-10 23:19:51,440 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:19:51,440 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:19:51,440 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-10 23:19:51,441 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:19:51,540 - aiogram.event - INFO - Update id=311268896 is handled. Duration 335 ms by bot id=7041366449
2025-04-10 23:19:55,518 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:19:55,519 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:19:55,519 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('Автотовары',)
2025-04-10 23:19:55,520 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:19:55,623 - aiogram.event - INFO - Update id=311268897 is handled. Duration 676 ms by bot id=7041366449
2025-04-10 23:19:56,868 - aiogram.event - INFO - Update id=311268898 is handled. Duration 495 ms by bot id=7041366449
2025-04-10 23:19:58,563 - aiogram.event - INFO - Update id=311268899 is handled. Duration 179 ms by bot id=7041366449
2025-04-10 23:20:01,618 - aiogram.event - INFO - Update id=311268900 is handled. Duration 206 ms by bot id=7041366449
2025-04-10 23:20:04,586 - aiogram.event - INFO - Update id=311268901 is handled. Duration 297 ms by bot id=7041366449
2025-04-10 23:20:08,467 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmaNn-AoEnBbi7H3zQ-coiYmtjFJzGwACqvUxGwfwwUtUj6EQzWF6igEAAwIAA3kAAzYE, размер=576x1280
2025-04-10 23:20:08,468 - app - INFO - Является частью группы: True
2025-04-10 23:20:08,468 - app - INFO - Добавлено фото в группу 13954531266019866, всего фото в группе: 1
2025-04-10 23:20:08,920 - root - INFO - File saved: 2025/04/10/69256316e8464e339bd7392250ae3cd3.jpg
2025-04-10 23:20:08,921 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 23:20:09,012 - app - INFO - Создано новое сообщение для группы 13954531266019866
2025-04-10 23:20:09,013 - aiogram.event - INFO - Update id=311268902 is handled. Duration 558 ms by bot id=7041366449
2025-04-10 23:20:09,384 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 23:20:09,385 - app - INFO - Является частью группы: True
2025-04-10 23:20:09,385 - app - INFO - Добавлено фото в группу 13954531266019866, всего фото в группе: 2
2025-04-10 23:20:10,179 - root - INFO - File saved: 2025/04/10/ca929503423b45a1ab2ef845b1f341e1.jpg
2025-04-10 23:20:10,180 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 23:20:10,325 - app - INFO - Сообщение для группы 13954531266019866 обновлено
2025-04-10 23:20:10,326 - aiogram.event - INFO - Update id=311268903 is handled. Duration 954 ms by bot id=7041366449
2025-04-10 23:20:11,900 - aiogram.event - INFO - Update id=311268904 is handled. Duration 239 ms by bot id=7041366449
2025-04-10 23:20:14,326 - aiogram.event - INFO - Update id=311268905 is handled. Duration 172 ms by bot id=7041366449
2025-04-10 23:20:16,794 - aiogram.event - INFO - Update id=311268906 is handled. Duration 422 ms by bot id=7041366449
2025-04-10 23:20:20,534 - aiogram.event - INFO - Update id=311268907 is handled. Duration 269 ms by bot id=7041366449
2025-04-10 23:20:24,521 - aiogram.event - INFO - Update id=311268908 is handled. Duration 163 ms by bot id=7041366449
2025-04-10 23:21:29,161 - __main__ - INFO - Stopping application...
2025-04-10 23:21:29,639 - __main__ - INFO - Application stopped
2025-04-10 23:21:32,658 - app - INFO - Starting application...
2025-04-10 23:21:32,658 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:21:32,658 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:21:32,658 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:21:33,086 - __main__ - INFO - Application started successfully
2025-04-10 23:21:33,088 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:21:38,562 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:21:38,562 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:21:38,564 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:21:38,564 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:21:38,565 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:21:38,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:21:38,566 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:21:38,566 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:21:38,566 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1043270764,)
2025-04-10 23:21:38,567 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:21:39,073 - aiogram.event - INFO - Update id=311268909 is handled. Duration 572 ms by bot id=7041366449
2025-04-10 23:21:40,552 - aiogram.event - INFO - Update id=311268910 is handled. Duration 212 ms by bot id=7041366449
2025-04-10 23:21:41,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:21:41,726 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:21:41,736 - sqlalchemy.engine.Engine - INFO - [generated in 0.01037s] (1043270764,)
2025-04-10 23:21:41,740 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:21:41,872 - aiogram.event - INFO - Update id=311268911 is handled. Duration 300 ms by bot id=7041366449
2025-04-10 23:21:45,248 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:21:45,249 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:21:45,249 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-10 23:21:45,250 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:21:45,343 - aiogram.event - INFO - Update id=311268912 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 23:21:46,578 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:21:46,579 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:21:46,579 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('Автотовары',)
2025-04-10 23:21:46,585 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:21:46,680 - aiogram.event - INFO - Update id=311268913 is handled. Duration 197 ms by bot id=7041366449
2025-04-10 23:21:48,641 - aiogram.event - INFO - Update id=311268914 is handled. Duration 210 ms by bot id=7041366449
2025-04-10 23:21:51,599 - aiogram.event - INFO - Update id=311268915 is handled. Duration 199 ms by bot id=7041366449
2025-04-10 23:21:54,356 - aiogram.event - INFO - Update id=311268916 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 23:21:57,571 - aiogram.event - INFO - Update id=311268917 is handled. Duration 191 ms by bot id=7041366449
2025-04-10 23:21:59,865 - aiogram.event - INFO - Update id=311268918 is handled. Duration 100 ms by bot id=7041366449
2025-04-10 23:22:02,226 - aiogram.event - INFO - Update id=311268919 is handled. Duration 178 ms by bot id=7041366449
2025-04-10 23:22:16,078 - aiogram.event - INFO - Update id=311268920 is handled. Duration 507 ms by bot id=7041366449
2025-04-10 23:22:23,380 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3dn9oY4q0qWk1Degs2AFL5pLpWaLQACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 23:22:23,380 - app - INFO - Является частью группы: True
2025-04-10 23:22:23,380 - app - INFO - Добавлено фото в группу 13954532343919554, всего фото в группе: 1
2025-04-10 23:22:23,933 - root - INFO - File saved: 2025/04/10/cea928749d5f4b5d962bd090041e204b.jpg
2025-04-10 23:22:23,934 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 23:22:24,060 - app - INFO - Создано новое сообщение для группы 13954532343919554
2025-04-10 23:22:24,062 - aiogram.event - INFO - Update id=311268921 is handled. Duration 696 ms by bot id=7041366449
2025-04-10 23:22:24,492 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBl3Vn9oY4Bz3eL85wQD7bVY_sNUZhkwACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 23:22:24,493 - app - INFO - Является частью группы: True
2025-04-10 23:22:24,493 - app - INFO - Добавлено фото в группу 13954532343919554, всего фото в группе: 2
2025-04-10 23:22:24,866 - root - INFO - File saved: 2025/04/10/0966de952da44995b4914a143c84f089.jpg
2025-04-10 23:22:24,867 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 23:22:25,006 - app - INFO - Сообщение для группы 13954532343919554 обновлено
2025-04-10 23:22:25,007 - aiogram.event - INFO - Update id=311268922 is handled. Duration 529 ms by bot id=7041366449
2025-04-10 23:22:26,344 - aiogram.event - INFO - Update id=311268923 is handled. Duration 332 ms by bot id=7041366449
2025-04-10 23:22:28,587 - aiogram.event - INFO - Update id=311268924 is handled. Duration 219 ms by bot id=7041366449
2025-04-10 23:22:31,344 - aiogram.event - INFO - Update id=311268925 is handled. Duration 724 ms by bot id=7041366449
2025-04-10 23:22:33,439 - aiogram.event - INFO - Update id=311268926 is handled. Duration 464 ms by bot id=7041366449
2025-04-10 23:22:39,779 - aiogram.event - INFO - Update id=311268927 is handled. Duration 375 ms by bot id=7041366449
2025-04-10 23:22:43,045 - aiogram.event - INFO - Update id=311268928 is handled. Duration 200 ms by bot id=7041366449
2025-04-10 23:22:44,424 - aiogram.event - INFO - Update id=311268929 is handled. Duration 183 ms by bot id=7041366449
2025-04-10 23:23:11,495 - __main__ - INFO - Stopping application...
2025-04-10 23:23:11,959 - __main__ - INFO - Application stopped
2025-04-10 23:23:15,046 - app - INFO - Starting application...
2025-04-10 23:23:15,046 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:23:15,046 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:23:15,046 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:23:15,556 - __main__ - INFO - Application started successfully
2025-04-10 23:23:15,558 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:23:19,414 - aiogram.event - INFO - Update id=311268930 is handled. Duration 252 ms by bot id=7041366449
2025-04-10 23:23:22,616 - aiogram.event - INFO - Update id=311268931 is handled. Duration 179 ms by bot id=7041366449
2025-04-10 23:23:24,339 - aiogram.event - INFO - Update id=311268932 is handled. Duration 469 ms by bot id=7041366449
2025-04-10 23:23:39,801 - aiogram.event - INFO - Update id=311268933 is handled. Duration 363 ms by bot id=7041366449
2025-04-10 23:23:41,504 - aiogram.event - INFO - Update id=311268934 is handled. Duration 224 ms by bot id=7041366449
2025-04-10 23:23:42,812 - aiogram.event - INFO - Update id=311268935 is handled. Duration 407 ms by bot id=7041366449
2025-04-10 23:23:43,718 - aiogram.event - INFO - Update id=311268936 is handled. Duration 188 ms by bot id=7041366449
2025-04-10 23:23:45,206 - aiogram.event - INFO - Update id=311268937 is handled. Duration 241 ms by bot id=7041366449
2025-04-10 23:23:46,706 - aiogram.event - INFO - Update id=311268938 is handled. Duration 206 ms by bot id=7041366449
2025-04-10 23:23:48,594 - aiogram.event - INFO - Update id=311268939 is handled. Duration 250 ms by bot id=7041366449
2025-04-10 23:23:49,745 - aiogram.event - INFO - Update id=311268940 is handled. Duration 167 ms by bot id=7041366449
2025-04-10 23:23:50,764 - aiogram.event - INFO - Update id=311268941 is handled. Duration 166 ms by bot id=7041366449
2025-04-10 23:23:52,002 - aiogram.event - INFO - Update id=311268942 is handled. Duration 179 ms by bot id=7041366449
2025-04-10 23:23:53,557 - aiogram.event - INFO - Update id=311268943 is handled. Duration 195 ms by bot id=7041366449
2025-04-10 23:23:56,420 - aiogram.event - INFO - Update id=311268944 is handled. Duration 193 ms by bot id=7041366449
2025-04-10 23:23:57,940 - aiogram.event - INFO - Update id=311268945 is handled. Duration 278 ms by bot id=7041366449
2025-04-10 23:24:07,990 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:24:07,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:24:07,991 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:24:07,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:24:07,992 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:24:07,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:24:07,994 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:07,994 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:24:07,994 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1043270764,)
2025-04-10 23:24:07,996 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:08,292 - aiogram.event - INFO - Update id=311268946 is handled. Duration 336 ms by bot id=7041366449
2025-04-10 23:24:09,730 - aiogram.event - INFO - Update id=311268947 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 23:24:11,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:11,137 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:24:11,147 - sqlalchemy.engine.Engine - INFO - [generated in 0.00987s] (1043270764,)
2025-04-10 23:24:11,151 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:11,259 - aiogram.event - INFO - Update id=311268948 is handled. Duration 221 ms by bot id=7041366449
2025-04-10 23:24:15,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:15,650 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:24:15,651 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ()
2025-04-10 23:24:15,655 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:15,753 - aiogram.event - INFO - Update id=311268949 is handled. Duration 205 ms by bot id=7041366449
2025-04-10 23:24:18,960 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:18,961 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:24:18,961 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('Автотовары',)
2025-04-10 23:24:18,963 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:19,075 - aiogram.event - INFO - Update id=311268950 is handled. Duration 215 ms by bot id=7041366449
2025-04-10 23:24:21,480 - aiogram.event - INFO - Update id=311268951 is handled. Duration 266 ms by bot id=7041366449
2025-04-10 23:24:23,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:23,714 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:24:23,714 - sqlalchemy.engine.Engine - INFO - [cached since 4.754s ago] ('Автотовары',)
2025-04-10 23:24:23,717 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:23,807 - aiogram.event - INFO - Update id=311268952 is handled. Duration 176 ms by bot id=7041366449
2025-04-10 23:24:25,252 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:25,252 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:24:25,252 - sqlalchemy.engine.Engine - INFO - [cached since 9.602s ago] ()
2025-04-10 23:24:25,254 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:25,420 - aiogram.event - INFO - Update id=311268953 is handled. Duration 315 ms by bot id=7041366449
2025-04-10 23:24:27,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:24:27,563 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:24:27,563 - sqlalchemy.engine.Engine - INFO - [cached since 8.603s ago] ('Автотовары',)
2025-04-10 23:24:27,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:24:27,748 - aiogram.event - INFO - Update id=311268954 is handled. Duration 326 ms by bot id=7041366449
2025-04-10 23:24:29,757 - aiogram.event - INFO - Update id=311268955 is handled. Duration 247 ms by bot id=7041366449
2025-04-10 23:24:35,539 - aiogram.event - INFO - Update id=311268956 is handled. Duration 191 ms by bot id=7041366449
2025-04-10 23:24:37,854 - aiogram.event - INFO - Update id=311268957 is handled. Duration 188 ms by bot id=7041366449
2025-04-10 23:24:41,449 - aiogram.event - INFO - Update id=311268958 is handled. Duration 214 ms by bot id=7041366449
2025-04-10 23:24:43,808 - aiogram.event - INFO - Update id=311268959 is handled. Duration 168 ms by bot id=7041366449
2025-04-10 23:24:48,101 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmIFn9vt1CFGUb3k2BhmeLdPIq70fRgACf_cxG2fgqEupXNnaLff00AEAAwIAA3kAAzYE, размер=960x1280
2025-04-10 23:24:48,101 - app - INFO - Является частью группы: True
2025-04-10 23:24:48,101 - app - INFO - Добавлено фото в группу 13954533503107178, всего фото в группе: 1
2025-04-10 23:24:48,495 - root - INFO - File saved: 2025/04/10/52bfe1d994dc4869bc6260a446c05bd0.jpg
2025-04-10 23:24:48,496 - app - INFO - Фото сохранено, всего фото: 1
2025-04-10 23:24:48,652 - app - INFO - Создано новое сообщение для группы 13954533503107178
2025-04-10 23:24:48,654 - aiogram.event - INFO - Update id=311268960 is handled. Duration 557 ms by bot id=7041366449
2025-04-10 23:24:49,069 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBmhFn-CkPn33js_PoBM0rCz0Ymov5aQACZ_YxGwfwwUsRAAHKoJ61CtYBAAMCAAN5AAM2BA, размер=960x1280
2025-04-10 23:24:49,069 - app - INFO - Является частью группы: True
2025-04-10 23:24:49,069 - app - INFO - Добавлено фото в группу 13954533503107178, всего фото в группе: 2
2025-04-10 23:24:49,362 - root - INFO - File saved: 2025/04/10/91261fc7fc2d4974b6c31cabf2e87344.jpg
2025-04-10 23:24:49,362 - app - INFO - Фото сохранено, всего фото: 2
2025-04-10 23:24:49,465 - app - INFO - Сообщение для группы 13954533503107178 обновлено
2025-04-10 23:24:49,466 - aiogram.event - INFO - Update id=311268961 is handled. Duration 399 ms by bot id=7041366449
2025-04-10 23:24:50,982 - aiogram.event - INFO - Update id=311268962 is handled. Duration 278 ms by bot id=7041366449
2025-04-10 23:24:53,590 - aiogram.event - INFO - Update id=311268963 is handled. Duration 163 ms by bot id=7041366449
2025-04-10 23:24:55,455 - aiogram.event - INFO - Update id=311268964 is handled. Duration 348 ms by bot id=7041366449
2025-04-10 23:24:57,025 - aiogram.event - INFO - Update id=311268965 is handled. Duration 175 ms by bot id=7041366449
2025-04-10 23:24:59,915 - aiogram.event - INFO - Update id=311268966 is handled. Duration 400 ms by bot id=7041366449
2025-04-10 23:25:03,059 - aiogram.event - INFO - Update id=311268967 is handled. Duration 204 ms by bot id=7041366449
2025-04-10 23:25:11,099 - aiogram.event - INFO - Update id=311268968 is not handled. Duration 11 ms by bot id=7041366449
2025-04-10 23:25:53,078 - __main__ - INFO - Stopping application...
2025-04-10 23:25:53,538 - __main__ - INFO - Application stopped
2025-04-10 23:25:57,254 - app - INFO - Starting application...
2025-04-10 23:25:57,254 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:25:57,255 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:25:57,255 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:25:57,661 - __main__ - INFO - Application started successfully
2025-04-10 23:25:57,663 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:26:00,658 - aiogram.event - INFO - Update id=311268969 is handled. Duration 417 ms by bot id=7041366449
2025-04-10 23:26:08,802 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:26:08,802 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:26:08,803 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:26:08,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:26:08,804 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:26:08,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:26:08,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:26:08,805 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:26:08,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1043270764,)
2025-04-10 23:26:08,807 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:26:09,096 - aiogram.event - INFO - Update id=311268970 is handled. Duration 357 ms by bot id=7041366449
2025-04-10 23:26:10,601 - aiogram.event - INFO - Update id=311268971 is handled. Duration 157 ms by bot id=7041366449
2025-04-10 23:26:11,981 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:26:11,981 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:26:11,981 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1043270764,)
2025-04-10 23:26:11,983 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:26:12,066 - aiogram.event - INFO - Update id=311268972 is handled. Duration 157 ms by bot id=7041366449
2025-04-10 23:26:13,570 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:26:13,570 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:26:13,571 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ()
2025-04-10 23:26:13,575 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:26:13,675 - aiogram.event - INFO - Update id=311268973 is handled. Duration 196 ms by bot id=7041366449
2025-04-10 23:26:15,774 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:26:15,775 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:26:15,776 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ('Автотовары',)
2025-04-10 23:26:15,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:26:15,869 - aiogram.event - INFO - Update id=311268974 is handled. Duration 184 ms by bot id=7041366449
2025-04-10 23:26:17,338 - aiogram.event - INFO - Update id=311268975 is handled. Duration 206 ms by bot id=7041366449
2025-04-10 23:26:19,476 - aiogram.event - INFO - Update id=311268976 is handled. Duration 332 ms by bot id=7041366449
2025-04-10 23:26:22,634 - aiogram.event - INFO - Update id=311268977 is handled. Duration 207 ms by bot id=7041366449
2025-04-10 23:26:26,994 - aiogram.event - INFO - Update id=311268978 is handled. Duration 337 ms by bot id=7041366449
2025-04-10 23:26:30,998 - aiogram.event - INFO - Update id=311268979 is handled. Duration 431 ms by bot id=7041366449
2025-04-10 23:26:34,506 - aiogram.event - INFO - Update id=311268980 is handled. Duration 168 ms by bot id=7041366449
2025-04-10 23:26:38,841 - aiogram.event - INFO - Update id=311268981 is handled. Duration 408 ms by bot id=7041366449
2025-04-10 23:26:41,909 - aiogram.event - INFO - Update id=311268982 is handled. Duration 331 ms by bot id=7041366449
2025-04-10 23:26:43,594 - aiogram.event - INFO - Update id=311268983 is handled. Duration 154 ms by bot id=7041366449
2025-04-10 23:26:45,631 - aiogram.event - INFO - Update id=311268984 is handled. Duration 335 ms by bot id=7041366449
2025-04-10 23:26:47,503 - aiogram.event - INFO - Update id=311268985 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 23:26:49,719 - aiogram.event - INFO - Update id=311268986 is handled. Duration 329 ms by bot id=7041366449
2025-04-10 23:26:51,173 - aiogram.event - INFO - Update id=311268987 is handled. Duration 168 ms by bot id=7041366449
2025-04-10 23:29:55,644 - __main__ - INFO - Stopping application...
2025-04-10 23:29:56,112 - __main__ - INFO - Application stopped
2025-04-10 23:29:59,851 - app - INFO - Starting application...
2025-04-10 23:29:59,851 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:29:59,851 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:29:59,851 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:30:00,236 - __main__ - INFO - Application started successfully
2025-04-10 23:30:00,238 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:30:02,517 - aiogram.event - INFO - Update id=311268988 is handled. Duration 298 ms by bot id=7041366449
2025-04-10 23:30:09,222 - aiogram.event - INFO - Update id=311268989 is handled. Duration 349 ms by bot id=7041366449
2025-04-10 23:30:13,539 - aiogram.event - INFO - Update id=311268990 is handled. Duration 270 ms by bot id=7041366449
2025-04-10 23:30:43,178 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:30:43,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:30:43,179 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:30:43,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:30:43,180 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:30:43,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:30:43,181 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:30:43,181 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:30:43,181 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-10 23:30:43,182 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:30:43,600 - aiogram.event - INFO - Update id=311268991 is handled. Duration 487 ms by bot id=7041366449
2025-04-10 23:30:45,719 - aiogram.event - INFO - Update id=311268992 is handled. Duration 188 ms by bot id=7041366449
2025-04-10 23:30:46,841 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:30:46,843 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-10 23:30:46,843 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] (1043270764,)
2025-04-10 23:30:46,847 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:30:46,942 - aiogram.event - INFO - Update id=311268993 is handled. Duration 185 ms by bot id=7041366449
2025-04-10 23:30:49,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:30:49,619 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:30:49,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ()
2025-04-10 23:30:49,624 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:30:49,760 - aiogram.event - INFO - Update id=311268994 is handled. Duration 236 ms by bot id=7041366449
2025-04-10 23:30:50,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:30:50,771 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:30:50,772 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('Автотовары',)
2025-04-10 23:30:50,776 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:30:50,866 - aiogram.event - INFO - Update id=311268995 is handled. Duration 206 ms by bot id=7041366449
2025-04-10 23:30:52,086 - aiogram.event - INFO - Update id=311268996 is handled. Duration 186 ms by bot id=7041366449
2025-04-10 23:30:54,839 - aiogram.event - INFO - Update id=311268997 is handled. Duration 197 ms by bot id=7041366449
2025-04-10 23:30:57,576 - aiogram.event - INFO - Update id=311268998 is handled. Duration 195 ms by bot id=7041366449
2025-04-10 23:30:59,634 - aiogram.event - INFO - Update id=311268999 is handled. Duration 178 ms by bot id=7041366449
2025-04-10 23:31:02,168 - aiogram.event - INFO - Update id=311269000 is handled. Duration 176 ms by bot id=7041366449
2025-04-10 23:31:05,351 - aiogram.event - INFO - Update id=311269001 is handled. Duration 263 ms by bot id=7041366449
2025-04-10 23:31:08,262 - aiogram.event - INFO - Update id=311269002 is handled. Duration 408 ms by bot id=7041366449
2025-04-10 23:31:11,202 - aiogram.event - INFO - Update id=311269003 is handled. Duration 276 ms by bot id=7041366449
2025-04-10 23:31:24,345 - aiogram.event - INFO - Update id=311269004 is not handled. Duration 206 ms by bot id=7041366449
2025-04-10 23:31:24,345 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: message can't be edited
2025-04-10 23:31:24,719 - aiogram.event - INFO - Update id=311269004 is not handled. Duration 15 ms by bot id=7041366449
2025-04-10 23:33:17,635 - __main__ - INFO - Stopping application...
2025-04-10 23:33:18,093 - __main__ - INFO - Application stopped
2025-04-10 23:33:21,212 - app - INFO - Starting application...
2025-04-10 23:33:21,212 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:33:21,213 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:33:21,213 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:33:21,634 - __main__ - INFO - Application started successfully
2025-04-10 23:33:21,635 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:33:26,533 - aiogram.event - INFO - Update id=311269005 is handled. Duration 427 ms by bot id=7041366449
2025-04-10 23:33:33,015 - aiogram.event - INFO - Update id=311269006 is handled. Duration 363 ms by bot id=7041366449
2025-04-10 23:33:35,734 - aiogram.event - INFO - Update id=311269007 is handled. Duration 524 ms by bot id=7041366449
2025-04-10 23:33:41,673 - aiogram.event - INFO - Update id=311269008 is handled. Duration 317 ms by bot id=7041366449
2025-04-10 23:33:46,244 - aiogram.event - INFO - Update id=311269009 is handled. Duration 107 ms by bot id=7041366449
2025-04-10 23:33:53,928 - aiogram.event - INFO - Update id=311269010 is handled. Duration 386 ms by bot id=7041366449
2025-04-10 23:34:34,981 - app - INFO - === Подтверждение создания поставщика ===
2025-04-10 23:34:34,981 - app - INFO - ID пользователя: 1043270764
2025-04-10 23:34:34,982 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-10 23:34:34,982 - root - INFO - === Начало сохранения поставщика ===
2025-04-10 23:34:34,983 - root - INFO - Данные: company_name=Hdhfbfjf, product_name=None, category_id=None
2025-04-10 23:34:34,983 - root - INFO - Фотографии: 0 шт.
2025-04-10 23:34:34,983 - root - INFO - Видео: False
2025-04-10 23:34:35,048 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:34:35,048 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:34:35,049 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:34:35,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:34:35,050 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:34:35,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:34:35,051 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:34:35,051 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-10 23:34:35,052 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)
2025-04-10 23:34:35,053 - root - ERROR - Query execution error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).
[SQL: 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            ]
[parameters: ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-04-10 23:34:35,053 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:34:35,053 - root - ERROR - === ОШИБКА при сохранении поставщика: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).
[SQL: 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            ]
[parameters: ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) ===
2025-04-10 23:34:35,053 - root - ERROR - Тип ошибки: IntegrityError
2025-04-10 23:34:35,070 - root - ERROR - Стек вызовов: Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/app/services/database.py", line 495, in save_supplier
    result = await self.execute_query(query, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/app/services/database.py", line 131, in execute_query
    result = await self.session.execute(text(query), params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2260, in _execute_internal
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).
[SQL: 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            ]
[parameters: ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-04-10 23:34:35,071 - app - ERROR - === ОШИБКА при создании поставщика: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).
[SQL: 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            ]
[parameters: ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) ===
2025-04-10 23:34:35,071 - app - ERROR - Тип ошибки: IntegrityError
2025-04-10 23:34:35,079 - app - ERROR - Стек вызовов: Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/app/handlers/suppliers.py", line 1004, in confirm_supplier_creation
    
    
    ...<14 lines>...
        video=state_data.get("video")
        ^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/app/services/database.py", line 495, in save_supplier
    result = await self.execute_query(query, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/app/services/database.py", line 131, in execute_query
    result = await self.session.execute(text(query), params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2260, in _execute_internal
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "product_name" отношения "suppliers" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (11, Hdhfbfjf, null, null, null, null, null, null, null, null, null, null, 2025-04-10 23:34:35.052179, pending, null, null).
[SQL: 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            ]
[parameters: ('Hdhfbfjf', None, None, None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-04-10 23:34:35,266 - aiogram.event - INFO - Update id=311269011 is handled. Duration 764 ms by bot id=7041366449
2025-04-10 23:35:17,410 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:17,410 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:35:17,411 - sqlalchemy.engine.Engine - INFO - [generated in 0.00112s] (1043270764,)
2025-04-10 23:35:17,415 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:17,825 - aiogram.event - INFO - Update id=311269012 is handled. Duration 417 ms by bot id=7041366449
2025-04-10 23:35:20,346 - aiogram.event - INFO - Update id=311269013 is handled. Duration 175 ms by bot id=7041366449
2025-04-10 23:35:22,276 - aiogram.event - INFO - Update id=311269014 is handled. Duration 160 ms by bot id=7041366449
2025-04-10 23:35:24,021 - aiogram.event - INFO - Update id=311269015 is handled. Duration 163 ms by bot id=7041366449
2025-04-10 23:35:25,808 - aiogram.event - INFO - Update id=311269016 is handled. Duration 309 ms by bot id=7041366449
2025-04-10 23:35:27,710 - aiogram.event - INFO - Update id=311269017 is handled. Duration 165 ms by bot id=7041366449
2025-04-10 23:35:29,553 - aiogram.event - INFO - Update id=311269018 is handled. Duration 165 ms by bot id=7041366449
2025-04-10 23:35:31,331 - aiogram.event - INFO - Update id=311269019 is handled. Duration 613 ms by bot id=7041366449
2025-04-10 23:35:33,866 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:33,867 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:35:33,867 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ()
2025-04-10 23:35:33,871 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:33,966 - aiogram.event - INFO - Update id=311269020 is handled. Duration 176 ms by bot id=7041366449
2025-04-10 23:35:36,847 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:36,848 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:35:36,848 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('Автотовары',)
2025-04-10 23:35:36,853 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:36,951 - aiogram.event - INFO - Update id=311269021 is handled. Duration 190 ms by bot id=7041366449
2025-04-10 23:35:39,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,638 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 23:35:39,638 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (58,)
2025-04-10 23:35:39,639 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,728 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,729 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] (9,)
2025-04-10 23:35:39,735 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,737 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,738 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,738 - sqlalchemy.engine.Engine - INFO - [generated in 0.00125s] (9,)
2025-04-10 23:35:39,743 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,747 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,747 - sqlalchemy.engine.Engine - INFO - [cached since 0.0193s ago] (8,)
2025-04-10 23:35:39,751 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,753 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,754 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,754 - sqlalchemy.engine.Engine - INFO - [cached since 0.01692s ago] (8,)
2025-04-10 23:35:39,757 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,759 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,760 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,761 - sqlalchemy.engine.Engine - INFO - [cached since 0.033s ago] (7,)
2025-04-10 23:35:39,765 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,767 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,768 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,768 - sqlalchemy.engine.Engine - INFO - [cached since 0.03085s ago] (7,)
2025-04-10 23:35:39,770 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,772 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,773 - sqlalchemy.engine.Engine - INFO - [cached since 0.04492s ago] (6,)
2025-04-10 23:35:39,775 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,776 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,776 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,776 - sqlalchemy.engine.Engine - INFO - [cached since 0.0391s ago] (6,)
2025-04-10 23:35:39,777 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,778 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,779 - sqlalchemy.engine.Engine - INFO - [cached since 0.05091s ago] (5,)
2025-04-10 23:35:39,781 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,782 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,783 - sqlalchemy.engine.Engine - INFO - [cached since 0.04541s ago] (5,)
2025-04-10 23:35:39,784 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,785 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,785 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,786 - sqlalchemy.engine.Engine - INFO - [cached since 0.05793s ago] (4,)
2025-04-10 23:35:39,787 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,788 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,788 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,789 - sqlalchemy.engine.Engine - INFO - [cached since 0.05152s ago] (4,)
2025-04-10 23:35:39,790 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,791 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,791 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,791 - sqlalchemy.engine.Engine - INFO - [cached since 0.06344s ago] (3,)
2025-04-10 23:35:39,792 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,792 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,793 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,793 - sqlalchemy.engine.Engine - INFO - [cached since 0.0555s ago] (3,)
2025-04-10 23:35:39,793 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,794 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,794 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:35:39,794 - sqlalchemy.engine.Engine - INFO - [cached since 0.06635s ago] (2,)
2025-04-10 23:35:39,795 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,795 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:35:39,795 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:35:39,796 - sqlalchemy.engine.Engine - INFO - [cached since 0.05843s ago] (2,)
2025-04-10 23:35:39,796 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:35:39,798 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-10 23:35:40,256 - aiogram.event - INFO - Update id=311269022 is handled. Duration 619 ms by bot id=7041366449
2025-04-10 23:35:41,784 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 23:35:42,102 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 23:35:42,224 - aiogram.event - INFO - Update id=311269023 is handled. Duration 447 ms by bot id=7041366449
2025-04-10 23:35:43,451 - root - INFO - Фотографии поставщика: [{'id': 22, 'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 23, 'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 24, 'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}]
2025-04-10 23:35:43,816 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 23:35:43,901 - aiogram.event - INFO - Update id=311269024 is handled. Duration 451 ms by bot id=7041366449
2025-04-10 23:35:45,157 - root - INFO - Фотографии поставщика: [{'id': 19, 'type': 'photo', 'file_path': '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 20, 'type': 'photo', 'file_path': '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 21, 'type': 'photo', 'file_path': '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}]
2025-04-10 23:35:45,826 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 23:35:45,920 - aiogram.event - INFO - Update id=311269025 is handled. Duration 763 ms by bot id=7041366449
2025-04-10 23:35:47,572 - root - INFO - Фотографии поставщика: [{'id': 16, 'type': 'photo', 'file_path': '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 17, 'type': 'photo', 'file_path': '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 18, 'type': 'photo', 'file_path': '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}]
2025-04-10 23:35:48,136 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 23:35:48,223 - aiogram.event - INFO - Update id=311269026 is handled. Duration 654 ms by bot id=7041366449
2025-04-10 23:35:50,868 - root - INFO - Фотографии поставщика: [{'id': 13, 'type': 'photo', 'file_path': '2025/04/10/c9d00dbea00e41e48d204510811aa19a.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}, {'id': 14, 'type': 'photo', 'file_path': '2025/04/10/44b73d8ff5054324986c766fcc90ce0d.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}, {'id': 15, 'type': 'photo', 'file_path': '2025/04/10/5e7a302069804471aa2bc4684ee8af33.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 1, 58, 15, 749707)}]
2025-04-10 23:35:51,642 - root - ERROR - Ошибка при обновлении клавиатуры: 1 validation error for EditMessageReplyMarkup
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-04-10 23:35:51,736 - aiogram.event - INFO - Update id=311269027 is handled. Duration 874 ms by bot id=7041366449
2025-04-10 23:38:29,369 - __main__ - INFO - Stopping application...
2025-04-10 23:38:30,093 - __main__ - INFO - Application stopped
2025-04-10 23:39:08,549 - app - INFO - Starting application...
2025-04-10 23:39:08,549 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:39:08,550 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:39:08,550 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:39:08,962 - __main__ - INFO - Application started successfully
2025-04-10 23:39:08,964 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:39:09,240 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:39:09,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:39:09,242 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:39:09,242 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:39:09,243 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:39:09,243 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:39:09,245 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:39:09,245 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:39:09,245 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1043270764,)
2025-04-10 23:39:09,248 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:39:09,555 - aiogram.event - INFO - Update id=311269028 is handled. Duration 351 ms by bot id=7041366449
2025-04-10 23:39:12,417 - aiogram.event - INFO - Update id=311269029 is handled. Duration 204 ms by bot id=7041366449
2025-04-10 23:39:13,676 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:39:13,677 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:39:13,677 - sqlalchemy.engine.Engine - INFO - [generated in 0.00079s] ()
2025-04-10 23:39:13,682 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:39:13,789 - aiogram.event - INFO - Update id=311269030 is handled. Duration 195 ms by bot id=7041366449
2025-04-10 23:39:15,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:39:15,963 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:39:15,964 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('Автотовары',)
2025-04-10 23:39:15,968 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:39:16,073 - aiogram.event - INFO - Update id=311269031 is handled. Duration 212 ms by bot id=7041366449
2025-04-10 23:39:18,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:39:18,356 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 23:39:18,357 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (58,)
2025-04-10 23:39:18,358 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:39:18,358 - root - ERROR - Ошибка при получении поставщиков для подкатегории 58: 'InlineKeyboardMarkup' object has no attribute 'keyboard'
2025-04-10 23:39:18,463 - aiogram.event - INFO - Update id=311269032 is handled. Duration 108 ms by bot id=7041366449
2025-04-10 23:43:55,223 - __main__ - INFO - Stopping application...
2025-04-10 23:43:55,955 - __main__ - INFO - Application stopped
2025-04-10 23:43:58,705 - app - INFO - Starting application...
2025-04-10 23:43:58,706 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:43:58,706 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:43:58,706 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:43:59,094 - __main__ - INFO - Application started successfully
2025-04-10 23:43:59,095 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:44:02,549 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:44:02,549 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:44:02,551 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:44:02,551 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:44:02,551 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:44:02,551 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:44:02,552 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:02,552 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:44:02,552 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-04-10 23:44:02,553 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:02,681 - aiogram.event - INFO - Update id=311269033 is handled. Duration 364 ms by bot id=7041366449
2025-04-10 23:44:05,588 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:05,589 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:44:05,589 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('Автотовары',)
2025-04-10 23:44:05,594 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:05,757 - aiogram.event - INFO - Update id=311269034 is handled. Duration 264 ms by bot id=7041366449
2025-04-10 23:44:08,234 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,234 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 23:44:08,234 - sqlalchemy.engine.Engine - INFO - [generated in 0.00094s] (58,)
2025-04-10 23:44:08,239 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,723 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,724 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,724 - sqlalchemy.engine.Engine - INFO - [generated in 0.00120s] (9,)
2025-04-10 23:44:08,730 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,733 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,733 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,734 - sqlalchemy.engine.Engine - INFO - [generated in 0.00128s] (9,)
2025-04-10 23:44:08,735 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,736 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,736 - sqlalchemy.engine.Engine - INFO - [cached since 0.01312s ago] (8,)
2025-04-10 23:44:08,737 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,738 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,738 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,738 - sqlalchemy.engine.Engine - INFO - [cached since 0.005474s ago] (8,)
2025-04-10 23:44:08,739 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,740 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,740 - sqlalchemy.engine.Engine - INFO - [cached since 0.01722s ago] (7,)
2025-04-10 23:44:08,741 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,742 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,742 - sqlalchemy.engine.Engine - INFO - [cached since 0.009739s ago] (7,)
2025-04-10 23:44:08,743 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,744 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,744 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,744 - sqlalchemy.engine.Engine - INFO - [cached since 0.02115s ago] (6,)
2025-04-10 23:44:08,745 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,745 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,746 - sqlalchemy.engine.Engine - INFO - [cached since 0.01315s ago] (6,)
2025-04-10 23:44:08,746 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,747 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,747 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,747 - sqlalchemy.engine.Engine - INFO - [cached since 0.024s ago] (5,)
2025-04-10 23:44:08,748 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,750 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,750 - sqlalchemy.engine.Engine - INFO - [cached since 0.01737s ago] (5,)
2025-04-10 23:44:08,751 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,752 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,752 - sqlalchemy.engine.Engine - INFO - [cached since 0.02922s ago] (4,)
2025-04-10 23:44:08,755 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,756 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,756 - sqlalchemy.engine.Engine - INFO - [cached since 0.02389s ago] (4,)
2025-04-10 23:44:08,758 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,759 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,760 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,760 - sqlalchemy.engine.Engine - INFO - [cached since 0.037s ago] (3,)
2025-04-10 23:44:08,761 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,763 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,763 - sqlalchemy.engine.Engine - INFO - [cached since 0.03048s ago] (3,)
2025-04-10 23:44:08,764 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,765 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:44:08,765 - sqlalchemy.engine.Engine - INFO - [cached since 0.04253s ago] (2,)
2025-04-10 23:44:08,766 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,767 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:44:08,767 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:44:08,767 - sqlalchemy.engine.Engine - INFO - [cached since 0.03457s ago] (2,)
2025-04-10 23:44:08,768 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:44:08,768 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-10 23:44:09,249 - aiogram.event - INFO - Update id=311269035 is handled. Duration 1022 ms by bot id=7041366449
2025-04-10 23:44:14,265 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 23:44:14,585 - aiogram.event - INFO - Update id=311269036 is handled. Duration 494 ms by bot id=7041366449
2025-04-10 23:58:37,721 - __main__ - INFO - Stopping application...
2025-04-10 23:58:38,441 - __main__ - INFO - Application stopped
2025-04-10 23:58:42,022 - app - INFO - Starting application...
2025-04-10 23:58:42,023 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-10 23:58:42,023 - __main__ - INFO - Action config initialized successfully
2025-04-10 23:58:42,023 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-10 23:58:42,429 - __main__ - INFO - Application started successfully
2025-04-10 23:58:42,430 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-10 23:59:10,999 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-10 23:59:10,999 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:59:11,001 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-10 23:59:11,001 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:59:11,001 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-10 23:59:11,001 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-10 23:59:11,002 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:11,002 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-10 23:59:11,003 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-10 23:59:11,003 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:11,682 - aiogram.event - INFO - Update id=311269037 is handled. Duration 750 ms by bot id=7041366449
2025-04-10 23:59:15,731 - aiogram.event - INFO - Update id=311269038 is handled. Duration 192 ms by bot id=7041366449
2025-04-10 23:59:16,750 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:16,752 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-10 23:59:16,752 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] ()
2025-04-10 23:59:16,757 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:16,859 - aiogram.event - INFO - Update id=311269039 is handled. Duration 194 ms by bot id=7041366449
2025-04-10 23:59:19,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:19,639 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-10 23:59:19,639 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('Автотовары',)
2025-04-10 23:59:19,645 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:19,756 - aiogram.event - INFO - Update id=311269040 is handled. Duration 229 ms by bot id=7041366449
2025-04-10 23:59:21,245 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,245 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-10 23:59:21,245 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (58,)
2025-04-10 23:59:21,246 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,384 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,385 - sqlalchemy.engine.Engine - INFO - [generated in 0.00129s] (9,)
2025-04-10 23:59:21,391 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,394 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,395 - sqlalchemy.engine.Engine - INFO - [generated in 0.00127s] (9,)
2025-04-10 23:59:21,399 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,402 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,402 - sqlalchemy.engine.Engine - INFO - [cached since 0.01887s ago] (8,)
2025-04-10 23:59:21,406 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,409 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,410 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,410 - sqlalchemy.engine.Engine - INFO - [cached since 0.01682s ago] (8,)
2025-04-10 23:59:21,413 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,416 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,416 - sqlalchemy.engine.Engine - INFO - [cached since 0.03302s ago] (7,)
2025-04-10 23:59:21,420 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,424 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,424 - sqlalchemy.engine.Engine - INFO - [cached since 0.03087s ago] (7,)
2025-04-10 23:59:21,426 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,429 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,429 - sqlalchemy.engine.Engine - INFO - [cached since 0.04588s ago] (6,)
2025-04-10 23:59:21,431 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,434 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,435 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,435 - sqlalchemy.engine.Engine - INFO - [cached since 0.04195s ago] (6,)
2025-04-10 23:59:21,437 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,438 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,439 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,439 - sqlalchemy.engine.Engine - INFO - [cached since 0.0557s ago] (5,)
2025-04-10 23:59:21,441 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,442 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,443 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,443 - sqlalchemy.engine.Engine - INFO - [cached since 0.04948s ago] (5,)
2025-04-10 23:59:21,444 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,444 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,444 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,445 - sqlalchemy.engine.Engine - INFO - [cached since 0.06125s ago] (4,)
2025-04-10 23:59:21,446 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,447 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,447 - sqlalchemy.engine.Engine - INFO - [cached since 0.05364s ago] (4,)
2025-04-10 23:59:21,448 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,450 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,450 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,450 - sqlalchemy.engine.Engine - INFO - [cached since 0.06686s ago] (3,)
2025-04-10 23:59:21,453 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,454 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,454 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,454 - sqlalchemy.engine.Engine - INFO - [cached since 0.06068s ago] (3,)
2025-04-10 23:59:21,455 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,456 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,456 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-10 23:59:21,456 - sqlalchemy.engine.Engine - INFO - [cached since 0.07301s ago] (2,)
2025-04-10 23:59:21,457 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-10 23:59:21,458 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-10 23:59:21,458 - sqlalchemy.engine.Engine - INFO - [cached since 0.06487s ago] (2,)
2025-04-10 23:59:21,459 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-10 23:59:21,459 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-10 23:59:22,004 - aiogram.event - INFO - Update id=311269041 is handled. Duration 764 ms by bot id=7041366449
2025-04-10 23:59:27,727 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-10 23:59:28,035 - aiogram.event - INFO - Update id=311269042 is handled. Duration 465 ms by bot id=7041366449
2025-04-10 23:59:38,664 - root - INFO - Фотографии поставщика: [{'id': 22, 'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 23, 'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 24, 'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}]
2025-04-10 23:59:39,136 - aiogram.event - INFO - Update id=311269043 is handled. Duration 759 ms by bot id=7041366449
2025-04-10 23:59:48,969 - root - INFO - Фотографии поставщика: [{'id': 19, 'type': 'photo', 'file_path': '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 20, 'type': 'photo', 'file_path': '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 21, 'type': 'photo', 'file_path': '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}]
2025-04-10 23:59:49,573 - aiogram.event - INFO - Update id=311269044 is handled. Duration 751 ms by bot id=7041366449
2025-04-11 00:00:02,023 - root - INFO - Фотографии поставщика: [{'id': 16, 'type': 'photo', 'file_path': '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 17, 'type': 'photo', 'file_path': '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 18, 'type': 'photo', 'file_path': '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}]
2025-04-11 00:00:02,643 - aiogram.event - INFO - Update id=311269045 is handled. Duration 816 ms by bot id=7041366449
2025-04-11 00:03:27,543 - __main__ - INFO - Stopping application...
2025-04-11 00:03:28,014 - __main__ - INFO - Application stopped
2025-04-11 00:03:31,424 - app - INFO - Starting application...
2025-04-11 00:03:31,425 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:03:31,425 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:03:31,425 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:03:31,790 - __main__ - INFO - Application started successfully
2025-04-11 00:03:31,791 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:03:35,174 - aiogram.event - INFO - Update id=311269046 is handled. Duration 282 ms by bot id=7041366449
2025-04-11 00:03:37,396 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:03:37,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:03:37,397 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:03:37,397 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:03:37,398 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:03:37,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:03:37,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:37,400 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-11 00:03:37,400 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1043270764,)
2025-04-11 00:03:37,401 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:37,849 - aiogram.event - INFO - Update id=311269047 is handled. Duration 488 ms by bot id=7041366449
2025-04-11 00:03:39,587 - aiogram.event - INFO - Update id=311269048 is handled. Duration 259 ms by bot id=7041366449
2025-04-11 00:03:40,754 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:40,755 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:03:40,755 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-11 00:03:40,759 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:40,894 - aiogram.event - INFO - Update id=311269049 is handled. Duration 240 ms by bot id=7041366449
2025-04-11 00:03:44,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:44,189 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:03:44,189 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('Автотовары',)
2025-04-11 00:03:44,194 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:44,345 - aiogram.event - INFO - Update id=311269050 is handled. Duration 354 ms by bot id=7041366449
2025-04-11 00:03:46,151 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,152 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'pending'
            ORDER BY created_at DESC
        
2025-04-11 00:03:46,152 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] (58,)
2025-04-11 00:03:46,156 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,390 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,391 - sqlalchemy.engine.Engine - INFO - [generated in 0.00138s] (9,)
2025-04-11 00:03:46,394 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,394 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,394 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (9,)
2025-04-11 00:03:46,395 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,396 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,396 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,396 - sqlalchemy.engine.Engine - INFO - [cached since 0.006509s ago] (8,)
2025-04-11 00:03:46,397 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,398 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,398 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,398 - sqlalchemy.engine.Engine - INFO - [cached since 0.003783s ago] (8,)
2025-04-11 00:03:46,399 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,400 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,400 - sqlalchemy.engine.Engine - INFO - [cached since 0.01021s ago] (7,)
2025-04-11 00:03:46,401 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,402 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,402 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,402 - sqlalchemy.engine.Engine - INFO - [cached since 0.007786s ago] (7,)
2025-04-11 00:03:46,403 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,404 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,404 - sqlalchemy.engine.Engine - INFO - [cached since 0.01417s ago] (6,)
2025-04-11 00:03:46,404 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,405 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,405 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,405 - sqlalchemy.engine.Engine - INFO - [cached since 0.011s ago] (6,)
2025-04-11 00:03:46,406 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,406 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,406 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,406 - sqlalchemy.engine.Engine - INFO - [cached since 0.0167s ago] (5,)
2025-04-11 00:03:46,407 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,407 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,407 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,408 - sqlalchemy.engine.Engine - INFO - [cached since 0.01342s ago] (5,)
2025-04-11 00:03:46,408 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,409 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,409 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,410 - sqlalchemy.engine.Engine - INFO - [cached since 0.02002s ago] (4,)
2025-04-11 00:03:46,411 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,411 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,412 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,412 - sqlalchemy.engine.Engine - INFO - [cached since 0.0177s ago] (4,)
2025-04-11 00:03:46,413 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,413 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,414 - sqlalchemy.engine.Engine - INFO - [cached since 0.02401s ago] (3,)
2025-04-11 00:03:46,414 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,415 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,415 - sqlalchemy.engine.Engine - INFO - [cached since 0.02106s ago] (3,)
2025-04-11 00:03:46,416 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,418 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:03:46,418 - sqlalchemy.engine.Engine - INFO - [cached since 0.02846s ago] (2,)
2025-04-11 00:03:46,419 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,420 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:03:46,420 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:03:46,420 - sqlalchemy.engine.Engine - INFO - [cached since 0.02638s ago] (2,)
2025-04-11 00:03:46,421 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:03:46,422 - root - INFO - Фотографии поставщика: [{'id': 26, 'type': 'photo', 'file_path': '2025/04/10/a48697eb243d4d748527bb8e3c059021.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}, {'id': 27, 'type': 'photo', 'file_path': '2025/04/10/2ee3f79e6f7f450cbe377a4ef5561f1b.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 19, 22, 51, 387878)}]
2025-04-11 00:03:47,414 - aiogram.event - INFO - Update id=311269051 is handled. Duration 1269 ms by bot id=7041366449
2025-04-11 00:03:49,444 - root - INFO - Фотографии поставщика: [{'id': 25, 'type': 'photo', 'file_path': '2025/04/10/ed519d8c8bdc46019bd8d36f07555029.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 35, 57, 57643)}]
2025-04-11 00:03:49,749 - aiogram.event - INFO - Update id=311269052 is handled. Duration 611 ms by bot id=7041366449
2025-04-11 00:03:56,047 - root - ERROR - Ошибка при удалении медиа-сообщения 105118: Telegram server says - Bad Request: message to delete not found
2025-04-11 00:03:56,048 - root - INFO - Фотографии поставщика: [{'id': 22, 'type': 'photo', 'file_path': '2025/04/10/d63780c8e919481f850e27e12aeb44fb.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 23, 'type': 'photo', 'file_path': '2025/04/10/15fcda0d24f7439babc5df465dbbff6e.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}, {'id': 24, 'type': 'photo', 'file_path': '2025/04/10/6f87b9dd881e4c16a9c912a53dd4d9ef.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 29, 25, 592547)}]
2025-04-11 00:03:57,039 - aiogram.event - INFO - Update id=311269053 is handled. Duration 1224 ms by bot id=7041366449
2025-04-11 00:04:02,041 - root - INFO - Фотографии поставщика: [{'id': 19, 'type': 'photo', 'file_path': '2025/04/10/e2b8950493d64b68b6a73136fa39e3d1.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 20, 'type': 'photo', 'file_path': '2025/04/10/5f84fff844594189a45d1ab5bdc2e802.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}, {'id': 21, 'type': 'photo', 'file_path': '2025/04/10/2ecd3581ecc64aac9306a90a49ca0f23.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 20, 43, 713364)}]
2025-04-11 00:04:02,525 - aiogram.event - INFO - Update id=311269054 is handled. Duration 874 ms by bot id=7041366449
2025-04-11 00:04:08,792 - root - INFO - Фотографии поставщика: [{'id': 16, 'type': 'photo', 'file_path': '2025/04/10/f19d0c9a490249ff954d5f018c731e45.jpg', 'name': 'photo_1.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 17, 'type': 'photo', 'file_path': '2025/04/10/bd327776794e4f4caec34871a5a0758c.jpg', 'name': 'photo_2.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}, {'id': 18, 'type': 'photo', 'file_path': '2025/04/10/6ba7c443174f4943ac6d56aa95923fc5.jpg', 'name': 'photo_3.jpg', 'uploaded_at': datetime.datetime(2025, 4, 10, 2, 6, 59, 245325)}]
2025-04-11 00:04:09,341 - aiogram.event - INFO - Update id=311269055 is handled. Duration 931 ms by bot id=7041366449
2025-04-11 00:04:14,217 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:04:14,217 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:04:14,218 - sqlalchemy.engine.Engine - INFO - [cached since 30.03s ago] ('Автотовары',)
2025-04-11 00:04:14,220 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:04:14,304 - aiogram.event - INFO - Update id=311269056 is handled. Duration 163 ms by bot id=7041366449
2025-04-11 00:04:18,355 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:04:18,356 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:04:18,356 - sqlalchemy.engine.Engine - INFO - [cached since 37.6s ago] ()
2025-04-11 00:04:18,358 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:04:18,448 - aiogram.event - INFO - Update id=311269057 is handled. Duration 212 ms by bot id=7041366449
2025-04-11 00:04:19,738 - aiogram.event - INFO - Update id=311269058 is handled. Duration 169 ms by bot id=7041366449
2025-04-11 00:04:22,760 - aiogram.event - INFO - Update id=311269059 is handled. Duration 324 ms by bot id=7041366449
2025-04-11 00:04:28,238 - __main__ - INFO - Stopping application...
2025-04-11 00:04:28,561 - __main__ - INFO - Application stopped
2025-04-11 00:04:36,054 - app - INFO - Starting application...
2025-04-11 00:04:36,054 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:04:36,054 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:04:36,054 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:04:36,448 - __main__ - INFO - Application started successfully
2025-04-11 00:04:36,449 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:06:09,948 - aiogram.event - INFO - Update id=311269060 is handled. Duration 602 ms by bot id=7041366449
2025-04-11 00:06:11,119 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:06:11,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:06:11,120 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:06:11,120 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:06:11,120 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:06:11,120 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:06:11,121 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:06:11,121 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:06:11,122 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-11 00:06:11,123 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:06:11,261 - aiogram.event - INFO - Update id=311269061 is handled. Duration 280 ms by bot id=7041366449
2025-04-11 00:06:13,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:06:13,480 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:06:13,480 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ()
2025-04-11 00:06:13,484 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:06:13,617 - aiogram.event - INFO - Update id=311269062 is handled. Duration 252 ms by bot id=7041366449
2025-04-11 00:06:15,998 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:06:15,998 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:06:15,998 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('Автотовары',)
2025-04-11 00:06:16,000 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:06:16,096 - aiogram.event - INFO - Update id=311269063 is handled. Duration 198 ms by bot id=7041366449
2025-04-11 00:06:17,956 - aiogram.event - INFO - Update id=311269064 is handled. Duration 184 ms by bot id=7041366449
2025-04-11 00:06:20,303 - aiogram.event - INFO - Update id=311269065 is handled. Duration 207 ms by bot id=7041366449
2025-04-11 00:06:23,497 - aiogram.event - INFO - Update id=311269066 is handled. Duration 206 ms by bot id=7041366449
2025-04-11 00:06:24,734 - aiogram.event - INFO - Update id=311269067 is handled. Duration 169 ms by bot id=7041366449
2025-04-11 00:06:26,310 - aiogram.event - INFO - Update id=311269068 is handled. Duration 171 ms by bot id=7041366449
2025-04-11 00:06:28,187 - aiogram.event - INFO - Update id=311269069 is handled. Duration 410 ms by bot id=7041366449
2025-04-11 00:06:30,478 - aiogram.event - INFO - Update id=311269070 is handled. Duration 362 ms by bot id=7041366449
2025-04-11 00:06:31,757 - aiogram.event - INFO - Update id=311269071 is handled. Duration 164 ms by bot id=7041366449
2025-04-11 00:06:33,227 - aiogram.event - INFO - Update id=311269072 is handled. Duration 262 ms by bot id=7041366449
2025-04-11 00:06:35,217 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:06:35,217 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:06:35,217 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:06:35,218 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:06:35,218 - root - INFO - Данные: company_name=Jfndbf, product_name=Hdh, category_id=58
2025-04-11 00:06:35,218 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:06:35,219 - root - INFO - Видео: False
2025-04-11 00:06:35,220 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:06:35,221 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:06:35,221 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Jfndbf', 'Hdh', 58, 'Jdndbf djdjdjbdfj', None, None, None, None, '@egormeisters', None, None, 1043270764)
2025-04-11 00:06:35,227 - root - INFO - Поставщик создан с ID: 12
2025-04-11 00:06:35,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:06:35,228 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:06:35,228 - app - INFO - Поставщик успешно создан с ID: 12
2025-04-11 00:06:35,228 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 12 в чат -4610011073
2025-04-11 00:06:35,229 - app.services.admin_chat - ERROR - Ошибка при отправке карточки поставщика в чат администраторов: list index out of range
2025-04-11 00:06:35,229 - app - WARNING - Не удалось отправить уведомление в чат администраторов
2025-04-11 00:06:35,645 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:06:35,647 - aiogram.event - INFO - Update id=311269073 is handled. Duration 533 ms by bot id=7041366449
2025-04-11 00:10:33,668 - __main__ - INFO - Stopping application...
2025-04-11 00:10:34,127 - __main__ - INFO - Application stopped
2025-04-11 00:10:37,198 - app - INFO - Starting application...
2025-04-11 00:10:37,198 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:10:37,198 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:10:37,198 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:10:41,718 - __main__ - INFO - Application started successfully
2025-04-11 00:10:41,719 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:10:47,978 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:10:47,978 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:10:47,980 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:10:47,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:10:47,980 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:10:47,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:10:47,981 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:10:47,982 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:10:47,982 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-11 00:10:47,983 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:10:48,082 - aiogram.event - INFO - Update id=311269074 is handled. Duration 206 ms by bot id=7041366449
2025-04-11 00:11:37,808 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:11:37,809 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:11:37,809 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ()
2025-04-11 00:11:37,814 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:11:37,955 - aiogram.event - INFO - Update id=311269075 is handled. Duration 616 ms by bot id=7041366449
2025-04-11 00:11:39,267 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:11:39,268 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:11:39,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Автотовары',)
2025-04-11 00:11:39,274 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:11:39,361 - aiogram.event - INFO - Update id=311269076 is handled. Duration 183 ms by bot id=7041366449
2025-04-11 00:11:39,900 - aiogram.event - INFO - Update id=311269077 is handled. Duration 181 ms by bot id=7041366449
2025-04-11 00:11:42,170 - aiogram.event - INFO - Update id=311269078 is handled. Duration 224 ms by bot id=7041366449
2025-04-11 00:11:43,967 - aiogram.event - INFO - Update id=311269079 is handled. Duration 177 ms by bot id=7041366449
2025-04-11 00:11:47,203 - aiogram.event - INFO - Update id=311269080 is handled. Duration 157 ms by bot id=7041366449
2025-04-11 00:11:48,965 - aiogram.event - INFO - Update id=311269081 is handled. Duration 158 ms by bot id=7041366449
2025-04-11 00:11:50,179 - aiogram.event - INFO - Update id=311269082 is handled. Duration 146 ms by bot id=7041366449
2025-04-11 00:11:51,750 - aiogram.event - INFO - Update id=311269083 is handled. Duration 179 ms by bot id=7041366449
2025-04-11 00:11:53,158 - aiogram.event - INFO - Update id=311269084 is handled. Duration 153 ms by bot id=7041366449
2025-04-11 00:11:54,490 - aiogram.event - INFO - Update id=311269085 is handled. Duration 258 ms by bot id=7041366449
2025-04-11 00:11:56,028 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:11:56,028 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:11:56,028 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:11:56,029 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:11:56,029 - root - INFO - Данные: company_name=xdfghgh, product_name=sxdfgkl,hnb, category_id=58
2025-04-11 00:11:56,030 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:11:56,030 - root - INFO - Видео: False
2025-04-11 00:11:56,031 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:11:56,032 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:11:56,033 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('xdfghgh', 'sxdfgkl,hnb', 58, 'leksadjrfghneiklors;fghndfilors;gn', None, None, None, None, None, None, None, 1043270764)
2025-04-11 00:11:56,038 - root - INFO - Поставщик создан с ID: 13
2025-04-11 00:11:56,039 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:11:56,041 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:11:56,042 - app - INFO - Поставщик успешно создан с ID: 13
2025-04-11 00:11:56,043 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 13 в чат -4610011073
2025-04-11 00:11:56,131 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 13 в чат администраторов
2025-04-11 00:11:56,131 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-11 00:11:56,390 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:11:56,391 - aiogram.event - INFO - Update id=311269086 is handled. Duration 440 ms by bot id=7041366449
2025-04-11 00:12:03,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:12:03,329 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:12:03,367 - sqlalchemy.engine.Engine - INFO - [generated in 0.03819s] (13,)
2025-04-11 00:12:03,372 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:12:03,374 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:12:03,374 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:12:03,374 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (13,)
2025-04-11 00:12:03,378 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:12:03,379 - app.handlers.admin - ERROR - Ошибка при назначении поставщика 13 администратору 1043270764: unsupported operand type(s) for +: 'NoneType' and 'str'
2025-04-11 00:12:03,498 - aiogram.event - INFO - Update id=311269087 is handled. Duration 252 ms by bot id=7041366449
2025-04-11 00:13:46,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:13:46,478 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:13:46,479 - sqlalchemy.engine.Engine - INFO - [cached since 178.5s ago] (1043270764,)
2025-04-11 00:13:46,482 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:13:46,567 - aiogram.event - INFO - Update id=311269088 is handled. Duration 303 ms by bot id=7041366449
2025-04-11 00:13:49,560 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:13:49,560 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:13:49,560 - sqlalchemy.engine.Engine - INFO - [cached since 131.8s ago] ()
2025-04-11 00:13:49,561 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:13:49,671 - aiogram.event - INFO - Update id=311269089 is handled. Duration 236 ms by bot id=7041366449
2025-04-11 00:13:50,566 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:13:50,566 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:13:50,566 - sqlalchemy.engine.Engine - INFO - [cached since 132.8s ago] ()
2025-04-11 00:13:50,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:13:50,733 - aiogram.event - INFO - Update id=311269090 is handled. Duration 170 ms by bot id=7041366449
2025-04-11 00:13:51,911 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:13:51,911 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:13:51,911 - sqlalchemy.engine.Engine - INFO - [cached since 132.6s ago] ('Автотовары',)
2025-04-11 00:13:51,912 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:13:52,043 - aiogram.event - INFO - Update id=311269091 is handled. Duration 252 ms by bot id=7041366449
2025-04-11 00:13:52,695 - aiogram.event - INFO - Update id=311269092 is handled. Duration 289 ms by bot id=7041366449
2025-04-11 00:13:56,274 - aiogram.event - INFO - Update id=311269093 is handled. Duration 182 ms by bot id=7041366449
2025-04-11 00:13:58,347 - aiogram.event - INFO - Update id=311269094 is handled. Duration 309 ms by bot id=7041366449
2025-04-11 00:14:01,589 - aiogram.event - INFO - Update id=311269095 is handled. Duration 278 ms by bot id=7041366449
2025-04-11 00:14:03,100 - aiogram.event - INFO - Update id=311269096 is handled. Duration 246 ms by bot id=7041366449
2025-04-11 00:14:04,743 - aiogram.event - INFO - Update id=311269097 is handled. Duration 357 ms by bot id=7041366449
2025-04-11 00:14:07,301 - aiogram.event - INFO - Update id=311269098 is handled. Duration 170 ms by bot id=7041366449
2025-04-11 00:14:08,944 - aiogram.event - INFO - Update id=311269099 is handled. Duration 155 ms by bot id=7041366449
2025-04-11 00:14:10,379 - aiogram.event - INFO - Update id=311269100 is handled. Duration 255 ms by bot id=7041366449
2025-04-11 00:14:11,761 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:14:11,762 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:14:11,762 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:14:11,762 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:14:11,763 - root - INFO - Данные: company_name=dzfcvb, product_name=dsfgbh, category_id=58
2025-04-11 00:14:11,763 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:14:11,763 - root - INFO - Видео: False
2025-04-11 00:14:11,764 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:11,765 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:14:11,765 - sqlalchemy.engine.Engine - INFO - [cached since 135.7s ago] ('dzfcvb', 'dsfgbh', 58, ';dkxfjlgndjkls sdlrfkg', None, None, None, None, None, None, None, 1043270764)
2025-04-11 00:14:11,767 - root - INFO - Поставщик создан с ID: 14
2025-04-11 00:14:11,768 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:14:11,769 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:14:11,769 - app - INFO - Поставщик успешно создан с ID: 14
2025-04-11 00:14:11,770 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 14 в чат -4610011073
2025-04-11 00:14:11,851 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 14 в чат администраторов
2025-04-11 00:14:11,852 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-11 00:14:12,109 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:14:12,110 - aiogram.event - INFO - Update id=311269101 is handled. Duration 450 ms by bot id=7041366449
2025-04-11 00:14:16,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:16,415 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:14:16,415 - sqlalchemy.engine.Engine - INFO - [cached since 133.1s ago] (14,)
2025-04-11 00:14:16,416 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:14:16,417 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:16,417 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:14:16,417 - sqlalchemy.engine.Engine - INFO - [cached since 133s ago] (14,)
2025-04-11 00:14:16,418 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:14:16,418 - app.handlers.admin - ERROR - Ошибка при назначении поставщика 14 администратору 1043270764: unsupported operand type(s) for +: 'NoneType' and 'str'
2025-04-11 00:14:16,511 - aiogram.event - INFO - Update id=311269102 is handled. Duration 179 ms by bot id=7041366449
2025-04-11 00:14:42,370 - __main__ - INFO - Stopping application...
2025-04-11 00:14:43,072 - __main__ - INFO - Application stopped
2025-04-11 00:14:47,301 - app - INFO - Starting application...
2025-04-11 00:14:47,301 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:14:47,301 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:14:47,301 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:14:47,687 - __main__ - INFO - Application started successfully
2025-04-11 00:14:47,687 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:14:48,848 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:14:48,848 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:14:48,849 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:14:48,849 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:14:48,850 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:14:48,850 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:14:48,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:48,851 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:14:48,851 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-11 00:14:48,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:14:48,991 - aiogram.event - INFO - Update id=311269103 is handled. Duration 344 ms by bot id=7041366449
2025-04-11 00:14:50,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:50,540 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:14:50,540 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] ()
2025-04-11 00:14:50,545 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:14:50,744 - aiogram.event - INFO - Update id=311269104 is handled. Duration 379 ms by bot id=7041366449
2025-04-11 00:14:51,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:14:51,524 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:14:51,524 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('Автотовары',)
2025-04-11 00:14:51,527 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:14:51,663 - aiogram.event - INFO - Update id=311269105 is handled. Duration 273 ms by bot id=7041366449
2025-04-11 00:14:52,329 - aiogram.event - INFO - Update id=311269106 is handled. Duration 219 ms by bot id=7041366449
2025-04-11 00:14:54,549 - aiogram.event - INFO - Update id=311269107 is handled. Duration 184 ms by bot id=7041366449
2025-04-11 00:14:56,805 - aiogram.event - INFO - Update id=311269108 is handled. Duration 190 ms by bot id=7041366449
2025-04-11 00:14:58,526 - aiogram.event - INFO - Update id=311269109 is handled. Duration 171 ms by bot id=7041366449
2025-04-11 00:15:00,117 - aiogram.event - INFO - Update id=311269110 is handled. Duration 165 ms by bot id=7041366449
2025-04-11 00:15:01,278 - aiogram.event - INFO - Update id=311269111 is handled. Duration 161 ms by bot id=7041366449
2025-04-11 00:15:02,992 - aiogram.event - INFO - Update id=311269112 is handled. Duration 159 ms by bot id=7041366449
2025-04-11 00:15:04,285 - aiogram.event - INFO - Update id=311269113 is handled. Duration 309 ms by bot id=7041366449
2025-04-11 00:15:08,158 - aiogram.event - INFO - Update id=311269114 is handled. Duration 317 ms by bot id=7041366449
2025-04-11 00:15:09,699 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:15:09,699 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:15:09,699 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:15:09,700 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:15:09,701 - root - INFO - Данные: company_name=edrth, product_name=sdfh, category_id=58
2025-04-11 00:15:09,701 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:15:09,702 - root - INFO - Видео: False
2025-04-11 00:15:09,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:15:09,705 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:15:09,706 - sqlalchemy.engine.Engine - INFO - [generated in 0.00130s] ('edrth', 'sdfh', 58, 'seifu l esdirjgh oeisrgh', None, None, None, None, None, None, None, 1043270764)
2025-04-11 00:15:09,712 - root - INFO - Поставщик создан с ID: 15
2025-04-11 00:15:09,713 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:15:09,714 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:15:09,715 - app - INFO - Поставщик успешно создан с ID: 15
2025-04-11 00:15:09,715 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 15 в чат -4610011073
2025-04-11 00:15:09,800 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 15 в чат администраторов
2025-04-11 00:15:09,801 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-11 00:15:10,082 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:15:10,083 - aiogram.event - INFO - Update id=311269115 is handled. Duration 467 ms by bot id=7041366449
2025-04-11 00:15:12,971 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:15:12,971 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:15:12,972 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (15,)
2025-04-11 00:15:12,974 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:15:12,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:15:12,976 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:15:12,976 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (15,)
2025-04-11 00:15:12,978 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:15:13,047 - app.handlers.admin - ERROR - Ошибка при назначении поставщика 15 администратору 1043270764: Telegram server says - Bad Request: there is no caption in the message to edit
2025-04-11 00:15:13,131 - aiogram.event - INFO - Update id=311269116 is handled. Duration 239 ms by bot id=7041366449
2025-04-11 00:16:29,938 - __main__ - INFO - Stopping application...
2025-04-11 00:16:30,645 - __main__ - INFO - Application stopped
2025-04-11 00:16:35,264 - app - INFO - Starting application...
2025-04-11 00:16:35,264 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:16:35,264 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:16:35,265 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:16:35,599 - __main__ - INFO - Application started successfully
2025-04-11 00:16:35,600 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:16:38,070 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:16:38,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:16:38,071 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:16:38,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:16:38,072 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:16:38,072 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:16:38,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:38,073 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:16:38,073 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-11 00:16:38,074 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:16:38,239 - aiogram.event - INFO - Update id=311269117 is handled. Duration 349 ms by bot id=7041366449
2025-04-11 00:16:39,503 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:39,504 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:16:39,504 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ()
2025-04-11 00:16:39,508 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:16:39,704 - aiogram.event - INFO - Update id=311269118 is handled. Duration 280 ms by bot id=7041366449
2025-04-11 00:16:40,459 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:40,460 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:16:40,470 - sqlalchemy.engine.Engine - INFO - [generated in 0.00997s] ('Автотовары',)
2025-04-11 00:16:40,477 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:16:40,578 - aiogram.event - INFO - Update id=311269119 is handled. Duration 232 ms by bot id=7041366449
2025-04-11 00:16:41,118 - aiogram.event - INFO - Update id=311269120 is handled. Duration 181 ms by bot id=7041366449
2025-04-11 00:16:42,821 - aiogram.event - INFO - Update id=311269121 is handled. Duration 232 ms by bot id=7041366449
2025-04-11 00:16:44,769 - aiogram.event - INFO - Update id=311269122 is handled. Duration 329 ms by bot id=7041366449
2025-04-11 00:16:46,740 - aiogram.event - INFO - Update id=311269123 is handled. Duration 251 ms by bot id=7041366449
2025-04-11 00:16:48,407 - aiogram.event - INFO - Update id=311269124 is handled. Duration 275 ms by bot id=7041366449
2025-04-11 00:16:49,663 - aiogram.event - INFO - Update id=311269125 is handled. Duration 409 ms by bot id=7041366449
2025-04-11 00:16:51,640 - aiogram.event - INFO - Update id=311269126 is handled. Duration 197 ms by bot id=7041366449
2025-04-11 00:16:53,093 - aiogram.event - INFO - Update id=311269127 is handled. Duration 154 ms by bot id=7041366449
2025-04-11 00:16:54,322 - aiogram.event - INFO - Update id=311269128 is handled. Duration 227 ms by bot id=7041366449
2025-04-11 00:16:55,807 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:16:55,808 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:16:55,808 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:16:55,808 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:16:55,808 - root - INFO - Данные: company_name=sewrfth, product_name=xdfglkb, category_id=58
2025-04-11 00:16:55,809 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:16:55,809 - root - INFO - Видео: False
2025-04-11 00:16:55,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:55,811 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:16:55,811 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('sewrfth', 'xdfglkb', 58, 'sldkfjhg  sldifuhg', None, None, None, None, None, None, None, 1043270764)
2025-04-11 00:16:55,815 - root - INFO - Поставщик создан с ID: 16
2025-04-11 00:16:55,816 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:16:55,817 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:16:55,817 - app - INFO - Поставщик успешно создан с ID: 16
2025-04-11 00:16:55,817 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 16 в чат -4610011073
2025-04-11 00:16:55,902 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 16 в чат администраторов
2025-04-11 00:16:55,902 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-11 00:16:56,144 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:16:56,145 - aiogram.event - INFO - Update id=311269129 is handled. Duration 422 ms by bot id=7041366449
2025-04-11 00:16:59,958 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:59,958 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:16:59,958 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (16,)
2025-04-11 00:16:59,960 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:16:59,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:16:59,963 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:16:59,963 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (16,)
2025-04-11 00:16:59,964 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:17:00,441 - root - INFO - Фотографии поставщика: []
2025-04-11 00:17:00,616 - app.handlers.admin - INFO - Карточка поставщика 16 отправлена администратору 1043270764
2025-04-11 00:17:00,617 - aiogram.event - INFO - Update id=311269130 is handled. Duration 730 ms by bot id=7041366449
2025-04-11 00:17:16,714 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:17:16,715 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:17:16,715 - sqlalchemy.engine.Engine - INFO - [cached since 16.76s ago] (16,)
2025-04-11 00:17:16,719 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:17:16,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:17:16,721 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:17:16,721 - sqlalchemy.engine.Engine - INFO - [cached since 16.76s ago] (16,)
2025-04-11 00:17:16,724 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:17:16,730 - app.handlers.admin - INFO - Поставщик 16 одобрен администратором 1043270764
2025-04-11 00:17:16,998 - aiogram.event - INFO - Update id=311269131 is handled. Duration 1115 ms by bot id=7041366449
2025-04-11 00:19:21,713 - __main__ - INFO - Stopping application...
2025-04-11 00:19:22,181 - __main__ - INFO - Application stopped
2025-04-11 00:19:25,057 - app - INFO - Starting application...
2025-04-11 00:19:25,057 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-11 00:19:25,057 - __main__ - INFO - Action config initialized successfully
2025-04-11 00:19:25,057 - __main__ - INFO - Setting webhook at: https://52f2-46-8-230-15.ngrok-free.app/webhook
2025-04-11 00:19:25,463 - __main__ - INFO - Application started successfully
2025-04-11 00:19:25,464 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-11 00:19:34,596 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-11 00:19:34,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:19:34,597 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-11 00:19:34,597 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:19:34,598 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-11 00:19:34,598 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-11 00:19:34,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:19:34,599 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-11 00:19:34,599 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1043270764,)
2025-04-11 00:19:34,600 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:19:35,140 - aiogram.event - INFO - Update id=311269132 is handled. Duration 605 ms by bot id=7041366449
2025-04-11 00:19:36,634 - aiogram.event - INFO - Update id=311269133 is handled. Duration 195 ms by bot id=7041366449
2025-04-11 00:19:38,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:19:38,514 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-11 00:19:38,514 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] (1043270764,)
2025-04-11 00:19:38,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:19:38,625 - aiogram.event - INFO - Update id=311269134 is handled. Duration 202 ms by bot id=7041366449
2025-04-11 00:19:42,789 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:19:42,791 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-11 00:19:42,791 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ()
2025-04-11 00:19:42,796 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:19:42,892 - aiogram.event - INFO - Update id=311269135 is handled. Duration 190 ms by bot id=7041366449
2025-04-11 00:19:44,559 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:19:44,560 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-11 00:19:44,561 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ('Автотовары',)
2025-04-11 00:19:44,565 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:19:44,659 - aiogram.event - INFO - Update id=311269136 is handled. Duration 195 ms by bot id=7041366449
2025-04-11 00:19:45,247 - aiogram.event - INFO - Update id=311269137 is handled. Duration 169 ms by bot id=7041366449
2025-04-11 00:19:47,107 - aiogram.event - INFO - Update id=311269138 is handled. Duration 188 ms by bot id=7041366449
2025-04-11 00:19:49,182 - aiogram.event - INFO - Update id=311269139 is handled. Duration 213 ms by bot id=7041366449
2025-04-11 00:19:50,833 - aiogram.event - INFO - Update id=311269140 is handled. Duration 224 ms by bot id=7041366449
2025-04-11 00:19:52,707 - aiogram.event - INFO - Update id=311269141 is handled. Duration 178 ms by bot id=7041366449
2025-04-11 00:19:54,059 - aiogram.event - INFO - Update id=311269142 is handled. Duration 246 ms by bot id=7041366449
2025-04-11 00:20:48,087 - aiogram.event - INFO - Update id=311269143 is handled. Duration 542 ms by bot id=7041366449
2025-04-11 00:20:49,492 - aiogram.event - INFO - Update id=311269144 is handled. Duration 207 ms by bot id=7041366449
2025-04-11 00:20:51,172 - aiogram.event - INFO - Update id=311269145 is handled. Duration 250 ms by bot id=7041366449
2025-04-11 00:20:52,588 - app - INFO - === Подтверждение создания поставщика ===
2025-04-11 00:20:52,588 - app - INFO - ID пользователя: 1043270764
2025-04-11 00:20:52,588 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-11 00:20:52,589 - root - INFO - === Начало сохранения поставщика ===
2025-04-11 00:20:52,589 - root - INFO - Данные: company_name=шлвягаркп, product_name=джалчпьти, category_id=58
2025-04-11 00:20:52,589 - root - INFO - Фотографии: 0 шт.
2025-04-11 00:20:52,589 - root - INFO - Видео: False
2025-04-11 00:20:52,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:20:52,591 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-11 00:20:52,591 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('шлвягаркп', 'джалчпьти', 58, 'щлтгук ыфщулткс', None, None, None, None, None, None, None, 1043270764)
2025-04-11 00:20:52,595 - root - INFO - Поставщик создан с ID: 17
2025-04-11 00:20:52,596 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-11 00:20:52,597 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-11 00:20:52,597 - app - INFO - Поставщик успешно создан с ID: 17
2025-04-11 00:20:52,597 - app.services.admin_chat - INFO - Попытка отправки сообщения о поставщике 17 в чат -4610011073
2025-04-11 00:20:52,729 - app.services.admin_chat - INFO - Отправлено сообщение о новом поставщике 17 в чат администраторов
2025-04-11 00:20:52,729 - app - INFO - Уведомление о новом поставщике отправлено в чат администраторов
2025-04-11 00:20:53,010 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-11 00:20:53,010 - aiogram.event - INFO - Update id=311269146 is handled. Duration 550 ms by bot id=7041366449
2025-04-11 00:20:55,337 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:20:55,337 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:20:55,337 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (17,)
2025-04-11 00:20:55,339 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:20:55,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:20:55,340 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:20:55,340 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (17,)
2025-04-11 00:20:55,342 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:20:55,418 - root - INFO - Фотографии поставщика: []
2025-04-11 00:20:55,588 - app.handlers.admin - INFO - Карточка поставщика 17 отправлена администратору 1043270764
2025-04-11 00:20:55,589 - aiogram.event - INFO - Update id=311269147 is handled. Duration 325 ms by bot id=7041366449
2025-04-11 00:21:02,667 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:21:02,668 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-11 00:21:02,678 - sqlalchemy.engine.Engine - INFO - [cached since 7.341s ago] (17,)
2025-04-11 00:21:02,682 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:21:02,685 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:21:02,685 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-11 00:21:02,686 - sqlalchemy.engine.Engine - INFO - [cached since 7.346s ago] (17,)
2025-04-11 00:21:02,688 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:21:02,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-11 00:21:02,691 - sqlalchemy.engine.Engine - INFO - 
            UPDATE suppliers
            SET status = $1
            WHERE id = $2
        
2025-04-11 00:21:02,691 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('approved', 17)
2025-04-11 00:21:02,695 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-11 00:21:02,696 - app.services.database - ERROR - Error executing query: 
            UPDATE suppliers
            SET status = :status
            WHERE id = :supplier_id
 ...
2025-04-11 00:21:02,697 - app.services.database - ERROR - Error details: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.CheckViolationError'>: новая строка в отношении "suppliers" нарушает ограничение-проверку "suppliers_status_check"
DETAIL:  Ошибочная строка содержит (17, шлвягаркп, джалчпьти, 58, щлтгук ыфщулткс, null, null, null, null, null, null, null, 2025-04-11 00:20:52.592134, approved, 1043270764, null).
[SQL: 
            UPDATE suppliers
            SET status = $1
            WHERE id = $2
        ]
[parameters: ('approved', 17)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-04-11 00:21:02,697 - app.handlers.admin - ERROR - Ошибка при одобрении поставщика 17: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.CheckViolationError'>: новая строка в отношении "suppliers" нарушает ограничение-проверку "suppliers_status_check"
DETAIL:  Ошибочная строка содержит (17, шлвягаркп, джалчпьти, 58, щлтгук ыфщулткс, null, null, null, null, null, null, null, 2025-04-11 00:20:52.592134, approved, 1043270764, null).
[SQL: 
            UPDATE suppliers
            SET status = $1
            WHERE id = $2
        ]
[parameters: ('approved', 17)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-04-11 00:21:02,875 - aiogram.event - INFO - Update id=311269148 is handled. Duration 378 ms by bot id=7041366449
2025-04-11 00:21:53,696 - __main__ - INFO - Stopping application...
2025-04-11 00:21:54,157 - __main__ - INFO - Application stopped
