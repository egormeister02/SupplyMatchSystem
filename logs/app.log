2025-04-08 20:46:14,046 - app - INFO - Starting application...
2025-04-08 20:46:14,046 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:46:14,046 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:46:14,046 - __main__ - INFO - Setting webhook at: https://f925-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:46:14,683 - __main__ - INFO - Application started successfully
2025-04-08 20:46:14,683 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:46:17,317 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:46:17,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,330 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:46:17,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,332 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:46:17,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 20:46:17,333 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1043270764,)
2025-04-08 20:46:17,335 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:17,461 - aiogram.event - INFO - Update id=311268079 is handled. Duration 298 ms by bot id=7041366449
2025-04-08 20:46:20,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:20,709 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 20:46:20,710 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ()
2025-04-08 20:46:20,714 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:20,853 - aiogram.event - INFO - Update id=311268080 is handled. Duration 242 ms by bot id=7041366449
2025-04-08 20:46:23,228 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:46:23,229 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 20:46:23,229 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ('Дом и интерьер',)
2025-04-08 20:46:23,231 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:46:23,333 - aiogram.event - INFO - Update id=311268081 is handled. Duration 215 ms by bot id=7041366449
2025-04-08 20:46:24,819 - aiogram.event - INFO - Update id=311268082 is handled. Duration 199 ms by bot id=7041366449
2025-04-08 20:46:27,733 - aiogram.event - INFO - Update id=311268083 is handled. Duration 249 ms by bot id=7041366449
2025-04-08 20:46:31,306 - aiogram.event - INFO - Update id=311268084 is handled. Duration 300 ms by bot id=7041366449
2025-04-08 20:46:32,918 - aiogram.event - INFO - Update id=311268085 is handled. Duration 209 ms by bot id=7041366449
2025-04-08 20:46:37,549 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:46:37,549 - app - INFO - Является частью группы: True
2025-04-08 20:46:37,549 - app - INFO - Добавлено фото в группу 13953075179074098, всего фото в группе: 1
2025-04-08 20:46:37,906 - root - INFO - File saved: 2025/04/08/fbe29191496a4b8d95ee06d7fb7f8c0e.jpg
2025-04-08 20:46:37,906 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 20:46:38,407 - app - INFO - Ожидаем другие фото из группы 13953075179074098
2025-04-08 20:46:38,408 - aiogram.event - INFO - Update id=311268086 is handled. Duration 869 ms by bot id=7041366449
2025-04-08 20:46:38,666 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 20:46:38,666 - app - INFO - Является частью группы: True
2025-04-08 20:46:38,667 - app - INFO - Добавлено фото в группу 13953075179074098, всего фото в группе: 2
2025-04-08 20:46:39,042 - root - INFO - File saved: 2025/04/08/73e65ab3fb2c4635821d65a27568d4cc.jpg
2025-04-08 20:46:39,043 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 20:46:39,544 - app - INFO - Ожидаем другие фото из группы 13953075179074098
2025-04-08 20:46:39,545 - aiogram.event - INFO - Update id=311268087 is handled. Duration 889 ms by bot id=7041366449
2025-04-08 20:47:24,892 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:47:24,892 - app - INFO - Является частью группы: False
2025-04-08 20:47:25,394 - root - INFO - File saved: 2025/04/08/0307c70e1aaf4209b00820f54826a7f8.jpg
2025-04-08 20:47:25,394 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 20:47:25,529 - aiogram.event - INFO - Update id=311268088 is handled. Duration 639 ms by bot id=7041366449
2025-04-08 20:49:27,780 - __main__ - INFO - Stopping application...
2025-04-08 20:49:29,449 - __main__ - INFO - Application stopped
2025-04-08 20:50:26,144 - app - INFO - Starting application...
2025-04-08 20:50:26,144 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:50:26,144 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:50:26,144 - __main__ - INFO - Setting webhook at: https://f925-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:50:26,530 - __main__ - INFO - Application started successfully
2025-04-08 20:50:26,531 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:50:26,669 - aiogram.event - INFO - Update id=311268089 is not handled. Duration 3 ms by bot id=7041366449
2025-04-08 20:50:26,927 - aiogram.event - INFO - Update id=311268090 is not handled. Duration 9 ms by bot id=7041366449
2025-04-08 20:50:27,111 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 77 ms by bot id=7041366449
2025-04-08 20:50:27,111 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:27,188 - aiogram.event - INFO - Update id=311268091 is not handled. Duration 10 ms by bot id=7041366449
2025-04-08 20:50:27,441 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:50:27,441 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:27,447 - aiogram.event - INFO - Update id=311268093 is not handled. Duration 10 ms by bot id=7041366449
2025-04-08 20:50:27,695 - aiogram.event - INFO - Update id=311268094 is not handled. Duration 1 ms by bot id=7041366449
2025-04-08 20:50:27,967 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:50:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,968 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:50:27,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:50:27,970 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:50:27,970 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:50:27,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 20:50:27,971 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:50:28,154 - aiogram.event - INFO - Update id=311268095 is handled. Duration 213 ms by bot id=7041366449
2025-04-08 20:50:29,778 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 85 ms by bot id=7041366449
2025-04-08 20:50:29,778 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:34,366 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:50:34,367 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:42,870 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 91 ms by bot id=7041366449
2025-04-08 20:50:42,871 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:50:59,568 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 343 ms by bot id=7041366449
2025-04-08 20:50:59,568 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:11,145 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:51:11,147 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:51:11,147 - sqlalchemy.engine.Engine - INFO - [cached since 43.18s ago] (1043270764,)
2025-04-08 20:51:11,150 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:51:11,266 - aiogram.event - INFO - Update id=311268097 is handled. Duration 123 ms by bot id=7041366449
2025-04-08 20:51:32,155 - aiogram.event - INFO - Update id=311268092 is not handled. Duration 235 ms by bot id=7041366449
2025-04-08 20:51:32,156 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:32,723 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 178 ms by bot id=7041366449
2025-04-08 20:51:32,724 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:33,092 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 117 ms by bot id=7041366449
2025-04-08 20:51:33,093 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:35,509 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 97 ms by bot id=7041366449
2025-04-08 20:51:35,509 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:39,991 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 120 ms by bot id=7041366449
2025-04-08 20:51:39,992 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:48,521 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 166 ms by bot id=7041366449
2025-04-08 20:51:48,522 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:51:54,978 - __main__ - INFO - Stopping application...
2025-04-08 20:51:55,301 - __main__ - INFO - Application stopped
2025-04-08 20:52:08,072 - app - INFO - Starting application...
2025-04-08 20:52:08,072 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:52:08,072 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:52:08,072 - __main__ - INFO - Setting webhook at: https://3982-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:52:08,450 - __main__ - INFO - Application started successfully
2025-04-08 20:52:08,450 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:52:08,682 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 86 ms by bot id=7041366449
2025-04-08 20:52:08,682 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:09,033 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 93 ms by bot id=7041366449
2025-04-08 20:52:09,033 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:11,442 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:52:11,443 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:15,843 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 20:52:15,843 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:24,277 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 77 ms by bot id=7041366449
2025-04-08 20:52:24,278 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:40,873 - aiogram.event - INFO - Update id=311268096 is not handled. Duration 235 ms by bot id=7041366449
2025-04-08 20:52:40,873 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:41,243 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 116 ms by bot id=7041366449
2025-04-08 20:52:41,244 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:41,804 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 101 ms by bot id=7041366449
2025-04-08 20:52:41,804 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:44,242 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 120 ms by bot id=7041366449
2025-04-08 20:52:44,242 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:48,576 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:52:48,577 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:52:57,103 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:52:57,103 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:13,832 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 319 ms by bot id=7041366449
2025-04-08 20:53:13,832 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:22,597 - __main__ - INFO - Stopping application...
2025-04-08 20:53:22,921 - __main__ - INFO - Application stopped
2025-04-08 20:53:33,301 - app - INFO - Starting application...
2025-04-08 20:53:33,301 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 20:53:33,301 - __main__ - INFO - Action config initialized successfully
2025-04-08 20:53:33,301 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 20:53:33,695 - __main__ - INFO - Application started successfully
2025-04-08 20:53:33,695 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 20:53:33,921 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 89 ms by bot id=7041366449
2025-04-08 20:53:33,921 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:34,283 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 111 ms by bot id=7041366449
2025-04-08 20:53:34,283 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:36,618 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 20:53:36,618 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:53:41,160 - aiogram.event - INFO - Update id=311268098 is not handled. Duration 284 ms by bot id=7041366449
2025-04-08 20:53:41,160 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 20:54:58,342 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 20:54:58,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,343 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 20:54:58,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,344 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 20:54:58,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 20:54:58,345 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-08 20:54:58,346 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:54:58,666 - aiogram.event - INFO - Update id=311268099 is handled. Duration 379 ms by bot id=7041366449
2025-04-08 20:55:02,479 - aiogram.event - INFO - Update id=311268100 is handled. Duration 317 ms by bot id=7041366449
2025-04-08 20:55:03,893 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:03,895 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 20:55:03,895 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1043270764,)
2025-04-08 20:55:03,899 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:03,995 - aiogram.event - INFO - Update id=311268101 is handled. Duration 195 ms by bot id=7041366449
2025-04-08 20:55:05,555 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:05,556 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 20:55:05,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ()
2025-04-08 20:55:05,561 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:05,732 - aiogram.event - INFO - Update id=311268102 is handled. Duration 341 ms by bot id=7041366449
2025-04-08 20:55:08,521 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 20:55:08,522 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 20:55:08,523 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('Зоотовары',)
2025-04-08 20:55:08,528 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 20:55:08,713 - aiogram.event - INFO - Update id=311268103 is handled. Duration 413 ms by bot id=7041366449
2025-04-08 20:55:10,860 - aiogram.event - INFO - Update id=311268104 is handled. Duration 299 ms by bot id=7041366449
2025-04-08 20:55:15,559 - aiogram.event - INFO - Update id=311268105 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 20:55:18,852 - aiogram.event - INFO - Update id=311268106 is handled. Duration 411 ms by bot id=7041366449
2025-04-08 20:55:21,604 - aiogram.event - INFO - Update id=311268107 is handled. Duration 193 ms by bot id=7041366449
2025-04-08 20:55:25,717 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:55:25,717 - app - INFO - Является частью группы: True
2025-04-08 20:55:25,717 - app - INFO - Добавлено фото в группу 13953079399243906, всего фото в группе: 1
2025-04-08 20:55:26,133 - root - INFO - File saved: 2025/04/08/4f82e04f959441e9b425ff0373832e68.jpg
2025-04-08 20:55:26,133 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 20:55:26,634 - app - INFO - Ожидаем другие фото из группы 13953079399243906
2025-04-08 20:55:26,636 - aiogram.event - INFO - Update id=311268108 is handled. Duration 922 ms by bot id=7041366449
2025-04-08 20:55:26,904 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 20:55:26,904 - app - INFO - Является частью группы: True
2025-04-08 20:55:26,905 - app - INFO - Добавлено фото в группу 13953079399243906, всего фото в группе: 2
2025-04-08 20:55:27,397 - root - INFO - File saved: 2025/04/08/41e143df8de846089ca5d211902fcf29.jpg
2025-04-08 20:55:27,397 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 20:55:27,898 - app - INFO - Ожидаем другие фото из группы 13953079399243906
2025-04-08 20:55:27,900 - aiogram.event - INFO - Update id=311268109 is handled. Duration 1006 ms by bot id=7041366449
2025-04-08 21:00:14,935 - __main__ - INFO - Stopping application...
2025-04-08 21:00:15,412 - __main__ - INFO - Application stopped
2025-04-08 21:00:18,120 - app - INFO - Starting application...
2025-04-08 21:00:18,120 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 21:00:18,121 - __main__ - INFO - Action config initialized successfully
2025-04-08 21:00:18,121 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 21:00:18,565 - __main__ - INFO - Application started successfully
2025-04-08 21:00:18,566 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 21:00:21,512 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 21:00:21,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 21:00:21,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:00:21,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:21,515 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:00:21,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 21:00:21,516 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:21,699 - aiogram.event - INFO - Update id=311268110 is handled. Duration 245 ms by bot id=7041366449
2025-04-08 21:00:23,332 - aiogram.event - INFO - Update id=311268111 is handled. Duration 446 ms by bot id=7041366449
2025-04-08 21:00:24,328 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:24,329 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 21:00:24,329 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (1043270764,)
2025-04-08 21:00:24,333 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:24,468 - aiogram.event - INFO - Update id=311268112 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 21:00:26,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:26,415 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 21:00:26,425 - sqlalchemy.engine.Engine - INFO - [generated in 0.01019s] ()
2025-04-08 21:00:26,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:26,547 - aiogram.event - INFO - Update id=311268113 is handled. Duration 282 ms by bot id=7041366449
2025-04-08 21:00:30,113 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:00:30,115 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 21:00:30,115 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('Зоотовары',)
2025-04-08 21:00:30,121 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:00:30,243 - aiogram.event - INFO - Update id=311268114 is handled. Duration 233 ms by bot id=7041366449
2025-04-08 21:00:31,731 - aiogram.event - INFO - Update id=311268115 is handled. Duration 235 ms by bot id=7041366449
2025-04-08 21:00:34,296 - aiogram.event - INFO - Update id=311268116 is handled. Duration 217 ms by bot id=7041366449
2025-04-08 21:00:37,424 - aiogram.event - INFO - Update id=311268117 is handled. Duration 523 ms by bot id=7041366449
2025-04-08 21:00:38,779 - aiogram.event - INFO - Update id=311268118 is handled. Duration 328 ms by bot id=7041366449
2025-04-08 21:00:43,491 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:43,492 - app - INFO - Является частью группы: True
2025-04-08 21:00:43,492 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 1
2025-04-08 21:00:44,005 - root - INFO - File saved: 2025/04/08/a19eb16839d44fd79c6694aa592b3844.jpg
2025-04-08 21:00:44,005 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 21:00:44,005 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:44,113 - aiogram.event - INFO - Update id=311268119 is handled. Duration 634 ms by bot id=7041366449
2025-04-08 21:00:44,379 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:44,379 - app - INFO - Является частью группы: True
2025-04-08 21:00:44,379 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 2
2025-04-08 21:00:45,163 - root - INFO - File saved: 2025/04/08/0953d845dc4f424ba361786d52bf2341.jpg
2025-04-08 21:00:45,163 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 21:00:45,163 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:45,310 - aiogram.event - INFO - Update id=311268120 is handled. Duration 941 ms by bot id=7041366449
2025-04-08 21:00:45,575 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:00:45,575 - app - INFO - Является частью группы: True
2025-04-08 21:00:45,576 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 3
2025-04-08 21:00:46,163 - root - INFO - File saved: 2025/04/08/dd6087d8a52e44afbdde2231d4164391.jpg
2025-04-08 21:00:46,163 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 21:00:46,163 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:46,743 - aiogram.event - INFO - Update id=311268121 is handled. Duration 1178 ms by bot id=7041366449
2025-04-08 21:00:46,996 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 21:00:46,996 - app - INFO - Является частью группы: True
2025-04-08 21:00:46,996 - app - INFO - Добавлено фото в группу 13953081946348306, всего фото в группе: 4
2025-04-08 21:00:47,818 - root - INFO - File saved: 2025/04/08/2303cd00e27e4420b7d7b26ab9900eff.jpg
2025-04-08 21:00:47,818 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 21:00:47,819 - app - INFO - Группа 13953081946348306 завершена
2025-04-08 21:00:48,075 - aiogram.event - INFO - Update id=311268122 is handled. Duration 1080 ms by bot id=7041366449
2025-04-08 21:01:10,553 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:01:10,553 - app - INFO - Является частью группы: True
2025-04-08 21:01:10,554 - app - INFO - Добавлено фото в группу 13953082160280730, всего фото в группе: 1
2025-04-08 21:01:11,069 - root - INFO - File saved: 2025/04/08/7659e9a4b985441fbccf77546b7d0191.jpg
2025-04-08 21:01:11,070 - app - INFO - Фото сохранено, всего фото: 5
2025-04-08 21:01:11,070 - app - INFO - Группа 13953082160280730 завершена
2025-04-08 21:01:11,189 - aiogram.event - INFO - Update id=311268123 is handled. Duration 644 ms by bot id=7041366449
2025-04-08 21:01:11,456 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:01:11,456 - app - INFO - Является частью группы: True
2025-04-08 21:01:11,457 - app - INFO - Добавлено фото в группу 13953082160280730, всего фото в группе: 2
2025-04-08 21:01:11,806 - root - INFO - File saved: 2025/04/08/d175c2224e194cf4a6903beddaeef6d2.jpg
2025-04-08 21:01:11,806 - app - INFO - Фото сохранено, всего фото: 6
2025-04-08 21:01:11,807 - app - INFO - Группа 13953082160280730 завершена
2025-04-08 21:01:11,910 - aiogram.event - INFO - Update id=311268124 is handled. Duration 460 ms by bot id=7041366449
2025-04-08 21:09:04,824 - __main__ - INFO - Stopping application...
2025-04-08 21:09:05,290 - __main__ - INFO - Application stopped
2025-04-08 21:09:09,195 - app - INFO - Starting application...
2025-04-08 21:09:09,195 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 21:09:09,195 - __main__ - INFO - Action config initialized successfully
2025-04-08 21:09:09,195 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 21:09:09,644 - __main__ - INFO - Application started successfully
2025-04-08 21:09:09,646 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 21:09:10,831 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 21:09:10,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,833 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 21:09:10,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 21:09:10,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:10,835 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:09:10,835 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-08 21:09:10,836 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:10,982 - aiogram.event - INFO - Update id=311268125 is handled. Duration 212 ms by bot id=7041366449
2025-04-08 21:09:13,032 - aiogram.event - INFO - Update id=311268126 is handled. Duration 626 ms by bot id=7041366449
2025-04-08 21:09:14,229 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:14,230 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 21:09:14,231 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] (1043270764,)
2025-04-08 21:09:14,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:14,344 - aiogram.event - INFO - Update id=311268127 is handled. Duration 196 ms by bot id=7041366449
2025-04-08 21:09:15,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:15,835 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 21:09:15,835 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-08 21:09:15,836 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:15,939 - aiogram.event - INFO - Update id=311268128 is handled. Duration 229 ms by bot id=7041366449
2025-04-08 21:09:20,088 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:09:20,089 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 21:09:20,090 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ('Ювелирные изделия и украшения',)
2025-04-08 21:09:20,092 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:09:20,201 - aiogram.event - INFO - Update id=311268129 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 21:09:25,138 - aiogram.event - INFO - Update id=311268130 is handled. Duration 223 ms by bot id=7041366449
2025-04-08 21:09:27,869 - aiogram.event - INFO - Update id=311268131 is handled. Duration 260 ms by bot id=7041366449
2025-04-08 21:09:32,868 - aiogram.event - INFO - Update id=311268132 is handled. Duration 273 ms by bot id=7041366449
2025-04-08 21:09:36,641 - aiogram.event - INFO - Update id=311268133 is handled. Duration 170 ms by bot id=7041366449
2025-04-08 21:09:40,585 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 21:09:40,585 - app - INFO - Является частью группы: True
2025-04-08 21:09:40,585 - app - INFO - Добавлено фото в группу 13953086243243762, всего фото в группе: 1
2025-04-08 21:09:41,114 - root - INFO - File saved: 2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg
2025-04-08 21:09:41,114 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 21:09:41,224 - app - INFO - Создано новое сообщение для группы 13953086243243762
2025-04-08 21:09:41,225 - aiogram.event - INFO - Update id=311268134 is handled. Duration 643 ms by bot id=7041366449
2025-04-08 21:09:41,491 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:41,492 - app - INFO - Является частью группы: True
2025-04-08 21:09:41,492 - app - INFO - Добавлено фото в группу 13953086243243762, всего фото в группе: 2
2025-04-08 21:09:41,728 - root - INFO - File saved: 2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg
2025-04-08 21:09:41,728 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 21:09:41,821 - app - INFO - Сообщение для группы 13953086243243762 обновлено
2025-04-08 21:09:41,822 - aiogram.event - INFO - Update id=311268135 is handled. Duration 341 ms by bot id=7041366449
2025-04-08 21:09:48,696 - aiogram.event - INFO - Update id=311268136 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 21:09:51,988 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:51,989 - app - INFO - Является частью группы: False
2025-04-08 21:09:52,383 - root - INFO - File saved: 2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg
2025-04-08 21:09:52,384 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 21:09:52,756 - app - INFO - Отправлено сообщение для одиночного фото
2025-04-08 21:09:52,758 - aiogram.event - INFO - Update id=311268137 is handled. Duration 771 ms by bot id=7041366449
2025-04-08 21:09:56,597 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 21:09:56,597 - app - INFO - Является частью группы: True
2025-04-08 21:09:56,597 - app - INFO - Добавлено фото в группу 13953086371444826, всего фото в группе: 1
2025-04-08 21:09:56,999 - root - INFO - File saved: 2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg
2025-04-08 21:09:57,000 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 21:09:57,133 - app - INFO - Создано новое сообщение для группы 13953086371444826
2025-04-08 21:09:57,135 - aiogram.event - INFO - Update id=311268138 is handled. Duration 540 ms by bot id=7041366449
2025-04-08 21:09:57,402 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 21:09:57,403 - app - INFO - Является частью группы: True
2025-04-08 21:09:57,403 - app - INFO - Добавлено фото в группу 13953086371444826, всего фото в группе: 2
2025-04-08 21:09:57,584 - root - INFO - File saved: 2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg
2025-04-08 21:09:57,585 - app - INFO - Фото сохранено, всего фото: 5
2025-04-08 21:09:57,674 - app - INFO - Сообщение для группы 13953086371444826 обновлено
2025-04-08 21:09:57,676 - aiogram.event - INFO - Update id=311268139 is handled. Duration 282 ms by bot id=7041366449
2025-04-08 21:10:00,840 - aiogram.event - INFO - Update id=311268140 is handled. Duration 614 ms by bot id=7041366449
2025-04-08 21:10:13,538 - aiogram.event - INFO - Update id=311268141 is handled. Duration 507 ms by bot id=7041366449
2025-04-08 21:10:16,896 - root - INFO - === Подтверждение создания поставщика ===
2025-04-08 21:10:16,897 - root - INFO - ID пользователя: 1043270764
2025-04-08 21:10:16,897 - root - INFO - Данные из состояния: {'company_name': 'Jdjdhf', 'product_name': '-_;_+_', 'category_id': 100, 'photos_count': 5, 'has_video': False}
2025-04-08 21:10:16,897 - root - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 21:10:16,898 - root - INFO - Сессия БД создана
2025-04-08 21:10:16,898 - root - INFO - После проверки осталось 5 корректных фотографий
2025-04-08 21:10:16,898 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 21:10:16,899 - root - INFO - Данные: company_name=Jdjdhf, product_name=-_;_+_, category_id=100
2025-04-08 21:10:16,899 - root - INFO - Фотографии: 5 шт.
2025-04-08 21:10:16,899 - root - INFO - Видео: False
2025-04-08 21:10:16,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:10:16,902 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 21:10:16,902 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('Jdjdhf', '-_;_+_', 100, 'оалаьслв аоалашат', None, None, None, None, None, None, 1043270764)
2025-04-08 21:10:16,907 - root - INFO - Поставщик создан с ID: 4
2025-04-08 21:10:16,908 - root - INFO - Начинаю сохранение 5 фотографий
2025-04-08 21:10:16,908 - root - INFO - Сохраняю фото 1/5: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-08 21:10:16,908 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=4
2025-04-08 21:10:16,908 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,909 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,909 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ('photo', '2025/04/08/bbf468edabbf4e97874e124fd7bcdea9.jpg', 'photo_1.jpg', None, 4)
2025-04-08 21:10:16,910 - root - INFO - Файл сохранен с ID: 8
2025-04-08 21:10:16,911 - root - INFO - Фото 1 сохранено с ID: 8
2025-04-08 21:10:16,911 - root - INFO - Сохраняю фото 2/5: AgACAgIAAxkBAAEBk5Nn9Ut9IV4abiDz7b9LIs-CccD1MgACpPgxG2fgqEuY9B5SVTC51QEAAwIAA3kAAzYE
2025-04-08 21:10:16,911 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=4
2025-04-08 21:10:16,911 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,911 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,911 - sqlalchemy.engine.Engine - INFO - [cached since 0.00183s ago] ('photo', '2025/04/08/9bfe53fecc304406a0fae6f346777b25.jpg', 'photo_2.jpg', None, 4)
2025-04-08 21:10:16,912 - root - INFO - Файл сохранен с ID: 9
2025-04-08 21:10:16,912 - root - INFO - Фото 2 сохранено с ID: 9
2025-04-08 21:10:16,912 - root - INFO - Сохраняю фото 3/5: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 21:10:16,912 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=4
2025-04-08 21:10:16,912 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,912 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,912 - sqlalchemy.engine.Engine - INFO - [cached since 0.00293s ago] ('photo', '2025/04/08/ac5914e277a04f8d9b83512ae8a20077.jpg', 'photo_3.jpg', None, 4)
2025-04-08 21:10:16,913 - root - INFO - Файл сохранен с ID: 10
2025-04-08 21:10:16,913 - root - INFO - Фото 3 сохранено с ID: 10
2025-04-08 21:10:16,913 - root - INFO - Сохраняю фото 4/5: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 21:10:16,913 - root - INFO - Сохранение файла: photo, photo_4.jpg, supplier_id=4
2025-04-08 21:10:16,913 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg', 'name': 'photo_4.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,913 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,913 - sqlalchemy.engine.Engine - INFO - [cached since 0.004069s ago] ('photo', '2025/04/08/81a1e44145ed4a4081440ba23aa6f444.jpg', 'photo_4.jpg', None, 4)
2025-04-08 21:10:16,914 - root - INFO - Файл сохранен с ID: 11
2025-04-08 21:10:16,914 - root - INFO - Фото 4 сохранено с ID: 11
2025-04-08 21:10:16,914 - root - INFO - Сохраняю фото 5/5: AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE
2025-04-08 21:10:16,914 - root - INFO - Сохранение файла: photo, photo_5.jpg, supplier_id=4
2025-04-08 21:10:16,915 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg', 'name': 'photo_5.jpg', 'request_id': None, 'supplier_id': 4}
2025-04-08 21:10:16,915 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 21:10:16,915 - sqlalchemy.engine.Engine - INFO - [cached since 0.005728s ago] ('photo', '2025/04/08/4dc69f1e14d94cc89adc96e72e681b67.jpg', 'photo_5.jpg', None, 4)
2025-04-08 21:10:16,916 - root - INFO - Файл сохранен с ID: 12
2025-04-08 21:10:16,916 - root - INFO - Фото 5 сохранено с ID: 12
2025-04-08 21:10:16,916 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 21:10:16,917 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 21:10:16,917 - root - INFO - Поставщик успешно создан с ID: 4
2025-04-08 21:10:17,229 - root - INFO - === Создание поставщика успешно завершено ===
2025-04-08 21:10:17,229 - aiogram.event - INFO - Update id=311268142 is handled. Duration 415 ms by bot id=7041366449
2025-04-08 21:12:32,634 - aiogram.event - INFO - Update id=311268143 is handled. Duration 371 ms by bot id=7041366449
2025-04-08 21:12:35,152 - aiogram.event - INFO - Update id=311268144 is handled. Duration 296 ms by bot id=7041366449
2025-04-08 21:12:41,088 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 21:12:41,089 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 21:12:41,090 - sqlalchemy.engine.Engine - INFO - [cached since 210.3s ago] (1043270764,)
2025-04-08 21:12:41,092 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 21:12:41,210 - aiogram.event - INFO - Update id=311268145 is handled. Duration 123 ms by bot id=7041366449
2025-04-08 22:25:01,911 - __main__ - INFO - Stopping application...
2025-04-08 22:25:02,746 - __main__ - INFO - Application stopped
2025-04-08 22:25:07,535 - app - INFO - Starting application...
2025-04-08 22:25:07,535 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:25:07,535 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:25:07,536 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:25:09,398 - __main__ - INFO - Application started successfully
2025-04-08 22:25:09,399 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:25:18,403 - aiogram.event - INFO - Update id=311268146 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 22:25:19,716 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:25:19,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,718 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:25:19,718 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,719 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:25:19,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:25:19,720 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:19,721 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:25:19,721 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1043270764,)
2025-04-08 22:25:19,723 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:19,946 - aiogram.event - INFO - Update id=311268147 is handled. Duration 455 ms by bot id=7041366449
2025-04-08 22:25:22,358 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:22,360 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:25:22,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-04-08 22:25:22,365 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:22,539 - aiogram.event - INFO - Update id=311268148 is handled. Duration 299 ms by bot id=7041366449
2025-04-08 22:25:26,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:25:26,357 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:25:26,358 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('Цифровые товары',)
2025-04-08 22:25:26,363 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:25:26,478 - aiogram.event - INFO - Update id=311268149 is handled. Duration 240 ms by bot id=7041366449
2025-04-08 22:25:29,906 - aiogram.event - INFO - Update id=311268150 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 22:25:35,614 - aiogram.event - INFO - Update id=311268151 is handled. Duration 958 ms by bot id=7041366449
2025-04-08 22:25:37,439 - aiogram.event - INFO - Update id=311268152 is handled. Duration 559 ms by bot id=7041366449
2025-04-08 22:25:40,824 - aiogram.event - INFO - Update id=311268153 is handled. Duration 228 ms by bot id=7041366449
2025-04-08 22:25:47,828 - aiogram.event - INFO - Update id=311268154 is handled. Duration 150 ms by bot id=7041366449
2025-04-08 22:25:51,893 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:25:51,894 - app - INFO - Является частью группы: True
2025-04-08 22:25:51,894 - app - INFO - Добавлено фото в группу 13953122813817218, всего фото в группе: 1
2025-04-08 22:25:53,997 - root - INFO - File saved: 2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg
2025-04-08 22:25:53,997 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:25:54,251 - app - INFO - Создано новое сообщение для группы 13953122813817218
2025-04-08 22:25:54,253 - aiogram.event - INFO - Update id=311268155 is handled. Duration 2368 ms by bot id=7041366449
2025-04-08 22:25:54,525 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:25:54,526 - app - INFO - Является частью группы: True
2025-04-08 22:25:54,526 - app - INFO - Добавлено фото в группу 13953122813817218, всего фото в группе: 2
2025-04-08 22:25:57,769 - root - INFO - File saved: 2025/04/08/dcb7c925bfeb47b19767997251003967.jpg
2025-04-08 22:25:57,769 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:25:57,940 - app - INFO - Сообщение для группы 13953122813817218 обновлено
2025-04-08 22:25:57,941 - aiogram.event - INFO - Update id=311268156 is handled. Duration 3425 ms by bot id=7041366449
2025-04-08 22:26:07,053 - aiogram.event - INFO - Update id=311268157 is handled. Duration 304 ms by bot id=7041366449
2025-04-08 22:26:11,873 - aiogram.event - INFO - Update id=311268158 is handled. Duration 867 ms by bot id=7041366449
2025-04-08 22:26:24,857 - aiogram.event - INFO - Update id=311268159 is handled. Duration 499 ms by bot id=7041366449
2025-04-08 22:26:34,722 - aiogram.event - INFO - Update id=311268160 is handled. Duration 530 ms by bot id=7041366449
2025-04-08 22:26:38,234 - aiogram.event - INFO - Update id=311268161 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 22:26:41,476 - aiogram.event - INFO - Update id=311268162 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 22:26:49,746 - aiogram.event - INFO - Update id=311268163 is handled. Duration 878 ms by bot id=7041366449
2025-04-08 22:26:52,789 - aiogram.event - INFO - Update id=311268164 is handled. Duration 245 ms by bot id=7041366449
2025-04-08 22:27:00,911 - aiogram.event - INFO - Update id=311268165 is handled. Duration 571 ms by bot id=7041366449
2025-04-08 22:27:05,588 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 22:27:05,588 - app - INFO - ID пользователя: 1043270764
2025-04-08 22:27:05,589 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 22:27:05,589 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 22:27:05,590 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 22:27:05,590 - root - INFO - Данные: company_name=Окоаьп, product_name=Коткьп, category_id=96
2025-04-08 22:27:05,590 - root - INFO - Фотографии: 2 шт.
2025-04-08 22:27:05,590 - root - INFO - Видео: False
2025-04-08 22:27:05,591 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:27:05,593 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 22:27:05,593 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('Окоаьп', 'Коткьп', 96, 'Шалкикьададвп', 'Россия', 'москва', None, None, '79267091083', None, 1043270764)
2025-04-08 22:27:05,599 - root - INFO - Поставщик создан с ID: 5
2025-04-08 22:27:05,600 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 22:27:05,600 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 22:27:05,601 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=5
2025-04-08 22:27:05,601 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-08 22:27:05,603 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:27:05,603 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('photo', '2025/04/08/86b7fa70105c41f790d2fcc036a00c2d.jpg', 'photo_1.jpg', None, 5)
2025-04-08 22:27:05,608 - root - INFO - Файл сохранен с ID: 13
2025-04-08 22:27:05,608 - root - INFO - Фото 1 сохранено с ID: 13
2025-04-08 22:27:05,609 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-08 22:27:05,609 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=5
2025-04-08 22:27:05,609 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/dcb7c925bfeb47b19767997251003967.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 5}
2025-04-08 22:27:05,610 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:27:05,611 - sqlalchemy.engine.Engine - INFO - [cached since 0.00852s ago] ('photo', '2025/04/08/dcb7c925bfeb47b19767997251003967.jpg', 'photo_2.jpg', None, 5)
2025-04-08 22:27:05,613 - root - INFO - Файл сохранен с ID: 14
2025-04-08 22:27:05,614 - root - INFO - Фото 2 сохранено с ID: 14
2025-04-08 22:27:05,614 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 22:27:05,616 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 22:27:05,616 - app - INFO - Поставщик успешно создан с ID: 5
2025-04-08 22:27:05,933 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 22:27:05,935 - aiogram.event - INFO - Update id=311268166 is handled. Duration 435 ms by bot id=7041366449
2025-04-08 22:27:41,913 - aiogram.event - INFO - Update id=311268167 is not handled. Duration 12 ms by bot id=7041366449
2025-04-08 22:44:40,882 - __main__ - INFO - Stopping application...
2025-04-08 22:44:41,617 - __main__ - INFO - Application stopped
2025-04-08 22:44:46,686 - app - INFO - Starting application...
2025-04-08 22:44:46,686 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:44:46,686 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:44:46,686 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:44:47,050 - __main__ - INFO - Application started successfully
2025-04-08 22:44:47,051 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:45:03,291 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:45:03,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,293 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:45:03,293 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,294 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:45:03,294 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:45:03,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:03,296 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 22:45:03,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1043270764,)
2025-04-08 22:45:03,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:03,632 - aiogram.event - INFO - Update id=311268168 is handled. Duration 393 ms by bot id=7041366449
2025-04-08 22:45:03,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:03,884 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 22:45:03,884 - sqlalchemy.engine.Engine - INFO - [cached since 0.5883s ago] (1043270764,)
2025-04-08 22:45:03,885 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:03,989 - aiogram.event - INFO - Update id=311268169 is handled. Duration 107 ms by bot id=7041366449
2025-04-08 22:45:08,272 - aiogram.event - INFO - Update id=311268170 is handled. Duration 265 ms by bot id=7041366449
2025-04-08 22:45:10,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:10,497 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:45:10,497 - sqlalchemy.engine.Engine - INFO - [generated in 0.00092s] (1043270764,)
2025-04-08 22:45:10,510 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:10,802 - aiogram.event - INFO - Update id=311268171 is handled. Duration 1111 ms by bot id=7041366449
2025-04-08 22:45:17,783 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:17,784 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:45:17,795 - sqlalchemy.engine.Engine - INFO - [generated in 0.01039s] ()
2025-04-08 22:45:17,803 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:17,898 - aiogram.event - INFO - Update id=311268172 is handled. Duration 205 ms by bot id=7041366449
2025-04-08 22:45:21,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:45:21,127 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:45:21,127 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('Электроника',)
2025-04-08 22:45:21,135 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:45:21,225 - aiogram.event - INFO - Update id=311268173 is handled. Duration 191 ms by bot id=7041366449
2025-04-08 22:45:23,671 - aiogram.event - INFO - Update id=311268174 is handled. Duration 182 ms by bot id=7041366449
2025-04-08 22:45:26,390 - aiogram.event - INFO - Update id=311268175 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 22:45:30,158 - aiogram.event - INFO - Update id=311268176 is handled. Duration 554 ms by bot id=7041366449
2025-04-08 22:45:32,579 - aiogram.event - INFO - Update id=311268177 is handled. Duration 166 ms by bot id=7041366449
2025-04-08 22:45:37,392 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-08 22:45:37,392 - app - INFO - Является частью группы: True
2025-04-08 22:45:37,392 - app - INFO - Добавлено фото в группу 13953132298516410, всего фото в группе: 1
2025-04-08 22:45:38,443 - root - INFO - File saved: 2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg
2025-04-08 22:45:38,444 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:45:38,607 - app - INFO - Создано новое сообщение для группы 13953132298516410
2025-04-08 22:45:38,607 - aiogram.event - INFO - Update id=311268178 is handled. Duration 1218 ms by bot id=7041366449
2025-04-08 22:45:38,868 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:45:38,868 - app - INFO - Является частью группы: True
2025-04-08 22:45:38,869 - app - INFO - Добавлено фото в группу 13953132298516410, всего фото в группе: 2
2025-04-08 22:45:39,906 - root - INFO - File saved: 2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg
2025-04-08 22:45:39,907 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:45:40,001 - app - INFO - Сообщение для группы 13953132298516410 обновлено
2025-04-08 22:45:40,002 - aiogram.event - INFO - Update id=311268179 is handled. Duration 1143 ms by bot id=7041366449
2025-04-08 22:45:42,869 - aiogram.event - INFO - Update id=311268180 is handled. Duration 321 ms by bot id=7041366449
2025-04-08 22:45:46,410 - aiogram.event - INFO - Update id=311268181 is handled. Duration 277 ms by bot id=7041366449
2025-04-08 22:45:54,117 - aiogram.event - INFO - Update id=311268182 is handled. Duration 814 ms by bot id=7041366449
2025-04-08 22:46:15,250 - aiogram.event - INFO - Update id=311268183 is handled. Duration 444 ms by bot id=7041366449
2025-04-08 22:46:18,892 - aiogram.event - INFO - Update id=311268184 is handled. Duration 439 ms by bot id=7041366449
2025-04-08 22:46:21,961 - aiogram.event - INFO - Update id=311268185 is handled. Duration 190 ms by bot id=7041366449
2025-04-08 22:46:25,214 - aiogram.event - INFO - Update id=311268186 is handled. Duration 168 ms by bot id=7041366449
2025-04-08 22:46:46,683 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 22:46:46,778 - aiogram.event - INFO - Update id=311268187 is handled. Duration 431 ms by bot id=7041366449
2025-04-08 22:47:01,066 - aiogram.event - INFO - Update id=311268188 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 22:47:05,492 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 22:47:05,493 - app - INFO - ID пользователя: 1043270764
2025-04-08 22:47:05,493 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 22:47:05,493 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 22:47:05,494 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 22:47:05,494 - root - INFO - Данные: company_name=Раоалп, product_name=Аллалп, category_id=1
2025-04-08 22:47:05,494 - root - INFO - Фотографии: 2 шт.
2025-04-08 22:47:05,495 - root - INFO - Видео: False
2025-04-08 22:47:05,496 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:47:05,497 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 22:47:05,497 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Раоалп', 'Аллалп', 1, 'Лалаща слашаш алсшьа', None, None, None, None, '+89267091083', None, 1043270764)
2025-04-08 22:47:05,517 - root - INFO - Поставщик создан с ID: 6
2025-04-08 22:47:05,518 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 22:47:05,518 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-08 22:47:05,518 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=6
2025-04-08 22:47:05,519 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-08 22:47:05,520 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:47:05,521 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('photo', '2025/04/08/f2a4e95b83274e3c9bddb30dcdb618b3.jpg', 'photo_1.jpg', None, 6)
2025-04-08 22:47:05,527 - root - INFO - Файл сохранен с ID: 15
2025-04-08 22:47:05,528 - root - INFO - Фото 1 сохранено с ID: 15
2025-04-08 22:47:05,528 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 22:47:05,528 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=6
2025-04-08 22:47:05,529 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 6}
2025-04-08 22:47:05,530 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 22:47:05,530 - sqlalchemy.engine.Engine - INFO - [cached since 0.01s ago] ('photo', '2025/04/08/99bc20ff5a714845916486b950e4fb01.jpg', 'photo_2.jpg', None, 6)
2025-04-08 22:47:05,532 - root - INFO - Файл сохранен с ID: 16
2025-04-08 22:47:05,532 - root - INFO - Фото 2 сохранено с ID: 16
2025-04-08 22:47:05,533 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 22:47:05,534 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 22:47:05,534 - app - INFO - Поставщик успешно создан с ID: 6
2025-04-08 22:47:05,829 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 22:47:05,831 - aiogram.event - INFO - Update id=311268189 is handled. Duration 438 ms by bot id=7041366449
2025-04-08 22:51:22,819 - __main__ - INFO - Stopping application...
2025-04-08 22:52:04,865 - app - INFO - Starting application...
2025-04-08 22:52:04,865 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:52:04,866 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:52:04,866 - __main__ - INFO - Setting webhook at: https://389b-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:52:24,906 - __main__ - INFO - Application started successfully
2025-04-08 22:52:24,906 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:52:27,419 - __main__ - INFO - Stopping application...
2025-04-08 22:52:27,741 - __main__ - INFO - Application stopped
2025-04-08 22:52:31,367 - app - INFO - Starting application...
2025-04-08 22:52:31,368 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:52:31,368 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:52:31,368 - __main__ - INFO - Setting webhook at: https://f25f-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:52:32,138 - __main__ - INFO - Application started successfully
2025-04-08 22:52:32,138 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:52:32,310 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 125 ms by bot id=7041366449
2025-04-08 22:52:32,310 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:32,650 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 87 ms by bot id=7041366449
2025-04-08 22:52:32,650 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:35,354 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 330 ms by bot id=7041366449
2025-04-08 22:52:35,355 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:39,713 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:52:39,714 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:52:48,215 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:52:48,215 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:04,872 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 253 ms by bot id=7041366449
2025-04-08 22:53:04,873 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:37,570 - aiogram.event - INFO - Update id=311268190 is not handled. Duration 287 ms by bot id=7041366449
2025-04-08 22:53:37,570 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:38,045 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 147 ms by bot id=7041366449
2025-04-08 22:53:38,045 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:38,426 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 126 ms by bot id=7041366449
2025-04-08 22:53:38,426 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:40,845 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 79 ms by bot id=7041366449
2025-04-08 22:53:40,846 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:45,349 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 169 ms by bot id=7041366449
2025-04-08 22:53:45,350 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:53:53,889 - aiogram.event - INFO - Update id=311268191 is not handled. Duration 116 ms by bot id=7041366449
2025-04-08 22:53:53,889 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:10,622 - __main__ - INFO - Stopping application...
2025-04-08 22:54:11,434 - __main__ - INFO - Application stopped
2025-04-08 22:54:15,967 - app - INFO - Starting application...
2025-04-08 22:54:15,967 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:54:15,967 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:54:15,967 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:54:16,380 - __main__ - INFO - Application started successfully
2025-04-08 22:54:16,381 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:54:16,604 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 84 ms by bot id=7041366449
2025-04-08 22:54:16,604 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:16,943 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 86 ms by bot id=7041366449
2025-04-08 22:54:16,943 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:19,322 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 88 ms by bot id=7041366449
2025-04-08 22:54:19,322 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:23,702 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 128 ms by bot id=7041366449
2025-04-08 22:54:23,702 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:32,220 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 170 ms by bot id=7041366449
2025-04-08 22:54:32,221 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:54:48,916 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 254 ms by bot id=7041366449
2025-04-08 22:54:48,917 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:21,551 - aiogram.event - INFO - Update id=311268192 is not handled. Duration 223 ms by bot id=7041366449
2025-04-08 22:55:21,552 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:21,890 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 22:55:21,890 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:22,225 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 82 ms by bot id=7041366449
2025-04-08 22:55:22,225 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:24,556 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 79 ms by bot id=7041366449
2025-04-08 22:55:24,556 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:55:28,990 - aiogram.event - INFO - Update id=311268193 is not handled. Duration 80 ms by bot id=7041366449
2025-04-08 22:55:28,990 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-08 22:57:38,421 - __main__ - INFO - Stopping application...
2025-04-08 22:57:38,872 - __main__ - INFO - Application stopped
2025-04-08 22:57:43,189 - app - INFO - Starting application...
2025-04-08 22:57:43,189 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 22:57:43,189 - __main__ - INFO - Action config initialized successfully
2025-04-08 22:57:43,189 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 22:57:43,564 - __main__ - INFO - Application started successfully
2025-04-08 22:57:43,564 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 22:57:51,140 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 22:57:51,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,142 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 22:57:51,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 22:57:51,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:51,144 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 22:57:51,144 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1043270764,)
2025-04-08 22:57:51,145 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:51,279 - aiogram.event - INFO - Update id=311268194 is handled. Duration 269 ms by bot id=7041366449
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 22:57:55,436 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-08 22:57:55,438 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:55,573 - aiogram.event - INFO - Update id=311268195 is handled. Duration 222 ms by bot id=7041366449
2025-04-08 22:57:58,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 22:57:58,757 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 22:57:58,757 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('Строительные материалы',)
2025-04-08 22:57:58,764 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 22:57:58,858 - aiogram.event - INFO - Update id=311268196 is handled. Duration 193 ms by bot id=7041366449
2025-04-08 22:58:01,138 - aiogram.event - INFO - Update id=311268197 is handled. Duration 186 ms by bot id=7041366449
2025-04-08 22:58:03,237 - aiogram.event - INFO - Update id=311268198 is handled. Duration 219 ms by bot id=7041366449
2025-04-08 22:58:06,434 - aiogram.event - INFO - Update id=311268199 is handled. Duration 190 ms by bot id=7041366449
2025-04-08 22:58:09,187 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:09,188 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:09,447 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:09,447 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:11,731 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 9 ms by bot id=7041366449
2025-04-08 22:58:11,731 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:16,017 - aiogram.event - INFO - Update id=311268200 is not handled. Duration 2 ms by bot id=7041366449
2025-04-08 22:58:16,017 - __main__ - ERROR - Error processing webhook: 'NoneType' object has no attribute 'strip'
2025-04-08 22:58:18,131 - aiogram.event - INFO - Update id=311268202 is handled. Duration 165 ms by bot id=7041366449
2025-04-08 22:58:24,420 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:58:24,420 - app - INFO - Является частью группы: True
2025-04-08 22:58:24,420 - app - INFO - Добавлено фото в группу 13953138312881770, всего фото в группе: 1
2025-04-08 22:58:24,842 - root - INFO - File saved: 2025/04/08/e919627a1fdb41a797aea2235421c866.jpg
2025-04-08 22:58:24,842 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 22:58:24,929 - app - INFO - Создано новое сообщение для группы 13953138312881770
2025-04-08 22:58:24,930 - aiogram.event - INFO - Update id=311268200 is handled. Duration 512 ms by bot id=7041366449
2025-04-08 22:58:25,189 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 22:58:25,189 - app - INFO - Является частью группы: True
2025-04-08 22:58:25,190 - app - INFO - Добавлено фото в группу 13953138312881770, всего фото в группе: 2
2025-04-08 22:58:25,365 - root - INFO - File saved: 2025/04/08/7035a817be4a404ebdc84ce1b53b3ee4.jpg
2025-04-08 22:58:25,366 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 22:58:25,453 - app - INFO - Сообщение для группы 13953138312881770 обновлено
2025-04-08 22:58:25,454 - aiogram.event - INFO - Update id=311268201 is handled. Duration 275 ms by bot id=7041366449
2025-04-08 22:58:25,709 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 22:58:25,710 - app - INFO - Является частью группы: True
2025-04-08 22:58:25,710 - app - INFO - Добавлено фото в группу 13953138424374986, всего фото в группе: 1
2025-04-08 22:58:26,131 - root - INFO - File saved: 2025/04/08/6d1e92eafbf74cd1a0ccd94a74fa464c.jpg
2025-04-08 22:58:26,131 - app - INFO - Фото сохранено, всего фото: 3
2025-04-08 22:58:26,229 - app - INFO - Создано новое сообщение для группы 13953138424374986
2025-04-08 22:58:26,230 - aiogram.event - INFO - Update id=311268203 is handled. Duration 529 ms by bot id=7041366449
2025-04-08 22:58:26,478 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 22:58:26,478 - app - INFO - Является частью группы: True
2025-04-08 22:58:26,478 - app - INFO - Добавлено фото в группу 13953138424374986, всего фото в группе: 2
2025-04-08 22:58:26,631 - root - INFO - File saved: 2025/04/08/800ed07f87d0462099ad9185af020608.jpg
2025-04-08 22:58:26,631 - app - INFO - Фото сохранено, всего фото: 4
2025-04-08 22:58:26,722 - app - INFO - Сообщение для группы 13953138424374986 обновлено
2025-04-08 22:58:26,724 - aiogram.event - INFO - Update id=311268204 is handled. Duration 247 ms by bot id=7041366449
2025-04-08 22:58:29,318 - aiogram.event - INFO - Update id=311268205 is handled. Duration 186 ms by bot id=7041366449
2025-04-08 22:58:34,239 - aiogram.event - INFO - Update id=311268206 is handled. Duration 294 ms by bot id=7041366449
2025-04-08 22:58:40,247 - aiogram.event - INFO - Update id=311268207 is handled. Duration 361 ms by bot id=7041366449
2025-04-08 22:58:44,277 - aiogram.event - INFO - Update id=311268208 is handled. Duration 165 ms by bot id=7041366449
2025-04-08 22:58:55,535 - aiogram.event - INFO - Update id=311268209 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 22:58:58,443 - aiogram.event - INFO - Update id=311268210 is handled. Duration 171 ms by bot id=7041366449
2025-04-08 22:59:01,701 - aiogram.event - INFO - Update id=311268211 is handled. Duration 188 ms by bot id=7041366449
2025-04-08 23:10:31,249 - __main__ - INFO - Stopping application...
2025-04-08 23:10:31,702 - __main__ - INFO - Application stopped
2025-04-08 23:10:35,268 - app - INFO - Starting application...
2025-04-08 23:10:35,268 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:10:35,268 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:10:35,268 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:10:35,675 - __main__ - INFO - Application started successfully
2025-04-08 23:10:35,676 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:10:53,834 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:10:53,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,835 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:10:53,835 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,836 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:10:53,836 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 23:10:53,837 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-08 23:10:53,838 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:10:54,118 - aiogram.event - INFO - Update id=311268212 is handled. Duration 316 ms by bot id=7041366449
2025-04-08 23:13:33,531 - aiogram.event - INFO - Update id=311268213 is handled. Duration 331 ms by bot id=7041366449
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:13:34,423 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-08 23:13:34,424 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:34,510 - aiogram.event - INFO - Update id=311268214 is handled. Duration 164 ms by bot id=7041366449
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:13:37,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-08 23:13:37,909 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:38,133 - aiogram.event - INFO - Update id=311268215 is handled. Duration 389 ms by bot id=7041366449
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:13:39,143 - sqlalchemy.engine.Engine - INFO - [cached since 1.236s ago] ()
2025-04-08 23:13:39,144 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:39,240 - aiogram.event - INFO - Update id=311268216 is handled. Duration 98 ms by bot id=7041366449
2025-04-08 23:13:41,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:13:41,875 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:13:41,876 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ('Электроника',)
2025-04-08 23:13:41,882 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:13:42,017 - aiogram.event - INFO - Update id=311268217 is handled. Duration 297 ms by bot id=7041366449
2025-04-08 23:13:44,882 - aiogram.event - INFO - Update id=311268218 is handled. Duration 578 ms by bot id=7041366449
2025-04-08 23:13:46,178 - aiogram.event - INFO - Update id=311268219 is handled. Duration 200 ms by bot id=7041366449
2025-04-08 23:13:48,498 - aiogram.event - INFO - Update id=311268220 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 23:14:01,668 - aiogram.event - INFO - Update id=311268221 is handled. Duration 270 ms by bot id=7041366449
2025-04-08 23:14:03,713 - aiogram.event - INFO - Update id=311268222 is handled. Duration 264 ms by bot id=7041366449
2025-04-08 23:14:08,165 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:14:08,165 - app - INFO - Является частью группы: True
2025-04-08 23:14:08,166 - app - INFO - Добавлено фото в группу 13953145984647826, всего фото в группе: 1
2025-04-08 23:14:09,128 - root - INFO - File saved: 2025/04/08/39f6a3c2b96b40708c5ae628f7608258.jpg
2025-04-08 23:14:09,128 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:14:09,234 - app - INFO - Создано новое сообщение для группы 13953145984647826
2025-04-08 23:14:09,235 - aiogram.event - INFO - Update id=311268223 is handled. Duration 1078 ms by bot id=7041366449
2025-04-08 23:14:09,504 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 23:14:09,504 - app - INFO - Является частью группы: True
2025-04-08 23:14:09,505 - app - INFO - Добавлено фото в группу 13953145984647826, всего фото в группе: 2
2025-04-08 23:14:09,652 - root - INFO - File saved: 2025/04/08/3e37cad897274a95b9a8328df84df386.jpg
2025-04-08 23:14:09,653 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 23:14:09,747 - app - INFO - Сообщение для группы 13953145984647826 обновлено
2025-04-08 23:14:09,748 - aiogram.event - INFO - Update id=311268224 is handled. Duration 253 ms by bot id=7041366449
2025-04-08 23:14:11,504 - aiogram.event - INFO - Update id=311268225 is handled. Duration 171 ms by bot id=7041366449
2025-04-08 23:14:13,256 - aiogram.event - INFO - Update id=311268226 is handled. Duration 285 ms by bot id=7041366449
2025-04-08 23:14:16,123 - aiogram.event - INFO - Update id=311268227 is handled. Duration 387 ms by bot id=7041366449
2025-04-08 23:14:20,826 - aiogram.event - INFO - Update id=311268228 is handled. Duration 277 ms by bot id=7041366449
2025-04-08 23:14:23,156 - aiogram.event - INFO - Update id=311268229 is handled. Duration 355 ms by bot id=7041366449
2025-04-08 23:14:34,188 - aiogram.event - INFO - Update id=311268230 is handled. Duration 391 ms by bot id=7041366449
2025-04-08 23:14:36,594 - aiogram.event - INFO - Update id=311268231 is handled. Duration 276 ms by bot id=7041366449
2025-04-08 23:14:39,101 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:14:39,251 - aiogram.event - INFO - Update id=311268232 is handled. Duration 366 ms by bot id=7041366449
2025-04-08 23:14:44,892 - aiogram.event - INFO - Update id=311268233 is handled. Duration 176 ms by bot id=7041366449
2025-04-08 23:14:47,979 - aiogram.event - INFO - Update id=311268234 is handled. Duration 192 ms by bot id=7041366449
2025-04-08 23:14:52,985 - aiogram.event - INFO - Update id=311268235 is handled. Duration 181 ms by bot id=7041366449
2025-04-08 23:14:59,083 - aiogram.event - INFO - Update id=311268236 is handled. Duration 225 ms by bot id=7041366449
2025-04-08 23:15:01,599 - aiogram.event - INFO - Update id=311268237 is handled. Duration 182 ms by bot id=7041366449
2025-04-08 23:15:03,835 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:15:03,949 - aiogram.event - INFO - Update id=311268238 is handled. Duration 310 ms by bot id=7041366449
2025-04-08 23:15:11,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:15:11,937 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-08 23:15:11,937 - sqlalchemy.engine.Engine - INFO - [cached since 258.1s ago] (1043270764,)
2025-04-08 23:15:11,940 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:15:12,044 - aiogram.event - INFO - Update id=311268239 is handled. Duration 110 ms by bot id=7041366449
2025-04-08 23:21:11,162 - __main__ - INFO - Stopping application...
2025-04-08 23:21:11,639 - __main__ - INFO - Application stopped
2025-04-08 23:21:15,346 - app - INFO - Starting application...
2025-04-08 23:21:15,346 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:21:15,346 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:21:15,346 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:21:15,755 - __main__ - INFO - Application started successfully
2025-04-08 23:21:15,757 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:21:17,715 - aiogram.event - INFO - Update id=311268240 is handled. Duration 273 ms by bot id=7041366449
2025-04-08 23:21:19,428 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:21:19,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,429 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:21:19,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:21:19,431 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 23:21:19,432 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:19,585 - aiogram.event - INFO - Update id=311268241 is handled. Duration 301 ms by bot id=7041366449
2025-04-08 23:21:20,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:20,856 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:21:20,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-04-08 23:21:20,861 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:21,006 - aiogram.event - INFO - Update id=311268242 is handled. Duration 287 ms by bot id=7041366449
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:21:21,991 - sqlalchemy.engine.Engine - INFO - [cached since 1.135s ago] ()
2025-04-08 23:21:21,992 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:22,187 - aiogram.event - INFO - Update id=311268243 is handled. Duration 199 ms by bot id=7041366449
2025-04-08 23:21:23,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:21:23,557 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:21:23,558 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] ('Электроника',)
2025-04-08 23:21:23,564 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:21:23,667 - aiogram.event - INFO - Update id=311268244 is handled. Duration 206 ms by bot id=7041366449
2025-04-08 23:21:29,336 - aiogram.event - INFO - Update id=311268245 is handled. Duration 220 ms by bot id=7041366449
2025-04-08 23:21:31,678 - aiogram.event - INFO - Update id=311268246 is handled. Duration 205 ms by bot id=7041366449
2025-04-08 23:21:34,270 - aiogram.event - INFO - Update id=311268247 is handled. Duration 185 ms by bot id=7041366449
2025-04-08 23:21:37,601 - aiogram.event - INFO - Update id=311268248 is handled. Duration 292 ms by bot id=7041366449
2025-04-08 23:21:40,896 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:21:40,896 - app - INFO - Является частью группы: False
2025-04-08 23:21:41,301 - root - INFO - File saved: 2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg
2025-04-08 23:21:41,301 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:21:41,404 - app - INFO - Отправлено сообщение для одиночного фото
2025-04-08 23:21:41,407 - aiogram.event - INFO - Update id=311268249 is handled. Duration 515 ms by bot id=7041366449
2025-04-08 23:21:43,255 - aiogram.event - INFO - Update id=311268250 is handled. Duration 211 ms by bot id=7041366449
2025-04-08 23:21:47,727 - aiogram.event - INFO - Update id=311268251 is handled. Duration 279 ms by bot id=7041366449
2025-04-08 23:21:50,050 - aiogram.event - INFO - Update id=311268252 is handled. Duration 352 ms by bot id=7041366449
2025-04-08 23:21:55,107 - aiogram.event - INFO - Update id=311268253 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 23:21:56,719 - aiogram.event - INFO - Update id=311268254 is handled. Duration 259 ms by bot id=7041366449
2025-04-08 23:21:57,179 - root - ERROR - Error editing message: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-08 23:21:57,300 - aiogram.event - INFO - Update id=311268255 is handled. Duration 317 ms by bot id=7041366449
2025-04-08 23:22:02,999 - aiogram.event - INFO - Update id=311268256 is handled. Duration 187 ms by bot id=7041366449
2025-04-08 23:22:04,550 - aiogram.event - INFO - Update id=311268257 is handled. Duration 508 ms by bot id=7041366449
2025-04-08 23:22:08,702 - aiogram.event - INFO - Update id=311268258 is handled. Duration 261 ms by bot id=7041366449
2025-04-08 23:22:11,284 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:22:11,504 - aiogram.event - INFO - Update id=311268259 is handled. Duration 569 ms by bot id=7041366449
2025-04-08 23:22:15,777 - aiogram.event - INFO - Update id=311268260 is handled. Duration 202 ms by bot id=7041366449
2025-04-08 23:22:17,839 - aiogram.event - INFO - Update id=311268261 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 23:22:21,418 - aiogram.event - INFO - Update id=311268262 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:22:22,906 - aiogram.event - INFO - Update id=311268263 is handled. Duration 184 ms by bot id=7041366449
2025-04-08 23:22:25,230 - aiogram.event - INFO - Update id=311268264 is handled. Duration 192 ms by bot id=7041366449
2025-04-08 23:22:28,434 - aiogram.event - INFO - Update id=311268265 is handled. Duration 206 ms by bot id=7041366449
2025-04-08 23:22:29,858 - aiogram.event - INFO - Update id=311268266 is handled. Duration 213 ms by bot id=7041366449
2025-04-08 23:22:31,876 - aiogram.event - INFO - Update id=311268267 is handled. Duration 183 ms by bot id=7041366449
2025-04-08 23:22:41,670 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 23:22:41,670 - app - INFO - ID пользователя: 1043270764
2025-04-08 23:22:41,670 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 23:22:41,670 - app - INFO - После проверки осталось 1 корректных фотографий
2025-04-08 23:22:41,670 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 23:22:41,670 - root - INFO - Данные: company_name=Тататп, product_name=Алалаьпд, category_id=2
2025-04-08 23:22:41,670 - root - INFO - Фотографии: 1 шт.
2025-04-08 23:22:41,670 - root - INFO - Видео: False
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 23:22:41,671 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('Тататп', 'Алалаьпд', 2, 'Оалаьпдадал аладал', None, None, None, None, '79267091083', None, 1043270764)
2025-04-08 23:22:41,673 - root - INFO - Поставщик создан с ID: 7
2025-04-08 23:22:41,673 - root - INFO - Начинаю сохранение 1 фотографий
2025-04-08 23:22:41,673 - root - INFO - Сохраняю фото 1/1: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 23:22:41,673 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=7
2025-04-08 23:22:41,673 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 7}
2025-04-08 23:22:41,674 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:22:41,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/08/a1e2b0ee32764a00b6d579e2a0c5a330.jpg', 'photo_1.jpg', None, 7)
2025-04-08 23:22:41,675 - root - INFO - Файл сохранен с ID: 17
2025-04-08 23:22:41,675 - root - INFO - Фото 1 сохранено с ID: 17
2025-04-08 23:22:41,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 23:22:41,676 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 23:22:41,676 - app - INFO - Поставщик успешно создан с ID: 7
2025-04-08 23:22:42,033 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 23:22:42,034 - aiogram.event - INFO - Update id=311268268 is handled. Duration 511 ms by bot id=7041366449
2025-04-08 23:31:39,006 - __main__ - INFO - Stopping application...
2025-04-08 23:31:39,459 - __main__ - INFO - Application stopped
2025-04-08 23:31:43,164 - app - INFO - Starting application...
2025-04-08 23:31:43,164 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-08 23:31:43,164 - __main__ - INFO - Action config initialized successfully
2025-04-08 23:31:43,164 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-08 23:31:43,547 - __main__ - INFO - Application started successfully
2025-04-08 23:31:43,548 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-08 23:31:45,642 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-08 23:31:45,642 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,643 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-08 23:31:45,643 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,644 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-08 23:31:45,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-08 23:31:45,645 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-08 23:31:45,646 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:45,743 - aiogram.event - INFO - Update id=311268269 is handled. Duration 278 ms by bot id=7041366449
2025-04-08 23:31:48,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:48,598 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-08 23:31:48,599 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ()
2025-04-08 23:31:48,604 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:48,754 - aiogram.event - INFO - Update id=311268270 is handled. Duration 249 ms by bot id=7041366449
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-08 23:31:52,050 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('Ювелирные изделия и украшения',)
2025-04-08 23:31:52,052 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-08 23:31:52,147 - aiogram.event - INFO - Update id=311268271 is handled. Duration 188 ms by bot id=7041366449
2025-04-08 23:31:54,630 - aiogram.event - INFO - Update id=311268272 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:31:59,338 - aiogram.event - INFO - Update id=311268273 is handled. Duration 180 ms by bot id=7041366449
2025-04-08 23:32:02,867 - aiogram.event - INFO - Update id=311268274 is handled. Duration 179 ms by bot id=7041366449
2025-04-08 23:32:05,634 - aiogram.event - INFO - Update id=311268275 is handled. Duration 1022 ms by bot id=7041366449
2025-04-08 23:32:10,234 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-08 23:32:10,234 - app - INFO - Является частью группы: True
2025-04-08 23:32:10,234 - app - INFO - Добавлено фото в группу 13953154640356610, всего фото в группе: 1
2025-04-08 23:32:10,626 - root - INFO - File saved: 2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg
2025-04-08 23:32:10,626 - app - INFO - Фото сохранено, всего фото: 1
2025-04-08 23:32:10,725 - app - INFO - Создано новое сообщение для группы 13953154640356610
2025-04-08 23:32:10,726 - aiogram.event - INFO - Update id=311268276 is handled. Duration 502 ms by bot id=7041366449
2025-04-08 23:32:10,990 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE, размер=576x1280
2025-04-08 23:32:10,991 - app - INFO - Является частью группы: True
2025-04-08 23:32:10,991 - app - INFO - Добавлено фото в группу 13953154640356610, всего фото в группе: 2
2025-04-08 23:32:11,131 - root - INFO - File saved: 2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg
2025-04-08 23:32:11,132 - app - INFO - Фото сохранено, всего фото: 2
2025-04-08 23:32:11,221 - app - INFO - Сообщение для группы 13953154640356610 обновлено
2025-04-08 23:32:11,222 - aiogram.event - INFO - Update id=311268277 is handled. Duration 242 ms by bot id=7041366449
2025-04-08 23:32:13,186 - aiogram.event - INFO - Update id=311268278 is handled. Duration 174 ms by bot id=7041366449
2025-04-08 23:32:18,300 - aiogram.event - INFO - Update id=311268279 is handled. Duration 334 ms by bot id=7041366449
2025-04-08 23:33:41,990 - aiogram.event - INFO - Update id=311268280 is handled. Duration 707 ms by bot id=7041366449
2025-04-08 23:33:46,943 - aiogram.event - INFO - Update id=311268281 is handled. Duration 244 ms by bot id=7041366449
2025-04-08 23:33:48,718 - aiogram.event - INFO - Update id=311268282 is handled. Duration 178 ms by bot id=7041366449
2025-04-08 23:33:56,406 - aiogram.event - INFO - Update id=311268283 is handled. Duration 167 ms by bot id=7041366449
2025-04-08 23:34:04,086 - aiogram.event - INFO - Update id=311268284 is handled. Duration 167 ms by bot id=7041366449
2025-04-08 23:34:15,724 - aiogram.event - INFO - Update id=311268285 is handled. Duration 334 ms by bot id=7041366449
2025-04-08 23:34:26,412 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-08 23:34:26,498 - aiogram.event - INFO - Update id=311268286 is handled. Duration 253 ms by bot id=7041366449
2025-04-08 23:34:34,680 - aiogram.event - INFO - Update id=311268287 is handled. Duration 345 ms by bot id=7041366449
2025-04-08 23:34:56,906 - app - INFO - === Подтверждение создания поставщика ===
2025-04-08 23:34:56,907 - app - INFO - ID пользователя: 1043270764
2025-04-08 23:34:56,907 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-08 23:34:56,908 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-08 23:34:56,908 - root - INFO - === Начало сохранения поставщика ===
2025-04-08 23:34:56,908 - root - INFO - Данные: company_name=Оалалп, product_name=Шулкла, category_id=98
2025-04-08 23:34:56,909 - root - INFO - Фотографии: 2 шт.
2025-04-08 23:34:56,909 - root - INFO - Видео: False
2025-04-08 23:34:56,910 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-08 23:34:56,912 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_phone, 
                    contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11
                )
                RETURNING id
            
2025-04-08 23:34:56,912 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ('Оалалп', 'Шулкла', 98, 'Оалвла алалала аладад', None, None, None, None, '+79267091083', None, 1043270764)
2025-04-08 23:34:56,918 - root - INFO - Поставщик создан с ID: 8
2025-04-08 23:34:56,918 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-08 23:34:56,919 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-08 23:34:56,919 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=8
2025-04-08 23:34:56,919 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 8}
2025-04-08 23:34:56,919 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:34:56,919 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('photo', '2025/04/08/d143d9c684bb4bb5847b678eef1c61b9.jpg', 'photo_1.jpg', None, 8)
2025-04-08 23:34:56,921 - root - INFO - Файл сохранен с ID: 18
2025-04-08 23:34:56,921 - root - INFO - Фото 1 сохранено с ID: 18
2025-04-08 23:34:56,921 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxln9RKoJ1R1F4hvuNPWs8-HmaqAegACnPYxG2fgqEv8xdsaisDfGwEAAwIAA3kAAzYE
2025-04-08 23:34:56,921 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=8
2025-04-08 23:34:56,921 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 8}
2025-04-08 23:34:56,921 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-08 23:34:56,921 - sqlalchemy.engine.Engine - INFO - [cached since 0.002391s ago] ('photo', '2025/04/08/9c5983aa7fc8402e97c9695c5f36ffb0.jpg', 'photo_2.jpg', None, 8)
2025-04-08 23:34:56,923 - root - INFO - Файл сохранен с ID: 19
2025-04-08 23:34:56,923 - root - INFO - Фото 2 сохранено с ID: 19
2025-04-08 23:34:56,923 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-08 23:34:56,924 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-08 23:34:56,924 - app - INFO - Поставщик успешно создан с ID: 8
2025-04-08 23:34:57,214 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-08 23:34:57,215 - aiogram.event - INFO - Update id=311268288 is handled. Duration 558 ms by bot id=7041366449
2025-04-09 00:09:07,839 - __main__ - INFO - Stopping application...
2025-04-09 00:09:08,247 - __main__ - INFO - Application stopped
2025-04-09 00:09:12,616 - app - INFO - Starting application...
2025-04-09 00:09:12,616 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:09:12,616 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:09:12,616 - __main__ - INFO - Setting webhook at: https://fe69-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:09:12,889 - __main__ - INFO - Application started successfully
2025-04-09 00:09:12,890 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:09:39,768 - __main__ - INFO - Stopping application...
2025-04-09 00:09:40,484 - __main__ - INFO - Application stopped
2025-04-09 00:09:44,433 - app - INFO - Starting application...
2025-04-09 00:09:44,433 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:09:44,433 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:09:44,433 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:09:44,851 - __main__ - INFO - Application started successfully
2025-04-09 00:09:44,853 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:09:45,042 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 00:09:45,042 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,043 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 00:09:45,043 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,044 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 00:09:45,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:09:45,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:09:45,045 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 00:09:45,046 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 00:09:45,046 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:09:45,192 - aiogram.event - INFO - Update id=311268289 is handled. Duration 191 ms by bot id=7041366449
2025-04-09 00:10:01,913 - __main__ - INFO - Stopping application...
2025-04-09 00:10:02,634 - __main__ - INFO - Application stopped
2025-04-09 00:10:06,268 - app - INFO - Starting application...
2025-04-09 00:10:06,268 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:10:06,268 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:10:06,268 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:10:06,680 - __main__ - INFO - Application started successfully
2025-04-09 00:10:06,681 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:12:18,017 - __main__ - INFO - Stopping application...
2025-04-09 00:12:18,721 - __main__ - INFO - Application stopped
2025-04-09 00:12:22,282 - app - INFO - Starting application...
2025-04-09 00:12:22,282 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:12:22,282 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:12:22,282 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:12:22,688 - __main__ - INFO - Application started successfully
2025-04-09 00:12:22,689 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:16:51,457 - __main__ - INFO - Stopping application...
2025-04-09 00:16:52,172 - __main__ - INFO - Application stopped
2025-04-09 00:19:49,106 - app - INFO - Starting application...
2025-04-09 00:19:49,106 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 00:19:49,106 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:19:49,106 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:19:49,528 - __main__ - INFO - Application started successfully
2025-04-09 00:19:49,529 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:20:30,418 - __main__ - INFO - Stopping application...
2025-04-09 00:20:31,122 - __main__ - INFO - Application stopped
2025-04-09 00:20:48,476 - app - INFO - Starting application...
2025-04-09 00:20:48,476 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 00:20:48,477 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 00:20:48,477 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 00:20:48,507 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 00:20:48,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,509 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 00:20:48,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,511 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 00:20:48,511 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 00:20:48,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,513 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 00:20:48,513 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 00:20:48,514 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,515 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 00:20:48,515 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 00:20:48,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,516 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 00:20:48,517 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ()
2025-04-09 00:20:48,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,518 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 00:20:48,519 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 00:20:48,519 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,522 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,534 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 00:20:48,535 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 00:20:48,535 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 00:20:48,538 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,539 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 00:20:48,539 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 00:20:48,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,540 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 00:20:48,540 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 00:20:48,542 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,543 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 00:20:48,544 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 00:20:48,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,544 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 00:20:48,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,549 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 00:20:48,550 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 00:20:48,550 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,551 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 00:20:48,551 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 00:20:48,554 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,556 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 00:20:48,556 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 00:20:48,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,557 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 00:20:48,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,560 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,563 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 00:20:48,563 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 00:20:48,563 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,564 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 00:20:48,564 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 00:20:48,566 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,569 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 00:20:48,569 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 00:20:48,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,570 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 00:20:48,570 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 00:20:48,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,575 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 00:20:48,575 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 00:20:48,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,576 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 00:20:48,576 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 00:20:48,579 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,581 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 00:20:48,581 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 00:20:48,581 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 00:20:48,583 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,585 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 00:20:48,586 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 00:20:48,586 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 00:20:48,586 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,587 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 00:20:48,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 00:20:48,590 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,591 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 00:20:48,591 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 00:20:48,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,593 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 00:20:48,593 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 00:20:48,597 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,598 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 00:20:48,598 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 00:20:48,598 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,603 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,604 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 00:20:48,604 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 00:20:48,605 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 00:20:48,610 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,611 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 00:20:48,611 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 00:20:48,612 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,617 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 00:20:48,617 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 00:20:48,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,618 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 00:20:48,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 00:20:48,622 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,623 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 00:20:48,623 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 00:20:48,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,623 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 00:20:48,624 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,628 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,629 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 00:20:48,629 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 00:20:48,629 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,630 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 00:20:48,630 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 00:20:48,635 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,636 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 00:20:48,636 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 00:20:48,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,636 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 00:20:48,637 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,641 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,642 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 00:20:48,642 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 00:20:48,643 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 00:20:48,646 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,647 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 00:20:48,647 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 00:20:48,647 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 00:20:48,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,648 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 00:20:48,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 00:20:48,654 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,654 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 00:20:48,655 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 00:20:48,655 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 00:20:48,655 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,656 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 00:20:48,656 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 00:20:48,660 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,661 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 00:20:48,661 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 00:20:48,661 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 00:20:48,662 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,669 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,672 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 00:20:48,673 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 00:20:48,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,673 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 00:20:48,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 00:20:48,679 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,681 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 00:20:48,681 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 00:20:48,682 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,685 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,686 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 00:20:48,686 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 00:20:48,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,686 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 00:20:48,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ()
2025-04-09 00:20:48,689 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,690 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 00:20:48,690 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 00:20:48,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,691 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 00:20:48,692 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 00:20:48,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,694 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 00:20:48,694 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 00:20:48,694 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,695 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,696 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 00:20:48,696 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 00:20:48,696 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,697 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,698 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 00:20:48,698 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,698 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,699 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 00:20:48,699 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,701 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,702 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 00:20:48,702 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 00:20:48,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,703 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 00:20:48,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,706 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 00:20:48,706 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 00:20:48,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 00:20:48,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,710 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 00:20:48,710 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 00:20:48,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,710 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 00:20:48,711 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 00:20:48,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,712 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 00:20:48,713 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 00:20:48,713 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,714 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,715 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 00:20:48,715 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,715 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,715 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 00:20:48,716 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 00:20:48,718 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,719 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 00:20:48,719 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 00:20:48,719 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,720 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 00:20:48,720 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 00:20:48,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,723 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 00:20:48,724 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 00:20:48,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,725 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 00:20:48,725 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 00:20:48,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,727 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 00:20:48,727 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 00:20:48,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 00:20:48,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,730 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 00:20:48,730 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 00:20:48,730 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 00:20:48,731 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,732 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 00:20:48,732 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 00:20:48,732 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,733 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 00:20:48,734 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ()
2025-04-09 00:20:48,735 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,736 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 00:20:48,736 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 00:20:48,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,737 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 00:20:48,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 00:20:48,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,739 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 00:20:48,740 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,741 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 00:20:48,741 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ()
2025-04-09 00:20:48,743 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,743 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 00:20:48,743 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 00:20:48,744 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 00:20:48,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,746 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 00:20:48,746 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 00:20:48,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,747 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 00:20:48,747 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ()
2025-04-09 00:20:48,748 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,748 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 00:20:48,748 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,750 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 00:20:48,750 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] ()
2025-04-09 00:20:48,752 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,753 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 00:20:48,753 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 00:20:48,753 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,754 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 00:20:48,754 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 00:20:48,756 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,757 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 00:20:48,758 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 00:20:48,758 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,759 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 00:20:48,759 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 00:20:48,761 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,761 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 00:20:48,762 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 00:20:48,762 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 00:20:48,764 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:20:48,764 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 00:20:48,764 - app.services.database - INFO - Database initialization completed
2025-04-09 00:20:48,764 - __main__ - INFO - Action config initialized successfully
2025-04-09 00:20:48,764 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 00:20:49,159 - __main__ - INFO - Application started successfully
2025-04-09 00:20:49,160 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 00:21:00,013 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:00,014 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 00:21:00,014 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (1043270764,)
2025-04-09 00:21:00,015 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:21:00,317 - aiogram.event - INFO - Update id=311268290 is handled. Duration 304 ms by bot id=7041366449
2025-04-09 00:21:16,159 - aiogram.event - INFO - Update id=311268291 is handled. Duration 481 ms by bot id=7041366449
2025-04-09 00:21:23,277 - aiogram.event - INFO - Update id=311268292 is handled. Duration 226 ms by bot id=7041366449
2025-04-09 00:21:38,563 - aiogram.event - INFO - Update id=311268293 is handled. Duration 228 ms by bot id=7041366449
2025-04-09 00:21:42,064 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 00:21:42,162 - aiogram.event - INFO - Update id=311268294 is handled. Duration 370 ms by bot id=7041366449
2025-04-09 00:21:44,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:44,628 - sqlalchemy.engine.Engine - INFO - 
            INSERT INTO users (tg_id, username, first_name, last_name, email, phone, created_at)
            VALUES ($1, $2, $3, $4, $5, $6, NOW())
            ON CONFLICT (tg_id) DO UPDATE
            SET username = $2, 
                first_name = $3, 
                last_name = $4,
                email = COALESCE($5, users.email),
                phone = COALESCE($6, users.phone)
        
2025-04-09 00:21:44,628 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764, '@egormeisters', 'Егор', 'Смирнов', 'bot@egormeister.ru', '+79267091083')
2025-04-09 00:21:44,629 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:21:44,629 - root - INFO - User saved: 1043270764, @egormeisters, email: bot@egormeister.ru, phone: +79267091083
2025-04-09 00:21:44,814 - aiogram.event - INFO - Update id=311268295 is handled. Duration 266 ms by bot id=7041366449
2025-04-09 00:21:47,439 - aiogram.event - INFO - Update id=311268296 is handled. Duration 213 ms by bot id=7041366449
2025-04-09 00:21:49,457 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:21:49,458 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 00:21:49,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] (1043270764,)
2025-04-09 00:21:49,463 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:21:49,575 - aiogram.event - INFO - Update id=311268297 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 00:22:07,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:22:07,532 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 00:22:07,533 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ()
2025-04-09 00:22:07,538 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:22:07,674 - aiogram.event - INFO - Update id=311268298 is handled. Duration 668 ms by bot id=7041366449
2025-04-09 00:22:09,875 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:22:09,876 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 00:22:09,877 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ('Автотовары',)
2025-04-09 00:22:09,881 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 00:22:10,000 - aiogram.event - INFO - Update id=311268299 is handled. Duration 215 ms by bot id=7041366449
2025-04-09 00:22:11,160 - aiogram.event - INFO - Update id=311268300 is handled. Duration 246 ms by bot id=7041366449
2025-04-09 00:22:15,600 - aiogram.event - INFO - Update id=311268301 is handled. Duration 221 ms by bot id=7041366449
2025-04-09 00:22:19,582 - aiogram.event - INFO - Update id=311268302 is handled. Duration 309 ms by bot id=7041366449
2025-04-09 00:22:36,783 - aiogram.event - INFO - Update id=311268303 is handled. Duration 307 ms by bot id=7041366449
2025-04-09 00:23:50,441 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 00:23:50,442 - app - INFO - Является частью группы: True
2025-04-09 00:23:50,442 - app - INFO - Добавлено фото в группу 13953179440781378, всего фото в группе: 1
2025-04-09 00:23:51,190 - root - INFO - File saved: 2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg
2025-04-09 00:23:51,190 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 00:23:51,281 - app - INFO - Создано новое сообщение для группы 13953179440781378
2025-04-09 00:23:51,282 - aiogram.event - INFO - Update id=311268304 is handled. Duration 841 ms by bot id=7041366449
2025-04-09 00:23:51,555 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 00:23:51,555 - app - INFO - Является частью группы: True
2025-04-09 00:23:51,556 - app - INFO - Добавлено фото в группу 13953179440781378, всего фото в группе: 2
2025-04-09 00:23:51,913 - root - INFO - File saved: 2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg
2025-04-09 00:23:51,913 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 00:23:52,037 - app - INFO - Сообщение для группы 13953179440781378 обновлено
2025-04-09 00:23:52,038 - aiogram.event - INFO - Update id=311268305 is handled. Duration 495 ms by bot id=7041366449
2025-04-09 00:23:53,954 - aiogram.event - INFO - Update id=311268306 is handled. Duration 163 ms by bot id=7041366449
2025-04-09 00:23:59,599 - aiogram.event - INFO - Update id=311268307 is handled. Duration 174 ms by bot id=7041366449
2025-04-09 00:24:02,634 - aiogram.event - INFO - Update id=311268308 is handled. Duration 897 ms by bot id=7041366449
2025-04-09 00:24:06,715 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 00:24:06,807 - aiogram.event - INFO - Update id=311268309 is handled. Duration 420 ms by bot id=7041366449
2025-04-09 00:24:19,265 - aiogram.event - INFO - Update id=311268310 is handled. Duration 188 ms by bot id=7041366449
2025-04-09 00:24:25,007 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 00:24:25,007 - app - INFO - ID пользователя: 1043270764
2025-04-09 00:24:25,007 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 00:24:25,008 - app - INFO - После проверки осталось 2 корректных фотографий
2025-04-09 00:24:25,008 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 00:24:25,008 - root - INFO - Данные: company_name=поставляю, product_name=хуйню, category_id=58
2025-04-09 00:24:25,009 - root - INFO - Фотографии: 2 шт.
2025-04-09 00:24:25,009 - root - INFO - Видео: False
2025-04-09 00:24:25,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 00:24:25,011 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 00:24:25,012 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('поставляю', 'хуйню', 58, 'высшего сорта', 'Россия', 'Москва', 'Москва', None, '@egormeisters', '+79267091083', '2@egormeister.ru', 1043270764)
2025-04-09 00:24:25,018 - root - INFO - Поставщик создан с ID: 1
2025-04-09 00:24:25,019 - root - INFO - Начинаю сохранение 2 фотографий
2025-04-09 00:24:25,019 - root - INFO - Сохраняю фото 1/2: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-09 00:24:25,019 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=1
2025-04-09 00:24:25,019 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 00:24:25,021 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 00:24:25,021 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('photo', '2025/04/09/7193209fb7464a35b9b5c03fd733e6ef.jpg', 'photo_1.jpg', None, 1)
2025-04-09 00:24:25,026 - root - INFO - Файл сохранен с ID: 1
2025-04-09 00:24:25,027 - root - INFO - Фото 1 сохранено с ID: 1
2025-04-09 00:24:25,027 - root - INFO - Сохраняю фото 2/2: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-09 00:24:25,028 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=1
2025-04-09 00:24:25,028 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 00:24:25,029 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 00:24:25,030 - sqlalchemy.engine.Engine - INFO - [cached since 0.008977s ago] ('photo', '2025/04/09/288664aaf5fb4aeaaf5bc058fdc2fb10.jpg', 'photo_2.jpg', None, 1)
2025-04-09 00:24:25,032 - root - INFO - Файл сохранен с ID: 2
2025-04-09 00:24:25,033 - root - INFO - Фото 2 сохранено с ID: 2
2025-04-09 00:24:25,033 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 00:24:25,035 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 00:24:25,036 - app - INFO - Поставщик успешно создан с ID: 1
2025-04-09 00:24:25,304 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 00:24:25,304 - aiogram.event - INFO - Update id=311268311 is handled. Duration 381 ms by bot id=7041366449
2025-04-09 01:41:48,793 - __main__ - INFO - Stopping application...
2025-04-09 01:41:49,256 - __main__ - INFO - Application stopped
2025-04-09 01:41:53,456 - app - INFO - Starting application...
2025-04-09 01:41:53,456 - app.services.database - ERROR - Error initializing database: 'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'
2025-04-09 01:41:53,457 - app.services.database - ERROR - Exception type: AttributeError
2025-04-09 01:41:53,457 - app.services.database - ERROR - Full exception: AttributeError("'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'")
2025-04-09 01:41:53,457 - __main__ - ERROR - Failed to initialize database. Shutting down.
2025-04-09 01:41:53,457 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:41:53,457 - __main__ - INFO - Stopping application...
2025-04-09 01:41:53,956 - __main__ - INFO - Application stopped
2025-04-09 01:43:49,395 - app - INFO - Starting application...
2025-04-09 01:43:49,395 - app.services.database - ERROR - Error initializing database: 'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'
2025-04-09 01:43:49,395 - app.services.database - ERROR - Exception type: AttributeError
2025-04-09 01:43:49,395 - app.services.database - ERROR - Full exception: AttributeError("'LocalConfig' object has no attribute 'RECREATE_DB_SCHEMA'")
2025-04-09 01:43:49,395 - __main__ - ERROR - Failed to initialize database. Shutting down.
2025-04-09 01:43:49,396 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:43:49,396 - __main__ - INFO - Stopping application...
2025-04-09 01:43:49,855 - __main__ - INFO - Application stopped
2025-04-09 01:45:56,551 - app - INFO - Starting application...
2025-04-09 01:45:56,552 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 01:45:56,552 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 01:45:56,552 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 01:45:56,586 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 01:45:56,586 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,588 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 01:45:56,588 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,589 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 01:45:56,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:45:56,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,591 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 01:45:56,591 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:45:56,593 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,594 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 01:45:56,594 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 01:45:56,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,595 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 01:45:56,595 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 01:45:56,596 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,596 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 01:45:56,597 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 01:45:56,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:45:56,599 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,600 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 01:45:56,600 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 01:45:56,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,601 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 01:45:56,601 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-04-09 01:45:56,602 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,603 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 01:45:56,603 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 01:45:56,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,604 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 01:45:56,604 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:45:56,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,608 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 01:45:56,609 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 01:45:56,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,609 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 01:45:56,610 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,613 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,616 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 01:45:56,616 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 01:45:56,616 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,617 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 01:45:56,617 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,620 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,621 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 01:45:56,621 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 01:45:56,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,622 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 01:45:56,622 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:45:56,624 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,625 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 01:45:56,626 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 01:45:56,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,627 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 01:45:56,628 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 01:45:56,630 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,633 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 01:45:56,633 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 01:45:56,633 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,634 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 01:45:56,634 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 01:45:56,636 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,638 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 01:45:56,638 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 01:45:56,638 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:45:56,640 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,641 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 01:45:56,641 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 01:45:56,642 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,643 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 01:45:56,644 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-04-09 01:45:56,645 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,647 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 01:45:56,647 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 01:45:56,647 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 01:45:56,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,652 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 01:45:56,652 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 01:45:56,653 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,657 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,657 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 01:45:56,658 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 01:45:56,658 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:45:56,664 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,665 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 01:45:56,665 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 01:45:56,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,666 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:45:56,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ()
2025-04-09 01:45:56,671 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,671 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 01:45:56,671 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 01:45:56,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,672 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:45:56,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,675 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,677 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 01:45:56,677 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 01:45:56,677 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,678 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:45:56,678 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 01:45:56,682 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,683 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 01:45:56,684 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 01:45:56,684 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:45:56,688 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,688 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 01:45:56,688 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:45:56,689 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,694 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 01:45:56,695 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 01:45:56,695 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,701 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 01:45:56,701 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 01:45:56,702 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,706 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 01:45:56,706 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 01:45:56,706 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 01:45:56,706 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,707 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 01:45:56,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,710 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,711 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 01:45:56,711 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 01:45:56,711 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 01:45:56,712 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:45:56,716 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,717 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 01:45:56,717 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 01:45:56,717 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 01:45:56,718 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,726 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 01:45:56,727 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 01:45:56,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,727 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 01:45:56,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,734 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,736 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 01:45:56,736 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 01:45:56,736 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,737 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 01:45:56,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:45:56,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,738 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 01:45:56,739 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 01:45:56,739 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:45:56,741 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,741 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 01:45:56,741 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:45:56,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,742 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 01:45:56,743 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ()
2025-04-09 01:45:56,745 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,745 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 01:45:56,746 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 01:45:56,746 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ()
2025-04-09 01:45:56,748 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,748 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 01:45:56,748 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 01:45:56,749 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:45:56,751 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,751 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 01:45:56,752 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,753 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 01:45:56,753 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 01:45:56,754 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,755 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 01:45:56,755 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 01:45:56,755 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,756 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 01:45:56,756 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:45:56,757 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,758 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 01:45:56,758 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 01:45:56,758 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,759 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 01:45:56,760 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ()
2025-04-09 01:45:56,762 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,763 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 01:45:56,763 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:45:56,763 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,763 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 01:45:56,764 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ()
2025-04-09 01:45:56,766 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,766 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 01:45:56,766 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 01:45:56,767 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,769 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,770 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 01:45:56,770 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 01:45:56,770 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,771 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,772 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 01:45:56,772 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 01:45:56,772 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:45:56,773 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,774 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 01:45:56,774 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 01:45:56,774 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:45:56,777 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,778 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 01:45:56,778 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,779 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 01:45:56,779 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ()
2025-04-09 01:45:56,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,781 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 01:45:56,782 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:45:56,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,782 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 01:45:56,783 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:45:56,784 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,785 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 01:45:56,785 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 01:45:56,785 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,786 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 01:45:56,786 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,787 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,787 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 01:45:56,787 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 01:45:56,788 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:45:56,789 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,789 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 01:45:56,789 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 01:45:56,790 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 01:45:56,791 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,792 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 01:45:56,792 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,793 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 01:45:56,794 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-04-09 01:45:56,795 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,797 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 01:45:56,797 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 01:45:56,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,798 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 01:45:56,798 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ()
2025-04-09 01:45:56,800 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,801 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 01:45:56,801 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,802 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 01:45:56,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:45:56,803 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,803 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 01:45:56,803 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 01:45:56,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,805 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,805 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 01:45:56,805 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 01:45:56,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2025-04-09 01:45:56,808 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,808 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 01:45:56,809 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:45:56,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:45:56,811 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 01:45:56,811 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ()
2025-04-09 01:45:56,814 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:45:56,814 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 01:45:56,815 - app.services.database - INFO - Database initialization completed
2025-04-09 01:45:56,815 - __main__ - INFO - Action config initialized successfully
2025-04-09 01:45:56,815 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 01:45:57,198 - __main__ - INFO - Application started successfully
2025-04-09 01:45:57,199 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:52:54,931 - __main__ - INFO - Stopping application...
2025-04-09 01:52:55,388 - __main__ - INFO - Application stopped
2025-04-09 01:52:59,060 - app - INFO - Starting application...
2025-04-09 01:52:59,060 - app.services.database - INFO - RECREATE_DB_SCHEMA = True, начинаем инициализацию базы данных
2025-04-09 01:52:59,061 - app.services.database - INFO - Executing initialization script: 00_drop_all.sql
2025-04-09 01:52:59,061 - app.services.database - INFO - Executing query 1 from 00_drop_all.sql: -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files...
2025-04-09 01:52:59,089 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 01:52:59,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,091 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 01:52:59,092 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,093 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 01:52:59,093 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 01:52:59,094 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,095 - sqlalchemy.engine.Engine - INFO - -- Drop all triggers
DROP TRIGGER IF EXISTS delete_file_trigger ON files
2025-04-09 01:52:59,095 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ()
2025-04-09 01:52:59,097 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,097 - app.services.database - INFO - Successfully executed query 1 from 00_drop_all.sql
2025-04-09 01:52:59,097 - app.services.database - INFO - Executing query 2 from 00_drop_all.sql: -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()...
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - -- Drop all functions
DROP FUNCTION IF EXISTS delete_physical_file()
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,098 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,099 - app.services.database - INFO - Successfully executed query 2 from 00_drop_all.sql
2025-04-09 01:52:59,099 - app.services.database - INFO - Executing query 3 from 00_drop_all.sql: -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE...
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - -- Drop all tables
DROP TABLE IF EXISTS favorites CASCADE
2025-04-09 01:52:59,099 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] ()
2025-04-09 01:52:59,101 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,102 - app.services.database - INFO - Successfully executed query 3 from 00_drop_all.sql
2025-04-09 01:52:59,102 - app.services.database - INFO - Executing query 4 from 00_drop_all.sql: DROP TABLE IF EXISTS matches CASCADE...
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS matches CASCADE
2025-04-09 01:52:59,103 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,106 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,107 - app.services.database - INFO - Successfully executed query 4 from 00_drop_all.sql
2025-04-09 01:52:59,107 - app.services.database - INFO - Executing query 5 from 00_drop_all.sql: DROP TABLE IF EXISTS files CASCADE...
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS files CASCADE
2025-04-09 01:52:59,108 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,110 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,111 - app.services.database - INFO - Successfully executed query 5 from 00_drop_all.sql
2025-04-09 01:52:59,111 - app.services.database - INFO - Executing query 6 from 00_drop_all.sql: DROP TABLE IF EXISTS requests CASCADE...
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS requests CASCADE
2025-04-09 01:52:59,111 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,113 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,115 - app.services.database - INFO - Successfully executed query 6 from 00_drop_all.sql
2025-04-09 01:52:59,115 - app.services.database - INFO - Executing query 7 from 00_drop_all.sql: DROP TABLE IF EXISTS suppliers CASCADE...
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS suppliers CASCADE
2025-04-09 01:52:59,115 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-04-09 01:52:59,117 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,119 - app.services.database - INFO - Successfully executed query 7 from 00_drop_all.sql
2025-04-09 01:52:59,119 - app.services.database - INFO - Executing query 8 from 00_drop_all.sql: DROP TABLE IF EXISTS users CASCADE...
2025-04-09 01:52:59,119 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,120 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS users CASCADE
2025-04-09 01:52:59,120 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ()
2025-04-09 01:52:59,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,129 - app.services.database - INFO - Successfully executed query 8 from 00_drop_all.sql
2025-04-09 01:52:59,129 - app.services.database - INFO - Executing query 9 from 00_drop_all.sql: DROP TABLE IF EXISTS help_requests CASCADE...
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS help_requests CASCADE
2025-04-09 01:52:59,129 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ()
2025-04-09 01:52:59,131 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,132 - app.services.database - INFO - Successfully executed query 9 from 00_drop_all.sql
2025-04-09 01:52:59,132 - app.services.database - INFO - Executing query 10 from 00_drop_all.sql: DROP TABLE IF EXISTS reviews CASCADE...
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS reviews CASCADE
2025-04-09 01:52:59,132 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 01:52:59,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,136 - app.services.database - INFO - Successfully executed query 10 from 00_drop_all.sql
2025-04-09 01:52:59,136 - app.services.database - INFO - Executing query 11 from 00_drop_all.sql: DROP TABLE IF EXISTS categories CASCADE...
2025-04-09 01:52:59,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,137 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS categories CASCADE
2025-04-09 01:52:59,138 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ()
2025-04-09 01:52:59,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,143 - app.services.database - INFO - Successfully executed query 11 from 00_drop_all.sql
2025-04-09 01:52:59,143 - app.services.database - INFO - Executing query 12 from 00_drop_all.sql: DROP TABLE IF EXISTS main_categories CASCADE...
2025-04-09 01:52:59,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,144 - sqlalchemy.engine.Engine - INFO - DROP TABLE IF EXISTS main_categories CASCADE
2025-04-09 01:52:59,144 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,145 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,146 - app.services.database - INFO - Successfully executed query 12 from 00_drop_all.sql
2025-04-09 01:52:59,146 - app.services.database - INFO - Executing initialization script: 01_create_tables.sql
2025-04-09 01:52:59,147 - app.services.database - INFO - Executing query 1 from 01_create_tables.sql: -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE...
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - -- Create main_categories table
CREATE TABLE main_categories (
    name VARCHAR(255) NOT NULL UNIQUE PRIMARY KEY
)
2025-04-09 01:52:59,147 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,150 - app.services.database - INFO - Successfully executed query 1 from 01_create_tables.sql
2025-04-09 01:52:59,150 - app.services.database - INFO - Executing query 2 from 01_create_tables.sql: -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255...
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - -- Create categories table
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    main_category_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (main_category_name) REFERENCES main_categories(name)
)
2025-04-09 01:52:59,150 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,153 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,153 - app.services.database - INFO - Successfully executed query 2 from 01_create_tables.sql
2025-04-09 01:52:59,153 - app.services.database - INFO - Executing query 3 from 01_create_tables.sql: -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(25...
2025-04-09 01:52:59,153 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,154 - sqlalchemy.engine.Engine - INFO - -- Create users table
CREATE TABLE users (
    tg_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255) CHECK (username IS NULL OR username LIKE '@%'),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    phone VARCHAR(255) CHECK (phone IS NULL OR LENGTH(phone) >= 10),
    email VARCHAR(255) CHECK (email IS NULL OR email ~* '^[A-Za-z0-9._+%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$'),
    role VARCHAR(255) CHECK (role IN ('user', 'admin')) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW()
)
2025-04-09 01:52:59,154 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,158 - app.services.database - INFO - Successfully executed query 3 from 01_create_tables.sql
2025-04-09 01:52:59,158 - app.services.database - INFO - Executing query 4 from 01_create_tables.sql: -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCH...
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - -- Create suppliers table
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    company_name VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    category_id INTEGER,
    description TEXT,
    country VARCHAR(255),
    region VARCHAR(255),
    city VARCHAR(255),
    address VARCHAR(255),
    contact_username VARCHAR(255) CHECK (contact_username IS NULL OR contact_username LIKE '@%'),
    contact_phone VARCHAR(255),
    contact_email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(255) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_by_id INTEGER,
    tarrif VARCHAR(255),

    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:52:59,159 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 01:52:59,166 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,167 - app.services.database - INFO - Successfully executed query 4 from 01_create_tables.sql
2025-04-09 01:52:59,167 - app.services.database - INFO - Executing query 5 from 01_create_tables.sql: -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,...
2025-04-09 01:52:59,167 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,167 - sqlalchemy.engine.Engine - INFO - -- Create requests table
CREATE TABLE requests (
    id SERIAL PRIMARY KEY,
    category_id INTEGER,
    description TEXT,
    created_by_id INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    FOREIGN KEY (created_by_id) REFERENCES users(tg_id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
)
2025-04-09 01:52:59,168 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,170 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,171 - app.services.database - INFO - Successfully executed query 5 from 01_create_tables.sql
2025-04-09 01:52:59,171 - app.services.database - INFO - Executing query 6 from 01_create_tables.sql: -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,...
2025-04-09 01:52:59,171 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,171 - sqlalchemy.engine.Engine - INFO - -- Create files table
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    request_id INTEGER,
    supplier_id INTEGER,
    uploaded_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:52:59,172 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:52:59,176 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,177 - app.services.database - INFO - Successfully executed query 6 from 01_create_tables.sql
2025-04-09 01:52:59,177 - app.services.database - INFO - Executing query 7 from 01_create_tables.sql: -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REF...
2025-04-09 01:52:59,177 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,178 - sqlalchemy.engine.Engine - INFO - -- Create matches table
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES requests(id) NOT NULL,
    supplier_id INTEGER REFERENCES suppliers(id) NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'accepted', 'rejected')) DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
2025-04-09 01:52:59,178 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,183 - app.services.database - INFO - Successfully executed query 7 from 01_create_tables.sql
2025-04-09 01:52:59,184 - app.services.database - INFO - Executing query 8 from 01_create_tables.sql: -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
  ...
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - -- Create favorites table
CREATE TABLE favorites (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    supplier_id INTEGER,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (user_id, supplier_id),
    FOREIGN KEY (user_id) REFERENCES users(tg_id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
)
2025-04-09 01:52:59,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,187 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,187 - app.services.database - INFO - Successfully executed query 8 from 01_create_tables.sql
2025-04-09 01:52:59,187 - app.services.database - INFO - Executing query 9 from 01_create_tables.sql: -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BI...
2025-04-09 01:52:59,187 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,188 - sqlalchemy.engine.Engine - INFO - -- Create help_requests table
CREATE TABLE help_requests (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    request TEXT NOT NULL,
    status VARCHAR(50) CHECK (status IN ('pending', 'answered', 'closed')) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(tg_id)
)
2025-04-09 01:52:59,188 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ()
2025-04-09 01:52:59,192 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,193 - app.services.database - INFO - Successfully executed query 9 from 01_create_tables.sql
2025-04-09 01:52:59,193 - app.services.database - INFO - Executing query 10 from 01_create_tables.sql: -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    ...
2025-04-09 01:52:59,193 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,194 - sqlalchemy.engine.Engine - INFO - -- Create reviews table
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    match_id INTEGER,
    author_id BIGINT,
    review_id BIGINT,
    review TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (match_id) REFERENCES matches(id),
    FOREIGN KEY (author_id) REFERENCES users(tg_id),
    FOREIGN KEY (review_id) REFERENCES users(tg_id)
)
2025-04-09 01:52:59,194 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-04-09 01:52:59,200 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,201 - app.services.database - INFO - Successfully executed query 10 from 01_create_tables.sql
2025-04-09 01:52:59,201 - app.services.database - INFO - Executing initialization script: 02_create_functions.sql
2025-04-09 01:52:59,201 - app.services.database - INFO - Executing query 1 from 02_create_functions.sql: -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGE...
2025-04-09 01:52:59,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,201 - sqlalchemy.engine.Engine - INFO - -- Function to delete physical file
CREATE OR REPLACE FUNCTION delete_physical_file()
RETURNS TRIGGER AS $$
DECLARE
    storage_path TEXT := '/home/egor/projects/SupplyMatchBot/storage';full_path TEXT;result BOOLEAN;BEGIN
    -- Log what we're trying to delete
    RAISE NOTICE 'Attempting to delete file: %', OLD.file_path;-- Construct full path
    full_path := storage_path || '/' || OLD.file_path;RAISE NOTICE 'Full path to delete: %', full_path;-- Try to delete using pg_file_unlink
    BEGIN
        result := pg_catalog.pg_file_unlink(full_path);IF result THEN
            RAISE NOTICE 'Successfully deleted file: %', full_path;ELSE
            RAISE NOTICE 'Failed to delete file (returned false): %', full_path;END IF;EXCEPTION WHEN OTHERS THEN
        RAISE NOTICE 'Error deleting file %: %', full_path, SQLERRM;END;RETURN OLD;END;$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public
2025-04-09 01:52:59,202 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,204 - app.services.database - INFO - Successfully executed query 1 from 02_create_functions.sql
2025-04-09 01:52:59,204 - app.services.database - INFO - Executing initialization script: 03_create_triggers.sql
2025-04-09 01:52:59,204 - app.services.database - INFO - Executing query 1 from 03_create_triggers.sql: -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед создание...
2025-04-09 01:52:59,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,204 - sqlalchemy.engine.Engine - INFO - -- Trigger for file deletion
DO $$
BEGIN
    -- Проверяем существование таблицы files перед созданием триггера
    IF EXISTS (SELECT 1 FROM pg_tables WHERE tablename = 'files') THEN
        -- Удаляем триггер, если он уже существует
        DROP TRIGGER IF EXISTS delete_file_trigger ON files;-- Создаем триггер
        CREATE TRIGGER delete_file_trigger
            BEFORE DELETE ON files
            FOR EACH ROW
            EXECUTE FUNCTION delete_physical_file();RAISE NOTICE 'Trigger delete_file_trigger created successfully';ELSE
        RAISE NOTICE 'Table "files" does not exist, skipping trigger creation';END IF;END
$$
2025-04-09 01:52:59,205 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,207 - app.services.database - INFO - Successfully executed query 1 from 03_create_triggers.sql
2025-04-09 01:52:59,207 - app.services.database - INFO - Executing initialization script: 04_add_categoies.sql
2025-04-09 01:52:59,208 - app.services.database - INFO - Executing query 1 from 04_add_categoies.sql: -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE...
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - -- Очистка таблиц перед вставкой данных
TRUNCATE TABLE categories CASCADE
2025-04-09 01:52:59,208 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 01:52:59,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,218 - app.services.database - INFO - Successfully executed query 1 from 04_add_categoies.sql
2025-04-09 01:52:59,218 - app.services.database - INFO - Executing query 2 from 04_add_categoies.sql: TRUNCATE TABLE main_categories CASCADE...
2025-04-09 01:52:59,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,219 - sqlalchemy.engine.Engine - INFO - TRUNCATE TABLE main_categories CASCADE
2025-04-09 01:52:59,220 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-04-09 01:52:59,224 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,226 - app.services.database - INFO - Successfully executed query 2 from 04_add_categoies.sql
2025-04-09 01:52:59,226 - app.services.database - INFO - Executing query 3 from 04_add_categoies.sql: -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Б...
2025-04-09 01:52:59,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,226 - sqlalchemy.engine.Engine - INFO - -- Вставка основных категорий
INSERT INTO main_categories (name) VALUES
    ('Электроника'),
    ('Бытовая техника'),
    ('Одежда и обувь'),
    ('Красота и здоровье'),
    ('Дом и интерьер'),
    ('Продукты питания'),
    ('Спорт и отдых'),
    ('Детские товары'),
    ('Автотовары'),
    ('Книги и канцелярия'),
    ('Зоотовары'),
    ('Строительство и ремонт'),
    ('Хобби и творчество'),
    ('Цифровые товары'),
    ('Ювелирные изделия и украшения'),
    ('Товары для праздников'),
    ('Товары для бизнеса'),
    ('Товары для туризма'),
    ('Товары для здоровья'),
    ('Товары для красоты'),
    ('Строительные материалы'),
    ('Промышленное оборудование'),
    ('Услуги для бизнеса')
2025-04-09 01:52:59,227 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:52:59,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,229 - app.services.database - INFO - Successfully executed query 3 from 04_add_categoies.sql
2025-04-09 01:52:59,229 - app.services.database - INFO - Executing query 4 from 04_add_categoies.sql: -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
 ...
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Электроника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Смартфоны и гаджеты', 'Электроника'),
    ('Ноутбуки и компьютеры', 'Электроника'),
    ('Телевизоры и аудиотехника', 'Электроника'),
    ('Фото- и видеокамеры', 'Электроника'),
    ('Аксессуары для электроники', 'Электроника'),
    ('Игровые консоли и аксессуары', 'Электроника'),
    ('Умные устройства', 'Электроника'),
    ('Офисная техника', 'Электроника')
2025-04-09 01:52:59,230 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,233 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,234 - app.services.database - INFO - Successfully executed query 4 from 04_add_categoies.sql
2025-04-09 01:52:59,234 - app.services.database - INFO - Executing query 5 from 04_add_categoies.sql: -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:52:59,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,235 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Бытовая техника"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крупная бытовая техника', 'Бытовая техника'),
    ('Мелкая бытовая техника', 'Бытовая техника'),
    ('Кухонная техника', 'Бытовая техника'),
    ('Климатическая техника', 'Бытовая техника'),
    ('Водонагреватели и бойлеры', 'Бытовая техника'),
    ('Чистящая техника', 'Бытовая техника')
2025-04-09 01:52:59,236 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,237 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,238 - app.services.database - INFO - Successfully executed query 5 from 04_add_categoies.sql
2025-04-09 01:52:59,238 - app.services.database - INFO - Executing query 6 from 04_add_categoies.sql: -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,238 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,238 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Одежда и обувь"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мужская одежда', 'Одежда и обувь'),
    ('Женская одежда', 'Одежда и обувь'),
    ('Детская одежда', 'Одежда и обувь'),
    ('Обувь', 'Одежда и обувь'),
    ('Аксессуары', 'Одежда и обувь'),
    ('Нижнее белье и носки', 'Одежда и обувь'),
    ('Спортивная одежда и обувь', 'Одежда и обувь')
2025-04-09 01:52:59,239 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ()
2025-04-09 01:52:59,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,240 - app.services.database - INFO - Successfully executed query 6 from 04_add_categoies.sql
2025-04-09 01:52:59,240 - app.services.database - INFO - Executing query 7 from 04_add_categoies.sql: -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,241 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Красота и здоровье"
INSERT INTO categories (name, main_category_name) VALUES
    ('Косметика и уход за кожей', 'Красота и здоровье'),
    ('Парфюмерия', 'Красота и здоровье'),
    ('Уход за волосами', 'Красота и здоровье'),
    ('Витамины и БАДы', 'Красота и здоровье'),
    ('Медицинские товары', 'Красота и здоровье'),
    ('Гигиенические средства', 'Красота и здоровье'),
    ('Средства для загара и ухода за телом', 'Красота и здоровье')
2025-04-09 01:52:59,241 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:52:59,242 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,242 - app.services.database - INFO - Successfully executed query 7 from 04_add_categoies.sql
2025-04-09 01:52:59,242 - app.services.database - INFO - Executing query 8 from 04_add_categoies.sql: -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Дом и интерьер"
INSERT INTO categories (name, main_category_name) VALUES
    ('Мебель', 'Дом и интерьер'),
    ('Текстиль', 'Дом и интерьер'),
    ('Декор и освещение', 'Дом и интерьер'),
    ('Посуда и кухонные принадлежности', 'Дом и интерьер'),
    ('Хранение и организация', 'Дом и интерьер'),
    ('Сад и огород', 'Дом и интерьер'),
    ('Ковры и ковровые покрытия', 'Дом и интерьер')
2025-04-09 01:52:59,243 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ()
2025-04-09 01:52:59,244 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,245 - app.services.database - INFO - Successfully executed query 8 from 04_add_categoies.sql
2025-04-09 01:52:59,245 - app.services.database - INFO - Executing query 9 from 04_add_categoies.sql: -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VAL...
2025-04-09 01:52:59,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,246 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Продукты питания"
INSERT INTO categories (name, main_category_name) VALUES
    ('Молочные продукты', 'Продукты питания'),
    ('Мясо и рыба', 'Продукты питания'),
    ('Овощи и фрукты', 'Продукты питания'),
    ('Бакалея', 'Продукты питания'),
    ('Напитки', 'Продукты питания'),
    ('Кондитерские изделия', 'Продукты питания'),
    ('Полуфабрикаты', 'Продукты питания')
2025-04-09 01:52:59,247 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ()
2025-04-09 01:52:59,249 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,250 - app.services.database - INFO - Successfully executed query 9 from 04_add_categoies.sql
2025-04-09 01:52:59,250 - app.services.database - INFO - Executing query 10 from 04_add_categoies.sql: -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES...
2025-04-09 01:52:59,250 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,251 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Спорт и отдых"
INSERT INTO categories (name, main_category_name) VALUES
    ('Спортивная одежда и обувь', 'Спорт и отдых'),
    ('Тренажеры и фитнес-оборудование', 'Спорт и отдых'),
    ('Туризм и кемпинг', 'Спорт и отдых'),
    ('Велосипеды и самокаты', 'Спорт и отдых'),
    ('Игры и развлечения на открытом воздухе', 'Спорт и отдых'),
    ('Рыбалка и охота', 'Спорт и отдых'),
    ('Зимние виды спорта', 'Спорт и отдых')
2025-04-09 01:52:59,251 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,252 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,252 - app.services.database - INFO - Successfully executed query 10 from 04_add_categoies.sql
2025-04-09 01:52:59,252 - app.services.database - INFO - Executing query 11 from 04_add_categoies.sql: -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUE...
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Детские товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Игрушки', 'Детские товары'),
    ('Детская мебель', 'Детские товары'),
    ('Товары для школы и творчества', 'Детские товары'),
    ('Товары для малышей', 'Детские товары'),
    ('Детский транспорт', 'Детские товары'),
    ('Одежда и обувь для детей', 'Детские товары'),
    ('Книги и развивающие игры', 'Детские товары')
2025-04-09 01:52:59,253 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-04-09 01:52:59,254 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,254 - app.services.database - INFO - Successfully executed query 11 from 04_add_categoies.sql
2025-04-09 01:52:59,254 - app.services.database - INFO - Executing query 12 from 04_add_categoies.sql: -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
  ...
2025-04-09 01:52:59,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,256 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Автотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Автозапчасти', 'Автотовары'),
    ('Автоаксессуары', 'Автотовары'),
    ('Шины и диски', 'Автотовары'),
    ('Уход за автомобилем', 'Автотовары'),
    ('Электроника для авто', 'Автотовары'),
    ('Автохимия и масла', 'Автотовары'),
    ('Инструменты для ремонта', 'Автотовары')
2025-04-09 01:52:59,257 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-04-09 01:52:59,258 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,259 - app.services.database - INFO - Successfully executed query 12 from 04_add_categoies.sql
2025-04-09 01:52:59,259 - app.services.database - INFO - Executing query 13 from 04_add_categoies.sql: -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,259 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,260 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Книги и канцелярия"
INSERT INTO categories (name, main_category_name) VALUES
    ('Художественная литература', 'Книги и канцелярия'),
    ('Учебники и пособия', 'Книги и канцелярия'),
    ('Канцелярские товары', 'Книги и канцелярия'),
    ('Блокноты и ежедневники', 'Книги и канцелярия'),
    ('Подарочные издания', 'Книги и канцелярия'),
    ('Книги для детей', 'Книги и канцелярия'),
    ('Книги по саморазвитию и бизнесу', 'Книги и канцелярия')
2025-04-09 01:52:59,260 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,261 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,261 - app.services.database - INFO - Successfully executed query 13 from 04_add_categoies.sql
2025-04-09 01:52:59,261 - app.services.database - INFO - Executing query 14 from 04_add_categoies.sql: -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
   ...
2025-04-09 01:52:59,261 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,262 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Зоотовары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Корма для животных', 'Зоотовары'),
    ('Аксессуары для животных', 'Зоотовары'),
    ('Игрушки для животных', 'Зоотовары'),
    ('Уход за животными', 'Зоотовары'),
    ('Лекарства и витамины для животных', 'Зоотовары'),
    ('Товары для аквариумов и террариумов', 'Зоотовары'),
    ('Домики и лежанки для животных', 'Зоотовары')
2025-04-09 01:52:59,262 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,263 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,263 - app.services.database - INFO - Successfully executed query 14 from 04_add_categoies.sql
2025-04-09 01:52:59,264 - app.services.database - INFO - Executing query 15 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:52:59,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,264 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительство и ремонт"
INSERT INTO categories (name, main_category_name) VALUES
    ('Инструменты', 'Строительство и ремонт'),
    ('Отделочные материалы', 'Строительство и ремонт'),
    ('Сантехника', 'Строительство и ремонт'),
    ('Электрика', 'Строительство и ремонт'),
    ('Строительные материалы', 'Строительство и ремонт'),
    ('Садовая техника', 'Строительство и ремонт'),
    ('Освещение и электроника для дома', 'Строительство и ремонт')
2025-04-09 01:52:59,265 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 01:52:59,267 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,268 - app.services.database - INFO - Successfully executed query 15 from 04_add_categoies.sql
2025-04-09 01:52:59,268 - app.services.database - INFO - Executing query 16 from 04_add_categoies.sql: -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,269 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Хобби и творчество"
INSERT INTO categories (name, main_category_name) VALUES
    ('Рисование и живопись', 'Хобби и творчество'),
    ('Рукоделие', 'Хобби и творчество'),
    ('Моделирование', 'Хобби и творчество'),
    ('Музыкальные инструменты', 'Хобби и творчество'),
    ('Фотография', 'Хобби и творчество'),
    ('Настольные игры и пазлы', 'Хобби и творчество'),
    ('Коллекционирование', 'Хобби и творчество')
2025-04-09 01:52:59,269 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ()
2025-04-09 01:52:59,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,270 - app.services.database - INFO - Successfully executed query 16 from 04_add_categoies.sql
2025-04-09 01:52:59,270 - app.services.database - INFO - Executing query 17 from 04_add_categoies.sql: -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALU...
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Цифровые товары"
INSERT INTO categories (name, main_category_name) VALUES
    ('Программное обеспечение', 'Цифровые товары'),
    ('Электронные книги', 'Цифровые товары'),
    ('Онлайн-курсы', 'Цифровые товары'),
    ('Игры и приложения', 'Цифровые товары'),
    ('Подписки на сервисы', 'Цифровые товары')
2025-04-09 01:52:59,271 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ()
2025-04-09 01:52:59,273 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,274 - app.services.database - INFO - Successfully executed query 17 from 04_add_categoies.sql
2025-04-09 01:52:59,275 - app.services.database - INFO - Executing query 18 from 04_add_categoies.sql: -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_categ...
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Ювелирные изделия и украшения"
INSERT INTO categories (name, main_category_name) VALUES
    ('Кольца, серьги, браслеты', 'Ювелирные изделия и украшения'),
    ('Часы', 'Ювелирные изделия и украшения'),
    ('Бижутерия', 'Ювелирные изделия и украшения'),
    ('Украшения из драгоценных металлов', 'Ювелирные изделия и украшения'),
    ('Подарочные наборы', 'Ювелирные изделия и украшения'),
    ('Аксессуары для украшений', 'Ювелирные изделия и украшения')
2025-04-09 01:52:59,275 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ()
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,277 - app.services.database - INFO - Successfully executed query 18 from 04_add_categoies.sql
2025-04-09 01:52:59,277 - app.services.database - INFO - Executing query 19 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name...
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,277 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для праздников"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декорации', 'Товары для праздников'),
    ('Подарки', 'Товары для праздников'),
    ('Костюмы и маски', 'Товары для праздников'),
    ('Посуда для праздников', 'Товары для праздников'),
    ('Товары для свадеб', 'Товары для праздников'),
    ('Товары для детских праздников', 'Товары для праздников')
2025-04-09 01:52:59,278 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ()
2025-04-09 01:52:59,278 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,279 - app.services.database - INFO - Successfully executed query 19 from 04_add_categoies.sql
2025-04-09 01:52:59,279 - app.services.database - INFO - Executing query 20 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,279 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('Офисная мебель', 'Товары для бизнеса'),
    ('Оргтехника', 'Товары для бизнеса'),
    ('Канцелярия для офиса', 'Товары для бизнеса'),
    ('Упаковочные материалы', 'Товары для бизнеса'),
    ('Торговое оборудование', 'Товары для бизнеса'),
    ('Программное обеспечение для бизнеса', 'Товары для бизнеса')
2025-04-09 01:52:59,280 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 01:52:59,281 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,281 - app.services.database - INFO - Successfully executed query 20 from 04_add_categoies.sql
2025-04-09 01:52:59,282 - app.services.database - INFO - Executing query 21 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,283 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для туризма"
INSERT INTO categories (name, main_category_name) VALUES
    ('Чемоданы и дорожные сумки', 'Товары для туризма'),
    ('Дорожные аксессуары', 'Товары для туризма'),
    ('Туристическая одежда и обувь', 'Товары для туризма'),
    ('Навигаторы и карты', 'Товары для туризма'),
    ('Товары для кемпинга', 'Товары для туризма'),
    ('Сувениры и подарки', 'Товары для туризма')
2025-04-09 01:52:59,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-04-09 01:52:59,285 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,286 - app.services.database - INFO - Successfully executed query 21 from 04_add_categoies.sql
2025-04-09 01:52:59,286 - app.services.database - INFO - Executing query 22 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) ...
2025-04-09 01:52:59,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,287 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для здоровья"
INSERT INTO categories (name, main_category_name) VALUES
    ('Медицинские приборы', 'Товары для здоровья'),
    ('Ортопедические товары', 'Товары для здоровья'),
    ('Средства для реабилитации', 'Товары для здоровья'),
    ('Массажное оборудование', 'Товары для здоровья'),
    ('Товары для сна', 'Товары для здоровья'),
    ('Средства для гигиены полости рта', 'Товары для здоровья')
2025-04-09 01:52:59,287 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-04-09 01:52:59,289 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,290 - app.services.database - INFO - Successfully executed query 22 from 04_add_categoies.sql
2025-04-09 01:52:59,291 - app.services.database - INFO - Executing query 23 from 04_add_categoies.sql: -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,291 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,291 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Товары для красоты"
INSERT INTO categories (name, main_category_name) VALUES
    ('Декоративная косметика', 'Товары для красоты'),
    ('Уход за ногтями', 'Товары для красоты'),
    ('Уход за телом', 'Товары для красоты'),
    ('Парфюмерия', 'Товары для красоты'),
    ('Средства для макияжа', 'Товары для красоты'),
    ('Уход за волосами', 'Товары для красоты')
2025-04-09 01:52:59,292 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ()
2025-04-09 01:52:59,293 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,294 - app.services.database - INFO - Successfully executed query 23 from 04_add_categoies.sql
2025-04-09 01:52:59,295 - app.services.database - INFO - Executing query 24 from 04_add_categoies.sql: -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_nam...
2025-04-09 01:52:59,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,295 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Строительные материалы"
INSERT INTO categories (name, main_category_name) VALUES
    ('Крепежные изделия', 'Строительные материалы'),
    ('Цемент и смеси', 'Строительные материалы'),
    ('Кирпич и блоки', 'Строительные материалы'),
    ('Галька, щебень, песок', 'Строительные материалы'),
    ('Кровельные материалы', 'Строительные материалы'),
    ('Отделочные материалы', 'Строительные материалы'),
    ('Тепло- и звукоизоляция', 'Строительные материалы'),
    ('Лесоматериалы', 'Строительные материалы'),
    ('Сантехнические материалы', 'Строительные материалы'),
    ('Электротехнические материалы', 'Строительные материалы')
2025-04-09 01:52:59,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ()
2025-04-09 01:52:59,297 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,298 - app.services.database - INFO - Successfully executed query 24 from 04_add_categoies.sql
2025-04-09 01:52:59,298 - app.services.database - INFO - Executing query 25 from 04_add_categoies.sql: -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_...
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Промышленное оборудование"
INSERT INTO categories (name, main_category_name) VALUES
    ('Металлообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Деревообрабатывающее оборудование', 'Промышленное оборудование'),
    ('Пищевое оборудование', 'Промышленное оборудование'),
    ('Текстильное оборудование', 'Промышленное оборудование'),
    ('Химическое оборудование', 'Промышленное оборудование'),
    ('Энергетическое оборудование', 'Промышленное оборудование'),
    ('Горнодобывающее оборудование', 'Промышленное оборудование'),
    ('Сельскохозяйственное оборудование', 'Промышленное оборудование'),
    ('Упаковочное оборудование', 'Промышленное оборудование'),
    ('Складское оборудование', 'Промышленное оборудование'),
    ('Медицинское оборудование', 'Промышленное оборудование'),
    ('Полиграфическое оборудование', 'Промышленное оборудование'),
    ('Оборудование для переработки отходов', 'Промышленное оборудование'),
    ('Лабораторное оборудование', 'Промышленное оборудование'),
    ('Оборудование для производства строительных материалов', 'Промышленное оборудование')
2025-04-09 01:52:59,298 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-04-09 01:52:59,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,300 - app.services.database - INFO - Successfully executed query 25 from 04_add_categoies.sql
2025-04-09 01:52:59,300 - app.services.database - INFO - Executing query 26 from 04_add_categoies.sql: -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) V...
2025-04-09 01:52:59,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:52:59,301 - sqlalchemy.engine.Engine - INFO - -- Вставка подкатегорий для "Услуги для бизнеса"
INSERT INTO categories (name, main_category_name) VALUES
    ('SMM и продвижение в соцсетях', 'Услуги для бизнеса'),
    ('Реклама и маркетинг', 'Услуги для бизнеса'),
    ('Брендинг', 'Услуги для бизнеса'),
    ('Создание упаковки', 'Услуги для бизнеса'),
    ('Веб-разработка и дизайн', 'Услуги для бизнеса'),
    ('Копирайтинг и контент-маркетинг', 'Услуги для бизнеса'),
    ('Бухгалтерские услуги', 'Услуги для бизнеса'),
    ('Юридические услуги', 'Услуги для бизнеса'),
    ('HR и подбор персонала', 'Услуги для бизнеса'),
    ('Организация мероприятий', 'Услуги для бизнеса'),
    ('Логистика и складирование', 'Услуги для бизнеса'),
    ('IT-услуги', 'Услуги для бизнеса'),
    ('Фото- и видеосъемка', 'Услуги для бизнеса'),
    ('Полиграфия', 'Услуги для бизнеса'),
    ('Консалтинг', 'Услуги для бизнеса'),
    ('Обучение и тренинги', 'Услуги для бизнеса'),
    ('Аутсорсинг', 'Услуги для бизнеса'),
    ('Услуги для интернет-магазинов', 'Услуги для бизнеса'),
    ('Услуги для стартапов', 'Услуги для бизнеса'),
    ('Услуги для франшиз', 'Услуги для бизнеса')
2025-04-09 01:52:59,301 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-04-09 01:52:59,303 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:52:59,303 - app.services.database - INFO - Successfully executed query 26 from 04_add_categoies.sql
2025-04-09 01:52:59,303 - app.services.database - INFO - Database initialization completed
2025-04-09 01:52:59,303 - __main__ - INFO - Action config initialized successfully
2025-04-09 01:52:59,303 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 01:52:59,679 - __main__ - INFO - Application started successfully
2025-04-09 01:52:59,680 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 01:53:08,631 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1043270764,)
2025-04-09 01:53:08,632 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:53:08,837 - aiogram.event - INFO - Update id=311268312 is handled. Duration 208 ms by bot id=7041366449
2025-04-09 01:53:10,866 - aiogram.event - INFO - Update id=311268313 is handled. Duration 84 ms by bot id=7041366449
2025-04-09 01:53:11,585 - aiogram.event - INFO - Update id=311268314 is handled. Duration 209 ms by bot id=7041366449
2025-04-09 01:53:13,191 - aiogram.event - INFO - Update id=311268315 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 01:53:14,627 - root - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 01:53:14,717 - aiogram.event - INFO - Update id=311268316 is handled. Duration 249 ms by bot id=7041366449
2025-04-09 01:53:16,396 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:16,398 - sqlalchemy.engine.Engine - INFO - 
            INSERT INTO users (tg_id, username, first_name, last_name, email, phone, created_at)
            VALUES ($1, $2, $3, $4, $5, $6, NOW())
            ON CONFLICT (tg_id) DO UPDATE
            SET username = $2, 
                first_name = $3, 
                last_name = $4,
                email = COALESCE($5, users.email),
                phone = COALESCE($6, users.phone)
        
2025-04-09 01:53:16,398 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (1043270764, '@egormeisters', 'sdf', 'sdrg', None, None)
2025-04-09 01:53:16,401 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:53:16,402 - root - INFO - User saved: 1043270764, @egormeisters, email: NULL, phone: NULL
2025-04-09 01:53:16,642 - aiogram.event - INFO - Update id=311268317 is handled. Duration 354 ms by bot id=7041366449
2025-04-09 01:53:19,267 - aiogram.event - INFO - Update id=311268318 is handled. Duration 294 ms by bot id=7041366449
2025-04-09 01:53:22,609 - aiogram.event - INFO - Update id=311268319 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 01:53:25,218 - aiogram.event - INFO - Update id=311268320 is handled. Duration 408 ms by bot id=7041366449
2025-04-09 01:53:28,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:53:28,164 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 01:53:28,165 - sqlalchemy.engine.Engine - INFO - [cached since 19.53s ago] (1043270764,)
2025-04-09 01:53:28,168 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:53:28,259 - aiogram.event - INFO - Update id=311268321 is handled. Duration 98 ms by bot id=7041366449
2025-04-09 01:54:06,483 - aiogram.event - INFO - Update id=311268322 is handled. Duration 297 ms by bot id=7041366449
2025-04-09 01:54:08,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:08,524 - sqlalchemy.engine.Engine - INFO - 
            SELECT tg_id, username, first_name, last_name, email, phone, role, created_at
            FROM users
            WHERE tg_id = $1
        
2025-04-09 01:54:08,525 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1043270764,)
2025-04-09 01:54:08,527 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:08,625 - aiogram.event - INFO - Update id=311268323 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 01:54:10,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:10,704 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 01:54:10,705 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ()
2025-04-09 01:54:10,708 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:10,836 - aiogram.event - INFO - Update id=311268324 is handled. Duration 355 ms by bot id=7041366449
2025-04-09 01:54:11,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:11,115 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 01:54:11,115 - sqlalchemy.engine.Engine - INFO - [cached since 0.4107s ago] ()
2025-04-09 01:54:11,117 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:11,238 - aiogram.event - INFO - Update id=311268325 is handled. Duration 131 ms by bot id=7041366449
2025-04-09 01:54:13,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:54:13,856 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 01:54:13,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ('Цифровые товары',)
2025-04-09 01:54:13,862 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 01:54:13,952 - aiogram.event - INFO - Update id=311268326 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 01:54:15,682 - aiogram.event - INFO - Update id=311268327 is handled. Duration 184 ms by bot id=7041366449
2025-04-09 01:54:17,397 - aiogram.event - INFO - Update id=311268328 is handled. Duration 217 ms by bot id=7041366449
2025-04-09 01:54:19,994 - aiogram.event - INFO - Update id=311268329 is handled. Duration 195 ms by bot id=7041366449
2025-04-09 01:54:38,976 - aiogram.event - INFO - Update id=311268330 is handled. Duration 231 ms by bot id=7041366449
2025-04-09 01:55:01,738 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ, размер=960x1280
2025-04-09 01:55:01,739 - app - INFO - Является частью группы: True
2025-04-09 01:55:01,739 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 1
2025-04-09 01:55:02,271 - root - INFO - File saved: 2025/04/09/38946a5c30a24544888ef36e1494f757.jpg
2025-04-09 01:55:02,271 - app - INFO - Фото сохранено, всего фото: 1
2025-04-09 01:55:02,362 - app - INFO - Создано новое сообщение для группы 13953223210684266
2025-04-09 01:55:02,362 - aiogram.event - INFO - Update id=311268331 is handled. Duration 633 ms by bot id=7041366449
2025-04-09 01:55:02,623 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBliVn9alFCbn8o2VozeXgOaWGPsA3YQAC2PsxG2fgqEv1vCw4_QL8uQEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:02,624 - app - INFO - Является частью группы: True
2025-04-09 01:55:02,624 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 2
2025-04-09 01:55:03,000 - root - INFO - File saved: 2025/04/09/b2a135030f334483bb8c624de797aea7.jpg
2025-04-09 01:55:03,001 - app - INFO - Фото сохранено, всего фото: 2
2025-04-09 01:55:03,089 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:03,091 - aiogram.event - INFO - Update id=311268332 is handled. Duration 478 ms by bot id=7041366449
2025-04-09 01:55:03,353 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:03,354 - app - INFO - Является частью группы: True
2025-04-09 01:55:03,354 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 3
2025-04-09 01:55:03,662 - root - INFO - File saved: 2025/04/09/60a7c066635f48a981575c170c2f98de.jpg
2025-04-09 01:55:03,662 - app - INFO - Фото сохранено, всего фото: 3
2025-04-09 01:55:03,746 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:03,747 - aiogram.event - INFO - Update id=311268333 is handled. Duration 405 ms by bot id=7041366449
2025-04-09 01:55:04,008 - app - INFO - Получено фото: file_id=AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE, размер=960x1280
2025-04-09 01:55:04,009 - app - INFO - Является частью группы: True
2025-04-09 01:55:04,009 - app - INFO - Добавлено фото в группу 13953223210684266, всего фото в группе: 4
2025-04-09 01:55:04,361 - root - INFO - File saved: 2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg
2025-04-09 01:55:04,362 - app - INFO - Фото сохранено, всего фото: 4
2025-04-09 01:55:04,454 - app - INFO - Сообщение для группы 13953223210684266 обновлено
2025-04-09 01:55:04,456 - aiogram.event - INFO - Update id=311268334 is handled. Duration 458 ms by bot id=7041366449
2025-04-09 01:55:10,922 - aiogram.event - INFO - Update id=311268335 is handled. Duration 179 ms by bot id=7041366449
2025-04-09 01:55:12,097 - aiogram.event - INFO - Update id=311268336 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 01:55:15,551 - aiogram.event - INFO - Update id=311268337 is handled. Duration 351 ms by bot id=7041366449
2025-04-09 01:55:17,731 - aiogram.event - INFO - Update id=311268338 is handled. Duration 278 ms by bot id=7041366449
2025-04-09 01:55:19,937 - app - ERROR - Ошибка при очистке клавиатуры: Telegram server says - Bad Request: text must be non-empty
2025-04-09 01:55:20,031 - aiogram.event - INFO - Update id=311268339 is handled. Duration 274 ms by bot id=7041366449
2025-04-09 01:55:24,697 - aiogram.event - INFO - Update id=311268340 is handled. Duration 589 ms by bot id=7041366449
2025-04-09 01:55:26,958 - app - INFO - === Подтверждение создания поставщика ===
2025-04-09 01:55:26,959 - app - INFO - ID пользователя: 1043270764
2025-04-09 01:55:26,959 - app - INFO - Начинаю процесс сохранения поставщика в БД
2025-04-09 01:55:26,959 - app - INFO - После проверки осталось 4 корректных фотографий
2025-04-09 01:55:26,960 - root - INFO - === Начало сохранения поставщика ===
2025-04-09 01:55:26,960 - root - INFO - Данные: company_name=sdfhr, product_name=sdfhgb, category_id=94
2025-04-09 01:55:26,960 - root - INFO - Фотографии: 4 шт.
2025-04-09 01:55:26,961 - root - INFO - Видео: False
2025-04-09 01:55:26,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 01:55:26,963 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO suppliers (
                    company_name, product_name, category_id, description,
                    country, region, city, address, contact_username,
                    contact_phone, contact_email, created_by_id
                )
                VALUES (
                    $1, $2, $3, $4,
                    $5, $6, $7, $8, $9,
                    $10, $11, $12
                )
                RETURNING id
            
2025-04-09 01:55:26,963 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('sdfhr', 'sdfhgb', 94, 'sdfbdfsbv sdfgsdfg', 'russia', 'moscow', None, None, '@egormeisters', '79267091083', None, 1043270764)
2025-04-09 01:55:26,964 - root - INFO - Поставщик создан с ID: 1
2025-04-09 01:55:26,964 - root - INFO - Начинаю сохранение 4 фотографий
2025-04-09 01:55:26,964 - root - INFO - Сохраняю фото 1/4: AgACAgIAAxkBAAEBky5n9SSwDflD9DGVUTKQ1evlQ-w9AAN_9zEbZ-CoS6lc2dot9_TQAQADAgADeQADNgQ
2025-04-09 01:55:26,964 - root - INFO - Сохранение файла: photo, photo_1.jpg, supplier_id=1
2025-04-09 01:55:26,964 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'name': 'photo_1.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,965 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,965 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ('photo', '2025/04/09/38946a5c30a24544888ef36e1494f757.jpg', 'photo_1.jpg', None, 1)
2025-04-09 01:55:26,966 - root - INFO - Файл сохранен с ID: 1
2025-04-09 01:55:26,966 - root - INFO - Фото 1 сохранено с ID: 1
2025-04-09 01:55:26,966 - root - INFO - Сохраняю фото 2/4: AgACAgIAAxkBAAEBliVn9alFCbn8o2VozeXgOaWGPsA3YQAC2PsxG2fgqEv1vCw4_QL8uQEAAwIAA3kAAzYE
2025-04-09 01:55:26,966 - root - INFO - Сохранение файла: photo, photo_2.jpg, supplier_id=1
2025-04-09 01:55:26,966 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'name': 'photo_2.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,967 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,967 - sqlalchemy.engine.Engine - INFO - [cached since 0.001977s ago] ('photo', '2025/04/09/b2a135030f334483bb8c624de797aea7.jpg', 'photo_2.jpg', None, 1)
2025-04-09 01:55:26,967 - root - INFO - Файл сохранен с ID: 2
2025-04-09 01:55:26,967 - root - INFO - Фото 2 сохранено с ID: 2
2025-04-09 01:55:26,968 - root - INFO - Сохраняю фото 3/4: AgACAgIAAxkBAAEBkxhn9RKoBtpEdkvg-lcKF-lriLhbpwACnfYxG2fgqEvgTUO6hKRE_wEAAwIAA3kAAzYE
2025-04-09 01:55:26,968 - root - INFO - Сохранение файла: photo, photo_3.jpg, supplier_id=1
2025-04-09 01:55:26,968 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'name': 'photo_3.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,968 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,968 - sqlalchemy.engine.Engine - INFO - [cached since 0.003333s ago] ('photo', '2025/04/09/60a7c066635f48a981575c170c2f98de.jpg', 'photo_3.jpg', None, 1)
2025-04-09 01:55:26,969 - root - INFO - Файл сохранен с ID: 3
2025-04-09 01:55:26,969 - root - INFO - Фото 3 сохранено с ID: 3
2025-04-09 01:55:26,969 - root - INFO - Сохраняю фото 4/4: AgACAgIAAxkBAAEBk3Vn9UpEL-YJxEjjsI-3tXkRaS7A9AACj_gxG2fgqEuMKSYZSJE3qgEAAwIAA3kAAzYE
2025-04-09 01:55:26,969 - root - INFO - Сохранение файла: photo, photo_4.jpg, supplier_id=1
2025-04-09 01:55:26,969 - root - INFO - SQL параметры: {'type': 'photo', 'file_path': '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'name': 'photo_4.jpg', 'request_id': None, 'supplier_id': 1}
2025-04-09 01:55:26,970 - sqlalchemy.engine.Engine - INFO - 
                INSERT INTO files (
                    type, file_path, name, request_id, supplier_id
                )
                VALUES (
                    $1, $2, $3, $4, $5
                )
                RETURNING id
            
2025-04-09 01:55:26,970 - sqlalchemy.engine.Engine - INFO - [cached since 0.00528s ago] ('photo', '2025/04/09/9e7589d0aa7a492287b5096a5e977686.jpg', 'photo_4.jpg', None, 1)
2025-04-09 01:55:26,971 - root - INFO - Файл сохранен с ID: 4
2025-04-09 01:55:26,971 - root - INFO - Фото 4 сохранено с ID: 4
2025-04-09 01:55:26,971 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-04-09 01:55:26,972 - root - INFO - === Транзакция успешно завершена, поставщик сохранен ===
2025-04-09 01:55:26,972 - app - INFO - Поставщик успешно создан с ID: 1
2025-04-09 01:55:27,271 - app - INFO - === Создание поставщика успешно завершено ===
2025-04-09 01:55:27,272 - aiogram.event - INFO - Update id=311268341 is handled. Duration 399 ms by bot id=7041366449
2025-04-09 01:55:32,466 - __main__ - INFO - Stopping application...
2025-04-09 01:55:32,797 - __main__ - INFO - Application stopped
2025-04-09 02:06:18,714 - app - INFO - Starting application...
2025-04-09 02:06:18,715 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:06:18,715 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:06:18,715 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:06:19,092 - __main__ - INFO - Application started successfully
2025-04-09 02:06:19,093 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:06:22,746 - aiogram.event - INFO - Update id=311268342 is handled. Duration 194 ms by bot id=7041366449
2025-04-09 02:06:24,680 - aiogram.event - INFO - Update id=311268343 is handled. Duration 181 ms by bot id=7041366449
2025-04-09 02:06:26,175 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:06:26,175 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,215 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:06:26,215 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,217 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:06:26,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:06:26,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:26,218 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:26,219 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ()
2025-04-09 02:06:26,221 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:26,316 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 282 ms by bot id=7041366449
2025-04-09 02:06:26,316 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:26,661 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:26,662 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:26,662 - sqlalchemy.engine.Engine - INFO - [cached since 0.4441s ago] ()
2025-04-09 02:06:26,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:26,752 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 180 ms by bot id=7041366449
2025-04-09 02:06:26,753 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:29,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:29,186 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:29,187 - sqlalchemy.engine.Engine - INFO - [cached since 2.968s ago] ()
2025-04-09 02:06:29,189 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:29,271 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 164 ms by bot id=7041366449
2025-04-09 02:06:29,272 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:33,604 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:06:33,605 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:06:33,606 - sqlalchemy.engine.Engine - INFO - [cached since 7.387s ago] ()
2025-04-09 02:06:33,608 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:06:33,692 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 164 ms by bot id=7041366449
2025-04-09 02:06:33,692 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: BUTTON_DATA_INVALID
2025-04-09 02:06:42,186 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 76 ms by bot id=7041366449
2025-04-09 02:06:42,186 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:06:58,822 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 223 ms by bot id=7041366449
2025-04-09 02:06:58,823 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:07:31,483 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 221 ms by bot id=7041366449
2025-04-09 02:07:31,484 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:10,342 - __main__ - INFO - Stopping application...
2025-04-09 02:08:10,808 - __main__ - INFO - Application stopped
2025-04-09 02:08:14,754 - app - INFO - Starting application...
2025-04-09 02:08:14,754 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:08:14,754 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:08:14,754 - __main__ - INFO - Setting webhook at: https://77f7-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:08:15,138 - __main__ - INFO - Application started successfully
2025-04-09 02:08:15,138 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:08:15,387 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 92 ms by bot id=7041366449
2025-04-09 02:08:15,387 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:15,736 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 88 ms by bot id=7041366449
2025-04-09 02:08:15,736 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:18,084 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 90 ms by bot id=7041366449
2025-04-09 02:08:18,085 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:22,445 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 83 ms by bot id=7041366449
2025-04-09 02:08:22,445 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:30,951 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 87 ms by bot id=7041366449
2025-04-09 02:08:30,952 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:47,828 - aiogram.event - INFO - Update id=311268344 is not handled. Duration 478 ms by bot id=7041366449
2025-04-09 02:08:47,828 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:48,162 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:08:48,162 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:48,500 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:08:48,500 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:50,912 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 82 ms by bot id=7041366449
2025-04-09 02:08:50,912 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:08:55,317 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:08:55,317 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:03,752 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:09:03,752 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:20,346 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 226 ms by bot id=7041366449
2025-04-09 02:09:20,346 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:09:46,877 - __main__ - INFO - Stopping application...
2025-04-09 02:09:47,584 - __main__ - INFO - Application stopped
2025-04-09 02:09:59,552 - app - INFO - Starting application...
2025-04-09 02:09:59,552 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:09:59,552 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:09:59,552 - __main__ - INFO - Setting webhook at: https://9a28-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:09:59,950 - __main__ - INFO - Application started successfully
2025-04-09 02:09:59,951 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:10:00,173 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 77 ms by bot id=7041366449
2025-04-09 02:10:00,173 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:00,761 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:00,761 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:03,409 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:10:03,409 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:08,123 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:08,124 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:11,581 - __main__ - INFO - Stopping application...
2025-04-09 02:10:11,922 - __main__ - INFO - Application stopped
2025-04-09 02:10:21,085 - app - INFO - Starting application...
2025-04-09 02:10:21,086 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:10:21,086 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:10:21,086 - __main__ - INFO - Setting webhook at: https://dcff-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:10:21,462 - __main__ - INFO - Application started successfully
2025-04-09 02:10:21,463 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:10:21,696 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 75 ms by bot id=7041366449
2025-04-09 02:10:21,696 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:22,966 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:10:22,966 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:25,624 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 74 ms by bot id=7041366449
2025-04-09 02:10:25,625 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:30,279 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 116 ms by bot id=7041366449
2025-04-09 02:10:30,280 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,071 - aiogram.event - INFO - Update id=311268345 is not handled. Duration 101 ms by bot id=7041366449
2025-04-09 02:10:39,072 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,544 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 77 ms by bot id=7041366449
2025-04-09 02:10:39,545 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:39,944 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 78 ms by bot id=7041366449
2025-04-09 02:10:39,945 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:42,438 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 91 ms by bot id=7041366449
2025-04-09 02:10:42,439 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:46,936 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:10:46,936 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:10:53,630 - __main__ - INFO - Stopping application...
2025-04-09 02:10:53,949 - __main__ - INFO - Application stopped
2025-04-09 02:11:04,352 - app - INFO - Starting application...
2025-04-09 02:11:04,352 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:11:04,353 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:11:04,353 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:11:04,807 - __main__ - INFO - Application started successfully
2025-04-09 02:11:04,808 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:11:04,985 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 87 ms by bot id=7041366449
2025-04-09 02:11:04,985 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:05,657 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 108 ms by bot id=7041366449
2025-04-09 02:11:05,657 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:08,508 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 81 ms by bot id=7041366449
2025-04-09 02:11:08,508 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:13,168 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 205 ms by bot id=7041366449
2025-04-09 02:11:13,169 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:21,757 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 86 ms by bot id=7041366449
2025-04-09 02:11:21,757 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:11:38,579 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 228 ms by bot id=7041366449
2025-04-09 02:11:38,580 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:12:11,399 - aiogram.event - INFO - Update id=311268346 is not handled. Duration 225 ms by bot id=7041366449
2025-04-09 02:12:11,400 - __main__ - ERROR - Error processing webhook: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-04-09 02:12:29,256 - aiogram.event - INFO - Update id=311268347 is handled. Duration 338 ms by bot id=7041366449
2025-04-09 02:12:32,076 - aiogram.event - INFO - Update id=311268348 is handled. Duration 158 ms by bot id=7041366449
2025-04-09 02:12:33,379 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:12:33,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:12:33,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:12:33,382 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-04-09 02:12:33,383 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:33,843 - aiogram.event - INFO - Update id=311268349 is handled. Duration 597 ms by bot id=7041366449
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:12:38,871 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('Товары для здоровья',)
2025-04-09 02:12:38,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:38,957 - aiogram.event - INFO - Update id=311268350 is handled. Duration 181 ms by bot id=7041366449
2025-04-09 02:12:44,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:44,711 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'accepted'
            ORDER BY created_at DESC
        
2025-04-09 02:12:44,711 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (122,)
2025-04-09 02:12:44,750 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:44,836 - aiogram.event - INFO - Update id=311268351 is handled. Duration 204 ms by bot id=7041366449
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:12:51,053 - sqlalchemy.engine.Engine - INFO - [cached since 12.18s ago] ('Товары для здоровья',)
2025-04-09 02:12:51,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:51,144 - aiogram.event - INFO - Update id=311268352 is handled. Duration 183 ms by bot id=7041366449
2025-04-09 02:12:54,832 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:12:54,832 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:12:54,833 - sqlalchemy.engine.Engine - INFO - [cached since 21.45s ago] ()
2025-04-09 02:12:54,833 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:12:54,922 - aiogram.event - INFO - Update id=311268353 is handled. Duration 169 ms by bot id=7041366449
2025-04-09 02:14:21,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:14:21,704 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:14:21,704 - sqlalchemy.engine.Engine - INFO - [cached since 102.8s ago] ('Цифровые товары',)
2025-04-09 02:14:21,705 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:14:21,796 - aiogram.event - INFO - Update id=311268354 is handled. Duration 311 ms by bot id=7041366449
2025-04-09 02:14:24,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:14:24,428 - sqlalchemy.engine.Engine - INFO - 
            SELECT id FROM suppliers 
            WHERE category_id = $1 AND status = 'accepted'
            ORDER BY created_at DESC
        
2025-04-09 02:14:24,429 - sqlalchemy.engine.Engine - INFO - [cached since 99.72s ago] (94,)
2025-04-09 02:14:24,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:14:24,522 - aiogram.event - INFO - Update id=311268355 is handled. Duration 170 ms by bot id=7041366449
2025-04-09 02:18:32,306 - __main__ - INFO - Stopping application...
2025-04-09 02:18:32,774 - __main__ - INFO - Application stopped
2025-04-09 02:22:11,101 - app - INFO - Starting application...
2025-04-09 02:22:11,101 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:22:11,101 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:22:11,101 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:22:11,496 - __main__ - INFO - Application started successfully
2025-04-09 02:22:11,497 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:22:15,701 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:22:15,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,702 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:22:15,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,703 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:22:15,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:22:15,704 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:22:15,706 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:22:15,815 - aiogram.event - INFO - Update id=311268356 is handled. Duration 146 ms by bot id=7041366449
2025-04-09 02:22:17,791 - aiogram.event - INFO - Update id=311268357 is handled. Duration 201 ms by bot id=7041366449
2025-04-09 02:22:22,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:22:22,545 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:22:22,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-04-09 02:22:22,546 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:22:22,638 - aiogram.event - INFO - Update id=311268358 is handled. Duration 171 ms by bot id=7041366449
2025-04-09 02:22:32,128 - aiogram.event - INFO - Update id=311268359 is not handled. Duration 17 ms by bot id=7041366449
2025-04-09 02:24:25,360 - __main__ - INFO - Stopping application...
2025-04-09 02:24:25,809 - __main__ - INFO - Application stopped
2025-04-09 02:24:30,941 - app - INFO - Starting application...
2025-04-09 02:24:30,942 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:24:30,942 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:24:30,942 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:24:31,310 - __main__ - INFO - Application started successfully
2025-04-09 02:24:31,311 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:24:52,722 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:24:52,722 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,724 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:24:52,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,725 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:24:52,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:24:52,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:24:52,727 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:24:52,975 - aiogram.event - INFO - Update id=311268360 is handled. Duration 285 ms by bot id=7041366449
2025-04-09 02:25:06,030 - aiogram.event - INFO - Update id=311268361 is handled. Duration 229 ms by bot id=7041366449
2025-04-09 02:25:07,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:25:07,206 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:25:07,206 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ()
2025-04-09 02:25:07,208 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:25:07,302 - aiogram.event - INFO - Update id=311268362 is handled. Duration 175 ms by bot id=7041366449
2025-04-09 02:25:10,933 - aiogram.event - INFO - Update id=311268363 is not handled. Duration 15 ms by bot id=7041366449
2025-04-09 02:28:28,858 - __main__ - INFO - Stopping application...
2025-04-09 02:28:29,313 - __main__ - INFO - Application stopped
2025-04-09 02:28:33,414 - app - INFO - Starting application...
2025-04-09 02:28:33,414 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:28:33,414 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:28:33,414 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:28:33,853 - __main__ - INFO - Application started successfully
2025-04-09 02:28:33,853 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:28:37,295 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:28:37,295 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,296 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:28:37,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:28:37,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:37,298 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:28:37,299 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1043270764,)
2025-04-09 02:28:37,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:37,419 - aiogram.event - INFO - Update id=311268364 is handled. Duration 156 ms by bot id=7041366449
2025-04-09 02:28:45,730 - aiogram.event - INFO - Update id=311268365 is handled. Duration 176 ms by bot id=7041366449
2025-04-09 02:28:46,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:46,757 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:28:46,794 - sqlalchemy.engine.Engine - INFO - [generated in 0.03690s] ()
2025-04-09 02:28:46,796 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:46,887 - aiogram.event - INFO - Update id=311268366 is handled. Duration 211 ms by bot id=7041366449
2025-04-09 02:28:50,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:50,366 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:28:50,367 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('Цифровые товары',)
2025-04-09 02:28:50,372 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:50,467 - aiogram.event - INFO - Update id=311268367 is handled. Duration 109 ms by bot id=7041366449
2025-04-09 02:28:54,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:28:54,928 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'accepted'
                ORDER BY created_at DESC
            
2025-04-09 02:28:54,928 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (94,)
2025-04-09 02:28:54,929 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:28:55,021 - aiogram.event - INFO - Update id=311268368 is handled. Duration 95 ms by bot id=7041366449
2025-04-09 02:29:22,624 - __main__ - INFO - Stopping application...
2025-04-09 02:29:23,075 - __main__ - INFO - Application stopped
2025-04-09 02:29:26,852 - app - INFO - Starting application...
2025-04-09 02:29:26,852 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:29:26,852 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:29:26,852 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:29:27,240 - __main__ - INFO - Application started successfully
2025-04-09 02:29:27,241 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:29:31,117 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:29:31,117 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:29:31,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:29:31,120 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:31,121 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:29:31,121 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:29:31,122 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:31,248 - aiogram.event - INFO - Update id=311268369 is handled. Duration 195 ms by bot id=7041366449
2025-04-09 02:29:36,977 - aiogram.event - INFO - Update id=311268370 is handled. Duration 206 ms by bot id=7041366449
2025-04-09 02:29:37,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:37,998 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:29:37,998 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] ()
2025-04-09 02:29:38,003 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:38,403 - aiogram.event - INFO - Update id=311268371 is handled. Duration 520 ms by bot id=7041366449
2025-04-09 02:29:42,087 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:42,089 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:29:42,089 - sqlalchemy.engine.Engine - INFO - [generated in 0.00094s] ('Цифровые товары',)
2025-04-09 02:29:42,094 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:42,184 - aiogram.event - INFO - Update id=311268372 is handled. Duration 105 ms by bot id=7041366449
2025-04-09 02:29:43,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,112 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:43,113 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (94,)
2025-04-09 02:29:43,117 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,227 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:43,228 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (1,)
2025-04-09 02:29:43,231 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:43,231 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1,)
2025-04-09 02:29:43,233 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,235 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 133 ms by bot id=7041366449
2025-04-09 02:29:43,236 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:43,651 - sqlalchemy.engine.Engine - INFO - [cached since 0.5391s ago] (94,)
2025-04-09 02:29:43,652 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,771 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:43,772 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:43,773 - sqlalchemy.engine.Engine - INFO - [cached since 0.5457s ago] (1,)
2025-04-09 02:29:43,776 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:43,777 - sqlalchemy.engine.Engine - INFO - [cached since 0.546s ago] (1,)
2025-04-09 02:29:43,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:43,784 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 135 ms by bot id=7041366449
2025-04-09 02:29:43,785 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:46,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:46,287 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:46,287 - sqlalchemy.engine.Engine - INFO - [cached since 3.175s ago] (94,)
2025-04-09 02:29:46,289 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:46,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:46,395 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:46,396 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] (1,)
2025-04-09 02:29:46,399 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:46,400 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] (1,)
2025-04-09 02:29:46,402 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:46,403 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 125 ms by bot id=7041366449
2025-04-09 02:29:46,404 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:50,794 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:50,795 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:50,796 - sqlalchemy.engine.Engine - INFO - [cached since 7.683s ago] (94,)
2025-04-09 02:29:50,798 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:50,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:50,884 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:50,884 - sqlalchemy.engine.Engine - INFO - [cached since 7.657s ago] (1,)
2025-04-09 02:29:50,887 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:50,888 - sqlalchemy.engine.Engine - INFO - [cached since 7.657s ago] (1,)
2025-04-09 02:29:50,890 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:50,893 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 109 ms by bot id=7041366449
2025-04-09 02:29:50,893 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:29:59,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:59,383 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:29:59,384 - sqlalchemy.engine.Engine - INFO - [cached since 16.27s ago] (94,)
2025-04-09 02:29:59,384 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:29:59,488 - sqlalchemy.engine.Engine - INFO - [cached since 16.26s ago] (1,)
2025-04-09 02:29:59,490 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:29:59,491 - sqlalchemy.engine.Engine - INFO - [cached since 16.26s ago] (1,)
2025-04-09 02:29:59,493 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:29:59,495 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 113 ms by bot id=7041366449
2025-04-09 02:29:59,495 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:30:16,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:16,042 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:30:16,043 - sqlalchemy.engine.Engine - INFO - [cached since 32.93s ago] (94,)
2025-04-09 02:30:16,043 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:16,277 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:16,278 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:30:16,279 - sqlalchemy.engine.Engine - INFO - [cached since 33.05s ago] (1,)
2025-04-09 02:30:16,283 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:30:16,284 - sqlalchemy.engine.Engine - INFO - [cached since 33.05s ago] (1,)
2025-04-09 02:30:16,288 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:16,291 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 250 ms by bot id=7041366449
2025-04-09 02:30:16,291 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:30:48,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:48,940 - sqlalchemy.engine.Engine - INFO - 
                SELECT id FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:30:48,941 - sqlalchemy.engine.Engine - INFO - [cached since 65.83s ago] (94,)
2025-04-09 02:30:48,943 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:49,174 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:30:49,176 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:30:49,176 - sqlalchemy.engine.Engine - INFO - [cached since 65.95s ago] (1,)
2025-04-09 02:30:49,178 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:30:49,178 - sqlalchemy.engine.Engine - INFO - [cached since 65.95s ago] (1,)
2025-04-09 02:30:49,180 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:30:49,181 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 251 ms by bot id=7041366449
2025-04-09 02:30:49,181 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:31:12,794 - __main__ - INFO - Stopping application...
2025-04-09 02:31:13,245 - __main__ - INFO - Application stopped
2025-04-09 02:45:35,573 - app - INFO - Starting application...
2025-04-09 02:45:35,573 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:45:35,574 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:45:35,574 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:45:35,951 - __main__ - INFO - Application started successfully
2025-04-09 02:45:35,953 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:45:36,111 - aiogram.event - INFO - Update id=311268373 is not handled. Duration 13 ms by bot id=7041366449
2025-04-09 02:45:40,180 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:45:40,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,181 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:45:40,181 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,182 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:45:40,182 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:45:40,183 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:40,183 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:45:40,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:45:40,185 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:40,540 - aiogram.event - INFO - Update id=311268374 is handled. Duration 390 ms by bot id=7041366449
2025-04-09 02:45:42,333 - aiogram.event - INFO - Update id=311268375 is handled. Duration 207 ms by bot id=7041366449
2025-04-09 02:45:43,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:43,373 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:45:43,374 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] ()
2025-04-09 02:45:43,379 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:43,480 - aiogram.event - INFO - Update id=311268376 is handled. Duration 189 ms by bot id=7041366449
2025-04-09 02:45:46,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:46,440 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:45:46,441 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ('Цифровые товары',)
2025-04-09 02:45:46,446 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:46,538 - aiogram.event - INFO - Update id=311268377 is handled. Duration 106 ms by bot id=7041366449
2025-04-09 02:45:47,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,429 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:47,466 - sqlalchemy.engine.Engine - INFO - [generated in 0.03672s] (94,)
2025-04-09 02:45:47,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:47,561 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-04-09 02:45:47,563 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:47,563 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1,)
2025-04-09 02:45:47,564 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 143 ms by bot id=7041366449
2025-04-09 02:45:47,565 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:47,944 - sqlalchemy.engine.Engine - INFO - [cached since 0.5152s ago] (94,)
2025-04-09 02:45:47,946 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:48,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:48,043 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:48,044 - sqlalchemy.engine.Engine - INFO - [cached since 0.4827s ago] (1,)
2025-04-09 02:45:48,052 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:48,053 - sqlalchemy.engine.Engine - INFO - [cached since 0.4901s ago] (1,)
2025-04-09 02:45:48,060 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 183 ms by bot id=7041366449
2025-04-09 02:45:48,061 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:50,444 - sqlalchemy.engine.Engine - INFO - [cached since 3.015s ago] (94,)
2025-04-09 02:45:50,446 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:50,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:50,549 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:50,549 - sqlalchemy.engine.Engine - INFO - [cached since 2.989s ago] (1,)
2025-04-09 02:45:50,556 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:50,556 - sqlalchemy.engine.Engine - INFO - [cached since 2.993s ago] (1,)
2025-04-09 02:45:50,559 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 186 ms by bot id=7041366449
2025-04-09 02:45:50,559 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:45:54,908 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a6a5198b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,910 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca4e0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,912 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bcac60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:45:54,917 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:54,918 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:45:54,918 - sqlalchemy.engine.Engine - INFO - [cached since 7.489s ago] (94,)
2025-04-09 02:45:54,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:45:55,093 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:45:55,094 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:45:55,094 - sqlalchemy.engine.Engine - INFO - [cached since 7.533s ago] (1,)
2025-04-09 02:45:55,102 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:45:55,102 - sqlalchemy.engine.Engine - INFO - [cached since 7.539s ago] (1,)
2025-04-09 02:45:55,107 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 242 ms by bot id=7041366449
2025-04-09 02:45:55,107 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:46:04,589 - sqlalchemy.engine.Engine - INFO - [cached since 17.16s ago] (94,)
2025-04-09 02:46:04,591 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:46:04,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:46:04,753 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:46:04,753 - sqlalchemy.engine.Engine - INFO - [cached since 17.19s ago] (1,)
2025-04-09 02:46:04,756 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:46:04,756 - sqlalchemy.engine.Engine - INFO - [cached since 17.19s ago] (1,)
2025-04-09 02:46:04,759 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 234 ms by bot id=7041366449
2025-04-09 02:46:04,759 - __main__ - ERROR - Error processing webhook: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-04-09 02:46:15,488 - __main__ - INFO - Stopping application...
2025-04-09 02:46:15,812 - __main__ - INFO - Application stopped
2025-04-09 02:46:15,955 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca210>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:46:15,970 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67bca210>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:46:15,970 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67a38aa0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:46:15,972 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x705a67a38aa0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:28,802 - app - INFO - Starting application...
2025-04-09 02:47:28,802 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:47:28,802 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:47:28,802 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:47:29,230 - __main__ - INFO - Application started successfully
2025-04-09 02:47:29,232 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:47:29,564 - aiogram.event - INFO - Update id=311268378 is not handled. Duration 3 ms by bot id=7041366449
2025-04-09 02:47:30,124 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:47:30,124 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,125 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:47:30,125 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,126 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:47:30,126 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:47:30,127 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1043270764,)
2025-04-09 02:47:30,128 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:30,261 - aiogram.event - INFO - Update id=311268379 is handled. Duration 196 ms by bot id=7041366449
2025-04-09 02:47:32,339 - aiogram.event - INFO - Update id=311268380 is handled. Duration 213 ms by bot id=7041366449
2025-04-09 02:47:33,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:33,248 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:47:33,248 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ()
2025-04-09 02:47:33,254 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:33,350 - aiogram.event - INFO - Update id=311268381 is handled. Duration 187 ms by bot id=7041366449
2025-04-09 02:47:39,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:39,051 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:47:39,051 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('Цифровые товары',)
2025-04-09 02:47:39,057 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:39,156 - aiogram.event - INFO - Update id=311268382 is handled. Duration 114 ms by bot id=7041366449
2025-04-09 02:47:40,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:40,687 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:40,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (94,)
2025-04-09 02:47:40,693 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:40,788 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:40,794 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:40,797 - sqlalchemy.engine.Engine - INFO - [generated in 0.00412s] (1,)
2025-04-09 02:47:40,805 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:40,805 - sqlalchemy.engine.Engine - INFO - [generated in 0.00135s] (1,)
2025-04-09 02:47:40,814 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 135 ms by bot id=7041366449
2025-04-09 02:47:40,814 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:41,530 - sqlalchemy.engine.Engine - INFO - [cached since 0.843s ago] (94,)
2025-04-09 02:47:41,531 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:41,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:41,620 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:41,620 - sqlalchemy.engine.Engine - INFO - [cached since 0.827s ago] (1,)
2025-04-09 02:47:41,628 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:41,628 - sqlalchemy.engine.Engine - INFO - [cached since 0.8243s ago] (1,)
2025-04-09 02:47:41,635 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 169 ms by bot id=7041366449
2025-04-09 02:47:41,635 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:44,064 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:44,065 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:44,065 - sqlalchemy.engine.Engine - INFO - [cached since 3.379s ago] (94,)
2025-04-09 02:47:44,069 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:44,162 - sqlalchemy.engine.Engine - INFO - [cached since 3.369s ago] (1,)
2025-04-09 02:47:44,167 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:44,168 - sqlalchemy.engine.Engine - INFO - [cached since 3.364s ago] (1,)
2025-04-09 02:47:44,172 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 171 ms by bot id=7041366449
2025-04-09 02:47:44,173 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:48,482 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb368d8b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,482 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba27b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,483 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba2f30>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:48,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:48,516 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:48,516 - sqlalchemy.engine.Engine - INFO - [cached since 7.829s ago] (94,)
2025-04-09 02:47:48,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:48,644 - sqlalchemy.engine.Engine - INFO - [cached since 7.851s ago] (1,)
2025-04-09 02:47:48,647 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:48,647 - sqlalchemy.engine.Engine - INFO - [cached since 7.843s ago] (1,)
2025-04-09 02:47:48,649 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 170 ms by bot id=7041366449
2025-04-09 02:47:48,649 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:57,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:57,186 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:47:57,186 - sqlalchemy.engine.Engine - INFO - [cached since 16.5s ago] (94,)
2025-04-09 02:47:57,190 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:47:57,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:47:57,414 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:47:57,415 - sqlalchemy.engine.Engine - INFO - [cached since 16.62s ago] (1,)
2025-04-09 02:47:57,424 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:47:57,424 - sqlalchemy.engine.Engine - INFO - [cached since 16.62s ago] (1,)
2025-04-09 02:47:57,431 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 356 ms by bot id=7041366449
2025-04-09 02:47:57,431 - __main__ - ERROR - Error processing webhook: No module named 'aiogram.fs'
2025-04-09 02:47:58,808 - __main__ - INFO - Stopping application...
2025-04-09 02:47:59,129 - __main__ - INFO - Application stopped
2025-04-09 02:47:59,272 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba3b60>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:47:59,279 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0ba3b60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:47:59,280 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0bf0e60>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:47:59,283 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x785bb0bf0e60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-04-09 02:48:56,774 - app - INFO - Starting application...
2025-04-09 02:48:56,774 - app.services.database - INFO - RECREATE_DB_SCHEMA = False, пропускаем инициализацию базы данных
2025-04-09 02:48:56,774 - __main__ - INFO - Action config initialized successfully
2025-04-09 02:48:56,774 - __main__ - INFO - Setting webhook at: https://5a43-46-8-230-15.ngrok-free.app/webhook
2025-04-09 02:48:57,154 - __main__ - INFO - Application started successfully
2025-04-09 02:48:57,155 - hypercorn.error - INFO - Running on http://0.0.0.0:8000 (CTRL + C to quit)
2025-04-09 02:48:57,314 - aiogram.event - INFO - Update id=311268383 is not handled. Duration 13 ms by bot id=7041366449
2025-04-09 02:49:00,720 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-04-09 02:49:00,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,722 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-04-09 02:49:00,722 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,723 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-04-09 02:49:00,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - SELECT 1 FROM users WHERE tg_id = $1 LIMIT 1
2025-04-09 02:49:00,724 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1043270764,)
2025-04-09 02:49:00,725 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:00,837 - aiogram.event - INFO - Update id=311268384 is handled. Duration 182 ms by bot id=7041366449
2025-04-09 02:49:04,227 - aiogram.event - INFO - Update id=311268385 is handled. Duration 193 ms by bot id=7041366449
2025-04-09 02:49:08,002 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:08,003 - sqlalchemy.engine.Engine - INFO - 
            SELECT name
            FROM main_categories
            ORDER BY name
        
2025-04-09 02:49:08,003 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-04-09 02:49:08,005 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:08,092 - aiogram.event - INFO - Update id=311268386 is handled. Duration 166 ms by bot id=7041366449
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - 
            SELECT id, name
            FROM categories
            WHERE main_category_name = $1
            ORDER BY name
        
2025-04-09 02:49:11,353 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('Цифровые товары',)
2025-04-09 02:49:11,355 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:11,441 - aiogram.event - INFO - Update id=311268387 is handled. Duration 90 ms by bot id=7041366449
2025-04-09 02:49:12,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:12,335 - sqlalchemy.engine.Engine - INFO - 
                SELECT * FROM suppliers 
                WHERE category_id = $1 AND status = 'pending'
                ORDER BY created_at DESC
            
2025-04-09 02:49:12,336 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] (94,)
2025-04-09 02:49:12,340 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-04-09 02:49:12,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-04-09 02:49:12,429 - sqlalchemy.engine.Engine - INFO - 
                SELECT 
                    s.id, s.company_name, s.product_name, s.category_id, 
                    s.description, s.country, s.region, s.city, s.address,
                    s.contact_username, s.contact_phone, s.contact_email,
                    s.created_at, s.status, s.created_by_id, s.tarrif,
                    c.name as category_name, mc.name as main_category_name
                FROM suppliers s
                LEFT JOIN categories c ON s.category_id = c.id
                LEFT JOIN main_categories mc ON c.main_category_name = mc.name
                WHERE s.id = $1
            
2025-04-09 02:49:12,430 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-04-09 02:49:12,437 - sqlalchemy.engine.Engine - INFO - 
                SELECT id, type, file_path, name, uploaded_at
                FROM files
                WHERE supplier_id = $1
                ORDER BY type, uploaded_at
            
2025-04-09 02:49:12,437 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (1,)
2025-04-09 02:49:12,525 - aiogram.event - INFO - Update id=311268388 is handled. Duration 198 ms by bot id=7041366449
2025-04-09 02:49:18,935 - root - ERROR - Ошибка при редактировании сообщения: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-09 02:49:19,023 - aiogram.event - INFO - Update id=311268389 is handled. Duration 240 ms by bot id=7041366449
2025-04-09 02:49:20,664 - root - ERROR - Ошибка при редактировании сообщения: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-04-09 02:49:20,750 - aiogram.event - INFO - Update id=311268390 is handled. Duration 259 ms by bot id=7041366449
2025-04-09 02:49:37,544 - __main__ - INFO - Stopping application...
2025-04-09 02:49:38,258 - __main__ - INFO - Application stopped
2025-04-09 02:49:38,378 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e2d8f6b58b0>>
Traceback (most recent call last):
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
    dbapi_connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 922, in terminate
    self._connection.terminate()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
    ~~~~~~~~~~~^^
  File "/home/egor/projects/SupplyMatchBot/venv/lib/python3.13/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
    ~~~~~~~~~~~~~~~~~~~~^^
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 826, in abort
    self._force_close(None)
    ~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/selector_events.py", line 898, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-04-09 02:49:38,382 - sqlalchemy.pool.impl.AsyncAdaptedQueuePool - ERROR - The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7e2d8f6b58b0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
